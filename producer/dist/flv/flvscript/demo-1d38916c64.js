"use strict";var proversion,signalingUrl,studioRList,studioBehavior,facebookCheckInDistance,tokenSuffix,compressDir,compressString,usrRole,domainAddress,isPermission,currentVersion,userManage,userRecord,serRolePerm,userRoleList,tvuccUrl,isHttpsPageFlag,sessionId,userRolePerm,orderStatus,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jsVersion="build 1.0.176",studioTimer=null,pageWebsocketObj=null,volumesPageRequest=null,volumeControlObj=null,pageRequestObj=null,resetPage=null,isrestoreHistory=isHttpsPageFlag=!1;function getCheckConfig(c){var e=document.location.search;if(null!=e&&0<e.indexOf("session=")){var t=e.indexOf("session=");sessionId=e.substring(t+"session=".length)}var o="checkConfig?session="+sessionId;$.ajax({type:"POST",url:o,async:!1,success:function(e){e=JSON.parse(e),proversion=e.buildversion,signalingUrl=e.signalingUrl,studioRList=e.studioRList,studioBehavior=e.userBehavior,facebookCheckInDistance=e.facebookCheckInDistance,tokenSuffix=e.tokenSuffix,compressDir=e.compressDir,compressString=e.compressString,domainAddress=e.domainAddress,isPermission=e.isPermission,usrRole=e.USER_NAME.role,userRoleList=e.USER_NAME.userRoleList,(userRolePerm={}).userId=e.USER_NAME.id,userManage=e.userManage,userRecord=e.userRecord,tvuccUrl=e.tvuccUrl,sessionId=e.session,orderStatus=e.orderStatus;var t=e.activeInstance,o=e.rversion,i="ui:"+jsVersion+"\nService:"+proversion+"\nLinuxR:"+o,r=e.USER_NAME.email;if($("#userBehavior").val(studioBehavior),localStorage.setItem("userEmial",r),$("#user_info_name").text(r),$("#user_info_name").attr("title",r),$("#website_title_text").attr("title",i),window.serviceList={userseviceUrl:userManage},userRoleList){userRoleList=JSON.parse(userRoleList);for(var a=0;a<userRoleList.length;a++)userRolePerm[userRoleList[a].feature]=userRoleList[a].value}if(null!=userRecord&&""!=userRecord&&null!=userRecord||(userRecord=0),-1==t)$(".switch-instance").html(switchLangObj.i18n_openInstance),$(".studio_operate .studio-box").animate({left:"0px"}),$(".studio_operate .studio-box").removeClass("active"),null!==resetPage&&resetPage(),$.ajax({type:"GET",url:"studio_open",timeout:6e4,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode?3==e.result?getCheckConfig():getProgress(0):"0x80100016"==e.errorCode?oUtils.alertTips("i18n_systemOverload"):"0x80100015"==e.errorCode?oUtils.alertTips("i18n_producerNotArea"):"0x80100003"==e.errorCode?oUtils.alertTips("i18n_systemMaintained"):"0x80100019"==e.errorCode&&($(".purchase-loading").css("display","block"),$(".purchase-alert").css("display","block"))}});else if(3!==t)getProgress(t);else{$(".switch-instance").html(switchLangObj.i18n_closeInstance),$(".progress .progress-status").html("3/3"),$(".progress .meter .compelete").css("width","100%"),$(".studio_operate .studio-box").animate({left:"11px"}),$(".studio_operate .studio-box").addClass("active"),$(".progress").css("display","none"),$(".remaining").css("display","block"),$(".main-cut").css("margin-top","0.8rem"),countdownTime(userRecord);var s=JSON.parse(decodeURIComponent(studioBehavior)).OverlaySync;null!=s&&2!=s&&($("#bgFilter").css("display","block"),$(".recover_history").css("display","block")),getStudioRestore()}c&&c(e)}})}function getProgress(e){if(0==e||1==e)$(".studio_operate .studio-box").animate({left:"11px"}),$(".studio_operate .studio-box").addClass("active"),$(".switch-instance").html(switchLangObj.i18n_closeInstance),0==e&&($(".progress").css("display","block"),$(".remaining").css("display","none"),$(".main-cut").css("margin-top","0.2rem"),$(".progress .progress-status").html("1/3"),$(".progress .meter .compelete").css("width","33%")),1==e&&($(".progress").css("display","block"),$(".remaining").css("display","none"),$(".main-cut").css("margin-top","0.2rem"),$(".progress .progress-status").html("2/3"),$(".progress .meter .compelete").css("width","66%"));else if(3==e){if($(".switch-instance").html(switchLangObj.i18n_closeInstance),$(".progress .progress-status").html("3/3"),$(".progress .meter .compelete").css("width","100%"),$(".studio_operate .studio-box").animate({left:"0.11rem"}),$(".studio_operate .studio-box").addClass("active"),null!=pageWebsocketObj.socket)return;getCheckConfig(function(){$(".progress").css("display","none"),$(".main-cut").css("margin-top","0.8rem"),$(".remaining").css("display","block"),resetPage(),initStudioRList()})}}function goMainUrl(e,t){var o=sessionId;return t||window.open(tvuccUrl+"/index.action?pn="+e+"&session="+o,"_self"),!1}!function(){var e=window.localStorage.getItem("currentVersion");if(e&&e==currentVersion&&(i18n_cacheFlag=!0),window.localStorage.setItem("currentVersion",currentVersion),window.ActiveXObject||"ActiveXObject"in window)return $(".isChrome").css("display","block");getCheckConfig()}();var setcountdown="";function countdownTime(e){var t=e;clearInterval(setcountdown),setcountdown=setInterval(function(){if(0==t)clearInterval(setcountdown);else{var e=transTimeByms(--t);$(".remaining div").html(e),300==t&&$(".purchase-promptbox").fadeIn("slow"),290==t&&$(".purchase-promptbox").fadeOut("slow")}},1e3)}function transTimeByms(e){var t=Math.floor(e/3600),o=Math.floor(e/60%60),i=Math.floor(e%60%60);return(t=t<=9?"0"+t:t)+":"+(o=o<=9?"0"+o:o)+":"+(i=i<=9?"0"+i:i)}function getStudioRestore(){var e=JSON.parse(decodeURIComponent(studioBehavior)),t={rid:e=e.SelectR.peerId};$.ajax({type:"GET",url:"studio_restore",timeout:3e5,data:t,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode?"2"==e.result?($("#bgFilter").css("display","none"),$(".recover_history").css("display","none"),isrestoreHistory=!0):($("#bgFilter").css("display","block"),$(".recover_history").css("display","block"),getStudioRestore()):($("#bgFilter").css("display","block"),$(".recover_history").css("display","block"),getStudioRestore())}})}var overlayObj=function(b,s,o){var c={logoInit:function(o,e){var t=JSON.stringify(o);t=encodeURIComponent(t);var i=!0;e||b(".pretreat-content .logo").each(function(e,t){b(t).attr("data-id")!=o.id||(i=!1)});if(i){var r,a;if(null==o.imageWidth||""==o.imageWidth){var s=o.size.split("x");o.imageWidth=s[0],o.imageHeight=s[1];var c=o.imageHeight/o.imageWidth;o.imageWidth=needEven(o.imageWidth),o.imageHeight=Math.round(o.imageWidth*c)}var n="",l="";1<=o.checkedStatus?(n="border:1px solid #41FF6D;",l="check"):(n="border:border: 1px solid #444;",l=""),r=widthAndHeight.getPriviewWidth(null,240,o.imageWidth),a=widthAndHeight.getPriviewHeight(null,135,o.imageHeight);var d=widthAndHeight.getPriviewHeight(null,135,o.logoYOffset),p=widthAndHeight.getPriviewWidth(null,240,o.logoXOffset);r<30&&(a=30*a/r,r=30),a<30&&(r=30*r/a,a=30),240-r<p&&(p=240-r),135-a<d&&(d=135-a);var v='<li class="pretreat-item-logo pretreat-content-item logo '+l+" logo"+o.id+'" data-id="'+o.id+'" data-params="'+t+'" data-imageWidth="'+o.imageWidth+'" data-imageHeight="'+o.imageHeight+'" data-logoYOffset="'+o.logoYOffset+'"  data-logoXOffset="'+o.logoXOffset+'" data-url="'+o.url+'" style="'+n+'"><div class="logo-img" style="width:'+r+"px;height:"+a+"px;right:"+p+"px;top:"+d+'px;"><img src="'+o.url+'" style="width:100%;height:100%;" /></div></li>';0!=b(".pretreat-content.show-logo .logo"+o.id).length?b(".pretreat-content.show-logo .logo"+o.id).replaceWith(v):b(".sd-pretreat-container .pretreat-content.show-logo").append(v)}},textInit:function(e,t){var o=JSON.stringify(e);o=encodeURIComponent(o);var i=!0;if(!t){b(".pretreat-content .text");if(b(".text").attr("data-id")==e.id)return void(i=!1)}if(i){var r=e.style;"object"!=(void 0===r?"undefined":_typeof(r))&&(0==r.indexOf('"')&&(r=r.substring(1,r.length-1)),r=JSON.parse(r));r.backgroundColor;var a=r.backgroundColor.slice(2,8),s=r.backgroundColor.slice(0,2),c=HexToRgba(a,s),n=r.foregroundColor.slice(2,8),l="",d="";e.checked?(l="border:1px solid #41FF6D;",d="check"):(l="border:border: 1px solid #444;",d="");var p=widthAndHeight.getPriviewHeight(null,135,e.yOffset),v=widthAndHeight.getPriviewWidth(null,240,e.xOffset),u=widthAndHeight.getPriviewWidth(null,240,r.fontSize),h='<li class="pretreat-item-text pretreat-content-item text  '+d+" text"+e.id+'" data-params="'+o+'" data-textYOffset="'+e.yOffset+'" data-id="'+e.id+'"  style=" overflow：hidden; '+l+' "><div class="text-img"  data-deleteFlag="'+e.deleteFlag+'"  style="white-space: pre;text-overflow: ellipsis; font-size:'+u+"px; top:"+p+"px; right:"+v+"px; background-color:"+c+";color:#"+n+";font-family:"+r.fontName+';">'+e.text+"</div></li>";0!=b(".pretreat-content.show-text  .text"+e.id).length?b(".pretreat-content.show-text  .text"+e.id).replaceWith(h):b(".sd-pretreat-container .pretreat-content.show-text").append(h)}},scoreInit:function(o,e,t){var i=JSON.stringify(o);i=encodeURIComponent(i);var r=!0;e||b(".pretreat-content .pretreat-item-score").each(function(e,t){b(t).attr("data-id")!=o.id||(r=!1)});if(r){var a,s;if(null==o.imageWidth||""==o.imageWidth){var c=o.size.split("x");o.imageWidth=c[0],o.imageHeight=c[1]}a=widthAndHeight.getPriviewWidth(null,240,o.imageWidth),s=widthAndHeight.getPriviewHeight(null,135,o.imageHeight);"border:border: 1px solid #444;","";for(var n=widthAndHeight.getPriviewHeight(null,135,o.logoYOffset),l=widthAndHeight.getPriviewWidth(null,240,o.logoXOffset),d='<li class="pretreat-item-score pretreat-content-item score  score'+o.id+'" data-params="'+i+'" data-id="'+o.id+'" data-size="'+o.size+'"  style="border:border: 1px solid #444;"><div class=" score-img score'+o.id+'" data-scoreBord=1 data-imageWidth="'+o.imageWidth+'" data-imageHeight="'+o.imageHeight+'"data-logoYOffset="'+o.logoYOffset+'"  data-logoXOffset="'+o.logoXOffset+'"data-id="'+o.id+'" style="width:'+a+"px;height:"+s+"px;top:"+n+"px;right:"+l+'px"><img src="'+o.url+'" alt="" style="position:relative;width:100%;height:100%;">',p=o.subtitles,v=0;v<p.length;v++){var u=p[v].style;"object"!=(void 0===u?"undefined":_typeof(u))&&(0==u.indexOf('"')&&(u=u.substring(1,u.length-1)),u=JSON.parse(u));var h=u.fontSize;h=widthAndHeight.getPriviewHeight(null,240,h);var g=p[v].yOffset-o.logoYOffset;g=widthAndHeight.getPriviewHeight(null,135,g);var m=p[v].xOffset-o.logoXOffset,f=(m=widthAndHeight.getPriviewWidth(null,240,m),p[v].width);f=widthAndHeight.getPriviewWidth(null,240,f);var k=p[v].height;k=widthAndHeight.getPriviewHeight(null,135,k),d+='<input type="text" class="scoreText text'+(v+1)+'" data-zorder=3 value="'+p[v].text+'" data-scoreTextId="'+p[v].id+'"  data-bind-'+(v+1)+'="name" style="height:'+k+"px; position:absolute; width:"+f+"px; text-align: center; background-color:transparent; right:"+m+"px; top:"+g+"px; font-size:"+h+"px;color:#"+u.foregroundColor.slice(2,8)+';" disabled="disabled">'}d+="</div></li>",0!=b(".pretreat-content.show-score  .pretreat-item-score").length?b(".pretreat-content.show-score  .pretreat-item-score").replaceWith(d):b(".sd-pretreat-container .pretreat-content.show-score").append(d),1==t?b(".pretreat-content.show-score  .pretreat-item-score").trigger("click"):(b(".pretreat-content.show-score  .pretreat-item-score").css({border:"1px solid rgb(65, 255, 109)"}),b(".pretreat-content.show-score  .pretreat-item-score").addClass("check"))}},clockInit:function(e,t){var o=JSON.stringify(e);o=encodeURIComponent(o);var i=!0;if(!t){b(".pretreat-content .clock");if(b(".clock").attr("data-id")==e.id)return void(i=!1)}if(i){var r=e.style;"object"!=(void 0===r?"undefined":_typeof(r))&&(0==r.indexOf('"')&&(r=r.substring(1,r.length-1)),r=JSON.parse(r));var a=r.foregroundColor.slice(2,8),s="",c="";e.checked?(s="border:1px solid #41FF6D;",c="check"):(s="border:border: 1px solid #444;",c="");var n=widthAndHeight.getPriviewHeight(null,135,e.yOffset),l=widthAndHeight.getPriviewWidth(null,240,e.xOffset),d=widthAndHeight.getPriviewWidth(null,240,r.fontSize),p=e.timestamp,v=r.text,u=v.split(":"),h=60*parseInt(u[0]),g=parseInt(u[1]),m=parseInt(h+g),f=webflv.playObj[b(".main-preview .main-player").attr("id")].player,k=Math.round(1e3*f._mediaElement.currentTime)+f._muxer.dtsBase;if(-1==k)return void console.log("Cannot get timecode from flv player.overlay");var w="";if("start"!=e.operation)w=v;else if(null!=p)w=TimeByms(parseInt((k-p)/1e3)+m);else w=v;var C='<li class="pretreat-item-clock pretreat-content-item clock '+c+" clock"+e.id+'" data-params="'+o+'" data-textYOffset="'+e.yOffset+'" data-id="'+e.id+'"  style=" overflow：hidden; '+s+' "><div class="clock-img"  data-deleteFlag="'+e.deleteFlag+'"  style="font-size:'+d+"px; top:"+n+"px; right:"+l+"px;background-color:#212740; color:#"+a+";font-family:"+r.fontName+'; position:absolute;">'+w+"</div></li>";0!=b(".pretreat-content.show-clock  .clock").length?b(".pretreat-content.show-clock  .clock").replaceWith(C):b(".sd-pretreat-container .pretreat-content.show-clock").append(C)}},delLogo:function(e){var t=b(e).attr("data-id"),o={peerId:b(".main-rList .rList-show").attr("data-peerId"),fileId:t,module:"1"};s.ajaxReq("logo_delete",o,function(){b(".preview-source .logo"+t).remove(),b(".pretreat-content .logo"+t).remove()})},delScore:function(e){var t=b(e).attr("data-id"),o={peerId:b(".main-rList .rList-show").attr("data-peerId"),fileId:t,module:"1"};s.ajaxReq("logo_delete",o,function(e){"0x0"==e.errorCode?(b(".pretreat-content .score"+t).remove(),b(".preview-source  .score"+t).remove()):"0x80100003"==e.errorCode&&s.alertTips("i18n_requestTimeOut")})},delPip:function(e){var t={id:b(e).attr("data-id")};s.ajaxReq("studio_delete",t,function(e){"0x0"==e.errorCode?(b(".preview-source .pip").remove(),b(".pretreat-content .pip").remove(),b(".pip-picture").removeClass("created"),b(".pip-in .voice").removeClass("icon-voice").addClass("icon-novoice"),b(".pip-out .voice").removeClass("icon-novoice").addClass("icon-voice"),b(".pip-in-sel p").html("1"),b(".show-pip .pretreat-content-add").removeClass("hide")):s.alertTips(e.errorInfo,1500)})},delText:function(e){var t=b(".rList-show").attr("data-peerId"),o=b(e).attr("data-id"),i={peerId:t,textId:o};s.ajaxReq("subtitle_delete",i,function(){b(".preview-source .textDiv").remove(),b(".pretreat-content .text"+o).remove(),b(".show-text .pretreat-content-add").removeClass("hide")})},delClock:function(e){var t=b(".rList-show").attr("data-peerId"),o=b(e).attr("data-id"),i={peerId:t,id:o};s.ajaxReq("clock_delete",i,function(){clearInterval(clockObj.setClockTimer),b(".preview-source .clockDiv").remove(),b(".pretreat-content .clock"+o).remove(),b(".clockInput").removeAttr("disabled"),b(".show-clock .pretreat-content-add").removeClass("hide"),b(".clockStart").hasClass("hide")&&(b(".clockStop").addClass("hide"),b(".clockStart").removeClass("hide")),b(".TimeSet input").val(0),saveClockuserBehavior("stop","pvw")})},pipInit:function(e){var t="",o="";0!=e.checked?(t="border:1px solid #41FF6D;",o="check"):(t="border: 1px solid #444;",o="");var i;i='<li class="pip pretreat-item-logo pretreat-content-item '+o+'" data-pipXOffset="'+e.pipXOffset+'" data-id="'+e.id+'" data-pipHeight="'+e.pipHeight+'" data-pipVideoSharedMemoryName="'+e.pipVideoSharedMemoryName+'" data-pipWidth="'+e.pipWidth+'" data-pipYOffset="'+e.pipYOffset+'" data-pipAudioSharedMemoryName="'+e.pipAudioSharedMemoryName+'" data-audiostatus="'+e.audioStatus+'" style="'+t+'" > </li>',b("#preview .pip").attr("data-id",e.id),0!=b(".pretreat-content.show-pip .pip").length?b(".pretreat-content.show-pip .pip").replaceWith(i):b(".sd-pretreat-container .pretreat-content.show-pip").append(i)},pipEidtInit:function(){var i=b(".main-preview").attr("data-filename"),r=b(".pretreat-content .pip").attr("data-audiostatus"),a=b(".pretreat-content .pip").attr("data-pipvideosharedmemoryname"),s=b(".pretreat-content .pip").attr("data-pipaudiosharedmemoryname");-1==r&&(b(".pip-in .voice").removeClass("icon-voice").addClass("icon-novoice"),b(".pip-out .voice").removeClass("icon-voice").addClass("icon-novoice")),1==r&&(b(".pip-in .voice").removeClass("icon-novoice").addClass("icon-voice"),b(".pip-out .voice").removeClass("icon-novoice").addClass("icon-voice")),b(".preview-content li").each(function(e,t){var o=b(t).attr("data-filename");a==o&&b(".pip-in-sel p").html(e+1),i==o&&b(".pip-out-sel p").html(e+1),0==r&&s==o&&(s==i?(b(".pip-in .voice").removeClass("icon-voice").addClass("icon-novoice"),b(".pip-out .voice").removeClass("icon-novoice").addClass("icon-voice")):(b(".pip-in .voice").removeClass("icon-novoice").addClass("icon-voice"),b(".pip-out .voice").removeClass("icon-voice").addClass("icon-novoice")))})}};return b(".overlay-tab .operation-btns").on("click",".op-label",function(){var e=b(this);if(e.addClass("active").siblings().removeClass("active"),b(".operation-show").addClass("hide"),b(".clip-dot").css("display","none"),b(".preview-source .clip").remove(),b(".sd-pretreat .sd-pretreat-operation").removeClass("active"),b(".sd-pretreat-container .pretreat-content").addClass("hide"),clipDot.changeVideoCut(!0),e.hasClass("operation-text"))b(".sd-pretreat-container .pretreat-content.show-text").removeClass("hide"),0<b(".pretreat-content").find(".pretreat-item-text").length&&b(".show-text .pretreat-content-add").addClass("hide");else if(e.hasClass("operation-logo"))b(".sd-pretreat-container .pretreat-content.show-logo").removeClass("hide");else if(e.hasClass("operation-score"))b(".sd-pretreat-container .pretreat-content.show-score").removeClass("hide");else if(e.hasClass("operation-pip"))b(".sd-pretreat-container .pretreat-content.show-pip").removeClass("hide"),0<b(".sd-pretreat-container .pretreat-content.show-pip").find(".pip").length&&b(".show-pip .pretreat-content-add").addClass("hide");else if(e.hasClass("operation-clock")){if(b(".sd-pretreat-container .pretreat-content.show-clock").removeClass("hide"),0<b(".sd-pretreat-container .pretreat-content.show-clock").find(".clock").length)return void b(".show-clock .pretreat-content-add").addClass("hide")}else e.hasClass("operation-clip")&&b(".sd-pretreat-container .pretreat-content.show-clipvideo").removeClass("hide")}),b(".pretreat-content").on("mouseenter",".pretreat-content-item",function(){var e=b(this);e.append('<i class="icon-colse iconfont close"></i>'),(e.hasClass("pip")||e.hasClass("score"))&&e.append('<i class="icon-edit iconfont edit"></i>')}),b(".sd-pretreat").on("keyup","input",function(){return!1}),b(".sd-pretreat").on("change",".operation-uploadLogo",function(){var r=b("#file_p").val(),e=document.getElementById("file_p"),a=new Image;a.onload=function(){var e=b(".main-preview").attr("data-logomaxh")-0,t=b(".main-preview").attr("data-logomaxw")-0;if(a.height>e||a.width>t)return fn_switchLangAlertTip("Only allow to upload pictures below "+t+"x"+e+" wide","只允许上传"+t+"x"+e+"以下的图片"),void b("#file_p").val("");if(!r.match(/.png$/i)&&!r.match(/.gif$/i))return s.alertTips("i18n_LogoFormatProducer"),void b("#file_p").val("");var o=a.width+"x"+a.height,i=new FormData;i.append("peerId",b(".rList-show").attr("data-peerid")),i.append("size",o),i.append("module",1),i.append("upload",b("#file_p")[0].files[0]),b(".pretreat-content-add .operation-logo-label").css("display","none"),b(".operation-type-btns .operation-type-btn.operation-logo").removeClass("hover-bg"),b(".show-logo .addImg").css("display","block"),b.ajax({type:"POST",url:"logo_uploadLogo",data:i,processData:!1,contentType:!1,success:function(e){if(e=JSON.parse(e),b("#file_p").val(""),"0x0"==e.errorCode){var t=e.result;c.logoInit(t),overToPreview.logoInit(t)}"0x3"==e.errorCode?s.alertTips("i18n_logoHavedUpload"):"0x4"==e.errorCode?s.alertTips("i18n_producerPro_uploadLogoSize",2e3):"0x80100003"==e.errorCode&&s.alertTips("i18n_uploadLogoFail"),b(".show-logo .operation-logo-label").css("display","block"),b(".operation-type-btns .operation-type-btn.operation-logo").addClass("hover-bg"),b(".show-logo .addImg").css("display","none")},error:function(e){s.alertTips("i18n_uploadLogoFail"),b("#file_p").val(""),b("#loading-Bg").fadeOut(),b(".operation-type-btns .operation-type-btn .operation-logo-label").css("display","inline-block"),b(".operation-type-btns .operation-type-btn.operation-logo").addClass("hover-bg"),b(".show-logo .addImg").css("display","none")}})},a.src=window.URL.createObjectURL(e.files[0])}),b(".preview-source").on("click",".logo-box",function(e){e.stopPropagation(),b(".sd-pretreat-container .pretreat-content").addClass("hide"),b(".operation-show").addClass("hide"),b(".operation-logo").addClass("active"),b(".changepoint").remove(),b(".operation-logo").siblings().removeClass("active"),b(".show-logo").removeClass("hide")}),b(".show-text").on("click",".pretreat-content-add",function(){b(".show-text").addClass("hide"),b(".sd-text").removeClass("hide");var e=o.i18n_textValue,t='<div class="textDiv"><div class="preTextarea" onpaste="javascript:return false;" maxlength="128" style=" white-space:pre;text-overflow: ellipsis; background-color:#00000000"  contentEditable>'+e+"</div></i></div>";b("#preview").append(t),b("#sd-textarea").val(e),b(".textDiv").DragAndDrop({scale:!0,scaleClassName:".preTextarea",callback:correctDrag.textBlur}),"zh-CN"==window.navigator.language||"zh"==window.navigator.language?(b("#fontFamily").text("SimHei"),b(".preTextarea").css("font-family","SimHei")):("en-US"==window.navigator.language||window.navigator.language,b("#fontFamily").text("Arial"),b(".preTextarea").css("font-family","Arial")),addText()}),b(".bg-input").spectrum({showAlpha:!0,move:function(e){}}),b(".bg-input").on("move.spectrum",function(e,t){var o=b(".bg-input").siblings(".sp-replacer").find(".sp-preview-inner").css("background-color");0!==b(".preview-source .textDiv").length&&(b(".preview-source .textDiv").css("background-color",o),updateText())}),b(".fontColor").spectrum({move:function(e){}}),b(".fontColor").on("move.spectrum",function(e,t){var o=b(".fontColor").siblings(".sp-replacer").find(".sp-preview-inner").css("background-color");0!==b(".preview-source .preTextarea").length&&(b(".preview-source .preTextarea").css("color",o),updateText())}),b(".show-score").on("click",".pretreat-content-add",function(){b(".show-score").addClass("hide"),b(".sd-score").removeClass("hide")}),b(".score-pattern ").on("click","li",function(e){if(!b(".score-pattern").hasClass("disabled")){if(0<b("#preview .scoreDiv").length&&b("#preview .scoreDiv").attr("data-url")==b(this).find(".operation-view-score").attr("data-url"))return!1;var t=b(this).index();b(this).find(".scoreLoading").removeClass("hide"),createSocre(t),e.stopPropagation()}}),b(".show-pip").on("click",".pretreat-content-add",function(){b(".show-pip").addClass("hide"),b(".sd-pip").removeClass("hide")}),b(".pip-pat .pip-picture").on("click",function(){var e=b(this);if(e.hasClass("created")){if(b(".pretreat-content .pip").hasClass("check"))return;b(".pretreat-content .pip").trigger("click")}else createPipToInit(e)}),b(".pip-in-sel p").on("click",function(e){if(b(".pip-pat .pip-picture").hasClass("created")){for(var t=b(".preview-content .preview-item").length,o="",i=1;i<=t;i++)o+="<li>"+i+"</li>";b(".pip-in-source").html(o),b(".pip-in-source").removeClass("hide"),e.stopPropagation()}}),b(".preview-source").on("click",".pip",function(){c.pipEidtInit(),b(".sd-pip").removeClass("hide"),b(".operation-pip").addClass("active"),b(".operation-pip").siblings().removeClass("active"),b(".sd-pretreat-container .pretreat-content").addClass("hide"),b(".sd-pip").siblings().addClass("hide")}),b(".pip-in-sel").on("click","li",function(){if(b(".pip-picture").hasClass("created")){var e=b(this).html();changePipSource(e)}}),b(".show-clock").on("click",".pretreat-content-add",function(){if(b(".show-clock").addClass("hide"),b(".sd-clock").removeClass("hide"),0==b("#preview").find(".clockDiv").length){b("#preview").append('<div class="clockDiv"><div class="clockTextarea">00:00</div></div>'),b(".clockDiv").DragAndDrop({resize:!1,callback:correctDrag.correctClock}),b(".clockDiv").attr("data-operation","create");var e=b(".defaultTime input").val();""==e?(e=2700,b(".defaultTime input").val(45)):e=parseInt(e),clockObj.clockEndTime=60*parseInt(e)}addClock(clockObj.clockEndTime),saveClockuserBehavior("create","pvw")}),b(".clockInput").keyup(function(e){var t=TimeByms(60*b(".TimeSet input").val());b(".clockTextarea").html(t)}),b(".clockStart").click(function(e){if(b(".clockInput").attr("disabled","disabled"),!(b("#preview").find(".clockDiv").length<1)){b(".clockStart").addClass("hide"),b(".clockStop").removeClass("hide");var t=b(".defaultTime input").val();""==t&&(t=1e4),clockObj.clockEndTime=60*parseInt(t);var o=b(".clockTextarea").html().split(":"),i=60*parseInt(o[0])+parseInt(o[1]);clockObj.clockSeconds=i;var r=checkLocation("location");clearInterval(clockObj.setClockTimer),clockObj.setClockTimer=setInterval(function(){clockObj.clockSeconds++;var e=clockObj.clockSeconds%60,t=parseInt(clockObj.clockSeconds/60);e=e<=9?"0"+e:e,t=t<=9?"0"+t:t,clockObj.clockSeconds>clockObj.clockEndTime?b(".clockDiv").css("background-color","red"):b(".clockDiv").css("background-color","#212740"),b(".clockTextarea").html(t+":"+e),b(".clockDiv").attr("data-time",clockObj.clockSeconds),59940<clockObj.clockSeconds&&(clearInterval(clockObj.setClockTimer),clockObj.clockSeconds=0,b(".clockDiv").attr("data-operation","create"),b(".clockTextarea").html("00:00"),b(".clockStart").removeClass("hide"),b(".clockStop").addClass("hide"),b(".clockDiv").css("background-color","#212740"),b(".clockInput").removeAttr("disabled"),b(".clockInput").val(0),"pgm"==r?(applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"create"),saveClockuserBehavior("start","pvw")))},1e3),""!=r&&("pgm"==r?(b(".clockDiv").attr("data-operation","run"),applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("start","pgm")):(b(".clockDiv").attr("data-operation","start"),updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"start"),saveClockuserBehavior("start","pvw")))}}),b(".clockStop").click(function(e){b(".clockStart").removeClass("hide"),b(".clockStop").addClass("hide"),b(".clockInput").removeAttr("disabled");var t=b(".defaultTime input").val();""==t&&(t=1e4),clockObj.clockEndTime=60*parseInt(t),clearInterval(clockObj.setClockTimer);var o=checkLocation("location");""!=o&&("pgm"==o?(b(".clockDiv").attr("data-operation","pause"),applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(b(".clockDiv").attr("data-operation","create"),updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"pause"),saveClockuserBehavior("stop","pvw")))}),b(".clockReset").click(function(e){b(".clockTextarea").html("00:00"),b(".clockStart").removeClass("hide"),b(".clockStop").addClass("hide"),b(".TimeSet input").val(0),b(".clockDiv").attr("data-operation","create"),b(".clockInput").removeAttr("disabled");var t=b(".defaultTime input").val();""==t&&(t=1e4),clockObj.clockEndTime=60*t,clearInterval(clockObj.setClockTimer),b(".clockDiv").css("background-color","#212740");var o=checkLocation("location");""!=o&&("pgm"==o?(applyClockToPgm(0,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(updateClock(0,1e3*clockObj.clockEndTime,"create"),saveClockuserBehavior("stop","pvw")))}),b(".defaultTime").on("click",".TimerApply",function(){b(".clockDiv").attr("data-operation","newEndTime");var e,t=b(".defaultTime input").val();""==t&&(t=1e4),clockObj.clockEndTime=60*t,e=b(".clockStart").hasClass("hide")?"start":"stop";var o=checkLocation("location");""!=o&&("pgm"==o?(applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior(e,"pgm")):(updateClock(0,1e3*clockObj.clockEndTime,"newEndTime"),saveClockuserBehavior(e,"pvw")))}),b("#preview").on("click",".clockDiv",function(e){b(this),b(".sd-clock").removeClass("hide"),b(".sd-pretreat-container .pretreat-content").addClass("hide"),b(".operation-clock").addClass("active"),b(".operation-clock").siblings().removeClass("active"),b(".changepoint").remove(),b(".sd-clock").siblings().addClass("hide"),e.stopPropagation()}),b(".pretreat-content").on("mouseleave",".pretreat-content-item",function(){var e=b(this);e.find(".close").remove(),e.find(".edit").remove()}),b(".pretreat-content").on("click",".close",function(){if(!overlayCut.isCut){var e=b(this).parent();return e.hasClass("logo")?c.delLogo(e):e.hasClass("pip")?c.delPip(e):e.hasClass("text")?c.delText(e):e.hasClass("score")?c.delScore(e):e.hasClass("clock")&&c.delClock(e),!1}}),b(".operation-item-title").click(function(){var e=b(this);e.parents(".operation").addClass("hide");var i=e.attr("data-type"),t=b(".pretreat-content");b.each(t,function(e,t){var o=b(t).attr("data-type");i==o&&(b(t).removeClass("hide"),0<b(t).find(".pretreat-content-item").length&&("text"!=o&&"pip"!=o&&"clock"!=o||b(t).find(".pretreat-content-add").addClass("hide")))})}),{overlying:c}}($,oUtils,switchLangObj);function TimeByms(e){var t=Math.floor(e/60),o=Math.floor(e%60);return(t=t<=9?"0"+t:t)+":"+(o=o<=9?"0"+o:o)}function checkLocation(e){var t=JSON.parse(decodeURIComponent(studioBehavior)).ProgramClock;return null!=t?t[e]:""}function updateUserBehavior(e){if(null!=e){var t=JSON.parse(decodeURIComponent(studioBehavior)),o=t.ProgramClock;for(var i in null==o&&(o={}),e){var r=e[i];o[i]=r}t.ProgramClock=o,studioBehavior=encodeURIComponent(JSON.stringify(t))}}