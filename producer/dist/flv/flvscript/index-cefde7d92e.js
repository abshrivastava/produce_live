"use strict";var indexPageWebsocketObj,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},alertIntervalMethod=null,session=getQueryString("session"),currentPage_pathname=getQueryString("pn"),alertTimestamp=0,user_role=$("#user_role").val(),isFirstToken=!1,_isProtocol=window.location.protocol;function fn_initMenuTab(){var t=$("#website_nav .website_nav_list");$.each(t,function(t,e){if($(e).attr("data-mark")==currentPage_pathname)return $(e).addClass("active"),$(e).siblings().removeClass("active"),!1})}function indexPageWebsocketObj(){this.socket=null}function getQueryString(t,e,a){e=null==e?window.location.search.substr(1):e,a=null==a?"&":a;var i=new RegExp("(^|"+a+")"+t+"=([^"+a+"]*)("+a+"|$)","i"),s=e.match(i);return null!=s?unescape(s[2]):null}function logout(){$.ajax({url:"logout",data:{session:session},success:function(t){if(null!=t){if("false"==t.split("|")[0])return void(window.location.href="./main/login.jsp");var e=window.location.href.split("?")[0];window.location.href=e}else console.log(t)},error:function(){window.parent.location.href="./main/login.jsp"}})}function insertNotRead(t){if(null!=(n=$.parseJSON(t.alertMsg)[0])){var e=n.notReadMsg,a=n.newMsg;if(""==e)return $("#showDetailContent").hide(),void $("#alertHref").addClass("hasMsgShow");$("#alertHref").removeClass("hasMsgShow");var i=[];if(""!=a){for(var s=0;s<a.length;s++){var n=a[s].message,o=a[s].sender_name,r=a[s].recipients_name,l=a[s].timestamp,c="";c=0==s?'<div class="notReadRecord left hide not_read_alert_first" data-timestamp="'+l+'">':'<div class="notReadRecord left hide" data-timestamp="'+l+'">',c+='\t\t\t\t\t\t\t<div class="popup_alert_icon left"><img src="images/alert.png" alt="alerts"></div>\t\t\t\t\t\t\t<div class="popup_alert_content left"><div class="left alert_tip">From:</div><div class="left alert_contain">'+o+'</div><div class="clear"></div></div>\t\t\t\t\t\t\t<div class="popup_alert_content left"><div class="left alert_tip">To:&nbsp;&nbsp;</div><div class="left alert_contain">'+r+'</div><div class="clear"></div></div>\t\t\t\t\t\t\t<div class="popup_alert_content left popup_alert_msg"><div>'+html_encode(n)+'</div></div>\t\t\t\t\t\t\t<div class="clear"></div>\t\t\t\t\t\t  </div>',i.push(c)}i.push('<div class="clear"></div>'),$("#showDetailContent").children(".clearFix").html(i.join("")),fadeInAlertDiv()}}}function html_encode(t){return 0==t.length?"":t.replace(/&/g,"&gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>")}function html_decode(t){return 0==t.length?"":t.replace(/&gt;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/<br>/g,"\n")}function fadeInAlertDiv(){showPopupBoxOwn($("#showDetailContent")),alertTimestamp=$("#showDetailContent").children(".popupContent_header").children(".notReadRecord").first().attr("data-timestamp");var t=$("#showDetailContent").children(".popupContent_header").children(".notReadRecord");$.each(t,function(t,e){var a=300*(t+1);$(e).fadeIn(a)}),$("#showDetailContent").delay(5e3).hide("slow",function(){}),$("#showDetailContent").offset().height<500||$("#showDetailContent").fnNiceScroll()}function showPopupBoxOwn(t,e,a){t="object"==(void 0===t?"undefined":_typeof(t))?t:$(t);var i="object"==(void 0===e?"undefined":_typeof(e))?e:$("#bgFilter"),s="object"==(void 0===a?"undefined":_typeof(a))?a:$(a);e&&i.show(),void 0!==a&&s.hide(),t.show(),t.css({"margin-left":-100,top:80,hieght:$(window).height()}),t.fadeIn(500)}function fn_scroll(t){t.niceScroll({cursorcolor:"#fff",cursoropacitymax:1,touchbehavior:!1,cursorwidth:"5px",cursorborder:"1px solid #000",cursorborderradius:"5px"})}function commonErrorTipFn(t,e,a){var i=a||3e3;t.text(e),t.fadeIn(),setTimeout(function(){t.fadeOut()},i)}function getTokenMessage(){var t="tk"==currentPage_pathname;if(!t){var e={type:"tokenAlert",module:"getTokenMessage",atPage:t};indexPageWebsocketObj.getTokenMessage(e)}}$("html").fnNiceScroll(),fn_initMenuTab(),$(function(){$("header").headroom({offset:50,tolerance:5,classes:{initial:"animated",pinned:"slideInDown",unpinned:"slideOutUp"}}),$("#pro_nav_icon_bg").css({right:"0.56rem",top:"0.1rem"}),(indexPageWebsocketObj=new indexPageWebsocketObj).init(),getTokenMessage(),$("#userAccountMenu").click(function(){$(this).hasClass("active")?($(this).removeClass("active"),$("#user_operationList").addClass("hide")):($(this).addClass("active"),$("#user_operationList").removeClass("hide"))}),$("body").on("click",".notReadRecord",function(){$("#alertHref").addClass("active"),$("#alertHref").siblings(".website_nav_list").removeClass("active");var t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?pn=al&session="+session;window.location.href=t})}),$("#homeHref").on("click",function(){goMainUrl("hm",!1)}),$("#receiverControlHref").on("click",function(){goMainUrl("rc",isHttpsPage)}),$("#alertHref").on("click",function(){goMainUrl("al",!1)}),$("#shareHref").on("click",function(){goMainUrl("sh",!1)}),$("#settingHref").on("click",function(){goMainUrl("st",!1)}),$("#multiViewHref").on("click",function(){goMainUrl("mv",isHttpsPage)}),$("#tokenHref").on("click",function(){goMainUrl("tk",!1)}),$("#bookingHref").on("click",function(){goMainUrl("bk",!1)}),$("#studioHref").on("click",function(){goMainUrl("sd",!1)}),$("#gridControlHref").on("click",function(){goMainUrl("gc",!1)}),$("#gridControlPartner").on("click",function(){goMainUrl("gp",!1)}),$("#more_href").on("click",function(){$("#menu_operationList").toggleClass("hide")}),$("#fileDownLoadHref").on("click",function(){goMainUrl("fd",!1)}),indexPageWebsocketObj.prototype={constructor:indexPageWebsocketObj,init:function(){this.socket=oUtils.socket({url:"pageRequest?statusChange=1",error:function(t){console.log(t)},successObj:{instanceStatusChange:function(t){if("Running"==t.instanceStatus)$(".progress .progress-status").html("2/3"),$(".progress .meter .compelete").css("width","66%"),$(".progress").css("display","block"),$(".main-cut").css("margin-top","0.2rem");else if("ReceiverStarted"==t.instanceStatus){if($(".progress .progress-status").html("3/3"),$(".progress .meter .compelete").css("width","100%"),$(".progress").css("display","none"),$(".main-cut").css("margin-top","0.8rem"),null!=pageWebsocketObj.socket)return;getCheckConfig(function(){$(".progress").css("display","none"),$(".main-cut").css("margin-top","0.8rem"),resetPage(),initStudioRList()})}}}})},taskInfo_l:function(t){var o=this.socket;this.socket.send({message:t,time:1e3,key:"taskInfo_TR",success:function(t){extIp=fn_updateTRStatusInfo($.parseJSON(t.taskInfo)[0]);for(var e=rData?rData.getValueByKey("peerId"):[],a=tData?tData.getValueByKey("peerId"):[],i=0;i<e.length;i++){var s=e[i];if(cloudRPeerId[0]==s){e.splice(i,1);break}}var n={type:"taskInfo",module:"taskInfo_TR",sourceStr:a.join(","),programStr:e.join(",")};o.sendMsgs.taskInfo_TR.message=n}})},taskInfo_source:function(t){var v=this.socket;this.socket.send({message:t,time:1e3,key:"taskInfo_source",success:function(t){for(var e=$.parseJSON(t.taskInfo)[0].tInfo,a=0,i=e.length;a<i;a++){var s=e[a],n=s.peerId,o=e[a].name,r=s.status,l=s.livePeerId,c=$("#allRSource").find("li[data-id='"+n+"']"),d=s.type,u=c.attr("title"),p="whiteText";if($(c).attr("data-rstatus",r),$(c).attr("data-livepeerid",l),"2"==r?(p="redText",isSelectSourceR||$("#allRSourceList .titleValueS").attr("data-type",d)):"0"==r&&(p="grayText"),isSelectSourceR||$("#allRSourceList .titleValue").attr("data-value")!=n||$("#allRSourceList .titleValueS").attr("data-type",d),u!=o){c.attr("title",o),c.find(".sname").html(o);var g=$("#allRSourceList").find(".titleValue");g.attr("data-value")==n&&g.html(o)}c.hasClass(p)||c.removeClass("whiteText").removeClass("redText").removeClass("grayText").addClass(p)}var f={type:"taskInfo",module:"taskInfo_source",sourceStr:totalSourceList.join(","),programStr:[].join(",")};v.sendMsgs.taskInfo_source.message=f}})},getTokenMessage:function(t){this.socket.send({message:t,time:3e3,key:"getTokenMessage",success:function(t){var e=$.parseJSON(t.tokenAlert);if("0x0"==e.errorCode){var a=e.errorFlag;e.errorInfo;a?$("#tokenHref").addClass("showMsgIcon"):$("#tokenHref").removeClass("showMsgIcon")}}})},listEventRunning:function(){this.socket;this.socket.send({message:{type:"listEventRunning",module:"listEventRunning"},time:3e3,key:"listEventRunning",success:function(t){var e=t.runningEvent;e=JSON.parse(e),createRunningEvents(e)}})},existPendingEvent:function(){this.socket;this.socket.send({message:{type:"existPendingEvent",module:"existPendingEvent"},time:3e3,key:"existPendingEvent",success:function(t){"true"==t.runningEvent?$(".tab-blocks .tab-running").addClass("orangeColor"):$(".tab-blocks .tab-running").removeClass("orangeColor")}})},pageRunningEventPage:function(t){var i=this.socket;this.socket.send({message:t,time:3e3,key:"pageRunningEventPage",success:function(t){var e=t.runningEvent;e=JSON.parse(e),createBookingItem(e);var a={currentPageNum:$("#swicthPage .nextPage").val()||1,everyPageNum:$("#swicthPage .everyPageNum").attr("data-value")||10,type:"pageRunningEventPage",module:"pageRunningEventPage"};i.sendMsgs.pageRunningEventPage.message=a}})},updateSyncDevice:function(){var c=this.socket;console.log(allR_multi);for(var t=[],e=0;e<allR_multi.length;e++){var a=allR_multi[e].pid,i=allR_multi[e].tid;t.push(a,i)}var s={type:"checkDevieTimeLockStatus",module:"updateSyncDevice",peerIdList:t=t.join(",")};this.socket.send({message:s,time:5e3,key:"updateSyncDevice",success:function(t){console.log(t);var e=t.devieTimeLockStatus;e=JSON.parse(e),0<(i=(a=$("#multiRList .mVideo")).length)&&updateSynStatus(e,a);var a,i,s=[];if(0<(i=(a=$("#multiRList .mVideo")).length)){for(var n=0;n<i;n++){var o=$(a[n]).attr("data-multirid"),r=$(a[n]).find(".titleValue").attr("data-value");s.push(o,r)}s=s.join(",")}var l={type:"checkDevieTimeLockStatus",module:"updateSyncDevice",peerIdList:s};c.sendMsgs.updateSyncDevice.message=l}})},listTokenDevice4Pro:function(t,e){this.socket;var a={code:t,type:"listTokenDevice4Pro",module:"listTokenDevice4Pro"};this.socket.send({message:a,time:3e3,key:"listTokenDevice4Pro",success:function(t){var e=t.tokenDevice,a=JSON.parse(e).tList,i=void 0;"block"==$(".QrCode ").css("display")&&$(".QrCode ").attr("data-list",e);var s="",n="";isFirstToken&&0<$(".pack-body").find(".pack-info").length&&$(".pack-body .tokenLoad").remove(),!isFirstToken&&0<a.length&&(isFirstToken=!0,0==$(".pack-body").find(".pack-info").length&&$(".tokenLoad").css("display","block"));for(var o=0;o<a.length;o++){var r=a[o].peerId;i=a[o].status;if($(".preview-list-container").find(".preview-item").eq(o).attr("data-peertid",r),0!==$(".pack-body [data-peertid="+r+"]").length){var l=$(".pack-body .pack-operate[data-peertid='"+r+"']");if(l.attr("data-tStatus",i),2==l.attr("data-status")){l.attr("data-tlivepeerid");var c=l.attr("data-tlivepeerid").toUpperCase(),d=$(".preview-list-container").find(".preview-item[data-rid='"+c+"']");if(0!=d.length){var u=d.find(".preview-item-num").text();l.siblings(".pack-camera").find("span").text(u)}else l.siblings(".pack-camera").find("span").text(switchLangObj.i18n_Unspecified);if(l.find(".tokenImg").attr("data-tStatus")==l.attr("data-status"))return;l.text(switchLangObj.i18n_cancelLive),l.css({backgroundColor:"#FF4B4B",border:"1px solid #FF4B4B",color:"#FFF"}),l.siblings(".pack-address ").find("input").css("color","#FF4B4B")}else if(3==l.attr("data-tStatus")&&2!=l.attr("data-status")){if(l.find(".tokenImg").attr("data-tStatus")==l.attr("data-status"))return;l.text(switchLangObj.i18n_add),l.css({backgroundColor:"#20CA48",border:"1px solid #20CA48",color:"#FFF"}),l.siblings(".pack-address").find("input").css("color","#20CA48")}}else{var p=void 0;1==i?(p=switchLangObj.i18n_accept,n=s=""):3==i&&2!=$(".pack-operate[data-peertid='"+r+"']").attr("data-status")?(p=switchLangObj.i18n_add,s="pack-oprateAdd",n="inputAdd"):3==i&&2==$(".pack-operate[data-peertid='"+r+"']").attr("data-status")&&(p=switchLangObj.i18n_cancelLive,s="pack-oprateCancel",n="inputCancel");var g='<div class="pack-info clearFix">\t\t\t\t\t\t\t\t        <div class="pack-address left">\t\t\t\t\t\t\t\t           <input type="text" value="'+r+" / "+a[o].name+'" class="'+n+'" disabled=disabled>\t\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t\t\t        <div class="pack-camera left">\t\t\t\t\t\t\t\t            <span>'+switchLangObj.i18n_Unspecified+'</span>\t\t\t\t\t\t\t\t            <i class="pack-cameraArrow"></i>\t\t\t\t\t\t\t\t            <ul style="display:none;">\t\t\t\t\t\t\t\t                <li>1</li>\t\t\t\t\t\t\t\t                <li>2</li>\t\t\t\t\t\t\t\t                <li>3</li>\t\t\t\t\t\t\t\t                <li>4</li>\t\t\t\t\t\t\t\t            </ul>\t\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t\t\t        <div class="pack-operate left '+s+'" data-peertid="'+r+'" data-tStatus="'+i+'">'+p+'</div>\t\t\t\t\t\t\t\t        <div class="pack-del left" data-peertid="'+r+'">\t\t\t\t\t\t\t\t          \t<i class="iconfont icon-del"></i>\t\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t\t\t      </div>';$(".pack-body").prepend(g)}}}})},updateTimeLockStatus:function(t){this.socket;this.socket.send({message:{type:"timeLockMultiR",module:"timeLockMultiR"},time:3e3,key:"timeLockMultiR",success:function(t){var e=t.timeLockMultiR,a=(e=$.parseJSON(e)).synchronized,i=e.multiR;if("false"==a||0==a)$("#multiRSection .left-Select").removeClass("active"),$("#multiRList .rStatus-icon").removeClass("redCircle greenCircle grayCircle"),$("#multiRList .tStatus-icon").removeClass("redCircle greenCircle grayCircle");else{for(var s=$("#multiRList .mVideo"),n=[],o=s.length,r=i.length,l=0;l<r;l++)n.push(i[l].pid);if(r!=o)for(l=0;l<o;l++){var c=$(s[l]).attr("data-multirid"),d=$(s[l]).attr("data-rindex");-1==n.indexOf(c)&&removeOneR(d)}}}})},getDonwlaodFilePercent:function(){this.socket;var t={type:"getAllFile",tid:selsourceId,module:"getAllFile"};this.socket.send({message:t,time:1e3,key:"getAllFile",success:function(t){var e=JSON.parse(t.getAllFile);changeDownloadFileStatus(e)}})},getDownloadingFilePercent:function(){this.socket;this.socket.send({message:{type:"getDownloadingFile",module:"getDownloadingFile"},time:1e3,key:"getDownloadingFile",success:function(t){var e=JSON.parse(t.getDownloadingFile);changeDownloadFileStatus(e)}})},getDownloadedFile:function(){this.socket;this.socket.send({message:{type:"getDownloadedFile",module:"getDownloadedFile"},time:1e3,key:"getDownloadedFile",success:function(t){var e=JSON.parse(t.getDownloadedFile);dealDownloadedFileList(e)}})},keepCompleteWebrtc:function(t){this.socket;var e={type:"keepPlay",taskId:t,module:"keepPlay"};this.socket.send({message:e,time:1e3,key:"keepPlay",success:function(t){$("#record-show-preview").html(switchLangObj.i18n_stop).removeAttr("disabled").addClass("redBtn").attr("value","Stop")}})},getCompleteWebrtc:function(t){this.socket;var e={type:"getPlayTask",taskId:t,module:"getPlayTask"};this.socket.send({message:e,time:1e3,key:"getPlayTask",success:function(t){var e=JSON.parse(t.getPlayTask);switch(e.status){case 1:var a=e.msg;playvideoInterval&&clearInterval(playvideoInterval),playvideoInterval=setInterval(function(){PlayVideoByWebrtc(a),$("#bavkGroundDiv2").hide()},1e3);break;case 5:isFristWebrtc=!0,stopPreview(),on_leave()}}})}};