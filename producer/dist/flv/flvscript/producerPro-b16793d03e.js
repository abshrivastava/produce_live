"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sourceList={uploadFileShimArr:[],uploadIpShimArr:[],UploadUrl:"",pipIdArr:[],token2live:!1,tokenFlag:!0,startLvieTimeOut:2e3,tokenDelete:!1,retryCountTimer:!1,preventRepeatRequest:!1,isOrCanvas:!1,isLocalSource:!0},currentRInfo={selectRId:"",isLive:0,isSwitch:!1,selectRUserBehavior:{},IsAudioFollowVideo:void 0,isFlv:!1},overlying=overlayObj.overlying,statusObj={pipStatus:!1,IsPIPPreviewing:!1,pageInit:!0,previewListTimer:null},clockObj={setClockTimer:"",clockSeconds:0,clockEndTime:void 0,recordTimer:"",recordSeconds:0},allRidArray=[];function getUserBehavior(){$.ajax({type:"POST",url:"getUserBehavior",data:{pn:"sd"},dataType:"json",success:function(e){if("0x0"==e.errorCode&&e.userBehavior){currentRInfo.selectRUserBehavior=JSON.parse(e.userBehavior);var t=$(".rList-show").attr("data-peerId"),i=currentRInfo.selectRUserBehavior;if(i.directChange){for(var a=!1,r=0;r<i.directChange.length;r++){if(i.directChange[r].mainRid==t)a=!0,"shut"==i.directChange[r].status?directChangeShut():directChangeOpen()}a||directChangeOpen()}}},error:function(e){console.log(e.errorInfo)}})}function initStudioRList(){if(studioRList){var e=(e=JSON.parse(decodeURIComponent(studioRList))).sort(compareStatus),a="";if(e.forEach(function(e,t){var i=0<e.status?"online":"";a+='<li class="rList-item ellipsis '+i+'" data-status="'+e.status+'" data-version="'+e.version+'" data-peerId="'+e.peerId+'" data-rIp="'+e.ip+'" data-port="'+e.port+'" title="'+e.name+'">'+e.name+"</li>"}),$(".main-rList .rList-content").html(a),$(".main-rList .rList-content").fnNiceScroll(),studioBehavior){var t=JSON.parse(decodeURIComponent(studioBehavior));$(".main-rList .rList-show").html(t.SelectR.rname).attr({"data-status":t.SelectR.status,"data-version":t.SelectR.version,"data-peerId":t.SelectR.peerId,"data-rIp":t.SelectR.rIp,"data-port":t.SelectR.port,title:t.SelectR.rname}),currentRInfo.isLive=t.SelectR.status,currentRInfo.selectRId=t.SelectR.peerId,pageWebsocketObj.init(t.SelectR.peerId),volumesPageRequest.init(t.SelectR.peerId),pageRequestObj.shareNum(t.SelectR.peerId),volumeControlObj.init(t.SelectR.peerId)}else{if(""==e)return;$(".main-rList .rList-show").html(e[0].name).attr({"data-status":e[0].status,"data-version":e[0].version,"data-peerId":e[0].peerId,"data-rIp":e[0].rIp,"data-port":e[0].port,title:e[0].name}),currentRInfo.isLive=e[0].status,currentRInfo.selectRId=e[0].peerId,pageWebsocketObj.init(e[0].peerId),volumesPageRequest.init(e[0].peerId),pageRequestObj.shareNum(e[0].peerId),volumeControlObj.init(e[0].peerId)}}}function compareStatus(e,t){var i=e.status,a=t.status;return i<a?1:a<i?-1:0}function saveSelectRInfo(e){var t={pn:"sd",content:JSON.stringify(e),remark:"SelectR"};oUtils.ajaxReq("saveUserBehavior",t)}function clickPageHide(){$(".pagehide").addClass("hide")}function createVoiceControl(i,e,a){i.slider({orientation:"horizontal",range:"min",min:0,max:100,step:1,value:e,slide:function(e,t){i.find(".voice-value").html(t.value),i.siblings(".voice-control-mark").hasClass("icon-novoice")&&i.siblings(".voice-control-mark").removeClass("icon-novoice").addClass("icon-voice")},stop:function(e,t){i.siblings(".voice-control-mark").hasClass("icon-voice")&&i.siblings(".voice-control-mark").attr("data-value",t.value),a.find("video").prop("volume",t.value/100)}});var t='<span class="voice-value">'+e+"</span>";i.find(".ui-slider-handle").html(t),i.siblings(".voice-control-mark").off(),i.siblings(".voice-control-mark").on("click",function(){var e=$(this);e.hasClass("icon-novoice")?(e.removeClass("icon-novoice").addClass("icon-voice"),i.slider("value",e.attr("data-value")),a.find("video").prop("volume",e.attr("data-value")/100)):(e.removeClass("icon-voice").addClass("icon-novoice"),i.slider("value",0),a.find("video").prop("volume",0))}),i.siblings(".voice-control-mark").attr("data-value",e),a.find("video").prop("volume",e/100)}$(function(){FastClick.attach(document.body);var e=navigator.userAgent,t=-1<e.indexOf("Chrome"),i=-1<e.indexOf("compatible")&&-1<e.indexOf("MSIE")&&!isOpera,a=-1<e.indexOf("Edge")&&!i;function u(e,t){if(0!=$(".preview-source .clip").length&&!$(".main-preview .applyBtn.radius-box").hasClass("shut")&&t)clipDot.expressApply("record/express_apply");else{pageWebsocketObj.stop();var i=e.attr("data-filename"),a=[],r=$(".main-output").attr("data-filename"),o=tally.getBeReplacedTallyBox(r);if(null!==o){var s={};s.rid=$(".output-source").attr("data-rid"),o.hasClass("pipOutputActive")||(o.hasClass("previewActive")||o.hasClass("pipPreviewActive")?s.type=131:s.type=130,a.push(s))}e.attr("data-filename");if(void 0!==$(".preview-source").attr("data-rid")){var n={};n.rid=$(".preview-source").attr("data-rid"),n.type=132,a.push(n)}var c={SelectedSharedMemory:i},l=webflv.playObj[$(".main-preview .main-player").attr("id")].player,d=Math.round(1e3*l.currentTime)+l._muxer.dtsBase;c.SubTimestamp=d,console.log("setStudioLiveSharedMemory time:",(new Date).getTime());var p={rid:currentRInfo.selectRId,params:JSON.stringify(c),tallyArray:JSON.stringify(a)};oUtils.ajaxReq("setStudioLiveSharedMemory",p,function(e){"0x0"==e.errorCode&&updateMainOutput(i),pageWebsocketObj.stop(),pageWebsocketObj.recover()})}}0!=t&&1!=a||$(".isChrome").css("display","block"),$(document).on("click",function(){clickPageHide(),$(".afv-audio-cut .audio-select").css("display","none"),$(".fontSize-ul").css("display","none"),$(".sd-font-family .family-ul").css("display","none"),$(".pip-in-source").css("display","none"),$(".pack-camera ul").css("display","none"),$(".upload-body").css("overflow","hidden"),$(".textArrow").css("display","none")}),$(document).on("click",".alert_popupBg",function(e){e.stopPropagation()}),$(".purchase-alert div,.purchase-promptbox div").click(function(){localStorage.setItem("session",session),window.location.href="http://"+window.location.host+"/producerpro/user/register.html?1";var e=$("#user_info_name").text();localStorage.setItem("userName",e)}),$(".purchase-promptbox img").click(function(){return $(".purchase-promptbox").css("display","none"),!1}),initStudioRList(),initDirectChange(),pageRequestObj.taskInfo(),$(".main-swicthR").on("click",".rList-show",function(e){e.stopPropagation();var t=$(this).siblings(".pagehide");t.hasClass("hide")?t.removeClass("hide"):t.addClass("hide")}),$(".main-swicthR").on("click",".rList-item",function(e){var t=$(this),i=$(this).parent().siblings(".rList-show");if(!t.hasClass("online"))return oUtils.alertTips("i18n_clickOfflineR",1500),void e.stopPropagation();if(statusObj.pageInit=!0,t.html()!==i.html()){var a={};a.status=t.attr("data-status"),a.version=t.attr("data-version"),a.peerId=t.attr("data-peerId"),a.rIp=t.attr("data-rIp"),a.port=t.attr("data-port"),a.rname=t.html(),i.html(a.rname).attr({"data-status":a.status,"data-version":a.version,"data-peerId":a.peerId,"data-rIp":a.rIp,"data-port":a.port,title:a.rname}),currentRInfo.isSwitch=!0,getUserBehavior(),currentRInfo.selectRId=a.peerId,currentRInfo.isLive=a.status,saveSelectRInfo(a),pageWebsocketObj.close(),volumeControlObj.close(),volumesPageRequest.close(),resetPage(),pageWebsocketObj.init(a.peerId),volumesPageRequest.init(a.peerId),volumeControlObj.init(a.peerId),pageRequestObj.stop(),pageRequestObj.shareNum(a.peerId)}}),$(".preview-source").on("click",function(){if($(this).addClass("change"),$(".output-source").removeClass("change"),$(".pip").removeClass("change"),!(0<$(".preview-source").find(".changepoint").length)){$(".preview-source").append('<div class="changepoint"><p style="left:-5px;top:-5px;"></p><p style="right:-5px;top:-5px;"></p><p style="left:-5px;bottom:-5px;"></p><p style="right:-5px;bottom:-5px;"></p></div>')}}),$(".output-source").on("click",function(){$(".apply-preview  .radius-box").trigger("click"),$(".preview-source").removeClass("change"),$(".changepoint").remove(),$(".pip").removeClass("change")}),$(".preview-source").on("click",".pip",function(e){$(this).addClass("change"),$(".preview-source").removeClass("change"),$(".output-source").removeClass("change"),$(".changepoint").remove(),e.stopPropagation()}),$(".sd-preview-list").on("click",".preview-item-video",function(){pageWebsocketObj.stop();var e=$(this).parents(".preview-item"),t=e.attr("data-filename"),i={SelectedSharedMemory:t},a=webflv.playObj[e.find("video").attr("id")].player,r=Math.round(1e3*a.currentTime)+a.dtsBase;i.SubTimestamp=r,console.log("setStudioLiveSharedMemory time:",(new Date).getTime());var o={rid:currentRInfo.selectRId,params:JSON.stringify(i)},s=e.index(),n=($(".pretreat-content .pip"),$(".pretreat-content .pip").attr("data-id"),[]);if($(".apply-preview .radius-box").hasClass("shut")||$(".output-source").hasClass("change"))u(e,!1);else if($(".preview-source .pip").hasClass("change"))changePipSource(s+1);else{var c=$(".main-preview").attr("data-filename"),l=tally.getBeReplacedTallyBox(c);if(null!==l)(d={}).rid=$(".preview-source").attr("data-rid"),l.hasClass("outPutActive")||l.hasClass("pipOutputActive")||l.hasClass("pipPreviewActive")||(d.type=130,n.push(d));var d,p=e.attr("data-rid");if(void 0!==p)if(!e.hasClass("outPutActive")&&!e.hasClass("pipPreviewActive")&&!e.hasClass("pipOutputActive"))(d={}).rid=p,d.type=131,n.push(d);o.tallyArray=JSON.stringify(n),oUtils.ajaxReq("setStudioInputPreview",o,function(e){"0x0"==e.errorCode&&(clipDot.changeVideoCut(!0),$("#preview").removeAttr("data-storyid"),updateMainPreview(t)),pageWebsocketObj.stop(),pageWebsocketObj.recover()})}}),$(".main-cut-btn").on("click",function(){$(".sd-pretreat-operation").removeClass("active"),u($(".main-preview"),!0)}),$(document).keyup(function(e){var t=e.keyCode;return 32==t&&0==$(".preTextarea").is(":focus")&&u($(".main-preview"),!0),!(0==$(".scoreDiv .scoreText").is(":focus")&&$(".scoreDiv").find(".point").hasClass("show")||0==$(".preTextarea").is(":focus")&&$(".textDiv").find(".point").hasClass("show"))&&(1!=$(".preTextarea").is(":focus")&&1!=$(".scoreDiv .scoreText").is(":focus")&&1!=$("#sd-textarea").is(":focus")&&1!=$(".sd-score input").is(":focus")&&1!=$(".ip-address input").is(":focus")&&1!=$(".push-nickname").is(":focus")&&1!=$(".trimItem").is(":focus")&&1!=$(".description").is(":focus")&&1!=$(".TimeSet input").is(":focus")&&1!=$(".defaultTime input").is(":focus")&&(96<t&&t<106?t-=96:48<t&&t<57&&(t-=48),void $(".preview-content .preview-item").eq(t-1).find(".preview-item-video").trigger("click")))}),createVoiceControl($(".preview-voice .voice-control-slider"),0,$(".preview-source")),createVoiceControl($(".output-voice .voice-control-slider"),100,$(".output-source"))});var webrtcVideo={peerIds:[],initFlag:!0,mainTimer:null,listTimer:null,initTimer:null,clear:function(){this.peerIds=[],this.initFlag=!0,this.mainTimer&&clearInterval(this.mainTimer),this.listTimer&&clearInterval(this.listTimer),this.mainTimer=null,this.listTimer=null,this.initTimer=null},initMainVideo:function(e,t,i){if(this.initFlag){this.initFlag=!1;var a=this;0==$(".preview-source .audio").length&&webflv.createFlvVideo({input:$("#preview"),id:e}),a.mainTimer&&clearInterval(a.mainTimer),a.mainTimer=setInterval(function(){0<$(".main-preview .main-player").length&&0<$(".main-preview .main-player")[0].played.length&&(clearInterval(a.mainTimer),webflv.createFlvVideo({output:$(".main-output .output-source .big-video"),id:t,data:i}))},100)}},updateVideoList:function(e,t,i){var a=this,r=compareArr(a.peerIds,e);if(a.peerIds=cloneArr(e),r){if(0<r.add.length){var o=rePeerIdObj(t,r.add);console.log("增加了",r.add),0<$(".main-output .audio").length?(webflv.createFlvVideo({previewList:o}),firstOverlyShow(),$(".overlay-tab .operation-clock").removeClass("hide"),firstClockInit(),$(".overlay-tab .operation-clip").removeClass("hide")):r.add.forEach(function(e,t){var i=a.peerIds.indexOf(e);-1<i&&a.peerIds.splice(i,1)})}if(0<r.sub.length){console.log("减少了",r.sub),r.sub.forEach(function(e,t){var i=e.replace(/\//g,"_"),a=webflv.playObj[i].player;void 0!==a&&null!=a&&(webflv.playObj[i].wsreader.destroy(),webflv.playObj[i].player.pause(),webflv.playObj[i].player.detachMediaElement(),webflv.playObj[i].player.destroy(),webflv.playObj[i].player=null),$("#"+i).parents(".preview-item").remove()});var s=$(".preview-content .preview-item");$.each(s,function(e,t){$(t).find(".preview-item-num").html(e+1)})}}}};function firstInitLogo(){var e={peerId:$(".rList-show").attr("data-peerid"),module:"1"};oUtils.ajaxReq("logo_list",e,function(e){if("0x0"==e.errorCode)for(var t=e.result,i=0;i<t.length;i++)if(1==t[i].usingType)$(".clip-dot .pic-submit").css("background-image","url("+t[i].url+")"),$(".clip-dot .pic-submit").attr("data-userlogoid",t[i].userLogoId);else{var a=t[i].checkedStatus;1<=a&&1!=t[i].scoreBoard&&overToPreview.logoInit(t[i]),1!=t[i].scoreBoard&&overlying.logoInit(t[i]),1<=a&&1==t[i].scoreBoard&&(overToPreview.scoreInit(t[i]),overlying.scoreInit(t[i],!1,!0))}})}function firstOverlyShow(){var e={peerId:$(".rList-show").attr("data-peerid"),textId:$(".preTextarea").attr("data-id")};$.ajax({type:"POST",url:"subtitle_list",timeout:15e3,data:e,success:function(e){firstInitLogo();var t=JSON.parse(e);if("0x0"==t.errorCode&&0!=t.errorInfo.length)for(var i=t.errorInfo,a=0;a<i.length;a++){var r=i[a];r.checked&&(null!=r.logoId&&""!=r.logoId||(overToPreview.textInit(r),overlying.textInit(r))),null!=r.logoId&&""!=r.logoId||overlying.textInit(r)}}});var t={peerId:$(".rList-show").attr("data-peerid"),dataType:"pip"};oUtils.ajaxReq("studio_list",t,function(e){if("0x0"==e.errorCode){var t;$(".preview-content .preview-item");if(0!=e.result.pip.length){var i=e.result.pip[0],a=i.pipVideoSharedMemoryName;if(t=$(".preview-content .preview-item[data-filename='"+a+"']").find("video").eq(0).attr("id"),$(".pip-picture").addClass("created"),overlying.pipInit(i),0!=i.checked){overToPreview.pipInit(i,t),clearInterval(r);var r=setInterval(function(){0!=$(".preview-content .preview-item[data-filename='"+a+"']").length&&($(".preview-content .preview-item[data-filename='"+a+"']").addClass("pipPreviewActive"),clearInterval(r))},500)}}}else oUtils.alertTips(e.errorInfo,1500)})}function firstClockInit(){oUtils.ajaxReq("clock_list",{},function(e){if("0x0"==e.errorCode){var t=e.result;if(""!=t){t=t[0];var i=JSON.parse(decodeURIComponent(studioBehavior)).ProgramClock;if(null==i)return;var a=i.status,r=i.location;overToPreview.clockInit(t),overlying.clockInit(t);var o=t.endTime;clockObj.clockEndTime=o/1e3,1e4==(o=o/1e3/60)&&(o=""),$(".defaultTime input").val(o),"start"==a&&($(".clockStop").removeClass("hide"),$(".clockStart").addClass("hide"),$(".clockInput").attr("disabled","disabled"),clearInterval(clockObj.setClockTimer),clockObj.setClockTimer=setInterval(function(){clockObj.clockSeconds++;var e=clockObj.clockSeconds%60,t=parseInt(clockObj.clockSeconds/60);e=e<=9?"0"+e:e,t=t<=9?"0"+t:t,clockObj.clockSeconds>clockObj.clockEndTime?$(".clockDiv").css("background-color","red"):$(".clockDiv").css("background-color","#212740"),$(".clockTextarea").html(t+":"+e),$(".clockDiv").attr("data-time",clockObj.clockSeconds),59940<clockObj.clockSeconds&&(clearInterval(clockObj.setClockTimer),clockObj.clockSeconds=0,$(".clockDiv").attr("data-operation","create"),$(".clockTextarea").html("00:00"),$(".clockStart").removeClass("hide"),$(".clockStop").addClass("hide"),$(".clockDiv").css("background-color","#212740"),$(".clockInput").removeAttr("disabled"),$(".clockInput").val(0),"pgm"==r?(applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"create"),saveClockuserBehavior("start","pvw")))},1e3))}}else oUtils.alertTips(e.errorInfo,1500)})}function cloneArr(e){var i=[];return e.forEach(function(e,t){i.push(e)}),i}function compareArr(i,a){var e={},r=[],o=[];return i.forEach(function(e,t){a.indexOf(e)<0&&o.push(e)}),a.forEach(function(e,t){i.indexOf(e)<0&&r.push(e)}),0<r.length||0<o.length?(e.add=r,e.sub=o,e):null}function rePeerIdObj(e,i){var a=[];return e.forEach(function(e,t){-1<i.indexOf(e.PreviewID)&&a.push(e)}),a}function volumesRequest(){this.socket=null}setInterval(function(){if(0<currentRInfo.isLive){var e={rid:currentRInfo.selectRId,params:currentRInfo.selectRId,reStartflag:!0};oUtils.ajaxReq("queryStudioInfo",e)}$("video")},1e4),volumesRequest.prototype={constructor:volumesRequest,init:function(e){this.socket=oUtils.socket({url:"pagewebsocket",error:function(e){console.log(e)},param:{pid:e,identifyId:(new Date).getTime()+1}}),this.volumeInfo()},volumeInfo:function(){this.socket.send({message:{categoryId:"2152871168",operationType:"703"},time:200,key:"volumeInfo",success:function(e){if(e.data)var t=JSON.parse(e.data);volumeColumn.getVideoVolumeColumn(t)}})},stop:function(){this.socket.has("volumeInfo")&&this.socket.stop("volumeInfo")},recover:function(){this.socket.has("volumeInfo")||this.volumeInfo()},close:function(){this.socket&&this.socket.off()}};var volumesPageRequest=new volumesRequest;function PageWebsocket(){this.socket=null,this.onchanging=null,this.studioFlag=null}PageWebsocket.prototype={constructor:PageWebsocket,init:function(e){this.onchanging=1,this.socket=oUtils.socket({url:"pagewebsocket",error:function(e){console.log(e)},param:{pid:e,identifyId:(new Date).getTime()}}),this.studioFlag=!0,this.uploadInfo(),this.kernelState()},uploadInfo:function(){var i=this;this.socket.send({message:{categoryId:"2152871168",operationType:"101"},time:1e3,key:"uploadInfo",success:function(e){if(e.data)var t=JSON.parse(e.data);if(t){if(i.onchanging++,i.onchanging<2)return;updateCurrentRInfo(t),i.studioFlag=!0}else if("Module Not Found."===e.errorMessage&&i.studioFlag)return oUtils.alertTips("i18n_notFindProducerProModule",1500),void(i.studioFlag=!1)}})},kernelState:function(){this.socket.send({message:{categoryId:"2152857600",operationType:"102"},time:1e3,key:"kernelState",success:function(e){if(e.data)var t=JSON.parse(e.data).CurrentTStrIdHex;$(".main-preview").attr("data-livePeerId",t)}})},stop:function(){this.socket.has("uploadInfo")&&(this.socket.stop("uploadInfo"),this.onchanging=0)},recover:function(){this.socket.has("uploadInfo")||(this.uploadInfo(),this.onchanging=0)},close:function(){this.socket&&this.socket.off(),this.onchanging=null,this.studioFlag=null}};var pageWebsocketObj=new PageWebsocket;function updateCurrentRInfo(e){if(webrtcVideo.initMainVideo([e.InputPreviewWebRTCUserID],[e.OutputPreviewWebRTCUserID],e),e.SourceListPreview){var i=[],a=[],r=!1,o="";sourceList.uploadFileShimArr=[],sourceList.uploadIpShimArr=[],currentRInfo.isFlv=!0,e.SourceListPreview.forEach(function(e,t){e.PreviewShm.IsEnabled&&(i.push(e.PreviewID),a.push(e),400==e.PreviewShm.SourceType&&(r=!0)),100==(o=e.PreviewShm.SourceType)&&sourceList.uploadFileShimArr.push(e),200==o&&sourceList.uploadIpShimArr.push(e)}),webrtcVideo.updateVideoList(i,a,e),r?$(".main-rList .rList-show").attr("data-sdi",!0):$(".main-rList .rList-show").removeAttr("data-sdi")}var t=e.CurrentInputPreviewShm.SharedMemoryName,s=e.CurrentEncoderSharedMemory.SharedMemoryName;if(updateMainPreview(t),updateMainOutput(s),null!=e.CurrentPIPList&&0<e.CurrentPIPList.length){var n=e.CurrentPIPList[0].id,c=$(".sd-preview-list .preview-item[data-filename='"+n+"']");0<c.length&&c.addClass("pipOutputActive").siblings().removeClass("pipOutputActive")}if($(".main-preview").attr({"data-logoUrl":e.UploadLogoUrl,"data-logoMaxH":e.LogoMaxHeight,"data-logoMaxW":e.LogoMaxWidth,"data-maxCopierCount":e.MaxCopierCount}),widthAndHeight.resolutionW=e.SwitchBusScaleFormat.Width,widthAndHeight.resolutionH=e.SwitchBusScaleFormat.Height,0<e.EncoderList.length&&0<e.EncoderList[0].CopierList.length){for(var l=0,d=0,p=0;p<e.EncoderList[0].CopierList.length;p++)if(5==e.EncoderList[0].CopierList[p].Type){d++,l=e.EncoderList[0].CopierList.length-d;var u=$(".rList-show").attr("data-rip"),v=e.EncoderList[0].CopierList[p].OutputPort;$("#girdUrlShow img").css("display","none"),$(".gridIssp").attr("data-issp","yes"),$(".gridIssp").val("issp://"+u+":"+v)}else l=e.EncoderList[0].CopierList.length-d;$(".output-top .shareCounts").html()!=l&&($(".output-top .shareCounts").html(l).attr("data-encoder",e.EncoderList.length),$(".output-top .shareCounts").hasClass("active")||$(".output-top .shareCounts").addClass("active"))}else"0"!=$(".output-top .shareCounts").html()&&$(".output-top .shareCounts").html(0).removeClass("active").removeAttr("data-encoder");checkAfv(e)}function checkAfv(e){if(0==currentRInfo.IsAudioFollowVideo||1==currentRInfo.IsAudioFollowVideo)return currentRInfo.IsAudioFollowVideo++,!1;if(currentRInfo.IsAudioFollowVideo=void 0,1==e.IsAudioFollowVideo)$(".afv-cut .radius-box").removeClass("close"),$(".afv-cut .radius-box").css({left:"11px"}),$(".afv-cut .afv-audio").addClass("disabled"),$(".afv-audio").html("Audio 1"),$(".main-output .icon-erphone").hasClass("active")&&($("video").prop("volume",0),$(".main-output .main-player").prop("volume",1));else{$(".afv-cut .radius-box").addClass("close"),$(".afv-cut .radius-box").css({left:"0px"});var t=e.AudioOnlyShm.SharedMemoryName,i=$(".preview-content .preview-item[data-filename='"+t+"']").index();$(".afv-audio").html("Audio "+(i+1)),$(".afv-audio").removeClass("disabled"),$(".main-output .icon-erphone").hasClass("active")&&($("video").prop("volume",0),$(".main-output .main-player").prop("volume",1))}}function updateMainPreview(e){$(".main-preview").attr("data-filename",e);var t=$(".sd-preview-list .preview-item[data-filename='"+e+"']");t.length<=0||(t.addClass("previewActive").siblings().removeClass("previewActive"),t.attr("data-rid")?$(".preview-source").attr("data-rid",t.attr("data-rid")):$(".preview-source").removeAttr("data-rid"))}function updateMainOutput(e){$(".main-output").attr("data-filename",e);var t=$(".sd-preview-list .preview-item[data-filename='"+e+"']");t.length<=0||(t.addClass("outPutActive").siblings().removeClass("outPutActive"),t.attr("data-rid")?$(".output-source").attr("data-rid",t.attr("data-rid")):$(".output-source").removeAttr("data-rid"))}var volumeColumn={volumeObj:{},getVideoVolumeColumn:function(e){var t,i,a,r;for(var o in e)if("InputPreview"==o||"OutputPreview"==o){var s=e[o],n=s.SwitchBusNickName;this.volumeObj[n]||(this.volumeObj[n]={lastRightDb:0,lastLeftDb:0,curRightDb:0,curLeftDb:0}),t=this.volumeObj[n],i=s.VolumePreviewWorker.PreviewVoiceClip,a="InputPreview"==o?$(".preview-source").find(".audio"):$(".output-source ").find(".audio"),this.setVolumeColumn(i,a,t)}else for(var c=e.SourceListPreview,l=0;l<c.length;l++)r=c[l].PreviewShm.SharedMemoryName,0!=(a=$(".preview-content [data-filename='"+r+"']").find(".audio")).length&&(this.volumeObj[r]||(this.volumeObj[r]={lastRightDb:0,lastLeftDb:0,curRightDb:0,curLeftDb:0}),t=this.volumeObj[r],i=c[l].VolumePreviewWorker.PreviewVoiceClip,this.setVolumeColumn(i,a,t))},setVolumeColumn:function(e,t,i){var a=$(t).find(".active");volumeColumnObj.init(e,a,i)}},volumeColumnObj={init:function(e,t,i){i.lastRightDb=i.curRightDb,i.lastLeftDb=i.curLeftDb,i.curRightDb=e.RightDb,i.curLeftDb=e.LeftDb,this.dealVolume(i,t)},dealVolume:function(e,t){var i=Math.round((e.curLeftDb- -40)/40*120),a=Math.round((e.curRightDb- -40)/40*120),r=Math.round((e.lastLeftDb- -40)/40*120),o=Math.round((e.lastRightDb- -40)/40*120),s=Math.round((i-r)/5),n=Math.round((a-o)/5);this.animation(r,i,s,t[0]),this.animation(o,a,n,t[1])},animation:function(t,i,a,r){if(t<i){window.requestAnimationFrame(function e(){t=i<(t+=a)?i:t,$(r).css("height",t/120*100+"%"),t<i&&window.requestAnimationFrame(e)})}else{window.requestAnimationFrame(function e(){t=(t+=a)<i?i:t,$(r).css("height",t/120*100+"%"),i<t&&window.requestAnimationFrame(e)})}}};function PageRequest(){this.socket=null}PageRequest.prototype={constructor:PageRequest,init:function(){this.socket=oUtils.socket({url:"pageRequest",error:function(e){console.log(e)}})},taskInfo:function(e){var w=this.socket,y=[];0==$(".preview-content li").length?y.push($(".main-rList .rList-show").attr("data-peerid")):$.each($(".preview-content li"),function(e,t){y.push($(t).attr("data-rid"))});var k=[];$.each($(".pack-body .pack-operate"),function(e,t){k.push($(t).attr("data-peertid"))}),$.each($(".tvupack-body .pack-operate"),function(e,t){k.push($(t).attr("data-peertid"))});var t={type:"taskInfo",sourceStr:k.join(","),programStr:y.join(",")};this.socket.send({message:t,time:1e3,key:"taskInfo",success:function(e){if(e.taskInfo){var t=JSON.parse(e.taskInfo),i=t[0].rInfo,a=t[0].tInfo;if(updateRStatus(t[0].rInfo),t[0].tInfo)for(var r=0;r<a.length;r++){var o=a[r].peerId,s=a[r].status,n=a[r].livePeerId,c=a[r].name;if(sourceList.tokenDelete&&2==$(".pack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status")&&1==s){var l={"tokenCode.code":$(".preview-qrcode").attr("data-code"),peerId:o,confirm:"Delete"};oUtils.ajaxReq("token_confirm",l,function(e){"0x0"==e.errorCode?console.log("delete token:",e,"tid:",o,"imgCode:"):console.log("delete token:",e)})}$(".pack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status",s),$(".preview-list-container").find(".preview-item[data-peertid='"+o+"']").attr("data-status",s),$(".pack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-tlivePeerId",n),$(".tvupack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-tlivePeerId",n),$(".tvupack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status",s);var d=$(".tvupack-body .pack-operate[data-peertid='"+o+"']");if(0!=$(".tvupack-body [data-peertid="+o+"]").length&&($(".tvupack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status",s),2==d.attr("data-status")?(d.text(switchLangObj.i18n_cancelLive),d.css({backgroundColor:"#FF4B4B",border:"1px solid #FF4B4B",color:"#FFF"}),d.siblings(".pack-address ").find("input").css("color","#FF4B4B"),d.siblings(".pack-address").find("input").val(o+"/"+c)):1==d.attr("data-status")?(d.text(switchLangObj.i18n_add),d.css({backgroundColor:"#20CA48",border:"1px solid #20CA48",color:"#FFF"}),d.siblings(".pack-address").find("input").css("color","#20CA48"),d.siblings(".pack-address").find("input").val(o+"/"+c)):0==d.attr("data-status")?(d.text(switchLangObj.i18n_add),d.css({backgroundColor:"#999;",border:"1px solid #999;",color:"#666"}),d.siblings(".pack-address").find("input").css("color","#999"),d.siblings(".pack-address").find("input").val(o+"/"+c)):(d.text(switchLangObj.i18n_add),d.css({backgroundColor:"#999;",border:"1px solid #999;",color:"#666"}),d.siblings(".pack-address").find("input").css("color","#999"),d.siblings(".pack-address").find("input").val(o+"/"+c+"(No Camera)"))),2==d.attr("data-status")&&(""!=d.attr("data-tlivepeerid")||null!=d.attr("data-tlivepeerid"))){var p=d.attr("data-tlivepeerid").toUpperCase(),u=$(".preview-list-container").find(".preview-item[data-rid='"+p+"']");if(0!=u.length){var v=u.find(".preview-item-num").text();d.siblings(".pack-camera").find("span").text(v)}else d.siblings(".pack-camera").find("span").text(switchLangObj.i18n_Unspecified)}}for(r=0;r<i.length;r++){var h=(o=i[r].peerId).toUpperCase(),f=i[r].status;$(".preview-list-container").find(".preview-item[data-rid='"+h+"']").attr("data-rStatus",f);var m=i[r].livePeerId;$(".preview-list-container").find(".preview-item[data-rid='"+h+"']").attr("data-RlivePeerId",m)}y=[],0==$(".preview-content li").length?y.push($(".main-rList .rList-show").attr("data-peerid")):$.each($(".preview-content li"),function(e,t){y.push($(t).attr("data-rid"))}),k=[],$.each($(".pack-body .pack-operate"),function(e,t){k.push($(t).attr("data-peertid"))}),$.each($(".tvupack-body .pack-operate"),function(e,t){k.push($(t).attr("data-peertid"))});var g={type:"taskInfo",module:"taskInfo",sourceStr:k.join(","),programStr:y.join(",")};w.sendMsgs.taskInfo.message=g}}})},shareNum:function(e){var t={type:"shareNum",ridList:e};this.socket.send({message:t,time:1e3,key:"shareNum",success:function(e){if(e.shareNum){var t=JSON.parse(e.shareNum);if(""==t)return $(".Push_toAccount_comment .shareIcon").find(".icon-socialMeida").removeClass("active"),void $(".Push_toAccount_comment .shareIcon").find(".shareIcon-bottom").children(".shareCircle").css("display","none");t=t[0].shareInfo,$(".Push_toAccount_comment").find(".icon-socialMeida.active").removeClass("active"),$(".Push_toAccount_comment").find(".shareCircle").hide(),$.each(t,function(e,t){"producerPro"==t.liveModule&&($(".Push_toAccount_comment").find("[data-name='"+t.shareKey+"']").find(".icon-socialMeida").addClass("active"),$(".Push_toAccount_comment").find("[data-name='"+t.shareKey+"']").find(".shareCircle").css("display","inline-block"),$(".Push_toAccount_comment .gridShow").after($(".Push_toAccount_comment").find("[data-name='"+t.shareKey+"']")))})}}})},stop:function(){this.socket.has("shareNum")&&this.socket.stop("shareNum")},recover:function(){this.socket.has("shareNum")||this.shareNum($(".main-rList .rList-show").attr("data-peerId"))}};var pageRequestObj=new PageRequest;function updateRStatus(e){if(e){var a=currentRInfo.selectRId,r="",o=$(".main-rList .rList-show").attr("data-rIp");$.each(e,function(e,t){t.peerId==a&&(o!=t.ip&&$(".main-rList .rList-show").attr("data-rIp",t.ip),r=$(".main-rList .rList-show").attr("data-status"),$(".main-rList .rList-show").attr("data-status",t.status),currentRInfo.isLive=t.status,"2"===t.status?pageWebsocketObj.recover():"1"===t.status?(pageWebsocketObj.recover(),"0"==r&&(currentRInfo.isSwitch=!0,getUserBehavior())):"0"===t.status&&(console.log("当前R的状态为:"+t.status+" "+new Date),resetPage(),pageWebsocketObj.stop()));var i=$(".rList-content [data-peerId="+t.peerId+"]");i.html()!=t.name&&(i.html(t.name),i.attr("title",t.name)),i.attr("data-status")!=t.status&&(t.status<1?(i.removeClass("online"),$(".rList-content").append(i)):(i.addClass("online"),$(".rList-content").prepend(i)),i.attr("data-status",t.status))})}}function getLiveVideoId(e){var t=e.indexOf("/rtmp/")+6;return e.substring(t,t+15)}function resetPage(){$(".main-preview").removeAttr("data-filename"),$(".main-preview .preview-source .big-video").html(""),$(".main-output").removeAttr("data-filename"),$(".main-output .output-source .big-video").html(""),$(".sd-preview-list .preview-content").html(""),webrtcVideo.clear(),$(".operation-view-logo").removeClass("outputActive"),$(".operation-view-logo img").prop("src","./images/logo.png"),$(".pretreat-item-logo").removeClass("outputActive"),$(".operation-item-logo img").prop("src","./images/logo.png"),$(".output-top .shareCounts").html(0).removeClass("active"),$(".show-logo .pretreat-item-logo").remove(),$(".show-logo .pretreat-item-logo").remove(),$(".show-score .pretreat-item-score").remove(),$(".show-text .pretreat-item-text").remove(),$(".pip-picture").removeClass("created"),$(".afv-cut .radius-box").css("left","11px"),$(".afv-cut .afv-audio").addClass("disabled"),$(".afv-cut .afv-audio").html("Audio 1"),$(".afv-cut .radius-box").removeClass("close"),statusObj.pageInit=!0,volumeColumn.volumeObj={}}function initShareAccounts(){$(".pushing .websiteFilter").setSimulateSelect("all"),oUtils.ajaxReq("queryRtmpDetail",{type:"All",pageflag:"false"},function(e){"0x0"==e.errorCode?fn_updataToken(e=$.parseJSON(e.errorInfo)):0<e.errorInfo.indexOf("Null record")&&$(".pushing").find(".Push_toAccount_comment").html("")})}function fn_updataToken(e){var v=[];if(0<e.length){$.each(e,function(e,t){var i,a=t.type,r=t.nickName,o=t.rtmpId,s=t.appId,n=t.token,c=t.refreshAccessToken,l=(t.locale,t.should_not_tweet),d="";switch(a){case"F":i='<i class="iconfont icon-socialMeida icon-facebook icon-socialMeida-midddle icon-font-size showTitle icon-font-Facebooksize" data-website="'+a+'"></i>';break;case"Y":i='<i class="iconfont icon-socialMeida icon-youtube icon-socialMeida-midddlthisObjSe icon-font-size showTitle" data-website="'+a+'"></i>';break;case"I":i='<i class="icon-socialMeida icon-inke showTitle" data-website="'+a+'" data-rtmpId="'+o+'"></i>';break;case"P":i='<i class="icon-socialMeida icon-pandaTV showTitle" data-website="'+a+'"></i>';break;case"Z":i='<i class="icon-socialMeida icon-yiLive showTitle" data-website="'+a+'" data-rtmpId="'+o+'" data-token="'+n+'" data-scid="'+s+'"></i>';break;case"S":i='<i class="iconfont icon-socialMeida icon-periscope showTitle" data-website="'+a+'" data-refreshaccesstoken="'+c+'" data-token="'+n+'" data-should_not_tweet="'+l+'"></i>';break;case"O":i='<i class="iconfont icon-socialMeida icon-yunzhibo icon-socialMeida-midddle icon-font-size showTitle" data-website="'+a+'"></i>'}d="P"==a||"F"==a||"S"==a?r:o;var p=r;"S"!=a&&"F"!=a&&"O"!=a&&"P"!=a&&"Z"!=a&&"Y"!=a||(p="<span class='detialPush'>"+r+"</span>",d=switchLangObj.i18n_click2publish+" "+d);var u='<div class="shareIcon left" data-nickName="'+t.nickName+'" data-id="'+t.id+'" data-key="'+t.key+'" data-type="'+t.type+'" data-token="'+t.token+'" data-description="'+t.description+'" data-rtmpId="'+t.rtmpId+'" data-username="'+t.username+'" data-title="'+t.title+'" data-appId="'+t.appId+'" data-refreshAccessToken="'+t.refreshAccessToken+'" data-should_not_tweet="'+t.should_not_tweet+'"  data-name="'+r+'"  title="'+d+"/ "+r+'"><div class="dropdown_option checkbox shareOneSelectBtn selectPosition"><a href="javascript:;" class="ellipsis dropdown_option_item" data-value="'+r+'"></a></div>'+i+'<div class = "shareIcon-bottom"><span class="shareCircle hide"></span><span class="shareNickName ellipsis">'+p+"</span></div></div>";v.push(u)}),$(".pushing").find(".Push_toAccount_comment").html('<div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div>'+v.join("")),$(".pushing").find(".Push_toAccount_comment").fnNiceScroll()}}function fn_getAllShareAccount(){var i="All";if(!$(".websiteFilter .dropdown_menu li").eq(0).hasClass("active")){var e=$(".websiteFilter .dropdown_menu li.active");i="",$.each(e,function(e,t){i+=","+$(t).find("a").attr("data-value")}),i=i.slice(1)}var t={type:i,pageFlag:"false"};oUtils.ajaxReq("queryRtmpDetail",t,function(e){if("0x0"==e.errorCode)fn_updataToken(e=$.parseJSON(e.errorInfo));else if(-1<e.errorInfo.indexOf("Null record")){$(".pushing").find(".Push_toAccount_comment").html(' <div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div><div class="emptyPush"><div class="empty_box"><img src="images/empty_box.png" alt=""></div><span class="emptyData i18n" name="i18n_EmptyData">Empty Data</span></div>')}})}function fn_doShare(e,t,u,v,h,i){var a="";$(t.parents(".shareIcon")).each(function(){a+=$(this).attr("data-nickname")+","}),a=a.substr(0,a.length-1),$(".pushing").find(".loading").fadeIn(),$.ajax({type:"POST",url:"getRtmpUrl",data:{nickName:a,rId:u},dataType:"json",timeout:45e3,success:function(e){if("0x0"==e.errorCode){var t=e.errorInfo,l=[],d=[];if($.each($.parseJSON(t),function(e,t){var i=t.valid,a=(t.nickName,t.liveVideoId,t.rtmpUrl),r=t.scid;if("false"==i){var o={};o.nickName=t.nickName,o.type=t.type,o.rtmpUrl=t.rtmpUrl,l.push(o)}else{var s={rId:u,nickName:t.nickName,liveVideoId:t.liveVideoId,type:t.type,rtmpUrl:a,buildDate:"2017/1/17 16:10",livePeerId:h};if(d.push(s),r)for(var n=$("#"+u).find(".shareIcon").find(".shareNickName"),c=0;c<n.length;c++)n.eq(c).html()==t.nickName&&n.eq(c).parents(".shareIcon").children(".icon-socialMeida").attr("data-scid",r)}}),""!=l){var i=[],a=[],r=[];$.each(l,function(e,t){"I"===t.type?a.push(t.nickName):"P"===t.type?t.rtmpUrl&&(-1!=t.rtmpUrl.errorInfo.indexOf("room not exists")?r.push(t.nickName):i.push(t.nickName)):"Z"===t.type?t.rtmpUrl&&(500<t.rtmpUrl.result?a.push(t.nickName):i.push(t.nickName)):i.push(t.nickName)});var o="",s="";if(""!=i){var n=i.join(", ");s+="<div>Account "+n+" may be expired.</div>",o+="<div>账号 "+n+" 可能已过期。</div>"}if(""!=r){var c=r.join(", ");s+="<div>Account "+c+" does not have permission to go live on PandaTV.</div>",o+="<div>账号 "+c+" 在熊猫TV未开通直播权限。</div>"}if(""!=a){var p=a.join(", ");s+="<div>Account "+p+" failed to go live.</div>",o+="<div>账号 "+p+" 开启直播失败。</div>"}fn_switchLangAlertTip(s,o),$(".pushing").find(".loading").fadeOut()}""!=d&&fn_executeShareStreamUrl(d,u,e,v)}else $(".pushing").find(".loading").fadeOut()},error:function(){$(".pushing").find(".loading").fadeIn(),oUtils.alertTips("i18n_networkUnavailable")}})}function fn_executeShareStreamUrl(e,t,i,a){var r="";"0X0"!=i.errorCode&&"0x0"!=i.errorCode||(r=jQuery.parseJSON(i.errorInfo));var o=[],s=[],n=[],c=$(".main-preview").attr("data-livepeerId");$.each(r,function(e,t){var i={};i.nickName=t.nickName,i.url=t.rtmpUrl,i.type=t.type,n.push(i)}),$.each(r,function(e,t){if("false"!=t.valid){var i={};i.CopierNickName=t.nickName,i.EncoderIndex=1,i.RtmpUrl=t.rtmpUrl,i.CopierType=t.type,i.LiveModule="producerPro",0<o.length?$.each(o,function(e,t){t!=i.CopierType&&o.push(i.CopierType)}):o.push(i.CopierType),"F"==i.CopierType?(i.CopierType="Facebook",i.RetryTimes=10):"Y"==i.CopierType?(i.CopierType="Youtube",i.RetryTimes=0):"I"==i.CopierType?(i.CopierType="Inke",i.RetryTimes=0):"P"==i.CopierType?(i.CopierType="PandaTV",i.RetryTimes=0):"Z"==i.CopierType?(i.CopierType="Yi Live",i.RetryTimes=0):"S"==i.CopierType?(i.CopierType="Periscope",i.RetryTimes=0):"O"==i.CopierType&&(i.CopierType="Others",i.RetryTimes=0),s.push(i)}}),startCopierInfo(t,s,c,e)}function setInfo(t,i,e,a,r){var o={buildDate:"2017/1/17 16:10",rid:t,params:JSON.stringify({rid:t})};oUtils.ajaxReq("setStudioEncoderInfo",o,function(e){e.errorCode?($(".pushing").find(".loading").fadeOut(),console.log(e.errorInfo)):startCopierInfo(t,i,a,r)},!1)}function startCopierInfo(e,t,i,o){var a={rid:e,share:["share"],params:JSON.stringify(t),buildDate:"2017/1/17 16:10",encoderIndex:1,livePeerId:i,liveModule:"producerPro"};oUtils.ajaxReq("startStudioFileInfo",a,function(a){if("0X0"==a.errorCode||"0x0"==a.errorCode){var r=[];o&&$.each(o,function(e,t){t.liveModule="producerPro";var i=JSON.parse(a.errorInfo);$.each(i,function(e){t.nickName==e.copierNickName&&(t.encoderIndex=e.encoderIndex)}),r.push(JSON.stringify(t)),$(".pushing").find("[data-name='"+t.nickName+"']").children(".icon-socialMeida").addClass("active"),$(".pushing").find("[data-name='"+t.nickName+"']").find(".shareCircle").css("display","inline-block"),$(".Push_toAccount_comment .gridShow").after($(".Push_toAccount_comment").find("[data-name='"+t.nickName+"']"))});var e={shareDetail:r};oUtils.ajaxReq("saveShareDetail",e),$(".pushing").find(".block").parents(".shareIcon").removeClass("bgGreen"),$(".pushing").find(".block").removeClass("block selectAllBg")}$(".pushing").find(".loading").fadeOut()},null,null,function(){$(".pushing").find(".loading").fadeOut()})}function stopCopierInfo(){var e=$(".main-rList .rList-show").attr("data-peerId"),t=$(".main-preview").attr("data-livepeerId"),i=$(".push-foot .push-stop").parents(".push-foot").siblings(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").parents(".shareIcon").find(".shareNickName"),a=$(".push-foot .push-stop").parents(".push-foot").siblings(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").parents(".shareIcon").length,r=$(".main-output .shareCounts").html()-0,o=$(".pushing").find(".Push_toAccount_comment .block"),s=a<r?"":"1",n=[],c=[];if($.each(o,function(e,t){n.push($(t).attr("data-value"))}),a<r)$.each(i,function(e,t){var i={};i.CopierNickName=i.CopierNickName=$(t).parents(".shareIcon").attr("data-nickname"),i.EncoderIndex=1,c.push(i)});else{var l={};$.each(i,function(e,t){l.CopierNickName=[$(t).parents(".shareIcon").attr("data-nickname")]}),l.EncoderIndex=1,c.push(l)}var d={rid:e,buildDate:"2017/1/17 16:10",params:JSON.stringify(c),nickNameArr:n,encoderIndex:s,liveVideoId:t};oUtils.ajaxReq("stopStudioFileInfo",d,function(e){var t=e.errorCode;"0X0"==t||"0x0"==t?($(".Push_toAccount_comment").find(".block").parents(".shareIcon").children(".icon-socialMeida").removeClass("active"),$(".Push_toAccount_comment").find(".block").parents(".shareIcon").removeClass("bgRed").find(".shareCircle").hide(),$(".Push_toAccount_comment").find(".block").removeClass("block selectAllBg"),$(".shareIcon").find(".icon-socialMeida").hasClass("active")||0!=$(".Push_toAccount_comment").find(".bgRed").length||($(".push-live").removeClass("openLive"),$(".push-stop").addClass("hide"))):oUtils.alertTips("i18n_stopShareFailed")})}pageRequestObj.init(),$(function(){$(".sd-pretreat").on("click",".operation-confirm",function(){$(".sd-pretreat-operation").removeClass("active"),$(".sd-operation-type").css("display","block")}),$(".sd-pretreat").on("click",".operation-close",function(){$(".sd-pretreat-operation").removeClass("active"),$(".operation-text").removeAttr("disabled")}),$(".sd-pretreat").on("click",".operation-logo-label",function(e){$(this).hasClass("disabled")&&e.preventDefault()})}),$(function(){var e={checkbox:{parent:switchLangObj.i18n_socialAccount,selectAll:!0,children:[{val:"F",text:"Facebook"},{val:"Y",text:"YouTube"},{val:"Z",text:switchLangObj.i18n_YiLive},{val:"P",text:switchLangObj.i18n_pandaTV},{val:"S",text:"Periscope"},{val:"O",text:switchLangObj.i18n_Others}]}};$(".pushing .websiteFilter").createSimulateSelect(e,fn_getAllShareAccount,"val","text"),$(".pushing .websiteFilter").setSimulateSelect("all"),initShareAccounts(),$(".output-live").on("click",function(e){$(".rList-show").attr("data-status");$(".pushing").toggleClass("hide")}),$(".Push_toAccount_comment").hasClass("shareIcon")?$(".emptyPush").hide():$(".emptyPush").show(),$(".Push_toAccount_comment").on("mouseover",".shareIcon",function(){var e=$(this);e.find(".icon-socialMeida").hasClass("active")&&e.addClass("bghoverRed")}),$(".Push_toAccount_comment").on("mouseout",".shareIcon",function(){var e=$(this);e.find(".icon-socialMeida").hasClass("active")&&e.removeClass("bghoverRed")}),$(".push-foot").on("click",".SelectAllBtn .dropdown_option_item",function(){var e=$(this);$(".Push_toAccount_comment").hasClass("shareIcon")?$(".emptyPush").hide():$(".emptyPush").show(),e.hasClass("block selectAllBg")?(e.removeClass("block selectAllBg"),$(".push-live").removeClass("openLive"),e.parents(".pushing").find(".Push_toAccount_comment .dropdown_option_item").removeClass("block"),$(".shareIcon").find(".icon-socialMeida").hasClass("active")&&e.parents(".pushing").find(".shareIcon").removeClass("bgRed"),e.parents(".pushing").find(".shareIcon").removeClass("bgGreen")):(e.addClass("block selectAllBg"),$(".push-live").addClass("openLive"),e.parents(".pushing").find(".Push_toAccount_comment .dropdown_option_item").addClass("block"),$(".shareIcon").find(".icon-socialMeida").hasClass("active")?e.parents(".pushing").find(".shareIcon").addClass("bgRed"):e.parents(".pushing").find(".shareIcon").addClass("bgGreen"))}),$(".push-foot").on("click",".push-live",function(){var e=$(this),t=$(".main-rList .rList-show").attr("data-peerId"),i=$(".main-preview").attr("data-livepeerId"),a=e.parents(".pushing").find(".Push_toAccount_comment .block"),r=a.length,o=r+($(".main-output .shareCounts").html()-0);if(0<$(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").length)return oUtils.alertTips("i18n_stopThisVideoShareAnotherVideo",2e3),void e.parents(".liveVideo-item").find(".loading").fadeOut();if(0<r){var s=$(".main-preview").attr("data-maxCopierCount");if(s<o)return void fn_switchLangAlertTip("The max length you can share is "+s,"最多能分享"+s+"个");fn_doShare(e,a,t,!0,i)}else oUtils.alertTips("i18n_hasChoose",2e3)}),$(".push-foot").on("click",".push-stop",function(){var e=$(this),o=[],s=[];if(!e.hasClass("disabled")){var t=$(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").length,i=$(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active");if(0==t)return oUtils.alertTips("i18n_chooseLiveAccount",2e3),void e.parents(".liveVideo-item").find(".loading").fadeOut();$.each(i,function(e,t){var i=$(t).attr("data-website");if("Z"==i){var a={};a.scid=$(t).attr("data-scid"),a.memberid=$(t).attr("data-rtmpId"),a.accesstoken=$(t).attr("data-token"),o.push(a)}else if("S"==i){var r=$(t).parent().attr("data-name");s.push(r)}}),""!=o&&oUtils.ajaxReq("closeYizhiboPush",{param:JSON.stringify(o)}),0!=s.length&&oUtils.ajaxReq("stopPeriscopeBroadcast",{shareDetail:s}),stopCopierInfo()}}),$(".Push_toAccount_comment").on("click",".gridShow",function(){if(currentRInfo.isFlv&&($("#girdUrlShow").css("display","block"),"yes"!=$(".gridIssp").attr("data-issp"))){var e=[],t={};t.CopierNickName=Math.random(),t.EncoderIndex=1,t.RtmpUrl="default",t.CopierType="Others",t.LiveModule="producerPro",t.type=5,t.RetryTimes=0,e.push(t);var i={rid:$(".rList-show").attr("data-peerId"),share:["share"],params:JSON.stringify(e),buildDate:"2017/1/17 16:10",encoderIndex:1,livePeerId:$(".main-preview").attr("data-livepeerId"),liveModule:"producerPro"};oUtils.ajaxReq("startStudioFileInfo",i,function(e){"0X0"!=e.errorCode&&"0x0"!=e.errorCode||console.log(111)})}}),$("#girdUrlShow p").click(function(){$(".gridIssp").select(),document.execCommand("Copy"),oUtils.alertTips("i18n_Copyed",2e3)})});var widthAndHeight={resolutionW:1920,resolutionH:1080,getWTransRate:function(e,t){return e?e.width()/this.resolutionW:t?t/this.resolutionW:void 0},getHTransRate:function(e,t){return e?e.height()/this.resolutionH:t?t/this.resolutionH:void 0},getPriviewWidth:function(e,t,i){if(0==i)return 0;var a=void 0;return e&&(a=this.getWTransRate($(e),null)),t&&(a=this.getWTransRate(null,t)),i?Math.round(i*a):void 0},getPriviewHeight:function(e,t,i){if(0==i)return 0;var a=void 0;return e&&(a=this.getHTransRate($(e),null)),t&&(a=this.getHTransRate(null,t)),i?i*a:void 0},getOutputWidth:function(e,t){if(0==t)return 0;var i=this.getWTransRate($(e));return t?Math.round(t/i):void 0},getOutputHeight:function(e,t){if(0==t)return 0;var i=this.getHTransRate($(e));return t?Math.round(t/i):void 0}};$(".overlay-cut-btn").on("click",function(){$(".sd-pretreat-operation").removeClass("active");var e=$("#preview .xingquanDrag").length,t=$(".preview-source .scoreDiv").length,i=$("#preview .logo-box").length;return 7<e?(oUtils.alertTips("i18n_producerPro_maxOverlayNum"),!1):4<i-t?(oUtils.alertTips("i18n_producerPro_maxOverlayImgNum"),!1):(overlayCut.textCut(),overlayCut.pipCut(),void overlayCut.clockCut())}),$(".preview-list-container").on("click",function(){$(".sd-pretreat-operation").removeClass("active")});var overlayCut={isCut:!1,previewWidth:$("#preview").width(),textCut:function(){var e=$(".rList-show").attr("data-peerId");if(this.isCut=!0,0!=$("#preview .preTextarea").length||0!=$(".scoreText").length||0!=$(".clockDiv").length){var t=!1;sourceList.isOrCanvas&&(t=!0),updateMultiCheck(!1,t)}else{var i={peerId:e,params:JSON.stringify([])};oUtils.ajaxReq("subtitle_multiCheck",i,function(e){"0x0"==e.errorCode&&overlayCut.logoCut(),overlayCut.isCut=!1})}},logoCut:function(){this.isCut=!0;var e={peerId:$(".rList-show").attr("data-peerId")};1==sourceList.isOrCanvas&&$(".textDiv").addClass("logo-box");var d=[];if(0!=$(".preview-source .logo-box").length||0!=$(".preview-source .scoreDiv").length){var t=$(".preview-source .logo-box"),i=$(".preTextarea").css("transform");if(i&&(i=i.substring(7,i.indexOf(","))),0!=$(".preTextarea").length)var a=$(".preTextarea").html().gblen()/2,r={size:widthAndHeight.getOutputWidth("#preview",$("#preview .textDiv").width())+"x"+widthAndHeight.getOutputWidth("#preview",$("#preview .textDiv").height()),bgcolor:$("#preview .preTextarea").css("background-color"),color:$("#preview .preTextarea").css("color"),text:$("#preview .preTextarea").html(),fstyle:"normal",fweight:"normal",fsize:Math.round(widthAndHeight.getOutputWidth("#preview",$("#preview .textDiv").width())/a)+"px",ffamily:$("#preview .preTextarea").css("font-family")},p=placeholder.getData(r);t.each(function(e,t){var i={},a="";if($(t).hasClass("textDiv")||$(t).hasClass("scoreDiv")){var r=$(t).width(),o=$(t).height(),s=$(t).position().left;a=o/r;var n=$(t).position().top,c=$("#preview").width()-s-r;if(i.xOffset=widthAndHeight.getOutputWidth("#preview",c),i.yOffset=widthAndHeight.getOutputHeight("#preview",n),i.imageWidth=widthAndHeight.getOutputWidth("#preview",r),i.imageHeight=widthAndHeight.getOutputHeight("#preview",o),i.id=$(t).attr("data-id"),1==sourceList.isOrCanvas&&$(t).hasClass("textDiv")){var l=p.indexOf(",");i.base64=p.substring(l+1)}}else{a=(i=getAttrs($(".pretreat-content-item[data-id='"+$(t).attr("data-id")+"']"),i={imageWidth:"",imageHeight:"",logoYOffset:"",logoXOffset:"",url:"",id:""})).imageHeight/i.imageWidth,i.xOffset=i.logoXOffset,i.yOffset=i.logoYOffset}i.xOffset=needEven(i.xOffset),i.yOffset=needEven(i.yOffset),i.imageWidth=needEven(i.imageWidth),i.imageHeight=i.imageWidth*a,$(t).css({width:widthAndHeight.getPriviewWidth("#preview",null,i.imageWidth)+"px",height:widthAndHeight.getPriviewWidth("#preview",null,i.imageWidth*a)+"px",top:widthAndHeight.getPriviewHeight("#preview",null,i.yOffset)+"px"}),$(t).css({left:widthAndHeight.getPriviewWidth("#preview",null,widthAndHeight.resolutionW-i.xOffset-i.imageWidth)+"px"}),i.zorder=3,$(t).hasClass("scoreDiv")&&(i.zorder=6),d.push(i)}),e.params=JSON.stringify(d),$.ajax({type:"POST",url:"logo_multiCheck",data:e,success:function(e){if("0x0"===(e=JSON.parse(e)).errorCode)for(var t=e.result,i=0;i<t.length;i++){1!=t[i].scoreBoard?overlying.logoInit(t[i],!0):overlying.scoreInit(t[i],!0)}else oUtils.alertTips(e.errorInfo,2e3);overlayCut.isCut=!1},error:function(e){console.log(e)}})}else oUtils.ajaxReq("logo_clear",e,function(e){"0x0"!==e.errorCode&&(overlayCut.isCut=!1)})},pipCut:function(){var e={dataType:"pip",peerId:currentRInfo.selectRId};if(0!=$("#preview .pip").length){if(!$(".pretreat-content .pip")||!$(".pretreat-content .pip").attr("data-id"))return;var t=overToPreview.getPipInfo();if(t.id=$(".pretreat-content .pip").attr("data-id"),$(".afv-cut .radius-box").hasClass("close")){var i=$(".afv-audio-cut .afv-audio").html().substring(6),a=$(".preview-content .preview-item").eq(i-1).attr("data-filename");t.selectedAudio=a,t.audioStatus=0}else t.audioStatus=1;e.pipParams=JSON.stringify(t)}else{var r=$(".main-output").attr("data-filename");e.pipParams=JSON.stringify({pipAudioSharedMemoryName:r})}var o=[],s=$(".preview-content li.pipOutputActive");if(0!==s.length){var n=s.attr("data-rid");if(n){var c={};c.rid=n,s.hasClass("outPutActive")||!s.hasClass("previewActive")&&!s.hasClass("pipPreviewActive")?s.hasClass("outPutActive")||s.hasClass("previewActive")||s.hasClass("pipPreviewActive")||(c.type=130,o.push(c)):(c.type=131,o.push(c))}}$(".preview-content li").removeClass("pipOutputActive"),$(".preview-content li.pipPreviewActive").addClass("pipOutputActive");var l=$(".preview-content li.pipOutputActive"),d=l.attr("data-rid");if(d){var p={};p.rid=d,l.hasClass("outPutActive")||(p.type=132,o.push(p))}e.tallyArray=JSON.stringify(o),oUtils.ajaxReq("studio_check",e,function(e){if(overlayCut.isCut=!1,"0x0"===e.errorCode){if(0==$("#preview .pip").length)return $(".main-output").removeAttr("data-pipfilename"),void $(".preview-list-container li.pipOutputActive").removeClass("pipOutputActive");overlying.pipInit(e.result.pip)}else oUtils.alertTips(e.errorInfo,1500)})},clockCut:function(){$(".rList-show").attr("data-peerId");if(this.isCut=!0,0<$("#preview").find(".clockDiv").length)var e=$(".clockTextarea").html().split(":"),t=60*parseInt(e[0])*1e3+1e3*parseInt(e[1]);var i=$(".defaultTime input").val();(""==i&&(i=1e4),clockObj.clockEndTime=60*parseInt(i),$(".clockStart").hasClass("hide"))?($(".clockDiv").attr("data-operation","run"),saveClockuserBehavior("start","pgm")):saveClockuserBehavior($(".clockDiv").attr("data-operation"),"pgm");applyClockToPgm(t,1e3*clockObj.clockEndTime)},score:function(w){var y=$("#preview").width(),k=[];return(1==w?$(".scoreDiv.score-hide .scoreText"):$(".scoreDiv.score-active .scoreText")).each(function(e,t){var i=$(this),a=$(this).parent(),r=i.css("color");r="rgb(255, 255, 255)"==r?"FFFFFFFF":"FF000000";var o=parseInt(i.css("left").split("p")[0]),s=parseInt(i.css("top").split("p")[0])+parseInt(a.css("top").split("p")[0]),n=i.width(),c=i.height(),l=i.css("fontFamily"),d=i.val(),p=i.attr("data-scoreTextId"),u=r,v=(s=widthAndHeight.getOutputHeight("#preview",s),i.css("font-size").split("p")[0]);v=widthAndHeight.getOutputWidth("#preview",v);var h=a.width()-o-n,f=y-parseInt(a.css("left").split("p")[0])-a.width()+h;f=widthAndHeight.getOutputWidth("#preview",f),n=widthAndHeight.getOutputWidth("#preview",n),c=widthAndHeight.getOutputWidth("#preview",c);var m={};m.fontSize=v,m.backgroundColor="00000000",m.fontName=l,m.foregroundColor=u,m.foregroundColor=u;var g={};""==p&&null==p||(g.textId=p),g.text=d,g.yOffset=s,g.xOffset=f,g.zorder=7,g.style=m,g.width=n,g.height=c,g.horizonAlign="center",g.verticalAlign="center",w?k.push(JSON.stringify(g)):k.push(g)}),k},subtitleCom:function(){var e,t=$(".preTextarea").text(),i=$(".preTextarea").attr("data-id"),a=$(".preTextarea").css("font-size");a=a.split("p")[0];var r=$(".preTextarea").css("transform");r&&(a*=r=r.substring(7,r.indexOf(",")));var o=$(".preTextarea").css("font-family");e=changeColor($(".textDiv").css("background-color")).substring(1,9);var s=changeColor($(".preTextarea").css("color")).substring(1,9),n=$(".textDiv").position().left,c=$(".textDiv").position().top,l=$(".textDiv").width(),d=$(".textDiv").height(),p=$("#preview").width()-n-l;c=widthAndHeight.getOutputHeight("#preview",c),p=widthAndHeight.getOutputWidth("#preview",p),a=widthAndHeight.getOutputWidth("#preview",a),l=widthAndHeight.getOutputWidth("#preview",l),d=widthAndHeight.getOutputWidth("#preview",d);var u={},v={};return v.fontSize=a,v.backgroundColor=e,v.fontName=o,v.foregroundColor=s,u.text=t,u.yOffset=c,u.xOffset=p,u.style=v,u.zorder=2,u.width=l,u.height=d,u.horizonAlign="center",u.verticalAlign="center",""==i&&null==i||(u.textId=i),u},clockSubtitle:function(){var e=$(".clockTextarea").text(),t=$(".clockDiv").attr("data-id"),i=$(".clockDiv").css("font-size");i=i.split("p")[0];var a=$(".clockDiv").css("font-family");changeColor($(".clockDiv").css("background-color")).substring(1,9);var r=changeColor($(".clockDiv").css("color")).substring(1,9),o=$(".clockDiv").position().left,s=$(".clockDiv").position().top,n=$(".clockDiv").width(),c=$(".clockDiv").css("border-width").split("p")[0],l=$(".clockDiv").height(),d=$("#preview").width()-o-n;s=widthAndHeight.getOutputHeight("#preview",s),d=widthAndHeight.getOutputWidth("#preview",d),i=widthAndHeight.getOutputWidth("#preview",i),n=widthAndHeight.getOutputWidth("#preview",n),l=widthAndHeight.getOutputWidth("#preview",l),c=widthAndHeight.getOutputWidth("#preview",c);var p={},u={};return u.fontSize=i,u.fontName=a,u.foregroundColor=r,u.text=e,p.yOffset=s,p.xOffset=d,p.style=u,p.zorder=7,p.width=n,p.height=l,p.horizonAlign="left",p.verticalAlign="center",""==t&&null==t||(p.id=t),p}};function needEven(e){return e%2==1&&e++,e}var overToPreview={textResize:!0,logoInit:function(i){var e=$("#preview .logo-box"),a=!0;e.each(function(e,t){$(t).attr("data-id")!=i.id||(a=!1)});var t=void 0;if(a){var r,o;if(null==i.imageWidth||""==i.imageWidth){var s=i.size.split("x");i.imageWidth=s[0],i.imageHeight=s[1],t=i.imageHeight/i.imageWidth,i.imageWidth=needEven(i.imageWidth),i.imageHeight=Math.round(i.imageWidth*t),t=i.imageHeight/i.imageWidth}t||(t=i.imageHeight/i.imageWidth),o=(r=widthAndHeight.getPriviewWidth("#preview",null,i.imageWidth))*t;var n="",c="",l=widthAndHeight.getPriviewHeight("#preview",null,i.logoYOffset);i.logoXOffset+i.imageWidth>widthAndHeight.resolutionW/2?(c=widthAndHeight.resolutionW-i.logoXOffset-i.imageWidth,n+="left:",(c=widthAndHeight.getPriviewWidth("#preview",null,c))<0&&(c=0)):(c=i.logoXOffset,c=widthAndHeight.getPriviewWidth("#preview",null,c),n+="right:"),r+c>$("#preview").width()&&(c=$("#preview").width()-r),o+l>$("#preview").height()&&(l=$("#preview").height()-o),n+=c+"px;";var d='<div class="logo-box logo'+i.id+'" data-imageWidth="'+i.imageWidth+'" data-imageHeight="'+i.imageHeight+'" data-logoYOffset="'+i.logoYOffset+'"  data-logoXOffset="'+i.logoXOffset+'" data-url="'+i.url+'" data-id="'+i.id+'" style="width:'+r+"px;height:"+o+"px;top:"+l+"px; "+n+'z-index:4;"><img src="'+i.url+'" alt="" style="display:block;width:100%;height:100%"></div>';$("#preview").append(d),$(".preview-source .logo"+i.id).hasClass(".scoreDiv")||$(".preview-source .logo"+i.id).DragAndDrop({callback:correctDrag.correctLogo,rate:t})}},scoreInit:function(i,e,t){var a=$("#preview .scoreDiv"),r=!0;if(a.each(function(e,t){$(t).attr("data-id")!=i.id||(r=!1)}),i.scoreBoard){if(r){var o,s,n,c;if(i.size){var l=i.size.split("x");i.imageWidth=l[0],i.imageHeight=l[1]}o=widthAndHeight.getPriviewWidth("#preview",null,i.imageWidth),s=widthAndHeight.getPriviewHeight("#preview",null,i.imageHeight),n=widthAndHeight.getPriviewHeight("#preview",null,i.logoYOffset),c=widthAndHeight.getPriviewWidth("#preview",null,i.logoXOffset);for(var d=$(".preview-source").width()-c-o,p='<div class="scoreDiv score-active logo-box score'+i.id+'" data-scoreBord=1 data-imageWidth="'+i.imageWidth+'" data-url="'+i.url+'" data-imageHeight="'+i.imageHeight+'"data-logoYOffset="'+i.logoYOffset+'"  data-logoXOffset="'+i.logoXOffset+'"data-id="'+i.id+'"><img src="'+i.url+'" alt="">',u=i.subtitles,v=0;v<u.length;v++){var h=u[v].style;"object"!=(void 0===h?"undefined":_typeof(h))&&(0==h.indexOf('"')&&(h=h.substring(1,h.length-1)),h=JSON.parse(h));var f=h.fontSize;f=widthAndHeight.getPriviewHeight("#preview",null,f);var m=u[v].yOffset-i.logoYOffset;m=widthAndHeight.getPriviewHeight("#preview",null,m);var g=u[v].xOffset-i.logoXOffset,w=(g=widthAndHeight.getPriviewWidth("#preview",null,g),u[v].width);w=widthAndHeight.getPriviewWidth("#preview",null,w);var y=u[v].height;y=widthAndHeight.getPriviewHeight("#preview",null,y),p+='<input type="text" class="scoreText scoreText'+(v+1)+'" data-zorder=3 value="'+u[v].text+'" data-scoreTextId="'+u[v].id+'"  style=" background-color:transparent;color:#'+h.foregroundColor.slice(2,8)+';">'}p+="</div>",$("#preview").append(p),$(".scoreDiv").attr("style","position:absolute;top:"+n+"px;left:"+d+"px; height:"+s+"px; width:"+o+"px; z-index:5;"),$("#preview .score"+i.id).DragAndDrop({resize:!1}),"zh-CN"==window.navigator.language||"zh"==window.navigator.language?$(".scoreText").css("font-family","SimHei"):("en-US"==window.navigator.language||window.navigator.language,$(".scoreText").css("font-family","Arial"));var k=$(".scoreDiv").attr("data-url"),C=parseInt(k.substring(15,16))+1;$(".scoreDiv").addClass("scorePreview"+C)}}else r=!1},textInit:function(e){if(null==e.logoId||""==e.logoId){var t=e.style;"object"!=(void 0===t?"undefined":_typeof(t))&&(0==t.indexOf('"')&&(t=t.substring(1,t.length-1)),t=JSON.parse(t));t.backgroundColor;var i=HexToRgba(t.backgroundColor.slice(2,8),t.backgroundColor.slice(0,2)),a=t.foregroundColor.slice(2,8),r=widthAndHeight.getPriviewHeight("#preview",null,e.yOffset),o=widthAndHeight.getPriviewWidth("#preview",null,e.xOffset),s=widthAndHeight.getPriviewWidth("#preview",null,t.fontSize);$("#fontFamily").val(t.fontName);var n='<div class="textDiv" onpaste="javascript:return false;" style=" background-color:"><div class="preTextarea" maxlength="128" contentEditable data-textYOffset="'+r+'"   data-textXOffset="'+o+'" data-Id="'+e.id+'" data-zorder="'+e.zorder+'"   style="white-space:pre;text-overflow: ellipsis; font-size:'+s+"px;right:"+o+"; color:#"+a+"; font-family:"+t.fontName+';" >'+e.text+"</div></div>";$("#preview").append(n);var c=$("#preview").width()-o-$(".textDiv").width();$(".textDiv").attr("style","position:absolute;top:"+r+"px;left:"+c+"px;z-index:3;background-color:"+i+";"),$(".textDiv").DragAndDrop({scale:!0,scaleClassName:".preTextarea",callback:correctDrag.textBlur})}},clockInit:function(e){var t,i=e.style;null!=i&&"object"!=(void 0===i?"undefined":_typeof(i))&&(0==i.indexOf('"')&&(i=i.substring(1,i.length-1)),i=JSON.parse(i));i.foregroundColor.slice(2,8);var a=widthAndHeight.getPriviewHeight("#preview",null,e.yOffset),r=widthAndHeight.getPriviewWidth("#preview",null,e.xOffset),o=widthAndHeight.getPriviewWidth("#preview",null,e.fontSize),s=i.text,n=s.split(":"),c=60*parseInt(n[0]),l=parseInt(n[1]),d=parseInt(c+l),p=webflv.playObj[$(".main-preview .main-player").attr("id")].player,u=Math.round(1e3*p.currentTime)+p._muxer.dtsBase;if(-1==u)return console.log("Cannot get timecode from flv player.pvw"),void oUtils.alertTips("i18n_ToRefesh");var v=e.timestamp,h=e.endTime,f="";e.operation;if("start"!=checkLocation("status"))f=s,t=d;else{var m=u-v;clockObj.clockSeconds=parseInt(m/1e3)+d,t=clockObj.clockSeconds,f=TimeByms(clockObj.clockSeconds)}var g="";g=h/1e3<t?"red":"";var w='<div class="clockDiv" data-check="'+e.checked+'" data-operation="'+e.operation+'" data-Id="'+e.id+'" data-zorder="'+e.zorder+'" style="'+g+'"><div class="clockTextarea">'+f+"</div></div>";$("#preview").append(w);var y=$("#preview").width()-r-$(".clockDiv").width();$(".clockDiv").attr("style","position:absolute;top:"+a+"px;left:"+y+"px;z-index:5;background-color:"+g+";font-size:"+o+"px"),$(".clockDiv").DragAndDrop({resize:!1,callback:correctDrag.correctClock})},pipInit:function(e,t){var i='<div class="pip" style="width:'+widthAndHeight.getPriviewWidth("#preview",null,e.pipWidth)+"px;height:"+widthAndHeight.getPriviewHeight("#preview",null,e.pipHeight)+"px;right:"+widthAndHeight.getPriviewWidth("#preview",null,e.pipXOffset)+"px;top:"+widthAndHeight.getPriviewHeight("#preview",null,e.pipYOffset)+'px;z-index:2;" data-pipVideoSharedMemoryName="'+e.pipVideoSharedMemoryName+'" data-pipAudioSharedMemoryName="'+e.pipAudioSharedMemoryName+'" data-filename="'+e.pipVideoSharedMemoryName+'" data-audiostatus="'+e.audioStatus+'" data-id="'+e.id+'"><video autoplay style="display:inline-block;z-index:1;width:100%;height:100%;" class="preview-item-video"></video></div>';$("#preview").append(i),$("#preview .pip").DragAndDrop({callback:correctDrag.correctPip}),createPipVideo(t)},getPipInfo:function(){var e=$("#preview .pip"),t=e.width(),i=e.height(),a=e.position().top;e.position().left;return i=(e=$(".pretreat-content-item[data-id='"+e.attr("data-id")+"']")).attr("data-pipheight"),t=e.attr("data-pipwidth"),a=e.attr("data-pipyoffset"),{pipXOffset:e.attr("data-pipxoffset"),pipYOffset:a,zorder:1,pipWidth:t,pipHeight:i,pipVideoSharedMemoryName:$("#preview .pip").attr("data-pipVideoSharedMemoryName"),pipAudioSharedMemoryName:$("#preview .pip").attr("data-pipAudioSharedMemoryName"),audioStatus:$("#preview .pip").attr("data-audiostatus")}}};function getAttrs(e,t){for(var i in t)t[i]=$(e).attr("data-"+i);return t}function getAfvCloseAudioIndex(){var e=$(".afv-audio-cut .afv-audio").html(),t=e.indexOf("o");return e.substring(t+1)-1}function fontInfo(e){var t=e.css("background-color");$(".left .sp-preview-inner").css("background-color",t);var i=e.css("color");$(".sd-font-color .sp-preview-inner").css("background-color",i);var a=e.css("font-family");$("#fontFamily").text(a);var r=e.css("font-size").split("p")[0];$(".size-input").text(r);var o=e.text();$("#sd-textarea").val(o)}function changeColor(e){if(/rgb?/.test(e)){var t=e.split(",");e="#";var i="";3<t.length?(i=t[3].replace(/[^\d]/gi,""),0==(i=parseInt(i/100*255,10).toString(16))?e="#00":e+=i):e+="FF";for(var a,r=0;r<3;)a=t[r++],e+=1==(a=parseInt(a.replace(/[^\d]/gi,""),10).toString(16)).length?"0"+a:a;e=e.toUpperCase()}return e}function HexToRgba(e,t){var i=parseInt("0x"+t,16);return i=(i/=255).toFixed(2),"rgba("+parseInt("0x"+e.slice(0,2))+","+parseInt("0x"+e.slice(2,4))+","+parseInt("0x"+e.slice(4,6))+","+i+")"}function addText(){if(0!=$(".preTextarea").length){$(".preTextarea").text();var e=$(".rList-show").attr("data-peerId"),t=overlayCut.subtitleCom();$.ajax({type:"POST",url:"subtitle_add",data:{peerId:e,params:JSON.stringify(t)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.errorInfo,i=t.id;$(".preTextarea").attr("data-id",i),overlying.textInit(t)}}})}}function updateText(){var e=$(".rList-show").attr("data-peerId"),t=$(".preTextarea").attr("data-id"),i=overlayCut.subtitleCom();$.ajax({type:"POST",url:"subtitle_update",data:{peerId:e,textId:t,params:JSON.stringify(i)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.errorInfo;t.id;overlying.textInit(t,!0)}}})}function addClock(e){var t=$(".rList-show").attr("data-peerId"),i=webflv.playObj[$(".main-preview .main-player").attr("id")].player,a=Math.round(1e3*i.currentTime)+i._muxer.dtsBase,r=overlayCut.clockSubtitle();r.startTime=0,r.endTime=1e3*e,r.timestamp=a,r.operation="create",$.ajax({type:"POST",url:"clock_add",async:!1,data:{peerId:t,params:JSON.stringify(r)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.result,i=t.id;$(".clockDiv").attr("data-id",i),overlying.clockInit(t)}}})}function updateClock(e,t,i){var a=$(".clockDiv").attr("data-id"),r=webflv.playObj[$(".main-preview .main-player").attr("id")].player,o=Math.round(1e3*r.currentTime)+r._muxer.dtsBase,s={};a?((s=overlayCut.clockSubtitle()).startTime=e,s.endTime=t,s.timestamp=o,s.operation=i):((s={operation:"destroy",xOffset:101,yOffset:10,zorder:1,height:300,width:200,startTime:111,endTime:1e5,timestamp:12345678}).style={fontSize:93,backgroundColor:"00000000",fontName:"Arial",foregroundColor:"FFFFFFFF"},clockid=""),$.ajax({type:"POST",url:"clock_update",async:!1,data:{id:a,params:JSON.stringify(s)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.result;if(null!=t&&""!=t){var i=t.checked;$(".clockDiv").attr("data-check",i);overlying.clockInit(t,!0)}}}})}function applyClockToPgm(e,t){var i=$(".rList-show").attr("data-peerId"),a=$(".clockDiv").attr("data-id"),r=webflv.playObj[$(".main-preview .main-player").attr("id")].player,o=Math.round(1e3*r.currentTime)+r._muxer.dtsBase,s={};if(a){var n=$(".clockDiv").attr("data-operation");(s=overlayCut.clockSubtitle()).startTime=e,s.endTime=t,s.timestamp=o,s.operation=n}else{(s={operation:"destroy",xOffset:101,yOffset:10,zorder:1,height:300,width:200,startTime:111,endTime:1e5,timestamp:12345678}).style={fontSize:93,backgroundColor:"00000000",fontName:"Arial",foregroundColor:"FFFFFFFF"},a="";var c=$(".show-clock .pretreat-item-clock")}$.ajax({type:"POST",url:"clock_check",data:{peerId:i,id:a,params:JSON.stringify(s)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.result;if(null!=t&&""!=t){var i=t.checked;$(".clockDiv").attr("data-check",i);overlying.clockInit(t,!0)}if("destroy"==s.operation&&0!==c.length){var a=c.attr("data-params");a=decodeURIComponent(a),(a=JSON.parse(a)).operation="create",a=JSON.stringify(a);var r=encodeURIComponent(a);c.attr("data-params",r),$(".clockStart").hasClass("hide")?saveClockuserBehavior("start","pvw"):saveClockuserBehavior("create","pvw")}}overlayCut.isCut=!1}})}function saveClockuserBehavior(e,t){var i={};i.status=e,i.location=t,updateUserBehavior(i),$.ajax({type:"POST",url:"saveUserBehavior",data:{pn:"sd",remark:"ProgramClock",content:JSON.stringify(i)},success:function(e){e=JSON.parse(e)}})}function createSocre(e){var t,i,a,r,o,s,n=$("#preview").width(),c=$("#preview").height(),l="";0==e?(i="score_bg1",a="scorePreview2",r="235x118",o=widthAndHeight.getPriviewHeight(null,c,118),s=widthAndHeight.getPriviewWidth(null,n,235)):1==e?(i="score_bg2",a="scorePreview3",r="294x130",o=widthAndHeight.getPriviewHeight(null,c,130),s=widthAndHeight.getPriviewWidth(null,n,294)):2==e?(i="score_bg3",a="scorePreview4",r="725x118",l='<input type="text" class="scoreText5 scoreText" data-bind-5="name" value="1st">',o=widthAndHeight.getPriviewHeight(null,c,118),s=widthAndHeight.getPriviewWidth(null,n,725)):(i="score_bg5",a="scorePreview6",r="541x94",l='<input type="text" class="scoreText5 scoreText" data-bind-5="name" value="AGG" readonly>\t\t\t    <input type="text" class="scoreText6 scoreText" data-bind-5="name" max-lengt=3 value="0">\t\t\t    <input type="text" class="scoreText7 scoreText" data-bind-5="name" max-lengt=3 value="0">',o=widthAndHeight.getPriviewHeight(null,c,94),s=widthAndHeight.getPriviewWidth(null,n,541)),t='<div class="scoreDiv  score-hide '+a+' logo-box" style="height:'+o+"px; width:"+s+'px;display:none;">\t\t<img src="images/'+i+'.png">\t\t<input type="text" class="scoreText1 scoreText" data-bind-1="name" value="Text">\t\t<input type="text" class="scoreText2 scoreText" data-bind-2="name" value="0">\t    <input type="text" class="scoreText3 scoreText" data-bind-3="name" value="Text">\t\t<input type="text" class="scoreText4 scoreText" data-bind-4="name" value="0">'+l,t+="</div>",$("#preview").append(t),$(".scoreDiv").DragAndDrop({resize:!1}),addScore(r,i)}function addScore(e,a){$(".score-pattern").addClass("disabled");var t=$(".rList-show").attr("data-peerId"),i=overlayCut.score(!0);a="images/"+a+".png",$.ajax({type:"POST",url:"logo_uploadLogo",data:{peerId:t,uploadContentType:"png",isScore:1,module:"1",size:""+e,zorder:3,uploadFileName:a,relativePath:a,params:"["+i.join(",")+"]"},success:function(e){if(e=JSON.parse(e),$(".score-pattern").removeClass("disabled"),"0x0"==e.errorCode){$("#preview .scoreDiv").remove(),$(".scoreLoading").addClass("hide"),$(".operation-view-score").css("border",""),$(".operation-view-score[data-url='"+a+"']").css("border","1px solid #41FF6D");var t=e.result;overToPreview.scoreInit(t),overlying.scoreInit(t,!1,!0)}else if("0x80100003"==e.errorCode){if("Query preload image failed"==e.errorInfo)$(".scoreDiv.score-hide").remove(),oUtils.alertTips("i18n_preload");else if("Cannot upload repeat score board!"==e.errorInfo){$(".operation-view-score").css("border",""),$(".operation-view-score[data-url='"+a+"']").css("border","1px solid #41FF6D");var i=$(".pretreat-content .pretreat-item-score[data-url='"+a+"']");i.hasClass("check")?$(".scoreDiv.score-hide").remove():i.trigger("click")}else oUtils.alertTips("i18n_uploadScoreFai");$(".scoreLoading").addClass("hide")}else $(".scoreDiv").remove(),$(".scoreLoading").addClass("hide")},error:function(e){$(".score-pattern").removeClass("disabled"),oUtils.alertTips("i18n_uploadScoreFail"),$(".scoreDiv.score-hide").remove(),$(".scoreLoading").addClass("hide"),$("#file_p").val(""),$("#loading-Bg").fadeOut()}})}function updateMultiCheck(e,t){var i=$(".preTextarea").text(),a=$(".scoreDiv").attr("data-id"),r=$(".rList-show").attr("data-peerId"),o=($(".preTextarea").attr("data-id"),$(".clockDiv").attr("data-id"),[]);if(null!=i&&""!=i){var s=overlayCut.subtitleCom();if(t){var n={size:s.width+"x"+s.height,bgcolor:$(".preview-source .textDiv").css("background-color"),color:$(".preview-source .preTextarea").css("color"),text:$(".preview-source .preTextarea").html(),fstyle:"normal",fweight:"normal",fsize:s.style.fontSize,ffamily:$(".preview-source .preTextarea").css("font-family")},c=(t=placeholder.getData(n)).indexOf(",");console.log(t),s.base64=t.substring(c+1)}o.push(s)}if(a){var l=overlayCut.score(!1);o=o.concat(l)}$.ajax({type:"POST",url:"subtitle_multiCheck",data:{peerId:r,params:JSON.stringify(o)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.errorInfo;if(0!=t.length)for(var i=[],a=0;a<t.length;a++){null==t[a].logoId?overlying.textInit(t[a],!0):i.push(t[a])}overlayCut.logoCut()}overlayCut.isCut=!1}})}function createPipToInit(e){var t=widthAndHeight.getPriviewWidth("#preview",null,640),i=.5625*t,a=widthAndHeight.getPriviewWidth("#preview",null,1100),r=widthAndHeight.getPriviewHeight("#preview",null,560),o=$(".preview-content .preview-item").eq(0).find("video").attr("id"),s='<div class="pip" style="width:'+t+"px;height:"+i+"px;right:"+a+"px;top:"+r+'px;z-index:2;"><video autoplay style="display:inline-block;z-index:1;width:100%;height:100%;" class="preview-item-video"></video></div>';$("#preview").append(s),$("#preview .pip").DragAndDrop({callback:correctDrag.correctPip}),createPipVideo(o),e.addClass("created");var n=overToPreview.getPipInfo(),c=$(".preview-content .preview-item").eq(0).attr("data-filename");$(".preview-content .preview-item").eq(0).addClass("pipPreviewActive"),$(".main-preview .icon-erphone").hasClass("active")&&setPipVideoVolume();var l=$(".preview-content .preview-item").eq(0),d=l.attr("data-rid"),p=[];if(d){var u={};u.rid=d,l.hasClass("outPutActive")||l.hasClass("pipOutPutActive")||(u.type=131,p.push(u))}n.pipVideoSharedMemoryName=c,n.pipAudioSharedMemoryName=$(".main-preview").attr("data-filename"),n.peerId=$(".rList-show").attr("data-peerId"),n.pipXOffset=1100,n.pipYOffset=560,n.pipWidth=640,n.pipHeight=360,n.tallyArray=JSON.stringify(p),$(".pretreat-content .pip").remove();studioAdd(n,0)}function studioAdd(t,i){oUtils.ajaxReq("studio_add",t,function(e){"0x0"==e.errorCode?overlying.pipInit(e.result):(1==++i&&oUtils.ajaxReq("studio_add",t,function(e){"0x0"==e.errorCode?overlying.pipInit(e.result):console.log(e.errorInfo)}),console.log(e.errorInfo))})}function createPipVideo(e){var t=$("#preview .pip").find("video").attr("id");t&&webflv.playObj[t]&&(void 0!==(o=webflv.playObj[t].player)&&null!=o&&(webflv.playObj[t].wsreader.destroy(),webflv.playObj[t].player.pause(),webflv.playObj[t].player.detachMediaElement(),webflv.playObj[t].player.destroy(),webflv.playObj[t].player=null));var i=$("#preview .pip").find("video")[0],a=e.replace(/_/g,"/"),r=wpjs.createWSReader(i),o=wpjs.createPlayer({isLive:!0,lazyLoadMaxDuration:60,seekType:"range"}),s=a.replace(/\//g,"_");$("#preview .pip").find("video").attr("id",s+"_pip"),webflv.playObj[s+"_pip"]={player:o,wsreader:r},o.init(i),r.onReconnect=o.reset.bind(o),r.onMetadataArrived=o.onMetadataReceived.bind(o),r.onVideoSampleArrived=o.appendVideoSample.bind(o),r.onAudioSampleArrived=o.appendAudioSample.bind(o),a="ws://"+$(".main-rList .rList-show").attr("data-rip")+":"+a,r.open(a),$(".preview-voice .voice-control-mark").hasClass("icon-novoice")?$("#preview .pip").find("video")[0].volume=0:$("#preview .pip").find("video")[0].volume=$(".preview-voice .voice-value").html().trim()/100}function changePipSource(e){var t=$(".preview-content li").eq(e-1),i=t.attr("data-filename");if(i!=$(".preview-source .pip").attr("data-filename")){var a=$(".pretreat-content .pip"),r={id:$(".pretreat-content .pip").attr("data-id"),pipVideoSharedMemoryName:i};a.hasClass("check")||(r.checked=1);var o,s=$(".preview-content .preview-item.pipPreviewActive"),n=[];if(o=s.attr("data-rid")){var c={};c.rid=o,s.hasClass("outPutActive")||s.hasClass("pipOutputActive")||s.hasClass("previewActive")||(c.type=130,n.push(c))}if($(".main-preview .icon-erphone").hasClass("active")&&delPipVideoVolume("pipPreviewActive"),$(".preview-content li").removeClass("pipPreviewActive"),t.addClass("pipPreviewActive"),$(".main-preview .icon-erphone").hasClass("active")&&setPipVideoVolume(),o=(s=$(".preview-content .preview-item.pipPreviewActive")).attr("data-rid")){var l={};l.rid=o,s.hasClass("outPutActive")||s.hasClass("pipOutPutActive")||(l.type=131,n.push(l))}if(r.tallyArray=JSON.stringify(n),!a.hasClass("check"))a.addClass("check"),a.css("border","1px solid #41FF6D"),r=getAttrs(a,r={pipXOffset:"",pipYOffset:"",zorder:"",pipWidth:"",pipHeight:"",pipVideoSharedMemoryName:"",pipAudioSharedMemoryName:"",audioStatus:""}),overToPreview.pipInit(r);$(".preview-source .pip").attr("data-filename",i),$(".pip-in-sel p").html(e),$(".preview-source .pip").attr("data-pipVideoSharedMemoryName",i),$(".pretreat-content .pip").attr("data-pipVideoSharedMemoryName",i),$(".pip-in .voice").hasClass("icon-voice")?($(".preview-source .pip").attr("data-pipAudioSharedMemoryName",i),$(".pretreat-content .pip").attr("data-pipAudioSharedMemoryName",i)):($(".preview-source .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename")),$(".pretreat-content .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename"))),$(".pip-in .voice").hasClass("icon-voice")&&$(".pip-out .voice").hasClass("icon-voice")&&($(".preview-source .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename")),$(".pretreat-content .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename"))),createPipVideo($(".preview-content .preview-item").eq(e-1).find("video").attr("id")),oUtils.ajaxReq("studio_update",r,function(e){"0x0"!=e.errorCode&&console.log(e.errorInfo)})}}function setPipVideoVolume(){if(0!==$("#preview .pip").length||$(".main-preview .icon-erphone").hasClass("active")){var e=$(".preview-content .pipPreviewActive").attr("data-filename"),t=$('.preview-content [data-filename="'+e+'"]'),i=t.find(".voice-value").html();t.find("video").prop("volume",i/100),t.find("video")[0].muted=!1,t.find(".icon-erphone").addClass("active")}}function delPipVideoVolume(e){filename=$(".preview-content ."+e).attr("data-filename");var t=$('.preview-content [data-filename="'+filename+'"]');t.find(".voice-value").html();t.find("video").prop("volume",0),t.find(".icon-erphone").removeClass("active")}function initLocalVideoModule(){var p="",e=sourceList.uploadFileShimArr;0==e.length?$(".video-manage .video-add").css("display","block"):$(".video-manage .video-add").css("display","none");for(var t=0;t<e.length;t++){var i=e[t].PreviewShm.SharedMemoryName,a=i.lastIndexOf("\\"),r=(i.substring(a+1),i.lastIndexOf(".")),o=i.indexOf("(File Shim)"),s=(i.substring(r+1),i.substring(a+1,r),i.substring(a+1,o));p+='<div class="video-info clearFix" data-filename="'+i+'" data-video="'+s+'"><div class="file left">'+s+'</div><div class="vedio-del left"><i class="iconfont icon-del"></i></div></div>'}"none"==$(".video-manage .video-add").css("display")&&$(".video-body").html(p);oUtils.ajaxReq("studio_list_stream",{streamType:"0"},function(e){if("0x0"==e.errorCode){var t=e.result;if(0!=t.length)for(var i=0;i<t.length;i++){var a=t[i].pathUrl,r=(a=decodeURIComponent(a)).indexOf("video"),o=a.slice(r+6),s=a.slice(r+6)+" (File Shim)",n=$(".video-info").attr("data-filename"),c=$(".video-info").attr("data-video").trim(),l=t[i].id;if(c==o){$(".video-info").remove();var d='<div class="video-info clearFix" data-videoId="'+l+'" data-filename="'+n+'"><div class="file left">'+o+'</div><div class="vedio-del left"><i class="iconfont icon-del"></i></div></div>';$(".video-body").html(d)}else p+='<div class="video-info clearFix" data-videoId="'+l+'" data-filename="'+s+'"><div class="file left">'+o+'</div><div class="vedio-del left"><i class="iconfont icon-del"></i></div></div>',$(".video-body").html(p)}}sourceList.isLocalSource=!0})}function deleteExtAndLocal(t,i){if(!t.hasClass("disabled")){var a=t.attr("data-filename"),e=!1;if(!(e=0!=$(".pretreat-content .pip").length&&$(".pretreat-content .pip").attr("data-pipvideosharedmemoryname")==a||$(".main-preview").attr("data-filename")==a||$(".main-output").attr("data-filename")==a)){if($(".afv-cut .radius-box").hasClass("close")){var r=$(".afv-audio-cut .afv-audio").html().substring(6);$(".preview-content .preview-item").eq(r-1).attr("data-filename")==a&&(e=!0)}0!==$(".preview-content .preview-item.pipOutputActive").length&&$(".preview-content .preview-item.pipOutputActive").attr("data-filename")==a&&(e=!0)}if(e)return oUtils.alertTips("i18n_dontDeleteVideoAtUsing"),!1;var o=$(".preview-content [data-filename='"+a+"']").find("video").attr("id"),s=t.attr("data-videoId");return oUtils.confirmTips("i18n_producerProdeleteVideoConfirm",function(){var e={rid:$(".main-rList .rList-show").attr("data-peerId"),params:JSON.stringify([{FileShimeName:a}])};null!=s&&(e.id=s),oUtils.ajaxReq("removeFileShim",e,function(e){"0x0"==e.errorCode?(t.remove(),i.css("display","block"),void 0!==o&&deletePlayer(webflv.playObj[o])):oUtils.alertTips(e.errorInfo,1500)})}),!1}}function uploadVideo(e){if(1===sourceList.uploadFileShimArr.length)return oUtils.alertTips("i18n_uploadMax1Files"),void $("#file_v").val("");var t=$("#file_v").val(),i=new FormData($("#formVideo")[0]),a=t.lastIndexOf("\\"),r=t.substring(a+1),o=t.lastIndexOf("."),s=t.substring(o+1),n=t.substring(a+1,o);if($("#file_v").val(""),1===sourceList.uploadFileShimArr.length){var c=sourceList.uploadFileShimArr[0].PreviewShm.SharedMemoryName;if(c=c.slice(0,c.indexOf(" (File Shim)")),r===c)return void oUtils.alertTips("i18n_NotSameFileName",2500)}if("png"!=s&&"jpg"!=s&&"gif"!=s){if(i.append("name","FileShim"),i.append("filename",t),i.append("UserID",userRolePerm.userId),""!=t){var l='<div class="video-info clearFix disabled filev" data-filename="'+r+' (File Shim)"><div class="file left">'+r+'</div><div class="vedio-del left"><img src="./images/cloud_loading.gif" width="24" height="24" /></div></div>';$(".video-body").append(l),$("#loading-Bg").fadeIn();var d=$(".main-rList .rList-show").attr("data-rip"),p=$(".main-preview").attr("data-logoUrl");$("#file_v").attr("disabled","disabled"),$.ajax({type:"POST",url:"http://"+d+":"+p,data:i,processData:!1,contentType:!1,success:function(e){"0x0"==(e=jQuery.parseJSON(e)).ErrorCode?(oUtils.alertTips("i18n_slateUploadSucceed",2e3),$("#file_v").removeAttr("disabled"),$(".video-info[data-filename='"+r+" (File Shim)']").removeClass("disabled"),$(".video-manage .video-add").css("display","none"),$(".video-info[data-filename='"+r+" (File Shim)']").find(".vedio-del").html('<i class="iconfont icon-del"></i>'),$(".video-body .filev .vedio-del").html('<i class="iconfont icon-del"></i>')):($(".video-info[data-filename='"+n+"']").remove(),$("#file_v").removeAttr("disabled"),"0x80524101"==e.ErrorCode?oUtils.alertTips("i18n_uploadMax2Files"):oUtils.alertTips("i18n_slateUploadFailed"),$("#loading-Bg").fadeOut(),$("#file_v").val(""))},error:function(e){$("#loading-Bg").fadeOut(),$("#file_v").val("")}})}}else oUtils.alertTips("i18n_onlyCanUpVideo")}function savaDirectlyChange(e){var t={},i=$(".rList-show").attr("data-peerId");t.mainRid=i,t.status=e;var a={pn:"sd",content:JSON.stringify(t),peerId:i,remark:"directChange"};oUtils.ajaxReq("saveUserBehavior",a)}function directChangeShut(){var e=$(".apply-preview  .radius-box");e.addClass("shut"),$(".applyPre").addClass("disabled").removeClass("active"),e.animate({left:"0px"});$(".preview-source").append('<div class="maskLayer" style="position:absolute;z-index:0;height:100%;left:0;top:0;width:100%;"><img src="images/producer_pro_mark.png"  alt="" style="width:100%;height:100%;"/></div>'),$(".sd-preview-list .preview-item").hasClass("previewActive")&&$(".sd-preview-list .preview-item").removeClass("previewActive"),$(".main-center .main-cut").addClass("direct-pgm"),$(".main-center .main-cut").hasClass("replay")&&($(".main-center .main-cut").removeClass("direct-pgm"),$(".preview-source .maskLayer").addClass("hide"))}function directChangeOpen(){var e=$(".main-preview").attr("data-filename"),t=$(".apply-preview  .radius-box");t.removeClass("shut"),t.animate({left:"11px"}),$(".output-source").removeClass("change"),$(".maskLayer").remove(),$(".applyPre").removeClass("disabled").addClass("active"),$(".main-center .main-cut").removeClass("direct-pgm");for(var i=0;i<$(".sd-preview-list .preview-item").length;i++)$(".sd-preview-list .preview-item").eq(i).attr("data-filename")===e&&($(".radius-box").hasClass("shut")&&$(".sd-preview-list .preview-item").eq(i).removeClass("previewActive"),$(".sd-preview-list .preview-item").eq(i).addClass("previewActive").siblings().removeClass("previewActive"))}function initDirectChange(){var e=$(".rList-show").attr("data-peerId");if(studioBehavior){var t=JSON.parse(decodeURIComponent(studioBehavior));if(t.directChange)for(var i=0;i<t.directChange.length;i++){if(t.directChange[i].mainRid==e)"shut"==t.directChange[i].status?($(".main-preview .audio").css("display","none"),directChangeShut()):directChangeOpen()}}}function createAnyWhere(){var e=QRImg();oUtils.ajaxReq("token_getToken4Pro",e,function(e){if("0x0"==e.errorCode){$(".pack-container").addClass("pack-containerBg"),$(".upload-body .qr-img").addClass("qr-imgBg");var t=e.result,i="<p>"+switchLangObj.i18n_headTips+"</p>";$(".anywher-title").html(i),$(".anywher-title").attr("data-code",t),$(".pack").attr("data-code",t),createQrImg("qrImg",t,tokenSuffix);var a='<p style="top:57px;"><b>'+switchLangObj.i18n_StepOne+"</b><i></i><span>"+switchLangObj.i18n_OnAppSetting+'</span></p>\t\t\t    <p style="top:94px;"><b>'+switchLangObj.i18n_StepTwo+"</b><i></i><span>"+switchLangObj.i18n_OnThisPage+'</span></p>\t\t\t    <p style="top:132px;"><b>'+switchLangObj.i18n_StepThree+"</b><i></i><span>"+switchLangObj.i18n_OnAppLive+'</span></p>\t\t\t    <p style="top:169px;"><b>'+switchLangObj.i18n_tips+"</b><i></i><span>"+switchLangObj.i18n_OnAppLivetips+"</span></p>";$(".tips").html(a);var r='<div class="file left">'+switchLangObj.i18n_Device+'</div>\t\t\t               <div class="Camera left" style="position:absolute;left:378px;">'+switchLangObj.i18n_Camera+'</div>\t\t\t               <div class="operate right" style="width:114px;">'+switchLangObj.i18n_Operation+"</div>";$(".sd-token-title").html(r);indexPageWebsocketObj.listTokenDevice4Pro(t)}else oUtils.alertTips("i18n_errorTips",2e3)})}function createPack(e,t,i){var a,r,o=void 0;return 0==i?(o=switchLangObj.i18n_add,a="pack-oprateNoAdd",r="inputAdd"):1==i?(o=switchLangObj.i18n_add,a="pack-oprateAdd",r="inputAdd"):2==i?(o=switchLangObj.i18n_cancelLive,a="pack-oprateCancel",r="inputCancel"):3==i&&(o=switchLangObj.i18n_add,a="pack-oprateNoAdd",r="inputAdd"),'<div class="pack-info clearFix">\t\t\t\t        <div class="pack-address left">\t\t\t\t           <input type="text" value="'+e+"/"+t+'" class="'+r+'" disabled=disabled>\t\t\t\t        </div>\t\t\t\t        <div class="pack-camera left">\t\t\t\t            <span>'+switchLangObj.i18n_Unspecified+'</span>\t\t\t\t            <i class="pack-cameraArrow"></i>\t\t\t\t            <ul style="display:none;">\t\t\t\t                <li>1</li>\t\t\t\t                <li>2</li>\t\t\t\t                <li>3</li>\t\t\t\t                <li>4</li>\t\t\t\t            </ul>\t\t\t\t        </div>\t\t\t\t        <div class="pack-operate left '+a+'" data-peertid="'+e+'" data-tStatus="'+i+'">'+o+'</div>\t\t\t\t        <div class="pack-del left" data-peertid="'+e+'">\t\t\t\t          \t<i class="iconfont icon-del"></i>\t\t\t\t        </div>\t\t\t        </div>'}function addToCancel(e,t){var i,a,r,o,s,n=e.siblings(".pack-camera").children("span").text(),c=parseInt(e.siblings(".pack-camera").children("span").text());s=e.attr("data-status");var l=$(".preview-list-container").find(".preview-item").eq(c-1);if(a=l.attr("data-rStatus"),r=l.attr("data-RlivePeerId"),e.text()==switchLangObj.i18n_add){if(n==switchLangObj.i18n_Unspecified)return void oUtils.alertTips("i18n_selectReceivers",2e3);if(""==l.attr("data-rid")||null==l.attr("data-rid"))return e.text()==switchLangObj.i18n_cancelLive&&oUtils.alertTips("i18n_ReceiverIslivingWithOther",2e3),void oUtils.alertTips("i18n_ReceiverIsNotOnline",2e3);i=l.attr("data-rid").toLowerCase(),(p={}).TIdHex=t;var d={rid:i,params:JSON.stringify(p)};2==s&&2==a?o==i&&r==t?(d.rid=i,p.TIdHex=t,d.params=JSON.stringify(p),startOrStopTLiveTally(t,130),stopLive(e,d)):(d.rid=i,p.TIdHex=r,d.params=JSON.stringify(p),stopLive(e,d),d.rid=o,p.TIdHex=t,d.params=JSON.stringify(p),startOrStopTLiveTally(t,130),stopLive(e,d),d.rid=i,p.TIdHex=t,d.params=JSON.stringify(p),startOrStopTLiveTally(t,null,i),startLive(e,d)):(2!=s&&2==a?(d.rid=i,p.TIdHex=r,d.params=JSON.stringify(p),stopLive(e,d)):2==s&&2!=a&&(d.rid=o,p.TIdHex=t,d.params=JSON.stringify(p),startOrStopTLiveTally(t,130),stopLive(e,d)),d.rid=i,p.TIdHex=t,d.params=JSON.stringify(p),startOrStopTLiveTally(t,null,i),startLive(e,d))}else if(e.text()==switchLangObj.i18n_cancelLive){var p;i=l.attr("data-rid").toLowerCase(),(p={}).TIdHex=t;d={rid:i,params:JSON.stringify(p)};startOrStopTLiveTally(t,130),stopLive(e,d)}}function startLive(a,e){if(0!=sourceList.tokenFlag){sourceList.tokenFlag=!1;var r=4;sourceList.retryCountTimer&&clearInterval(sourceList.retryCountTimer),sourceList.retryCountTimer=setInterval(function(){$.ajax({type:"POST",url:"startLive",timeout:7e3,data:e,success:function(e){sourceList.tokenFlag=!0;var t=(e=JSON.parse(e)).ErrorCode+"";if(-1<t.indexOf("2147"))if(r<=0)oUtils.alertTips("i18n_liveFailed",2e3),clearInterval(sourceList.retryCountTimer),a.find(".tokenImg").remove();else{if(r--,a.hasClass(".tokenImg"))return;a.text("");a.append('<img src="images/cloud_loading.gif" class="tokenImg" style="width:20px;">');var i=a.attr("data-status");a.find(".tokenImg").attr("data-tStatus",i)}else"0x80100002"==t||"0x80100008"==t?oUtils.alertTips("i18n_pleaseOtherCamera",2e3):"0"==t&&a.find(".tokenImg").remove(),clearInterval(sourceList.retryCountTimer)},error:function(e){console.log("startlive:",e,"tid:",tid,"rid:",rid,"imgCode:",imgCode),sourceList.tokenFlag=!0}})},sourceList.startLvieTimeOut)}}function stopLive(i,e){oUtils.ajaxReq("stopLive",e,function(e){if(0==e.ErrorCode){if(i.hasClass(".tokenImg"))return;i.text("");i.append('<img src="images/cloud_loading.gif" class="tokenImg" style="width:20px;">');var t=i.attr("data-status");i.find(".tokenImg").attr("data-tStatus",t)}})}function startOrStopTLiveTally(e,t,i){var a={},r=null;if(t)r={tid:e,type:t};else{var o=$(".preview-content .preview-item[data-rid="+i.toUpperCase()+"]");r=o.hasClass("outPutActive")||o.hasClass("pipOutputActive")?{tid:e,type:132}:o.hasClass("pipPreviewActive")||o.hasClass("previewActive")?{tid:e,type:131}:{tid:e,type:130}}var s=[];s.push(r),a.tallyArray=JSON.stringify(s),oUtils.ajaxReq("studio_tally",a,function(e){0!=e.ErrorCode&&console.log(e.errorInfo)})}function QRImg(){var a=$(".rList-show").attr("data-peerId");allRidArray=[];var r=[],o=$(".preview-content .preview-item");return $.each(o,function(e,t){if("Default"!=$(t).attr("data-filename"))var i=o.eq(e).attr("data-rid");null!=i&&(i=i.toLowerCase(),allRidArray.push(i),i!=a&&r.push(i))}),{mainRId:a,slaveRIds:r}}function createQrImg(e,t,i){$("#"+e).html("").addClass("qr-border"),t="####"+t+i,new QRCode(e,{width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}).makeCode(t)}$(".pretreat-content").on("click",".logo",function(){if(!overlayCut.isCut){var e=$(this);if(e.hasClass("check")){e.removeClass("check"),e.css("border","1px solid #444");var t=e.attr("data-id");$(".preview-source .logo"+t).remove()}else{e.addClass("check"),e.css("border","1px solid #41FF6D");var i={imageWidth:"",imageHeight:"",logoYOffset:"",logoXOffset:"",url:"",id:""};i=getAttrs(e,i),overToPreview.logoInit(i)}}}),$(".pretreat-content").on("click",".text",function(){if(!overlayCut.isCut){var e=$(this);if(e.hasClass("check"))e.removeClass("check"),e.css("border","1px solid #444"),$(".preview-source .textDiv").remove();else{e.addClass("check"),e.css("border","1px solid #41FF6D");var t=e.attr("data-params");t=decodeURIComponent(t),t=JSON.parse(t),overToPreview.textInit(t)}}}),$(".pretreat-content").on("click",".clock",function(){if(!overlayCut.isCut){var e=$(this);if(e.hasClass("check"))e.removeClass("check"),e.css("border","1px solid #444"),$(".preview-source .clockDiv").remove();else{e.addClass("check"),e.css("border","1px solid #41FF6D");var t=e.attr("data-params");t=decodeURIComponent(t),t=JSON.parse(t),overToPreview.clockInit(t)}}}),$(".pretreat-content").on("click",".score",function(){if(!overlayCut.isCut){var e=$(this);if(e.hasClass("check")){e.removeClass("check"),e.css("border","1px solid #444");e.attr("data-id");$(".preview-source .scoreDiv").remove()}else{e.addClass("check"),e.siblings(".score").removeClass("check"),e.siblings(".score").css("border","1px solid #444"),$(".preview-source .scoreDiv").remove(),e.css("border","1px solid #41FF6D");var t=e.attr("data-params");t=decodeURIComponent(t),t=JSON.parse(t),overToPreview.scoreInit(t)}}}),$(function(){$(".afv-cut .radius-box").on("click",function(){var t=$(this),e={rid:$(".rList-show").attr("data-peerId"),flag:!0};if(t.hasClass("close")){var i={IsAudioFollowVideo:!0};e.params=JSON.stringify(i),oUtils.ajaxReq("setStudioPreviewAudio",e,function(e){currentRInfo.IsAudioFollowVideo=0,t.removeClass("close"),t.animate({left:"11px"}),$(".afv-audio-cut .afv-audio").addClass("disabled")})}else{var a=$(".preview-list-container .outPutActive").index();i={IsAudioFollowVideo:!1,AudioOnlyShm:$(".preview-list-container .outPutActive").attr("data-filename")};e.params=JSON.stringify(i),oUtils.ajaxReq("setStudioPreviewAudio",e,function(e){if("0x0"===e.errorCode)return currentRInfo.IsAudioFollowVideo=0,t.addClass("close"),t.animate({left:"0rem"}),$(".afv-audio-cut .afv-audio").removeClass("disabled"),void $(".afv-audio").html("Audio "+(a+1));oUtils.alertTips(e.errorInfo,1500)})}}),$(".audio-select").fnNiceScroll(),$(".afv-audio").on("click",function(e){for(var t="",i=0;i<$(".preview-content li").length;i++)t+="<li>Audio "+(i+1)+"</li>";$(".afv-audio-cut .audio-select").html(t),e.stopPropagation();var a=$(this);a.hasClass("disabled")||(a.hasClass("check")?(a.removeClass("check"),$(".afv-audio-cut .audio-select").css("display","none")):(a.addClass("check"),$(".afv-audio-cut .audio-select").css("display","block")))}),$(".afv-audio-cut").on("click",".audio-select li",function(e){e.stopPropagation();var t=$(this).html(),i=t.indexOf("o");i=t.substring(i+1);var a={rid:$(".rList-show").attr("data-peerId"),flag:!0},r={IsAudioFollowVideo:!1,AudioOnlyShm:$($(".preview-list-container li")[i-1]).attr("data-filename")};a.params=JSON.stringify(r),oUtils.ajaxReq("setStudioPreviewAudio",a,function(e){if("0x0"===e.errorCode)return currentRInfo.IsAudioFollowVideo=0,void $(".afv-audio").html("Audio "+i)}),$(".afv-audio-cut .afv-audio").removeClass("check"),$(".afv-audio-cut .audio-select").css("display","none")})}),$(function(){$(".family-ul").fnNiceScroll(),$(".family-ul").on("click","li",function(e){e.stopPropagation();var t=$(this).text();$("#fontFamily").text(t);var i=$(".preTextarea");i.css("font-family");$(this).parent().css("display","none");var a=i.width(),r=i.text().gblen(),o=2*Math.round(a/r);i.css({transform:"scale(1)","font-size":o+"px"}),i.css("font-family",t),a=i.width();var s=i.height();$(".textDiv").css({width:a+"px",height:s+"px"}),updateText()}),$(".sd-font-family").on("click",".fontFamilyDiv","i",function(e){e.stopPropagation(),$(this).hasClass("disabled")?$(".sd-font-family .family-ul").css("display","none"):$(".sd-font-family .family-ul").css("display","block")}),$(".preview-source").on("input",".preTextarea",function(e){event.keyCode;var t=$(this),i=t.text(),a=(i.gblen(),$(".preTextarea").css("transform")),r=t.width();if("none"!=a&&(r*=a=a.substring(7,a.indexOf(","))),$(".textDiv").css("width",r+"px"),$("#preview").width()<$(".textDiv").width()+$(".textDiv").position().left){i=i.substring(0,i.length-1),t.text(i);r=t.width();"none"!=a&&(r*=a=a.substring(7,a.indexOf(","))),$(".textDiv").css("width",r+"px")}var o=$(".textDiv").width();if($(".textDiv").position().left+o>$(".preview-source").width()-parseInt($(".textDiv .preTextarea").css("font-size"))/2)return t.text(i.substring(0,i.length-1)),$(".textDiv").css({width:t.width()+"px",height:t.height()+"px"}),$(".preTextarea").blur(),!1;$("#sd-textarea").val(i),updateText()}),$("#preview").on("focus",".preTextarea",function(){var e=$(this),t=$(".preTextarea").css("transform");if("none"!=t){t=t.substring(7,t.indexOf(","));var i=parseInt(e.css("font-size"))*t;12<i?$(".preTextarea").css({transform:"scale(1)","font-size":i+"px"}):(t=i/12,$(".preTextarea").css({transform:"scale("+t+")","font-size":i+"px"}))}$(".textDiv").css({width:e.width()+"px",height:e.height()+"px"})}),$("#sd-textarea").keydown(function(e){var t=e.keyCode;if(13==t)return!1;var i=$("#sd-textarea").val(),a=$(".textDiv").width();if($(".textDiv").position().left+a>$(".preview-source").width()-parseInt($(".textDiv .preTextarea").css("font-size")))return 8==t||46==t||37<=t&&t<=40||($("#sd-textarea").blur(),!1);$(".preTextarea").text(i)}),$("#sd-textarea").keyup(function(){$(".textDiv").width(),$(".textDiv").position().left;var e=$("#sd-textarea").val();$(".preTextarea").html(e),updateText(),$(".textDiv").css({width:$(".preTextarea").width()+"px",height:$(".preTextarea").height()+"px"})})}),String.prototype.gblen=function(){for(var e=0,t=0;t<this.length;t++)127<this.charCodeAt(t)||94==this.charCodeAt(t)?e+=2:e++;return e},$("#preview").on("click",".preTextarea",function(e){var t=$(this);$(".sd-text").removeClass("hide"),$(".sd-pretreat-container .pretreat-content").addClass("hide"),$(".operation-text").addClass("active"),$(".operation-text").siblings().removeClass("active"),$("#sd-textarea").val($(".preTextarea").text()),$(".sd-font .sd-font-ul").css("display","none"),$(".sd-font-family .family-ul").css("display","none"),$(".changepoint").remove(),$(".sd-text").siblings().addClass("hide"),fontInfo(t),e.stopPropagation()}),$(function(){$(".preview-source").on("click",".scoreDiv",function(e){e.stopPropagation(),$(".changepoint").remove()}),$(".preview-source").on("keydown",".scoreText",function(e,t){for(var i=$(this),a=event.keyCode,r=(t=i.val(),i.width()),o=0,s=0;s<t.length;s++){255<t[s].charCodeAt()?o+=22:o+=11}if(r+5<o)return 8==a||46==a||37<=a&&a<=40||(i.blur(),!1)});var i=!0;$(".icon-sdleft").on("click",function(){if(i)if(i=!1,$(".score-pattern li").length<=2)i=!0;else{var e=$(".score-pattern ul").position().left;0<=e?i=!0:$(".score-pattern ul").animate({left:e+250+"px"},function(){i=!0})}}),$(".icon-sdright").on("click",function(){if(i){i=!1;var e=$(".score-pattern li").length,t=$(".score-pattern ul").position().left;e<=3&&0<=t?i=!0:t<=-500?i=!0:$(".score-pattern ul").animate({left:t-250+"px"},function(){i=!0})}})}),$(".preview-source").on("click",".scoreDiv",function(e){var t=$(this).attr("data-url");$(".sd-score").removeClass("hide"),$(".sd-pretreat-container .pretreat-content").addClass("hide"),$(".operation-score").addClass("active"),$(".changepoint").remove(),$(".operation-score").siblings().removeClass("active"),$(".operation-view-score").css("border",""),$(".operation-view-score[data-url='"+t+"']").css("border","1px solid #41FF6D"),$(".sd-score").siblings().addClass("hide"),e.stopPropagation()}),$(function(){$(".pip-setting .pip-in-source").fnNiceScroll(),$(".pip-pat .pip-picture").on("click",function(){var e=$(this);if(e.hasClass("created")){if($(".pretreat-content .pip").hasClass("check"))return;$(".pretreat-content .pip").trigger("click")}else createPipToInit(e)}),$(".pip-in-sel p").on("click",function(e){if($(".pip-pat .pip-picture").hasClass("created")){for(var t=$(".preview-content .preview-item").length,i="",a=1;a<=t;a++)i+="<li>"+a+"</li>";$(".pip-in-source").html(i),$(".pip-in-source").css("display","block"),e.stopPropagation()}}),$(".pretreat-content").on("click",".edit",function(){if(!overlayCut.isCut){var i=$(this).parent(),e=[];if(i.hasClass("pip")){if($(".sd-pip").removeClass("hide").siblings().addClass("hide"),$(".sd-operation-type").addClass("hide"),$(".sd-pretreat-container .show-pip").addClass("hide"),overlying.pipEidtInit(),!i.hasClass("check")){var t={id:i.attr("data-id")},a=i.attr("data-pipvideosharedmemoryname"),r=$(".preview-content .preview-item[data-filename='"+a+"']"),o=r.attr("data-rid");if(r.addClass("pipPreviewActive"),o){var s={};s.rid=o,r.hasClass("pipOutputActive")||r.hasClass("outPutActive")||r.hasClass("previewActive")||(s.type=131,e.push(s),t.tallyArray=JSON.stringify(e))}var n=r.find("video").eq(0).attr("id");t.checked=1,oUtils.ajaxReq("studio_update",t,function(e){if("0x0"==e.errorCode){i.addClass("check"),i.css("border","1px solid #41FF6D");var t={pipXOffset:"",pipYOffset:"",zorder:"",pipWidth:"",pipHeight:"",pipVideoSharedMemoryName:"",pipAudioSharedMemoryName:"",audioStatus:""};t=getAttrs(i,t),overToPreview.pipInit(t,n)}else oUtils.alertTips(e.errorInfo,1500)})}}else if(0!==$(".preview-source .scoreDiv").length)$(".preview-source .scoreDiv").trigger("click");else $(".sd-pretreat-operation").addClass("active"),$(".sd-operation-type").hide(),$(".operation-view-score").css("border",""),$(".operation-view-score").css("border","none"),$(".sd-score").show().siblings().hide();return!1}}),$(".pretreat-content").on("click",".pip",function(){if(!overlayCut.isCut){var i=$(this),e={id:i.attr("data-id")},t=[];if(i.hasClass("check")){var a=$(".preview-content .preview-item.pipPreviewActive");$(".main-preview .icon-erphone").hasClass("active")&&delPipVideoVolume("pipPreviewActive");var r=a.attr("data-rid");if(r){var o={};o.rid=r,a.hasClass("pipOutputActive")||a.hasClass("outPutActive")||a.hasClass("previewActive")||(o.type=130,t.push(o),e.tallyArray=JSON.stringify(t))}$(".preview-content .preview-item.pipPreviewActive").removeClass("pipPreviewActive"),e.checked=0,oUtils.ajaxReq("studio_update",e,function(e){if("0x0"==e.errorCode){i.removeClass("check"),i.css("border","1px solid #444");var t=$(".preview-source .pip").find("video").attr("id");t&&deletePlayer(webflv.playObj[t]),$(".preview-source .pip").remove()}else oUtils.alertTips(e.errorInfo,1500)})}else{var s=i.attr("data-pipvideosharedmemoryname"),n=$(".preview-content .preview-item[data-filename='"+s+"']"),c=n.attr("data-rid");if(n.addClass("pipPreviewActive"),$(".main-preview .icon-erphone").hasClass("active")&&setPipVideoVolume(),c){var l={};l.rid=c,n.hasClass("pipOutputActive")||n.hasClass("outPutActive")||n.hasClass("previewActive")||(l.type=131,t.push(l),e.tallyArray=JSON.stringify(t))}var d=n.find("video").attr("id");e.checked=1,oUtils.ajaxReq("studio_update",e,function(e){if("0x0"==e.errorCode){i.addClass("check"),i.css("border","1px solid #41FF6D");var t={pipXOffset:"",pipYOffset:"",zorder:"",pipWidth:"",pipHeight:"",pipVideoSharedMemoryName:"",pipAudioSharedMemoryName:"",audioStatus:""};t=getAttrs(i,t),overToPreview.pipInit(t,d)}else oUtils.alertTips(e.errorInfo,1500)})}}})}),$(function(){$(".upload-body").fnNiceScroll("#333"),$(".upload-tab li").dblclick(function(){}),$(".upload-tab li").on("click",function(){var e=$(this).index();if(0==e)createAnyWhere();else if(1==e)initLocalVideoModule();else if(2==e)resourceAbout.getIpStreamList();else{var t=$(".pack").attr("data-code");if(""==t||null==t)return void oUtils.alertTips("i18n_errorTips",2e3);oUtils.ajaxReq("studio_device",{type:"T"},function(e){if("0x0"==e.errorCode){var t=e.result;if(0!=t.length)for(var i="",a=0;a<t.length;a++){i=createPack(t[a].peerId,t[a].name,t[a].status)+i}$(".tvupack-body").html(i)}}),pageRequestObj.taskInfo()}$(this).addClass("active").siblings().removeClass("active"),$(".upload-body .video-manage").eq(e).css("display","block").siblings().css("display","none")}),$(".preview-add").on("click",function(){var e=$(this);if(0!=$(".sd-preview-list").find(".preview-item").length){var t=$(".upload-tab").children("li.active").index();if(!e.hasClass("disabled"))return $(".upload-video").css("display","block"),0==t?createAnyWhere():1==t&&initLocalVideoModule(),!1}}),$(".upload-header .close").on("click",function(){return $(".upload-video").css("display","none"),$("#bgFilter").css("display","none"),!1}),$(".video-body").on("click",".vedio-del",function(){deleteExtAndLocal($(this).parent(),$(".video-manage .video-add"))}),$(".upload-footer .complete-btn").on("click",function(){return $(".upload-header .close").trigger("click"),!1})}),$(function(){$(".apply-preview").on("click",".applyBtn",function(){if($(".apply-preview  .radius-box").hasClass("shut")){if($(".main-preview .audio").css("display","block"),$(".main-preview .icon-erphone").hasClass("active")){var e=$(".main-preview").attr("data-filename"),t=$(".preview-content .preview-item[data-filename='"+e+"']").find(".voice-value").html();$(".main-preview .main-player").prop("volume",t/100)}directChangeOpen(),savaDirectlyChange("open")}else{$(".main-preview .audio").css("display","none"),$(".main-preview .icon-erphone").hasClass("active")&&$(".main-preview .main-player").prop("volume",0),directChangeShut(),savaDirectlyChange("shut")}})}),$(function(){$(".preview-list-container").on("click",".set-name",function(e){if(!$(this).parents(".preview-item").attr("data-rid"))return!1;$(".preview-qrcode").remove();var t=$(this).parents(".preview-item"),i='<div class="preview-qrcode"><div class="QrCode select-tokenpair">                <div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div>                <p>'+switchLangObj.i18n_headTips+'</p>                <div class="QR-img" id="qrtokenImg"></div>                <p class="accept-token"><a class="aSelectBox selectedBoxClass"></a><span>Accept automatically</span></p>            </div>            <div class="select-tokenpair select-accept select-close">                <div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div>                <p class="select-title">'+switchLangObj.i18n_acceptAnywhere+'</p>                <div class="select-button">                    <p class="left select-accept-Yes select-Yes">'+switchLangObj.i18n_Yes+'</p>                    <p class="left select-accept-No select-No" >'+switchLangObj.i18n_No+'</p>                </div>            </div>            <div class="select-tokenpair select-live select-close">                <div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div>                <p class="select-title">'+switchLangObj.i18n_liveAnywhere+'</p>                <div class="select-button">                    <p class="left select-live-Yes select-Yes" >'+switchLangObj.i18n_Yes+'</p>                    <p class="left select-live-No select-No" >'+switchLangObj.i18n_No+'</p>                </div>            </div>            <div class="select-tokenpair start-live select-close" style="display:none;font-size:  15px;">\t\t\t\t<div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div> \t\t\t\t<div class="loading-live" style="height: 200px;text-align:center;line-height: 200px;">\t\t\t\t\t<img src="images/loading_add_image.gif"/><span>start living...5s</span>\t\t\t\t</div>            </div></div>';t.append(i);var a=QRImg();oUtils.ajaxReq("token_getToken4Pro",a,function(e){if("0x0"==e.errorCode){var t=e.result;$(".preview-qrcode").attr("data-code",t),createQrImg("qrtokenImg",t,tokenSuffix),$(".preview-qrcode .QrCode").css("display","block")}})}),$(".preview-list-container").on("click",".close",function(e){$(this).parent().css("display","none"),e.stopPropagation(),clearInterval(sourceList.retryCountTimer)}),$(".preview-list-container").on("click",".select-No",function(e){$(this).parents(".select-close").css("display","none"),e.stopPropagation()}),$(".preview-list-container").on("click",".select-accept-Yes",function(e){var t=$(this),i=$(".preview-list-container .preview-qrcode").attr("data-peertid"),a=$(".preview-list-container .preview-qrcode").attr("data-code"),r=$(".preview-list-container .preview-qrcode").parents(".preview-item").attr("data-rid"),o={"tokenCode.code":a,peerId:i,rid:r.toLowerCase(),checkFlag:0,confirm:"Accept"};$.ajax({type:"POST",url:"token_confirm",timeout:15e3,data:o,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode?(oUtils.alertTips("i18n_HasBeenSent",2e3),$(".pack-body .pack-info").each(function(e,t){$(t).find($(".pack-operate[data-peertid='"+i+"']").attr("data-tStatus",3))}),t.parents(".select-accept").siblings(".select-live").css("display","block"),t.parents(".select-accept").css("display","none")):oUtils.alertTips("i18n_proerrorTips",2e3)}}),e.stopPropagation()}),$(".preview-list-container").on("click",".select-live-Yes",function(e){var t=$(this),i=$(".preview-list-container .preview-qrcode").attr("data-peertid"),a=t.parents(".preview-item").attr("data-rid").toLowerCase();$(".preview-list-container .select-live").css("display","none"),$(".preview-list-container .start-live").css("display","block"),sourceList.preventRepeatRequest,liveToken(i,a,"",!1),e.stopPropagation()}),$(".preview-list-container").on("click",".edit-name",function(){var e=$(this),t=e.children("input"),i=e.children(".show-name");"none"==t.css("display")&&(t.val(i.html()),t.css("display","block"),t.focus(),i.css("display","none"))}),$(".preview-list-container").on("keyup","input",function(){return!1}),$(".preview-list-container").on("blur","input",function(){var e=$(this).parent(),t=e.children("input"),i=e.children(".show-name");i.html(t.val()),i.css("display","block"),t.css("display","none")})}),$(function(){$(".pack-body").on("click",".pack-camera",function(e){var t=$(this).children("ul");if(t.hasClass("activeUl"))t.removeClass("activeUl"),t.css("display","none");else{if($(this).siblings(".pack-operate").text()==switchLangObj.i18n_cancelLive)return;t.css("display","block"),$(".upload-body").css("overflow","visible"),t.addClass("activeUl"),t.parents(".pack-info").siblings().find(".pack-camera").find("ul").css("display","none")}e.stopPropagation()}),$(".pack-body,.tvupack-body").on("click","li",function(){var e=$(this),t=e.text();return $(".upload-body").css("overflow","hidden"),e.parents(".pack-camera").children("span").text(t),e.parents(".pack-camera").siblings(".pack-operate").attr("data-selectNumber",t),e.parent("ul").css("display","none"),!1}),$(".tvupack-body").on("click",".pack-camera",function(e){var t=$(this).children("ul");if(t.hasClass("activeUl"))t.removeClass("activeUl"),t.css("display","none");else{if($(this).siblings(".pack-operate").text()==switchLangObj.i18n_cancelLive)return;if(0==$(this).siblings(".pack-operate").attr("data-status")||3==$(this).siblings(".pack-operate").attr("data-status"))return;t.css("display","block"),t.addClass("activeUl"),t.parents(".pack-info").siblings().find(".pack-camera").find("ul").css("display","none")}e.stopPropagation()}),$(".pack-body").on("click",".pack-operate",function(){var i=$(this),e=i.attr("data-peertid");if(i.text()==switchLangObj.i18n_accept){if(4<$(".pack-body").find(".pack-operate").length)return void oUtils.alertTips("i18n_hastoken",2e3);i.text("");i.append('<img src="images/cloud_loading.gif" class="tokenImg" style="width:20px;">');var t={"tokenCode.code":$(".anywher-title").attr("data-code"),peerId:e,confirm:"Accept"};$.ajax({type:"POST",url:"token_confirm",timeout:15e3,data:t,success:function(e){var t=JSON.parse(e).errorCode;"0x0"==t?(i.attr("data-tStatus","3"),oUtils.alertTips("i18n_HasBeenSent",2e3)):"0x01"==t?oUtils.alertTips("i18n_acceptFail",2e3):oUtils.alertTips("i18n_proerrorTips",2e3),$(".tokenImg").remove(),i.text(switchLangObj.i18n_accept)}})}else addToCancel(i,e)}),$(".pack-body,.tvupack-body").on("click",".pack-del",function(){var a=$(this),e=a.siblings(".pack-operate"),t=parseInt(a.siblings(".pack-camera").children("span").text()),i=$(".preview-list-container").find(".preview-item").eq(t-1).attr("data-rid"),r=$(".anywher-title").attr("data-code"),o=a.attr("data-peertid");if(e.text()!=switchLangObj.i18n_cancelLive)if(""!=e.text()){if(null!=i&&""!=i){i=i.toLowerCase();var s={};s.TIdHex=o;var n={rid:i,params:JSON.stringify(s)};oUtils.ajaxReq("stopLive",n)}var c={"tokenCode.code":r,peerId:o,confirm:"Delete"};a.parents(".tvupack-body")&&(c.type="T"),oUtils.ajaxReq("token_confirm",c,function(e){var t=e.errorCode;if("0x0"==t){if(a.parents(".tvupack-body")){var i=$(".pack-body .pack-operate");$.each(i,function(e,t){$(t).attr("data-peertid")==o&&$(t).parents(".pack-info").remove()})}a.parent(".pack-info").remove(),oUtils.alertTips("i18n_deleteFeilSuccess",2e3)}else"0x01"==t&&a.parent(".pack-info").remove()})}else oUtils.alertTips("i18n_NotDelete");else oUtils.alertTips("i18n_ProhibitedtoDelete")}),$(".pairBtn").click(function(){var e=$(".tvuPackInfo input").val(),t=$(".pack").attr("data-code");if(""!=t&&null!=t){var i={"tokenCode.code":t,peerId:e,confirm:"Accept",type:"T"};indexPageWebsocketObj.listTokenDevice4Pro(t),/^[0-9a-fA-F]{16}$/.test(e)?$.ajax({type:"POST",url:"token_confirm",timeout:15e3,data:i,success:function(e){var t=JSON.parse(e).errorCode,i=JSON.parse(e).errorInfo;if("0x0"==t){oUtils.alertTips("i18n_HasBeenSent",2e3);oUtils.ajaxReq("studio_device",{type:"T"},function(e){if("0x0"==e.errorCode){var t=e.result;if(0!=t.length){for(var i="",a=0;a<t.length;a++){i=createPack(t[a].peerId,t[a].name,t[a].status)+i}$(".tvupack-body").html(i)}}})}else"0x01"==t?oUtils.alertTips(i,2e3):"0x80100003"==t&&oUtils.alertTips(i,2e3)}}):oUtils.alertTips("i18n_isPid",2e3)}else oUtils.alertTips("i18n_errorTips",2e3)}),$(".tvupack-body").on("click",".pack-operate",function(){var a=$(this),r=a.attr("data-peertid");if(1==a.attr("data-status")){var e={"tokenCode.code":$(".pack").attr("data-code"),peerId:r,confirm:"Accept",type:"T"};$.ajax({type:"POST",url:"token_confirm",timeout:15e3,data:e,success:function(e){var t=JSON.parse(e).errorCode,i=JSON.parse(e).errorInfo;if("0x0"==t)oUtils.alertTips("i18n_HasBeenSent",2e3),addToCancel(a,r);else{if("0x01"!=t)return"0x80100003"==t?void oUtils.alertTips(i,2e3):void 0;addToCancel(a,r)}}})}else{if(2!=a.attr("data-status"))return;addToCancel(a,r)}})});var tally={getBeReplacedTallyBox:function(e){for(var t=$(".preview-content .preview-item"),i=0;i<t.length;i++)if(t.eq(i).attr("data-filename")===e&&t.eq(i).attr("data-rid"))return t.eq(i);return null}};function volumeControl(){this.socket=null}volumeControl.prototype={constructor:volumeControl,init:function(s){this.socket=oUtils.socket({url:"studio/"+s+"/"+Math.random(),error:function(e){console.log(e)},successObj:{activeWs:function(e){$(".output-top .userNum").html(e.count),$(".output-top .userNum").attr("title",switchLangObj.i18n_currentUserNum)},tokenPairMsg:function(e){if("block"!=$(".upload-video").css("display")){var t=e.tokenDevice,i=$(".preview-list-container .preview-qrcode").attr("data-code"),a=$(".preview-qrcode").parents(".preview-item").attr("data-rid");if(a=a.toLowerCase(),0==sourceList.token2live){if(3==e.tokenStatus){if(1==sourceList.preventRepeatRequest)return;sourceList.preventRepeatRequest=!0,$(".preview-qrcode .select-tokenpair").css("display","none"),$(".preview-qrcode .select-live").css("display","block"),$(".preview-list-container .preview-qrcode").attr("data-peertid",e.tokenDevice);var r=e.tokenDeviceName||e.tokenDevice;$(".preview-list-container .preview-qrcode").parents(".preview-item").find(".show-name").html(r),setTimeout(function(){sourceList.preventRepeatRequest=!1},1e4)}else if(2==e.tokenStatus||1==e.tokenStatus){if(1==sourceList.preventRepeatRequest)return;if(sourceList.preventRepeatRequest=!0,$(".preview-list-container .preview-qrcode").attr("data-peertid",e.tokenDevice),$(".preview-list-container .preview-qrcode .aSelectBox").hasClass("selectedBoxClass")){var o={"tokenCode.code":i,peerId:t,checkFlag:"0",rid:a,confirm:"Accept"};$.ajax({type:"POST",url:"token_confirm",timeout:7e3,data:o,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode&&(setTimeout(function(){sourceList.preventRepeatRequest=!1},1e4),oUtils.alertTips(switchLangObj.i18n_PairingSuccess,2e3,function(){$(".preview-qrcode .select-tokenpair").css("display","none"),$(".preview-qrcode .select-live").css("display","block")}))},error:function(e){sourceList.preventRepeatRequest=!1,console.log("accept:",e,"tid:",tid,"rid:",s,"imgCode:",imgCode)}})}else $(".preview-qrcode .select-accept").css("display","block");r=e.tokenDeviceName||e.tokenDevice;$(".preview-list-container .preview-qrcode").parents(".preview-item").find(".show-name").html(r)}}else 2==e.tokenStatus||1==e.tokenStatus?liveToken(t,a,i,!0):liveToken(t,a,i)}},syncLocalSource:function(e){sourceList.isLocalSource&&(initLocalVideoModule(),sourceList.isLocalSource=!1)}}})},changeVolume:function(e,t){var i={parameter:{shm:t}};i.parameter.vol=-40==e?-40:e;var a=this;this.socket.send({message:i,time:200,key:"volume",success:function(e){a.stop()},error:function(e){a.stop(),console.log(e)}})},stop:function(){this.socket.has("volume")&&this.socket.stop("volume")},close:function(){this.socket&&this.socket.off()}};var volumeControlObj=new volumeControl;function liveToken(i,a,r,e){if(0!=sourceList.tokenFlag){sourceList.tokenFlag=!1;var o=i;if(1==e){var t={"tokenCode.code":r,peerId:o,checkFlag:"0",rid:a,confirm:"Accept"};$.ajax({type:"POST",url:"token_confirm",timeout:7e3,data:t,success:function(e){console.log("accept:",e,"tid:",i,"rid:",a,"imgCode:",r)},error:function(e){console.log("accept:",e,"tid:",i,"rid:",a,"imgCode:",r)}})}var s=4,n=5;$(".preview-list-container .start-live .loading-live span").html(switchLangObj.i18n_tokenStartlive+n+"s"),sourceList.retryCountTimer&&clearInterval(sourceList.retryCountTimer),sourceList.retryCountTimer=setInterval(function(){var e={};e.TIdHex=o;var t={rid:a.toLowerCase(),params:JSON.stringify(e)};$.ajax({type:"POST",url:"startLive",timeout:7e3,data:t,success:function(e){sourceList.tokenFlag=!0,console.log("startlive:",e,"tid:",i,"rid:",a,"imgCode:",r);var t=(e=JSON.parse(e)).ErrorCode+"";-1<t.indexOf("2147")?s<=0?($(".preview-list-container .select-live-Yes").html("Retry"),$(".preview-list-container .select-live .select-title").html(switchLangObj.i18n_heckNetworkRetry),$(".sd-preview-list .preview-item .select-title").css({"margin-top":"40px","margin-left":"13%"}),$(".preview-list-container .select-live").css("display","block"),$(".preview-list-container .select-live-No").css("display","none"),$(".preview-list-container .start-live").css("display","none"),clearInterval(sourceList.retryCountTimer)):(n--,$(".preview-list-container .start-live .loading-live span").html(switchLangObj.i18n_tokenStartlive+n+"s"),s--):("0x80100002"==t||"0x80100008"==t?oUtils.alertTips("i18n_pleaseOtherCamera",2e3):"0"==t&&($(".preview-list-container .start-live .loading-live span").html(switchLangObj.i18n_LvieSuccess),$(".preview-list-container .start-live .loading-live img").attr("src","images/Checkbox-On.png")),$(".preview-qrcode").fadeOut(2e3),clearInterval(sourceList.retryCountTimer))},error:function(e){console.log("startlive:",e,"tid:",i,"rid:",a,"imgCode:",r),sourceList.tokenFlag=!0}})},sourceList.startLvieTimeOut)}}function createPreviewListVoiceControl(e,r,t){var i=r.find(".slider-vertical");i.slider({orientation:t,range:"min",min:0,max:100,step:1,value:e,slide:function(e,t){var i=$(this).parents(".preview-item");i.find(".voice-value").html(t.value),0==t.value?i.find(".voice").removeClass("icon-voice").addClass("icon-novoice"):i.find(".voice").removeClass("icon-novoice").addClass("icon-voice");var a=i.attr("data-filename"),r=$(".main-preview").attr("data-filename");if($(".main-preview").find(".icon-erphone").hasClass("active")){a!=r||$(".apply-preview  .radius-box").hasClass("shut")||$(".main-preview .main-player").prop("volume",t.value/100);var o=$(this).parents(".preview-item.pipPreviewActive");0!==o.length&&o.attr("data-filename")==a&&$(this).siblings("video").prop("volume",t.value/100)}else i.find(".icon-erphone").hasClass("active")&&$(this).siblings("video").prop("volume",t.value/100)},stop:function(e,t){var i=volumeConversion.volumeLocal2R(t.value),a=$(this).parents(".preview-item").attr("data-filename");volumeControlObj.changeVolume(i,a),r.find("video").prop("volume",t.value/100)}});var a='<span class="voice-value">'+e+"</span>";i.find(".ui-slider-handle").html(a)}$(".preview-content").on("mouseenter touchstart",".voice",function(){var e=$(this),t=$(this).parents(".preview-item");t.attr("data-filename");return $(".preview-item .item-control-voice .voice").removeClass("active"),$(".preview-item .item-control-voice .voice").css("color","#666"),$(".preview-item .voice-control").css("display","none"),e.addClass("active"),e.css("color","#fff"),t.find(".voice-control").eq(0).css("display","block"),!1}),$(".preview-content").on("mouseleave",".preview-item",function(){var e=$(this).find(".voice");return e.css("color","#666"),e.removeClass("active"),$(this).find(".voice-control").eq(0).css("display","none"),!1});var volumeConversion={volumeR2local:function(e){if(0==(t=40+e))return 0;var t=(parseInt(t)+1)*(100/41);return Math.round(t)},volumeLocal2R:function(e){if(100==e)return 0;var t=.41*(parseInt(e)+1);return t=-40+t-1,Math.round(t)}};function deletePlayer(e){void 0!==e&&null!=e&&(e.wsreader.destroy(),e.player.pause(),e.player.detachMediaElement(),e.player.destroy(),e.player=null)}function satrtRecordVideo(e){oUtils.ajaxReq("record/start_record",e,function(e){"0x0"==e.errorCode&&($(".record").find($(".icon-record")).addClass("hide"),$(".record").find($(".icon-stoprecord")).removeClass("hide"),$("#RecordPGM").css("display","none"),clearInterval(clockObj.recordTimer),clockObj.recordTimer=setInterval(function(){clockObj.recordSeconds++,$(".recordTime").html(transTimeByms(clockObj.recordSeconds))},1e3))})}function stopRecordVideo(e){oUtils.ajaxReq("record/stop_record",e,function(e){"0x0"==e.errorCode&&($(".record").find($(".icon-stoprecord")).addClass("hide"),$(".record").find($(".icon-record")).removeClass("hide"),clockObj.recordSeconds=0,$(".recordTime").html("00:00:00"),clearInterval(clockObj.recordTimer))})}$(".erphone").on("click",".icon-erphone",function(){var e=$(this),t="";if(e.hasClass("active")&&"rgb(255, 255, 255)"==e.css("color")){e.removeClass("active"),e.css("color","#666"),$("video").prop("volume",0);for(var i=$("video"),a=0;a<i.length;a++)i[a].muted=!0}else{$(".icon-erphone").removeClass("active").css("color","#666"),e.css("color","#fff"),$("video").prop("volume",0);for(i=$("video"),a=0;a<i.length;a++)i[a].muted=!0;if(e.addClass("active"),e.parents(".erphone").hasClass("main-preview")){if(!$(".apply-preview  .radius-box").hasClass("shut")){t=$(".main-preview").attr("data-filename");var r=$('.preview-content [data-filename="'+t+'"]').find(".voice-value").html();$(".main-preview .main-player").prop("volume",r/100),$(".main-preview .main-player")[0].muted=!1}setPipVideoVolume()}else if(e.parents(".erphone").hasClass("main-output"))$(".main-output .main-player").prop("volume",1),$(".main-output .main-player")[0].muted=!1;else{r=e.parents(".preview-item").find(".voice-value").html();e.parents(".preview-item").find("video").prop("volume",r/100),e.parents(".preview-item").find("video")[0].muted=!1}}}),$(".sd-pretreat-container").fnNiceScroll("#444"),pushAbout.addpushCount(),window.addEventListener("resize",function(){correctDrag.dragCorrectPositionAndSize()}),window.onbeforeunload=function(){var e=webflv.playObj;for(var t in e)deletePlayer(e[t])},$(function(){$(".record").click(function(){if($(this).find(".icon-stoprecord").hasClass("hide"))$("#RecordPGM").css("display","block");else{var e=$(".record").attr("data-params");stopRecordVideo({rid:$(".rList-show").attr("data-peerId"),params:e})}}),$(".recordBtn").click(function(){var e=$("#detailPush").find(".resolutionTypeList").attr("data-value"),t=$("#detailPush").find(".BitrateTypeList .dropdownDefault_value").text(),i=t.indexOf("b"),a={Resolution:e,VBitrate:t=t.slice(0,i)},r={rid:$(".rList-show").attr("data-peerId"),params:JSON.stringify(a)};$(".record").attr("data-params",JSON.stringify(a)),satrtRecordVideo(r)})});