"use strict";var overlying=overlayObj.overlying,allRidArray=[];function getUserBehavior(){$.ajax({type:"POST",url:"/producerpro/getUserBehavior",data:{pn:"sd"},dataType:"json",success:function(e){if("0x0"==e.errorCode&&e.userBehavior){currentRInfo.selectRUserBehavior=JSON.parse(e.userBehavior);var t=$(".rList-show").attr("data-peerId"),i=currentRInfo.selectRUserBehavior;if(i.directChange){for(var r=!1,a=0;a<i.directChange.length;a++){if(i.directChange[a].mainRid==t)r=!0,"shut"==i.directChange[a].status?initOverlay.directChangeShut():initOverlay.directChangeOpen()}r||initOverlay.directChangeOpen()}}},error:function(e){console.log(e.errorInfo)}})}function clickPageHide(){$(".pagehide").addClass("hide")}function updateMainPreview(e){$(".main-preview").attr("data-filename",e);var t=$(".sd-preview-list .preview-item[data-filename='"+e+"']");if(!(t.length<=0)){if(t.addClass("previewActive").siblings().removeClass("previewActive"),0!=$(".sd-preview-list .preview-item.pipPreviewActive").length){var i=$(".sd-preview-list .preview-item.pipPreviewActive").index();$(".pip-setting .pip-in-sel p").html(i+1)}t.attr("data-rid")?$(".preview-source").attr("data-rid",t.attr("data-rid")):$(".preview-source").removeAttr("data-rid")}}function updateMainOutput(e){$(".main-output").attr("data-filename",e);var t=$(".sd-preview-list .preview-item[data-filename='"+e+"']");if(!(t.length<=0)){t.addClass("outPutActive").siblings().removeClass("outPutActive");var i=$(".sd-preview-list .preview-item.outPutActive").index();$(".pip-setting .pip-out-sel p").html(i+1),t.attr("data-rid")?$(".output-source").attr("data-rid",t.attr("data-rid")):$(".output-source").removeAttr("data-rid")}}function getLiveVideoId(e){var t=e.indexOf("/rtmp/")+6;return e.substring(t,t+15)}function resetPage(){$(".main-preview").removeAttr("data-filename"),$(".main-preview .preview-source .big-video").html(""),$(".main-output").removeAttr("data-filename"),$(".main-output .output-source .big-video").html(""),$(".sd-preview-list .preview-content").html(""),initSystem.webrtcVideo.clear(),$(".operation-view-logo").removeClass("outputActive"),$(".operation-view-logo img").prop("src","./images/logo.png"),$(".pretreat-item-logo").removeClass("outputActive"),$(".operation-item-logo img").prop("src","./images/logo.png"),$(".output-top .shareCounts").html(0).removeClass("active"),$(".show-logo .pretreat-item-logo").remove(),$(".show-logo .pretreat-item-logo").remove(),$(".show-score .pretreat-item-score").remove(),$(".show-text .pretreat-item-text").remove(),$(".pip-picture").removeClass("created"),$(".afv-cut .radius-box").css("left","11px"),$(".afv-cut .afv-audio").addClass("disabled"),$(".afv-cut .afv-audio").html("Audio 1"),$(".afv-cut .radius-box").removeClass("close"),$(".preview-source .audio").remove(),$(".output-source .audio").remove(),statusObj.pageInit=!0,peerClientStatusArr.isWebRTCDisconnect=!1,peerClientStatusArr.ipsourceFileName="",peerClientStatusArr.disconnectNum=0,peerClientStatusArr.previewList=!1,volume.volumeColumn.volumeObj={},peerClientStatusArr.resetVideoList=[],currentRInfo.rtcIdList={pvw:"",pgm:{id:[],data:null},preLis:{idArr:[],data:[]}}}function needEven(e){return e%2==1&&e++,e}function getAttrs(e,t){for(var i in t)t[i]=$(e).attr("data-"+i);return t}function fontInfo(e){var t=e.css("background-color");$(".left .sp-preview-inner").css("background-color",t);var i=e.css("color");$(".sd-font-color .sp-preview-inner").css("background-color",i);var r=e.css("font-family");$("#fontFamily").text(r),-1<r.indexOf("Proxima Nova Condensed")&&$("#fontFamily").text("Proxima Nova Con...");var a=e.css("font-size").split("p")[0];$(".size-input").text(a);var o=e.text();$("#sd-textarea").val(o)}function changeColor(e){if(/rgb?/.test(e)){var t=e.split(",");e="#";var i="";3<t.length?(i=t[3].replace(/[^\d]/gi,""),0==(i=parseInt(i/100*255,10).toString(16))?e="#00":e+=i):e+="FF";for(var r,a=0;a<3;)r=t[a++],e+=1==(r=parseInt(r.replace(/[^\d]/gi,""),10).toString(16)).length?"0"+r:r;e=e.toUpperCase()}return e}function HexToRgba(e,t){var i=parseInt("0x"+t,16);return i=(i/=255).toFixed(2),"rgba("+parseInt("0x"+e.slice(0,2))+","+parseInt("0x"+e.slice(2,4))+","+parseInt("0x"+e.slice(4,6))+","+i+")"}function updateClock(e,t,i){var r=$(".clockDiv").attr("data-id"),a=calPts($(".main-preview .main-player").attr("id")),o={};r?(o=overlayCut.clockSubtitle(),console.log(o),o.startTime=e,o.endTime=t,o.timestamp=a,o.operation=i):((o={operation:"destroy",xOffset:101,yOffset:10,zorder:1,height:300,width:200,startTime:111,endTime:1e5,timestamp:12345678}).style={fontSize:93,backgroundColor:"00000000",fontName:"Arial",foregroundColor:"FFFFFFFF"},clockid=""),$.ajax({type:"POST",url:"/producerpro/clock_update",async:!1,data:{id:r,params:JSON.stringify(o)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.result;if(null!=t&&""!=t){var i=t.checked;$(".clockDiv").attr("data-check",i);overlying.clockInit(t,!0)}}}})}function applyClockToPgm(e,t){var i=$(".rList-show").attr("data-peerId"),r=$("#preview .clockDiv").attr("data-id"),a=calPts($(".main-preview .main-player").attr("id")),l={};if(r){var o=$("#preview .clockDiv").attr("data-operation");(l=overlayCut.clockSubtitle()).startTime=e,l.endTime=t,l.timestamp=a,l.operation=o}else{(l={operation:"destroy",xOffset:101,yOffset:10,zorder:1e3,height:300,width:200,startTime:111,endTime:1e5,timestamp:12345678}).style={fontSize:93,backgroundColor:"00000000",fontName:"Arial",foregroundColor:"FFFFFFFF"},r="";var d=$(".show-clock .pretreat-item-clock")}$.ajax({type:"POST",url:"/producerpro/clock_check",data:{peerId:i,id:r,params:JSON.stringify(l)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.result;if(null!=t&&""!=t){var i=t.checked;$(".clockDiv").attr("data-check",i);if(overlying.clockInit(t,!0),currentRInfo.outputPreview){overToPreview.clockInit(e.result,".output-source .big-video");var r,a=JSON.parse(e.result.style).text.split(":"),o=60*parseInt(a[0]),s=parseInt(a[1]),n=parseInt(o+s);r=e.result.endTime/1e3<n?"red":"",$("#preview .clockDiv").css("background",r)}}if("destroy"==l.operation){if(0!==d.length){var c=d.attr("data-params");c=decodeURIComponent(c),(c=JSON.parse(c)).operation="create",c=JSON.stringify(c);var p=encodeURIComponent(c);d.attr("data-params",p),$(".clockStart").hasClass("hide")?saveClockuserBehavior("start","pvw"):saveClockuserBehavior("create","pvw")}$(".output-source .big-video .clockDiv").remove()}}overlayCut.isCut=!1}})}function saveClockuserBehavior(e,t){var i={};i.status=e,i.location=t,updateUserBehavior(i),$.ajax({type:"POST",url:"/producerpro/saveUserBehavior",data:{pn:"sd",remark:"ProgramClock",content:JSON.stringify(i)},success:function(e){e=JSON.parse(e)}})}function saveSingularuserBehavior(e,t){var i={};i.status=e,i.url=t,$.ajax({type:"POST",url:"/producerpro/saveUserBehavior",data:{pn:"sd",remark:"Singular",content:JSON.stringify(i)},success:function(e){e=JSON.parse(e)}})}function updateMultiCheck(e,t){var i=$("#preview .preTextarea").text(),r=$("#preview .scoreDiv").attr("data-id"),a=($(".rList-show").attr("data-peerId"),$("#preview .preTextarea").attr("data-id"),$(".clockDiv").attr("data-id"),[]);if(null!=i&&""!=i){var o=overlayCut.subtitleCom();if(t){var s={size:o.width+"x"+o.height,bgcolor:$(".preview-source .textDiv").css("background-color"),color:$(".preview-source .preTextarea").css("color"),text:$(".preview-source .preTextarea").html(),fstyle:"normal",fweight:"normal",fsize:o.style.fontSize,ffamily:$(".preview-source .preTextarea").css("font-family")},n=(t=placeholder.getData(s)).indexOf(",");console.log(t),o.base64=t.substring(n+1)}a.push(o)}if(r){var c=overlayCut.score(!1);a=a.concat(c)}return a}function createPipToInit(e){var t=widthAndHeight.getPriviewWidth("#preview",null,640),i=.5625*t,r=widthAndHeight.getPriviewWidth("#preview",null,1100),a=widthAndHeight.getPriviewHeight("#preview",null,560),o=$(".preview-content .preview-item").eq(0).find("video").attr("id"),s='<div class="pip" style="width:'+t+"px;height:"+i+"px;right:"+r+"px;top:"+a+"px;z-index:"+currentRInfo.zorder+++';"><video autoplay style="display:inline-block;z-index:1;width:100%;height:100%;" class="preview-item-video"></video></div>';$("#preview").append(s),$("#preview .pip").DragAndDrop({callback:correctDrag.correctPip}),createPipVideo(o),e.addClass("created");var n=overToPreview.getPipInfo();n.zorder=currentRInfo.zorder-1;var c=$(".preview-content .preview-item").eq(0).attr("data-filename");$(".preview-content .preview-item").eq(0).addClass("pipPreviewActive"),$(".main-preview .icon-erphone").hasClass("active")&&volume.setPipVideoVolume();var p=$(".preview-content .preview-item").eq(0),l=p.attr("data-rid"),d=[];if(l){var u={};u.rid=l,p.hasClass("outPutActive")||p.hasClass("pipOutPutActive")||(u.type=131,d.push(u))}n.pipVideoSharedMemoryName=c,n.pipAudioSharedMemoryName=$(".main-preview").attr("data-filename"),n.peerId=$(".rList-show").attr("data-peerId"),n.pipXOffset=1100,n.pipYOffset=560,n.pipWidth=640,n.pipHeight=360,n.tallyArray=JSON.stringify(d),$(".pretreat-content .pip").remove();studioAdd(n,0)}function studioAdd(t,i){oUtils.ajaxReq("/producerpro/studio_add",t,function(e){"0x0"==e.errorCode?overlying.pipInit(e.result):(1==++i&&oUtils.ajaxReq("/producerpro/studio_add",t,function(e){"0x0"==e.errorCode?overlying.pipInit(e.result):console.log(e.errorInfo)}),console.log(e.errorInfo))})}function createPipVideo(e,t){t=t||"#preview";var i=$("#"+e)[0].srcObject;$(t+" .pip").find("video")[0].srcObject=i,$(t+" .pip").find("video").attr("data-videoid",e);var r=$("#"+e).parents(".preview-item").attr("data-filename");$(t+" .pip").find("video")[0].volume=$(".preview-item[data-filename='"+r+"'] .voice-value").html().trim()/100,$(".main-output .output-erphone .icon-erphone").hasClass("active")||($(t+" .pip").find("video")[0].muted=!0)}function changePipSource(e){var t=$(".preview-content li").eq(e-1),i=t.attr("data-filename");if(i!=$(".preview-source .pip").attr("data-filename")){var r=$(".pretreat-content .pip"),a={id:$(".pretreat-content .pip").attr("data-id"),pipVideoSharedMemoryName:i};r.hasClass("check")||(a.checked=1);var o,s=$(".preview-content .preview-item.pipPreviewActive"),n=[];if(o=s.attr("data-rid")){var c={};c.rid=o,s.hasClass("outPutActive")||s.hasClass("pipOutputActive")||s.hasClass("previewActive")||(c.type=130,n.push(c))}if($(".main-preview .icon-erphone").hasClass("active")&&volume.delPipVideoVolume("pipPreviewActive"),$(".preview-content li").removeClass("pipPreviewActive"),t.addClass("pipPreviewActive"),$(".main-preview .icon-erphone").hasClass("active")&&volume.setPipVideoVolume(),o=(s=$(".preview-content .preview-item.pipPreviewActive")).attr("data-rid")){var p={};p.rid=o,s.hasClass("outPutActive")||s.hasClass("pipOutPutActive")||(p.type=131,n.push(p))}if(a.tallyArray=JSON.stringify(n),!r.hasClass("check"))r.addClass("check"),r.css("border","1px solid #41FF6D"),a=getAttrs(r,a={pipXOffset:"",pipYOffset:"",zorder:"",pipWidth:"",pipHeight:"",pipVideoSharedMemoryName:"",pipAudioSharedMemoryName:"",audioStatus:""}),overToPreview.pipInit(a);$(".preview-source .pip").attr("data-filename",i),$(".pip-in-sel p").html(e),$(".preview-source .pip").attr("data-pipVideoSharedMemoryName",i),$(".pretreat-content .pip").attr("data-pipVideoSharedMemoryName",i),$(".pip-in .voice").hasClass("icon-voice")?($(".preview-source .pip").attr("data-pipAudioSharedMemoryName",i),$(".pretreat-content .pip").attr("data-pipAudioSharedMemoryName",i)):($(".preview-source .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename")),$(".pretreat-content .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename"))),$(".pip-in .voice").hasClass("icon-voice")&&$(".pip-out .voice").hasClass("icon-voice")&&($(".preview-source .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename")),$(".pretreat-content .pip").attr("data-pipAudioSharedMemoryName",$(".sd-main .main-output").attr("data-filename"))),createPipVideo($(".preview-content .preview-item").eq(e-1).find("video").attr("id")),oUtils.ajaxReq("/producerpro/studio_update",a,function(e){"0x0"!=e.errorCode&&console.log(e.errorInfo)})}}function savaDirectlyChange(e){var t={},i=$(".rList-show").attr("data-peerId");t.mainRid=i,t.status=e;var r={pn:"sd",content:JSON.stringify(t),peerId:i,remark:"directChange"};oUtils.ajaxReq("/producerpro/saveUserBehavior",r)}function QRImg(){var r=$(".rList-show").attr("data-peerId");allRidArray=[];var a=[],o=$(".preview-content .preview-item");return $.each(o,function(e,t){if("Default"!=$(t).attr("data-filename"))var i=o.eq(e).attr("data-rid");null!=i&&(i=i.toLowerCase(),allRidArray.push(i),i!=r&&a.push(i))}),{mainRId:r,slaveRIds:a}}function createQrImg(e,t){$("#"+e).html("").addClass("qr-border"),t="####"+t+CONFIG.tokenSuffix,new QRCode(e,{width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}).makeCode(t)}$(function(){FastClick.attach(document.body),$(document).on("click",function(){clickPageHide(),$(".afv-audio-cut .audio-select").css("display","none"),$(".fontSize-ul").css("display","none"),$(".sd-font-family .family-ul").css("display","none"),$(".pip-in-source").css("display","none"),$(".pack-camera ul").css("display","none"),$(".upload-body").css("overflow","hidden"),$(".textArrow").css("display","none"),$(".pushing").addClass("hide")}),$(document).on("click",".alert_popupBg",function(e){e.stopPropagation()});var e=window.location.host,t=$(".businessType").text();localStorage.setItem("businessType",t),localStorage.setItem("session",session);var i=$("#user_info_name").text();function v(e,t){if(!mix_fn.isPrower("VideoCut"))return!1;if(0!=$(".preview-source .clip").length&&!$(".main-preview .applyBtn.radius-box").hasClass("shut")&&t)clipDot.expressApply("record/express_apply");else{var i=e.attr("data-filename"),r=[],a=$(".main-output").attr("data-filename"),o=tally.getBeReplacedTallyBox(a);if(null!==o){var s={};s.rid=$(".output-source").attr("data-rid"),o.hasClass("pipOutputActive")||(o.hasClass("previewActive")||o.hasClass("pipPreviewActive")?s.type=131:s.type=130,r.push(s))}e.attr("data-filename");if(void 0!==$(".preview-source").attr("data-rid")){var n={};n.rid=$(".preview-source").attr("data-rid"),n.type=132,r.push(n)}var c={SelectedSharedMemory:i},p=calPts($(".main-preview .main-player").attr("id"));c.SubTimestamp=p||0,$("#preview .timeStamp").html(p),console.log("setStudioLiveSharedMemory time:",p);var l={rid:currentRInfo.selectRId,params:JSON.stringify(c),tallyArray:JSON.stringify(r)};oUtils.ajaxReq("/producerpro/setStudioLiveSharedMemory",l,function(e){"0x0"==e.errorCode&&updateMainOutput(i)})}}localStorage.setItem("userName",i),$(".purchase-alert div,.refueling-package div").click(function(){window.open("http://"+window.location.host+"/producerpro/bussinessSystem.html")}),e.indexOf("producer.tvunetworks")<0&&(statusObj.isVoIpFunction=!0),$(".purchase-promptbox div").click(function(){window.open("http://"+window.location.host+"/producerpro/bussinessSystem.html?p")}),$(".purchase-promptbox img").click(function(){$(".purchase-promptbox").css("display","none")}),$("#user_manager").click(function(){window.open("http://"+window.location.host+"/producerpro/producerManage.html")}),$(".charge").click(function(){0==userRecord?window.open("http://"+window.location.host+"/producerpro/bussinessSystem.html"):1==isNewUser?window.open("http://"+window.location.host+"/producerpro/bussinessSystem.html"):window.open("http://"+window.location.host+"/producerpro/bussinessSystem.html?p")}),$(".preview-source").on("click",function(){if($(this).addClass("change"),$(".output-source").removeClass("change"),$(".pip").removeClass("change"),!(0<$(".preview-source").find(".changepoint").length)){$(".preview-source").append('<div class="changepoint"><p style="left:-5px;top:-5px;"></p><p style="right:-5px;top:-5px;"></p><p style="left:-5px;bottom:-5px;"></p><p style="right:-5px;bottom:-5px;"></p></div>')}}),$(".output-source").on("click",function(){$(".apply-preview  .radius-box").trigger("click"),$(".preview-source").removeClass("change"),$(".changepoint").remove(),$(".pip").removeClass("change")}),$(".preview-source").on("click",".pip",function(){return $(this).addClass("change"),$(".preview-source").removeClass("change"),$(".output-source").removeClass("change"),$(".changepoint").remove(),!1}),$(".sd-preview-list").on("click",".preview-item-video",function(){var e=$(this).parents(".preview-item"),t=e.attr("data-filename"),i={SelectedSharedMemory:t},r=new Date,a=calPts(e.find("video").attr("id"));i.SubTimestamp=a||0;var o=new Date-r;console.log("setStudioLiveSharedMemory time:",a,o);var s={rid:currentRInfo.selectRId,params:JSON.stringify(i)},n=e.index(),c=($(".pretreat-content .pip"),$(".pretreat-content .pip").attr("data-id"),[]);if($(".apply-preview .radius-box").hasClass("shut")||$(".output-source").hasClass("change"))v(e,!1);else if($(".preview-source .pip").hasClass("change"))changePipSource(n+1);else{var p=$(".main-preview").attr("data-filename"),l=tally.getBeReplacedTallyBox(p);if(null!==l)(d={}).rid=$(".preview-source").attr("data-rid"),l.hasClass("outPutActive")||l.hasClass("pipOutputActive")||l.hasClass("pipPreviewActive")||(d.type=130,c.push(d));var d,u=e.attr("data-rid");if(void 0!==u)if(!e.hasClass("outPutActive")&&!e.hasClass("pipPreviewActive")&&!e.hasClass("pipOutputActive"))(d={}).rid=u,d.type=131,c.push(d);s.tallyArray=JSON.stringify(c),oUtils.ajaxReq("/producerpro/setStudioInputPreview",s,function(e){"0x0"==e.errorCode&&(clipDot.changeVideoCut(!0),$("#preview").removeAttr("data-storyid"),updateMainPreview(t))})}}),$(".main-cut-btn").on("click",function(){if($(".sd-pretreat-operation").removeClass("active"),$(this).hasClass("disabled"))return!1;v($(".main-preview"),!0)}),$(document).keyup(function(e){var t=e.keyCode;return 32==t&&0==$("#preview .preTextarea").is(":focus")&&0==$(".scoreDiv .scoreText").is(":focus")&&v($(".main-preview"),!0),!(0==$(".scoreDiv .scoreText").is(":focus")&&$(".scoreDiv").find(".point").hasClass("show")||0==$("#preview .preTextarea").is(":focus")&&$("#preview .textDiv").find(".point").hasClass("show"))&&(1!=$("#preview .preTextarea").is(":focus")&&1!=$(".scoreDiv .scoreText").is(":focus")&&1!=$("#sd-textarea").is(":focus")&&1!=$(".sd-score input").is(":focus")&&1!=$(".ip-address input").is(":focus")&&1!=$(".push-nickname").is(":focus")&&1!=$(".trimItem").is(":focus")&&1!=$(".description").is(":focus")&&1!=$(".TimeSet input").is(":focus")&&1!=$(".defaultTime input").is(":focus")&&(96<t&&t<106?t-=96:48<t&&t<57&&(t-=48),void $(".preview-content .preview-item").eq(t-1).find(".preview-item-video").trigger("click")))})}),setInterval(function(){if(0<currentRInfo.isLive){var e={rid:currentRInfo.selectRId,params:currentRInfo.selectRId,reStartflag:!0};oUtils.ajaxReq("/producerpro/queryStudioInfo",e)}},1e4),oUtils.ajaxReq("/producerpro/studio_open"),$(function(){$(".sd-pretreat").on("click",".operation-confirm",function(){$(".sd-pretreat-operation").removeClass("active"),$(".sd-operation-type").css("display","block")}),$(".sd-pretreat").on("click",".operation-close",function(){$(".sd-pretreat-operation").removeClass("active"),$(".operation-text").removeAttr("disabled")}),$(".sd-pretreat").on("click",".operation-logo-label",function(e){$(this).hasClass("disabled")&&e.preventDefault()})}),$(".overlay-cut-btn").on("click",function(){if(!mix_fn.isPrower("OverlayCut"))return!1;$(".sd-pretreat-operation").removeClass("active");var e=$("#preview .xingquanDrag").length,t=$(".preview-source .scoreDiv").length,i=$("#preview .logo-box").length;if(7<e)return oUtils.alertTips("i18n_producerPro_maxOverlayNum"),!1;if(4<i-t)return oUtils.alertTips("i18n_producerPro_maxOverlayImgNum"),!1;var r=overlayCut.textCut();overlayCut.logoCut(r),overlayCut.pipCut(),overlayCut.clockCut(),cutToPgm()}),$(".preview-list-container").on("click",function(){$(".sd-pretreat-operation").removeClass("active")}),$(function(){$(".afv-cut .afv-name").on("click",function(){$(".afv-cut .radius-box").trigger("click")}),$(".afv-cut .radius-box").on("click",function(){var i=$(this),e={rid:$(".rList-show").attr("data-peerId"),flag:!0};if(i.hasClass("close")){var t={IsAudioFollowVideo:!0};e.params=JSON.stringify(t),oUtils.ajaxReq("/producerpro/setStudioPreviewAudio",e,function(e){if(currentRInfo.IsAudioFollowVideo=0,i.removeClass("close"),i.animate({left:"11px"}),$(".afv-audio-cut .afv-audio").addClass("disabled"),$(".main-output .icon-erphone").hasClass("active"))if($("video").prop("volume",0),currentRInfo.outputPreview){$(".main-output").attr("data-filename");if($(".main-output .main-player").prop("volume",1),0!=$(".output-source .pip").length){var t=$(".output-source .pip").attr("data-pipvideosharedmemoryname");$(".main-output .pip video").prop("volume",$(".preview-content .preview-item[data-filename='"+t+"'] .voice-value").html().trim()/100),$(".main-output .pip video")[0].muted=!1}}else $(".main-output .main-player").prop("volume",1)})}else{var r=$(".preview-list-container .outPutActive").index();t={IsAudioFollowVideo:!1,AudioOnlyShm:$(".preview-list-container .outPutActive").attr("data-filename")};e.params=JSON.stringify(t),oUtils.ajaxReq("/producerpro/setStudioPreviewAudio",e,function(e){if("0x0"===e.errorCode)return currentRInfo.IsAudioFollowVideo=0,i.addClass("close"),i.animate({left:"0rem"}),$(".afv-audio-cut .afv-audio").removeClass("disabled"),$(".afv-audio").html("Audio "+(r+1)),void($(".main-output .icon-erphone").hasClass("active")&&($("video").prop("volume",0),currentRInfo.outputPreview,$(".main-output .main-player").prop("volume",1)));oUtils.alertTips(e.errorInfo,1500)})}}),$(".audio-select").fnNiceScroll(),$(".pretreat-content").fnNiceScroll(),$("#detailPush .popupContent_content").fnNiceScroll("#444"),$(".afv-audio").on("click",function(e){for(var t="",i=0;i<$(".preview-content li").length;i++)t+="<li>Audio "+(i+1)+"</li>";$(".afv-audio-cut .audio-select").html(t),e.stopPropagation();var r=$(this);r.hasClass("disabled")||(r.hasClass("check")?(r.removeClass("check"),$(".afv-audio-cut .audio-select").css("display","none")):(r.addClass("check"),$(".afv-audio-cut .audio-select").css("display","block")))}),$(".afv-audio-cut").on("click",".audio-select li",function(e){e.stopPropagation();var t=$(this).html(),i=t.indexOf("o");i=t.substring(i+1);var r={rid:$(".rList-show").attr("data-peerId"),flag:!0},a=$($(".preview-list-container li")[i-1]).attr("data-filename"),o={IsAudioFollowVideo:!1,AudioOnlyShm:a};r.params=JSON.stringify(o),oUtils.ajaxReq("/producerpro/setStudioPreviewAudio",r,function(e){if("0x0"!==e.errorCode);else if(currentRInfo.IsAudioFollowVideo=0,$(".afv-audio").html("Audio "+i),currentRInfo.outputPreview&&$(".main-output .icon-erphone").hasClass("active")){$("video").prop("volume",0);$(".preview-content .preview-item[data-filename='"+a+"']"),$(".main-output").attr("data-filename");$(".main-output .main-player").prop("volume",1),$(".main-output .main-player")[0].muted=!1}}),$(".afv-audio-cut .afv-audio").removeClass("check"),$(".afv-audio-cut .audio-select").css("display","none")})}),String.prototype.gblen=function(){for(var e=0,t=0;t<this.length;t++)127<this.charCodeAt(t)||94==this.charCodeAt(t)?e+=2:e++;return e},$("#preview").on("click",".preTextarea",function(e){var t=$(this);$(".sd-text").removeClass("hide"),$(".sd-pretreat-container .pretreat-content").addClass("hide"),$(".operation-text").addClass("active"),$(".operation-text").siblings().removeClass("active"),$("#sd-textarea").val($("#preview .preTextarea").text()),$(".sd-font .sd-font-ul").css("display","none"),$(".sd-font-family .family-ul").css("display","none"),$(".changepoint").remove(),$(".sd-text").siblings().addClass("hide"),fontInfo(t),e.stopPropagation()}),$(function(){$(".preview-source").on("click",".scoreDiv",function(e){e.stopPropagation(),$(".changepoint").remove()}),$(".preview-source").on("keydown",".scoreText",function(e,t){var i=$(this),r=event.keyCode,a=(t=i.val(),i.width()),o=0;a=widthAndHeight.getPriviewHeight("#preview",null,a);for(var s=0;s<t.length;s++){255<t[s].charCodeAt()?o+=22:o+=11}if(a<o)return 8==r||46==r||37<=r&&r<=40||(i.blur(),!1)});var i=!0;$(".icon-sdleft").on("click",function(){if(i)if(i=!1,$(".score-pattern li").length<=2)i=!0;else{var e=$(".score-pattern ul").position().left;0<=e?i=!0:$(".score-pattern ul").animate({left:e+250+"px"},function(){i=!0})}}),$(".icon-sdright").on("click",function(){if(i){i=!1;var e=$(".score-pattern li").length,t=$(".score-pattern ul").position().left;e<=3&&0<=t?i=!0:t<=-500?i=!0:$(".score-pattern ul").animate({left:t-250+"px"},function(){i=!0})}})}),$(".preview-source").on("click",".scoreDiv",function(e){var t=$(this).attr("data-url");$(".sd-score").removeClass("hide"),$(".sd-pretreat-container .pretreat-content").addClass("hide"),$(".operation-score").addClass("active"),$(".changepoint").remove(),$(".operation-score").siblings().removeClass("active"),$(".operation-view-score").css("border",""),$(".operation-view-score[data-url='"+t+"']").css("border","1px solid #41FF6D"),$(".sd-score").siblings().addClass("hide"),e.stopPropagation()}),$(function(){$(".apply-preview").on("click",".applyBtn",function(){if($(".apply-preview  .radius-box").hasClass("shut")){if($(".main-preview .audio").css("display","block"),$(".main-preview .icon-erphone").hasClass("active")){var e=$(".main-preview").attr("data-filename"),t=$(".preview-content .preview-item[data-filename='"+e+"']").find(".voice-value").html();$(".main-preview .main-player").prop("volume",t/100)}initOverlay.directChangeOpen(),savaDirectlyChange("open")}else{$(".main-preview .audio").css("display","none"),$(".main-preview .icon-erphone").hasClass("active")&&$(".main-preview .main-player").prop("volume",0),initOverlay.directChangeShut(),savaDirectlyChange("shut")}})}),$(function(){$(".preview-list-container").on("click",".set-name",function(e){if(!mix_fn.isPrower("AddAnywhere"))return!1;if(!$(this).parents(".preview-item").attr("data-rid"))return!1;$(".preview-qrcode").remove();var t=$(this).parents(".preview-item"),i='<div class="preview-qrcode"><div class="QrCode select-tokenpair">                <div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div>                <p>'+switchLangObj.i18n_headTips+'</p>                <div class="QR-img" id="qrtokenImg"></div>                <p class="accept-token"><a class="aSelectBox selectedBoxClass"></a><span>'+switchLangObj.i18n_AcceptAutomatically+'</span></p>            </div>            <div class="select-tokenpair select-accept select-close">                <div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div>                <p class="select-title">'+switchLangObj.i18n_acceptAnywhere+'</p>                <div class="select-button">                    <p class="left select-accept-Yes select-Yes">'+switchLangObj.i18n_Yes+'</p>                    <p class="left select-accept-No select-No" >'+switchLangObj.i18n_No+'</p>                </div>            </div>            <div class="select-tokenpair select-live select-close">                <div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div>                <p class="select-title">'+switchLangObj.i18n_liveAnywhere+'</p>                <div class="select-button">                    <p class="left select-live-Yes select-Yes" >'+switchLangObj.i18n_Yes+'</p>                    <p class="left select-live-No select-No" >'+switchLangObj.i18n_No+'</p>                </div>            </div>            <div class="select-tokenpair start-live select-close" style="display:none;font-size:  15px;">\t\t\t\t<div class="close clearFix"><i class="iconfont icon-vedio-close right"></i></div> \t\t\t\t<div class="loading-live" style="height: 200px;text-align:center;line-height: 200px;">\t\t\t\t\t<img src="images/loading_add_image.gif"/><span>start living...5s</span>\t\t\t\t</div>            </div></div>';t.append(i);var r=QRImg();oUtils.ajaxReq("/producerpro/token_getToken4Pro",r,function(e){if("0x0"==e.errorCode){var t=e.result;$(".preview-qrcode").attr("data-code",t),createQrImg("qrtokenImg",t),$(".preview-qrcode .QrCode").css("display","block")}})}),$(".preview-list-container").on("click",".close",function(e){$(this).parent().css("display","none"),e.stopPropagation(),clearInterval(sourceList.retryCountTimer)}),$(".preview-list-container").on("click",".select-No",function(e){$(this).parents(".select-close").css("display","none"),e.stopPropagation()}),$(".preview-list-container").on("click",".select-accept-Yes",function(e){var t=$(this),i=$(".preview-list-container .preview-qrcode").attr("data-peertid"),r=$(".preview-list-container .preview-qrcode").attr("data-code"),a=$(".preview-list-container .preview-qrcode").parents(".preview-item").attr("data-rid"),o={"tokenCode.code":r,peerId:i,rid:a.toLowerCase(),checkFlag:0,confirm:"Accept"};$.ajax({type:"POST",url:"/producerpro/token_confirm",timeout:15e3,data:o,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode?(oUtils.alertTips("i18n_HasBeenSent",2e3),$(".pack-body .pack-info").each(function(e,t){$(t).find($(".pack-operate[data-peertid='"+i+"']").attr("data-tStatus",3))}),t.parents(".select-accept").siblings(".select-live").css("display","block"),t.parents(".select-accept").css("display","none")):oUtils.alertTips("i18n_proerrorTips",2e3)}}),e.stopPropagation()}),$(".preview-list-container").on("click",".select-live-Yes",function(e){var t=$(this),i=$(".preview-list-container .preview-qrcode").attr("data-peertid"),r=t.parents(".preview-item").attr("data-rid").toLowerCase();$(".preview-list-container .select-live").css("display","none"),$(".preview-list-container .start-live").css("display","block"),sourceList.preventRepeatRequest,liveToken(i,r,"",!1),e.stopPropagation()}),$(".preview-list-container").on("click",".edit-name",function(){var e=$(this),t=e.children("input"),i=e.children(".show-name");"none"==t.css("display")&&(t.val(i.html()),t.css("display","block"),t.focus(),i.css("display","none"))}),$(".preview-list-container").on("keyup","input",function(){return!1}),$(".preview-list-container").on("blur","input",function(){var e=$(this).parent(),t=e.children("input"),i=e.children(".show-name");i.html(t.val()),i.css("display","block"),t.css("display","none")})});var tally={getBeReplacedTallyBox:function(e){for(var t=$(".preview-content .preview-item"),i=0;i<t.length;i++)if(t.eq(i).attr("data-filename")===e&&t.eq(i).attr("data-rid"))return t.eq(i);return null}};function liveToken(i,r,a,e){if(0!=sourceList.tokenFlag){sourceList.tokenFlag=!1;var o=i;if(1==e){var t={"tokenCode.code":a,peerId:o,checkFlag:"0",rid:r,confirm:"Accept"};$.ajax({type:"POST",url:"/producerpro/token_confirm",timeout:7e3,data:t,success:function(e){console.log("accept:",e,"tid:",i,"rid:",r,"imgCode:",a)},error:function(e){console.log("accept:",e,"tid:",i,"rid:",r,"imgCode:",a)}})}var s=4,n=5;$(".preview-list-container .start-live .loading-live span").html(switchLangObj.i18n_tokenStartlive+n+"s"),sourceList.retryCountTimer&&clearInterval(sourceList.retryCountTimer),sourceList.retryCountTimer=setInterval(function(){var e={};e.TIdHex=o;var t={rid:r.toLowerCase(),params:JSON.stringify(e)};$.ajax({type:"POST",url:"/producerpro/startLive",timeout:7e3,data:t,success:function(e){sourceList.tokenFlag=!0,console.log("startlive:",e,"tid:",i,"rid:",r,"imgCode:",a);var t=(e=JSON.parse(e)).ErrorCode+"";-1<t.indexOf("2147")?s<=0?($(".preview-list-container .select-live-Yes").html("Retry"),$(".preview-list-container .select-live .select-title").html(switchLangObj.i18n_heckNetworkRetry),$(".sd-preview-list .preview-item .select-title").css({"margin-top":"40px","margin-left":"13%"}),$(".preview-list-container .select-live").css("display","block"),$(".preview-list-container .select-live-No").css("display","none"),$(".preview-list-container .start-live").css("display","none"),clearInterval(sourceList.retryCountTimer)):(n--,$(".preview-list-container .start-live .loading-live span").html(switchLangObj.i18n_tokenStartlive+n+"s"),s--):("0x80100002"==t||"0x80100008"==t?oUtils.alertTips("i18n_pleaseOtherCamera",2e3):"0"==t&&($(".preview-list-container .start-live .loading-live span").html(switchLangObj.i18n_LvieSuccess),$(".preview-list-container .start-live .loading-live img").attr("src","images/Checkbox-On.png")),$(".preview-qrcode").fadeOut(2e3),clearInterval(sourceList.retryCountTimer))},error:function(e){console.log("startlive:",e,"tid:",i,"rid:",r,"imgCode:",a),sourceList.tokenFlag=!0}})},sourceList.startLvieTimeOut)}}function getChangeList(e,n,t){var i={currentPageNum:e,everyPageNum:7,versionUpdateFlag:n,environment:t};oUtils.ajaxReq("/producerpro/queryWebVersionUpdate",i,function(e){if("0x0"==e.errorCode){var t=(e=e.result).resultList;if(0==t.length)return $(".shareHistory .page").addClass("hide"),$(".inviteUserHistory").html(""),!1;$(".shareHistory .page").removeClass("hide");for(var i="",r=0;r<t.length;r++){var a=t[r].added_time;a=ExpireDateTime(a);var o=t[r].content,s=t[r].sort;o=o.split("\n").join("<br/>"),i+='<li>\t\t\t\t\t\t\t<span class="updateNew '+(1==n&&s?"updateCircle":"")+'"></span>\t\t\t\t\t\t\t<span class="updateDate">'+a+'</span>\t\t\t\t\t\t\t<p class="updateContent">'+(o=o.split("\n").join("<br/>"))+"</p>\t\t\t\t\t\t</li>"}$(".updateBody ul").html(i),$(".updateVersion .pre-page").removeClass("disabled"),$(".updateVersion .next-page").removeClass("disabled"),1==e.currentPageNum&&$(".updateVersion .pre-page").addClass("disabled"),e.currentPageNum==e.totalPageNum&&$(".updateVersion .next-page").addClass("disabled"),$(".updateVersion .currentpage").html(e.currentPageNum),$(".updateVersion .totalpage").html(e.totalPageNum)}})}$(".sd-pretreat-container").fnNiceScroll("#444"),window.addEventListener("resize",function(){correctDrag.dragCorrectPositionAndSize()}),$(function(){$(".shareHasGift").click(function(){$(".share-promptbox").css("display","block"),$(".pushing").addClass("hide"),0==$(".shareqrcode").find("img").length&&$.ajax({type:"POST",url:"/producerpro/shareRegisterUrl",timeout:7e3,success:function(e){var t=JSON.parse(e).errorCode,i=JSON.parse(e).result;if("0x0"==t){var r=i.split("?"),a=(r[0],r[1].slice(11));new QRCode("shareCode",{width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}).makeCode(i),$(".sharecode").val(a);var o=localStorage.getItem("amount");o=parseInt(o)/100,$(".totalMoney").text("￥"+o)}}})}),$(".shareGift img").click(function(){$(".share-promptbox").css("display","none")}),$(".copyCode").click(function(){$(".sharecode").select(),document.execCommand("Copy"),oUtils.alertTips("i18n_Copyed",2e3)}),$(".scanHistory").click(function(){$(".share-promptbox").css("display","none"),$(".shareHistory").css("display","block"),getShareListRecords(1)}),$(".shareHistory .pre-page,.shareHistory .next-page").on("click",function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=$(".shareHistory .currentpage").html();t=e.hasClass("pre-page")?parseInt(t)-1:parseInt(t)+1,getShareListRecords(t)}),$(".shareHistory .invite").on("click","img",function(){$(".shareHistory").css("display","none")}),$(".shareHistory .invite").on("click","p",function(){$(".shareHistory").css("display","none"),$(".share-promptbox").css("display","block")})}),$(function(){$("#user_update").click(function(){$(".updateVersion").css("display","block")}),$(".updateVersion .updateBody").fnNiceScroll("#444"),"zh"==i18nLanguage?(0==versionUpdateFlag?getChangeList(1,1,"cn"):getChangeList(1,0,"cn"),$("#user_tutorial a").attr("href","http://"+location.host+"/producerpro/user/userManual/Producer Ver2.0 User Manual-zh-20180831.pdf")):(0==versionUpdateFlag?getChangeList(1,1,"com"):getChangeList(1,0,"com"),$("#user_tutorial a").attr("href","http://"+location.host+"/producerpro/user/userManual/Producer Ver2.0 User Manual-en-20180831.pdf")),$(".updateVersion").on("click","li",function(){$(this).find(".updateNew").hasClass("updateCircle")&&$(this).find(".updateNew").removeClass("updateCircle")}),$(".updateVersion .pre-page,.updateVersion .next-page").on("click",function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=$(".updateVersion .currentpage").html();getChangeList(t=e.hasClass("pre-page")?parseInt(t)-1:parseInt(t)+1,0)})});