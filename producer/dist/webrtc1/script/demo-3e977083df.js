"use strict";var signalingUrl,studioBehavior,facebookCheckInDistance,domainAddress,currentVersion,userManage,userRecord,serRolePerm,userRoleList,tvuccUrl,sessionId,userRolePerm,orderStatus,AUTHORITY,parentInviteCode,progressTime,businessType,isNewUser,userType,progressTimer,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jsVersion="build 1.0.120",initSystem=function(b,x,I,i){var t=function(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");if(r[0]==e)return r[1]}return!1}("session");function o(e,t){var i=e.status,r=t.status;return i<r?1:r<i?-1:0}function e(){this.socket=null,this.onchanging=null,this.studioFlag=null}t||(t=localStorage.getItem("session")),e.prototype={constructor:e,init:function(e){this.onchanging=1,this.socket=x.socket({url:"pagewebsocket",error:function(e){console.log(e)},param:{pid:e,identifyId:(new Date).getTime(),session:t}}),this.studioFlag=!0,this.uploadInfo(),this.kernelState(),this.volumeInfo()},volumeInfo:function(){this.socket.send({message:{categoryId:"2152871168",operationType:"703"},time:200,key:"volumeInfo",success:function(e){if(e.data)var t=JSON.parse(e.data);i.getVideoVolumeColumn(t)}})},uploadInfo:function(){var i=this;this.socket.send({message:{categoryId:"2152871168",operationType:"101"},time:1e3,key:"uploadInfo",success:function(e){if(e.data)var t=JSON.parse(e.data);if(t){if(i.onchanging++,i.onchanging<2)return;!function(e){if(g.initMainVideo([e.InputPreviewWebRTCUserID],[e.OutputPreviewWebRTCUserID],e),e.SourceListPreview){var i=[],r=[],a="";sourceList.uploadFileShimArr=[],sourceList.uploadIpShimArr=[],e.SourceListPreview.forEach(function(e,t){e.PreviewShm.IsEnabled&&e.IsPreivewing&&(i.push(e.PreviewID),r.push(e)),100==(a=e.PreviewShm.SourceType)&&sourceList.uploadFileShimArr.push(e),200!=a||e.PreviewShm.SharedMemoryName.endsWith("(File Shim)")||sourceList.uploadIpShimArr.push(e)}),g.updateVideoList(i,r,e)}var t=e.CurrentInputPreviewShm.SharedMemoryName,o=e.CurrentEncoderSharedMemory.SharedMemoryName;if(updateMainPreview(t),updateMainOutput(o),null!=e.CurrentPIPList&&0<e.CurrentPIPList.length){var s=e.CurrentPIPList[0].id,n=b(".sd-preview-list .preview-item[data-filename='"+s+"']");0<n.length&&n.addClass("pipOutputActive").siblings().removeClass("pipOutputActive")}if(b(".main-preview").attr({"data-logoUrl":e.UploadLogoUrl,"data-logoMaxH":e.LogoMaxHeight,"data-logoMaxW":e.LogoMaxWidth,"data-maxCopierCount":e.MaxCopierCount}),widthAndHeight.resolutionW=e.SwitchBusScaleFormat.Width,widthAndHeight.resolutionH=e.SwitchBusScaleFormat.Height,statusObj.resolutionArray=[],0<e.EncoderList.length){for(var d=0,c=0;c<e.EncoderList.length;c++){var l=e.EncoderList[c],p=e.EncoderList[c].Resolution,u=e.EncoderList[c].VBitrate;statusObj.resolutionArray.push(p+"&"+u);for(var v=0;v<l.CopierList.length;v++){var m=l.CopierList[v];if(5==m.Type){0;var f=b(".rList-show").attr("data-rip"),h=m.OutputPort;b("#girdUrlShow img").css("display","none"),b(".gridIssp").attr("data-issp","yes"),b(".gridIssp").val("issp://"+f+":"+h)}else d++}}b(".output-top .shareCounts").html()!=d&&(b(".output-top .shareCounts").html(d).attr("data-encoder",e.EncoderList.length),b(".output-top .shareCounts").hasClass("active")||b(".output-top .shareCounts").addClass("active"))}else"0"!=b(".output-top .shareCounts").html()&&b(".output-top .shareCounts").html(0).removeClass("active").removeAttr("data-encoder");!function(e){{if(0==I.IsAudioFollowVideo||1==I.IsAudioFollowVideo)return I.IsAudioFollowVideo++;I.IsAudioFollowVideo=void 0}if(1==e.IsAudioFollowVideo){if(b(".afv-cut .radius-box").removeClass("close"),b(".afv-cut .radius-box").css({left:"11px"}),b(".afv-cut .afv-audio").addClass("disabled"),b(".afv-audio").html("Audio 1"),b(".main-output .icon-erphone").hasClass("active")&&(b("video").prop("volume",0),b(".main-output .main-player").prop("volume",1),b(".main-output .main-player")[0].muted=!1,0!=b(".output-source .pip").length&&I.outputPreview)){var t=b(".output-source .pip").attr("data-pipvideosharedmemoryname");b(".main-output .pip video").prop("volume",b(".preview-content .preview-item[data-filename='"+t+"'] .voice-value").html().trim()/100),b(".main-output .pip video")[0].muted=!1}}else{b(".afv-cut .radius-box").addClass("close"),b(".afv-cut .radius-box").css({left:"0px"});var i=e.AudioOnlyShm.SharedMemoryName,r=b(".preview-content .preview-item[data-filename='"+i+"']"),a=r.index();b(".afv-audio").html("Audio "+(a+1)),b(".afv-audio").removeClass("disabled"),b(".main-output .icon-erphone").hasClass("active")&&(b("video").prop("volume",0),b(".main-output .main-player").prop("volume",1),b(".main-output .main-player")[0].muted=!1)}}(e)}(t),i.studioFlag=!0}else if("Module Not Found."===e.errorMessage&&i.studioFlag)return void(i.studioFlag=!1)}})},kernelState:function(){this.socket.send({message:{categoryId:"2152857600",operationType:"102"},time:1e3,key:"kernelState",success:function(e){if(e.data)var t=JSON.parse(e.data).CurrentTStrIdHex;b(".main-preview").attr("data-livePeerId",t)}})},stop:function(){this.socket.has("uploadInfo")&&(this.socket.stop("uploadInfo"),this.onchanging=0),this.socket.has("volumeInfo")&&this.socket.stop("volumeInfo")},recover:function(){this.socket.has("uploadInfo")||(this.uploadInfo(),this.onchanging=0),this.socket.has("volumeInfo")||this.volumeInfo()},close:function(){this.socket&&this.socket.off(),this.onchanging=null,this.studioFlag=null}};var S=new e,g={peerIds:[],initFlag:!0,mainTimer:null,listTimer:null,clear:function(){this.peerIds=[],this.mainTimer&&clearInterval(this.mainTimer),this.listTimer&&clearInterval(this.listTimer),this.mainTimer=null,this.listTimer=null},initMainVideo:function(e,t,i){if(this.initFlag){if(this.initFlag=!1,0==b(".preview-source .audio").length){var r=(new Date).getTime().toString()+"x",a=b("#user_info_name").html().trim();I.webrtcLogin=a+r,on_login(a+r),console.log(e+"创建pvw"),I.rtcIdList.pvw=e,I.rtcIdList.pvw.data=i,on_rtc(e)}0!=b(".preview-source .audio").length&&0==b(".output-source .audio").length&&0==I.rtcIdList.pgm.id.length&&(console.log(t+"创建pgm"),I.rtcIdList.pgm.id=t,I.rtcIdList.pgm.data=i,on_rtc(t),1==peerClientStatusArr.clearDisconnectPrompt&&(peerClientStatusArr.clearDisconnectPrompt=!1,0!==b(".simulate_popupBtnsContainer").length&&b("body .simulate_popupBtnsContainer .alert_sureBtn").trigger("click")))}else if(0!=b(".preview-source .audio").length&&0==b(".output-source .audio").length&&0==I.rtcIdList.pvw.length&&0==I.rtcIdList.pgm.id.length){this.initFlag=!0}},updateVideoList:function(e,t,i){var r,a,o,s,n,d,c,l,p,u=this,v=(r=u.peerIds,a=e,o={},s=[],n=[],r.forEach(function(e,t){a.indexOf(e)<0&&n.push(e)}),a.forEach(function(e,t){r.indexOf(e)<0&&s.push(e)}),0<s.length||0<n.length?(o.add=s,o.sub=n,o):null);if(u.peerIds=(d=[],e.forEach(function(e,t){d.push(e)}),d),v){if(0<v.add.length){var m=(c=t,l=v.add,p=[],c.forEach(function(e,t){-1<l.indexOf(e.PreviewID)&&p.push(e)}),p);console.log("增加了",v.add),0<b(".main-output .audio").length&&0==peerClientStatusArr.resetVideoList.length?(console.log(v.add+"创建list"),I.rtcIdList.preLis.idArr=I.rtcIdList.preLis.idArr.concat(v.add),I.rtcIdList.preLis.data=I.rtcIdList.preLis.data.concat(m),on_rtc(v.add,m),b(".pretreat-content .pretreat-content-item").length<=0&&(clearInterval(statusObj.previewListTimer),statusObj.previewListTimer=setInterval(function(){peerClientStatusArr.previewList&&isrestoreHistory&&(clearInterval(statusObj.previewListTimer),peerClientStatusArr.previewList=!1,statusObj.pageInit&&(statusObj.pageInit=!1,isrestoreHistory=!1,initOverlay.firstOverlyShow(),clearInterval(statusObj.clockInitTimer),statusObj.clockInitTimer=setInterval(function(){calPts(b(".main-preview .main-player").attr("id"))&&(clearInterval(statusObj.clockInitTimer),initOverlay.firstClockInit())},500)))},100))):v.add.forEach(function(e,t){var i=u.peerIds.indexOf(e);-1<i&&u.peerIds.splice(i,1)})}if(0<v.sub.length){console.log("减少了",v.sub),v.sub.forEach(function(e,t){on_leave(e),b("#"+e).parents(".preview-item").remove()});var f=b(".preview-content .preview-item");b.each(f,function(e,t){b(t).find(".preview-item-num").html(e+1)})}}}};var m=!1;function r(){this.socket=null}r.prototype={constructor:r,init:function(){this.socket=x.socket({url:"pageRequest?statusChange=1&session="+t,error:function(e){console.log(e)},successObj:{instanceStatusChange:function(e){if("Running"==e.instanceStatus)b(".progress p").html(switchLangObj.i18n_initialize),clearInterval(progressTimer),console.log("第三阶段开始"),b(".progress .progress-status").html("88%"),b(".progress .meter .compelete").css("width","88%"),initprogressTime=88,progressTimer=setInterval(function(){++initprogressTime;var e=initprogressTime+"%";b(".progress .progress-status").html(initprogressTime+"%"),b(".progress .meter .compelete").css("width",e),100==initprogressTime&&clearInterval(progressTimer)},4e3),b(".main-cut").css("margin-top","0.2rem");else if("ReceiverStarted"==e.instanceStatus){if(clearInterval(progressTimer),console.log("第三阶段完成"),b(".progress .progress-status").html("100%"),b(".progress p").html(switchLangObj.i18n_config),b(".progress .meter .compelete").css("width","100%"),b(".pp-loading").css("display","none"),b(".main-cut").css("margin-top","0.8rem"),null!=initSystem.pageWebsocketObj.socket)return;getCheckConfig()}},logo:function(e){"start"==e.logoCopyStatus?b(".recover_history .historyContent").html(switchLangObj.i18n_crossRecoverLogo):"end"==e.logoCopyStatus&&b(".recover_history .historyContent").html(switchLangObj.i18n_crossRecoverLogoEnd)},stream:function(e){"start"==e.streamCopyStatus?b(".recover_history .historyContent").html(switchLangObj.i18n_crossRecoverVideo):"end"==e.streamCopyStatus&&b(".recover_history .historyContent").html(switchLangObj.i18n_crossRecoverVideoEnd)}}}),this.taskInfo()},taskInfo:function(e){var w=this.socket,C=[];0==b(".preview-content li").length?C.push(b(".main-rList .rList-show").attr("data-peerid")):b.each(b(".preview-content li"),function(e,t){C.push(b(t).attr("data-rid"))});var y=[];b.each(b(".pack-body .pack-operate"),function(e,t){y.push(b(t).attr("data-peertid"))}),b.each(b(".tvupack-body .pack-operate"),function(e,t){y.push(b(t).attr("data-peertid"))});var t={type:"taskInfo",sourceStr:y.join(","),programStr:C.join(",")};this.socket.send({message:t,time:1e3,key:"taskInfo",success:function(e){if(e.taskInfo){var t=JSON.parse(e.taskInfo),i=t[0].rInfo,r=t[0].tInfo;if(function(e){if(!e)return;var i=I.selectRId,r="",a=b(".main-rList .rList-show").attr("data-rIp");b.each(e,function(e,t){t.peerId==i&&(a!=t.ip&&b(".main-rList .rList-show").attr("data-rIp",t.ip),r=b(".main-rList .rList-show").attr("data-status"),b(".main-rList .rList-show").attr("data-status",t.status),I.isLive=t.status,"2"===t.status?S.recover():"1"===t.status?(S.recover(),"0"==r&&(I.isSwitch=!0,getUserBehavior())):"0"===t.status&&console.log("当前R的状态为:"+t.status+" "+new Date))})}(t[0].rInfo),t[0].tInfo)for(var a=0;a<r.length;a++){var o=r[a].peerId,s=r[a].status,n=r[a].livePeerId,d=r[a].name,c=r[a].platform;if(sourceList.tokenDelete&&2==b(".pack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status")&&1==s){var l={"tokenCode.code":b(".preview-qrcode").attr("data-code"),peerId:o,confirm:"Delete"};x.ajaxReq("/producerpro/token_confirm",l,function(e){"0x0"==e.errorCode?console.log("delete token:",e,"tid:",o,"imgCode:"):console.log("delete token:",e)})}b(".pack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status",s),b(".preview-list-container").find(".preview-item[data-peertid='"+o+"']").attr("data-status",s),b(".preview-list-container").find(".preview-item[data-rlivepeerid='"+o+"']").attr("data-platform",c),b(".pack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-tlivePeerId",n),b(".tvupack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-tlivePeerId",n),b(".tvupack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status",s);var p=b(".tvupack-body .pack-operate[data-peertid='"+o+"']");if(0!=b(".tvupack-body [data-peertid="+o+"]").length&&(b(".tvupack-body").find(".pack-operate[data-peertid='"+o+"']").attr("data-status",s),2==p.attr("data-status")?(p.text(switchLangObj.i18n_cancelLive),p.css({backgroundColor:"#FF4B4B",border:"1px solid #FF4B4B",color:"#FFF"}),p.siblings(".pack-address ").find("input").css("color","#FF4B4B"),p.siblings(".pack-address").find("input").val(o+"/"+d)):1==p.attr("data-status")?(p.text(switchLangObj.i18n_add),p.css({backgroundColor:"#20CA48",border:"1px solid #20CA48",color:"#FFF"}),p.siblings(".pack-address").find("input").css("color","#20CA48"),p.siblings(".pack-address").find("input").val(o+"/"+d)):0==p.attr("data-status")?(p.text(switchLangObj.i18n_add),p.css({backgroundColor:"#999;",border:"1px solid #999;",color:"#666"}),p.siblings(".pack-address").find("input").css("color","#999"),p.siblings(".pack-address").find("input").val(o+"/"+d)):(p.text(switchLangObj.i18n_add),p.css({backgroundColor:"#999;",border:"1px solid #999;",color:"#666"}),p.siblings(".pack-address").find("input").css("color","#999"),p.siblings(".pack-address").find("input").val(o+"/"+d+"(No Camera)"))),2==p.attr("data-status")&&(""!=p.attr("data-tlivepeerid")||null!=p.attr("data-tlivepeerid"))){var u=p.attr("data-tlivepeerid").toUpperCase(),v=b(".preview-list-container").find(".preview-item[data-rid='"+u+"']");if(0!=v.length){var m=v.find(".preview-item-num").text();p.siblings(".pack-camera").find("span").text(m)}else p.siblings(".pack-camera").find("span").text(switchLangObj.i18n_Unspecified)}}for(a=0;a<i.length;a++){var f=(o=i[a].peerId).toUpperCase(),h=i[a].status;b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").attr("data-rStatus",h);var g=i[a].livePeerId;b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").attr("data-RlivePeerId",g),b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").find(".voip-calling").attr("data-RlivePeerId",g),""!=g&&16==g.length?b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").find(".voip-calling").css("color","#FFF"):b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").find(".voip-calling").css("color","#666"),b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").find(".voip-calling").hasClass("Connected")&&b(".preview-list-container").find(".preview-item[data-rid='"+f+"']").find(".voip-calling").css("color","#41FF6D")}C=[],0==b(".preview-content li").length?C.push(b(".main-rList .rList-show").attr("data-peerid")):b.each(b(".preview-content li"),function(e,t){C.push(b(t).attr("data-rid"))}),y=[],b.each(b(".pack-body .pack-operate"),function(e,t){y.push(b(t).attr("data-peertid"))}),b.each(b(".tvupack-body .pack-operate"),function(e,t){y.push(b(t).attr("data-peertid"))});var k={type:"taskInfo",module:"taskInfo",sourceStr:y.join(","),programStr:C.join(",")};w.sendMsgs.taskInfo.message=k}}})},listTokenDevice4Pro:function(e,t){this.socket;var i={code:e,type:"listTokenDevice4Pro",module:"listTokenDevice4Pro"};this.socket.send({message:i,time:3e3,key:"listTokenDevice4Pro",success:function(e){var t=e.tokenDevice,i=JSON.parse(t).tList,r=void 0;"block"==b(".QrCode ").css("display")&&b(".QrCode ").attr("data-list",t);var a="",o="";m&&0<b(".pack-body").find(".pack-info").length&&b(".pack-body .tokenLoad").remove(),!m&&0<i.length&&(m=!0,0==b(".pack-body").find(".pack-info").length&&b(".tokenLoad").css("display","block"));for(var s=0;s<i.length;s++){var n=i[s].peerId;r=i[s].status;if(b(".preview-list-container").find(".preview-item").eq(s).attr("data-peertid",n),0!==b(".pack-body [data-peertid="+n+"]").length){var d=b(".pack-body .pack-operate[data-peertid='"+n+"']");if(d.attr("data-tStatus",r),2==d.attr("data-status")){d.attr("data-tlivepeerid");var c=d.attr("data-tlivepeerid").toUpperCase(),l=b(".preview-list-container").find(".preview-item[data-rid='"+c+"']");if(0!=l.length){var p=l.find(".preview-item-num").text();d.siblings(".pack-camera").find("span").text(p)}else d.siblings(".pack-camera").find("span").text(switchLangObj.i18n_Unspecified);if(d.find(".tokenImg").attr("data-tStatus")==d.attr("data-status"))return;d.text(switchLangObj.i18n_cancelLive),d.css({backgroundColor:"#FF4B4B",border:"1px solid #FF4B4B",color:"#FFF"}),d.siblings(".pack-address ").find("input").css("color","#FF4B4B")}else if(3==d.attr("data-tStatus")&&2!=d.attr("data-status")){if(d.find(".tokenImg").attr("data-tStatus")==d.attr("data-status"))return;d.text(switchLangObj.i18n_add),d.css({backgroundColor:"#20CA48",border:"1px solid #20CA48",color:"#FFF"}),d.siblings(".pack-address").find("input").css("color","#20CA48")}}else{var u=void 0;1==r?(u=switchLangObj.i18n_accept,o=a=""):3==r&&2!=b(".pack-operate[data-peertid='"+n+"']").attr("data-status")?(u=switchLangObj.i18n_add,a="pack-oprateAdd",o="inputAdd"):3==r&&2==b(".pack-operate[data-peertid='"+n+"']").attr("data-status")&&(u=switchLangObj.i18n_cancelLive,a="pack-oprateCancel",o="inputCancel");var v='<div class="pack-info clearFix">                                            <div class="pack-address left">                                               <input type="text" value="'+n+" / "+i[s].name+'" class="'+o+'" disabled=disabled>                                            </div>                                            <div class="pack-camera left">                                                <span>'+switchLangObj.i18n_Unspecified+'</span>                                                <i class="pack-cameraArrow"></i>                                                <ul style="display:none;">                                                    <li>1</li>                                                    <li>2</li>                                                    <li>3</li>                                                    <li>4</li>                                                </ul>                                            </div>                                            <div class="pack-operate left '+a+'" data-peertid="'+n+'" data-tStatus="'+r+'">'+u+'</div>                                            <div class="pack-del left" data-peertid="'+n+'">                                                <i class="iconfont icon-del"></i>                                            </div>                                          </div>';b(".pack-body").prepend(v)}}}})},shareNum:function(e){var t={type:"shareNum",ridList:e};this.socket.send({message:t,time:1e3,key:"shareNum",success:function(e){if(e.shareNum){var t=JSON.parse(e.shareNum);if(""==t)return b(".Push_toAccount_comment .shareIcon").find(".icon-socialMeida").removeClass("active"),void b(".Push_toAccount_comment .shareIcon").find(".shareIcon-bottom").children(".shareCircle").css("display","none");t=t[0].shareInfo,b(".Push_toAccount_comment").find(".icon-socialMeida.active").removeClass("active"),b(".Push_toAccount_comment").find(".shareCircle").hide(),b.each(t,function(e,t){"producerPro"==t.liveModule&&(b(".Push_toAccount_comment").find("[data-name='"+t.shareKey+"']").find(".icon-socialMeida").addClass("active"),b(".Push_toAccount_comment").find("[data-name='"+t.shareKey+"']").find(".shareCircle").css("display","inline-block"),b(".Push_toAccount_comment .gridShow").after(b(".Push_toAccount_comment").find("[data-name='"+t.shareKey+"']")))})}}})},stop:function(){this.socket.has("shareNum")&&this.socket.stop("shareNum")},recover:function(){this.socket.has("shareNum")||this.shareNum(b(".main-rList .rList-show").attr("data-peerId"))}};var s=new r;function a(){this.socket=null}s.init(),a.prototype={constructor:a,init:function(s){this.socket=x.socket({url:"studio/"+s+"/"+Math.random()+"?session="+t,error:function(e){console.log(e)},successObj:{activeWs:function(e){b(".output-top .userNum").html(e.count),b(".output-top .userNum").attr("title",switchLangObj.i18n_currentUserNum)},tokenPairMsg:function(e){if("block"!=b(".upload-video").css("display")){var t=e.tokenDevice,i=b(".preview-list-container .preview-qrcode").attr("data-code"),r=b(".preview-qrcode").parents(".preview-item").attr("data-rid");if(r=r.toLowerCase(),0==sourceList.token2live){if(3==e.tokenStatus){if(1==sourceList.preventRepeatRequest)return;sourceList.preventRepeatRequest=!0,b(".preview-qrcode .select-tokenpair").css("display","none"),b(".preview-qrcode .select-live").css("display","block"),b(".preview-list-container .preview-qrcode").attr("data-peertid",e.tokenDevice);var a=e.tokenDeviceName||e.tokenDevice;b(".preview-list-container .preview-qrcode").parents(".preview-item").find(".show-name").html(a),setTimeout(function(){sourceList.preventRepeatRequest=!1},1e4)}else if(2==e.tokenStatus||1==e.tokenStatus){if(1==sourceList.preventRepeatRequest)return;if(sourceList.preventRepeatRequest=!0,b(".preview-list-container .preview-qrcode").attr("data-peertid",e.tokenDevice),b(".preview-list-container .preview-qrcode .aSelectBox").hasClass("selectedBoxClass")){var o={"tokenCode.code":i,peerId:t,checkFlag:"0",rid:r,confirm:"Accept"};b.ajax({type:"POST",url:"/producerpro/token_confirm",timeout:7e3,data:o,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode&&(setTimeout(function(){sourceList.preventRepeatRequest=!1},1e4),x.alertTips(switchLangObj.i18n_PairingSuccess,2e3,function(){b(".preview-qrcode .select-tokenpair").css("display","none"),b(".preview-qrcode .select-live").css("display","block")}))},error:function(e){sourceList.preventRepeatRequest=!1,console.log("accept:",e,"tid:",tid,"rid:",s,"imgCode:",imgCode)}})}else b(".preview-qrcode .select-accept").css("display","block");a=e.tokenDeviceName||e.tokenDevice;b(".preview-list-container .preview-qrcode").parents(".preview-item").find(".show-name").html(a)}}else 2==e.tokenStatus||1==e.tokenStatus?liveToken(t,r,i,!0):liveToken(t,r,i)}}}})},changeVolume:function(e,t){var i={parameter:{shm:t}};i.parameter.vol=-40==e?-40:e;var r=this;this.socket.send({message:i,time:200,key:"volume",success:function(e){r.stop()},error:function(e){r.stop(),console.log(e)}})},stop:function(){this.socket.has("volume")&&this.socket.stop("volume")},close:function(){this.socket&&this.socket.off()}};var n=new a;return{initStudioRList:function(e,t){if(t){var i=JSON.parse(decodeURIComponent(t));b(".main-rList .rList-show").html(i.SelectR.rname).attr({"data-status":i.SelectR.status,"data-version":i.SelectR.version,"data-peerId":i.SelectR.peerId,"data-rIp":i.SelectR.rIp,"data-port":i.SelectR.port,title:i.SelectR.rname}),I.isLive=i.SelectR.status,I.selectRId=i.SelectR.peerId,S.init(i.SelectR.peerId),s.shareNum(i.SelectR.peerId),n.init(i.SelectR.peerId)}else{if(!e)return;var r=(r=JSON.parse(decodeURIComponent(e))).sort(o),a="";r.forEach(function(e,t){var i=0<e.status?"online":"";a+='<li class="rList-item ellipsis '+i+'" data-status="'+e.status+'" data-version="'+e.version+'" data-peerId="'+e.peerId+'" data-rIp="'+e.ip+'" data-port="'+e.port+'" title="'+e.name+'">'+e.name+"</li>"}),b(".main-rList .rList-content").html(a),b(".main-rList .rList-content").fnNiceScroll(),b(".pretreat-content").fnNiceScroll(),b(".main-rList .rList-show").html(r[0].name).attr({"data-status":r[0].status,"data-version":r[0].version,"data-peerId":r[0].peerId,"data-rIp":r[0].rIp,"data-port":r[0].port,title:r[0].name}),I.isLive=r[0].status,I.selectRId=r[0].peerId,S.init(r[0].peerId),s.shareNum(r[0].peerId),n.init(r[0].peerId)}},pageRequestObj:s,pageWebsocketObj:S,volumeControlObj:n,webrtcVideo:g}}($,oUtils,currentRInfo,volume.volumeColumn),resourceAbout=function(v,m,f){var e={initEvent:function(){this.ipEvent()},ipEvent:function(){v(".ip-add").on("click",function(){if(10<=v(".ip-body .ip-info").length)return m.alertTips("i18n_OnlySupport10Ext"),!1;var e='<div class="ip-info clearFix"><div class="ip-address left"><input type="text"  placeholder="http/rtmp/issp/rtsp"></div><div class="left select"></div><div class="ip-operate operate left">'+f.i18n_ipConnect+'</div><div class="ip-del left"><i class="iconfont icon-del"></i></div></div>';v(".ip-body").prepend(e);v(".preview-content .preview-item");v(".ip-body .select").eq(0).createSimulateSelect([{name:1,type:"R"},{name:2,type:"R"},{name:3,type:"R"},{name:4,type:"R"},{name:5,type:"ip"}],"","type","name"),v(".ip-body .select").eq(0).attr("data-value","no_select"),v(".ip-body .select .dropdownDefault_value").eq(0).html(f.i18n_Unspecified),v(".ip-body .select .dropdownDefault_value").eq(0).attr("title",f.i18n_Unspecified)}),v(".ip-body").on("click",".ip-operate",function(){var i=v(this).parents(".ip-info");if("no_select"==i.find(".select").attr("data-value"))return m.alertTips("i18n_pleaseChooseCamera",1500),!1;if(i.hasClass("isLive")){if(5==i.find(".dropdownDefault_value").html())return p.deleteAddress(i,!1),!1;var e=i.attr("data-livepeerid"),t={rid:v(".preview-content .preview-item").eq(i.find(".select .dropdownDefault_value").eq(0).html()-1).attr("data-rid").toLowerCase(),params:JSON.stringify({TIdHex:e})};m.ajaxReq("/producerpro/stopLive",t,function(e){var t=e.ErrorCode;0!=t&&"‭2147483649‬"!=t||u(i.find(".select .dropdownDefault_value").eq(0).html(),void 0,i)})}else{var r=v(this).parent(),a=i.find("input").val();null==i.attr("data-filename")&&i.attr("data-filename",a);var o=r.find("input").eq(0).val();o=o.trim(),r.attr("data-id")?s(i,o):p.addrStreamAddress(o,i)}}),v(".grid-body").on("click",".grid-operate",function(){var i=v(this).parents(".grid-info");if("no_select"==i.find(".select").attr("data-value"))return m.alertTips("i18n_pleaseChooseCamera",1500),!1;if(i.hasClass("isLive")){var e=i.attr("data-tid"),t={rid:v(".preview-content .preview-item").eq(i.find(".select .dropdownDefault_value").eq(0).html()-1).attr("data-rid").toLowerCase(),params:JSON.stringify({TIdHex:e})};m.ajaxReq("/producerpro/stopLive",t,function(e){var t=e.ErrorCode;0!=t&&"2147483649‬"!=t||u(i.find(".select .dropdownDefault_value").eq(0).html(),void 0,i)})}else{var r=i.attr("data-id"),a=i.find(".dropdownDefault_value").html(),o={xId:r,rId:v(".preview-content .preview-item").eq(a-1).attr("data-rid")};i.find(".grid-operate").css("display","none"),i.find(".grid-loading").css("display","block"),p.connectGridSourceAndR(o,i)}}),v(".ip-body").on("click",".ip-del",function(){var e=v(this).parent();e.attr("data-id")?p.deleteAddress(e,!0):e.remove()}),v(".upload-tab li").dblclick(function(){return!1}),v(".upload-tab li").on("click",function(){var e=v(this).index();if(0==e)r();else if(1==e)d();else if(2==e)resourceAbout.getIpStreamList();else if(3==e){var t=v(".pack").attr("data-code");if(""==t||null==t)return void m.alertTips("i18n_errorTips",2e3);var i={type:"T"};m.ajaxReq("/producerpro/studio_device",i,function(e){if("0x0"==e.errorCode){var t=e.result;if(0!=t.length)for(var i="",r=0;r<t.length;r++){i=a(t[r].peerId,t[r].name,t[r].status)+i}v(".tvupack-body").html(i)}})}else if(4==e){i={};v(".video-manage.grid .sort .iconfont").hasClass("icon-sortdown")&&(i.sort="desc"),p.getGridSources(i)}else quadView.getQuadViewData(),console.log("转换到QuadView");v(this).addClass("active").siblings().removeClass("active"),v(".upload-body .video-manage").eq(e).css("display","block").siblings().css("display","none")}),v(".preview-add").on("click",function(){if(!mix_fn.isPrower("AddAnywhere"))return!1;var e=v(this);if(0!=v(".sd-preview-list").find(".preview-item").length){var t=v(".upload-tab").children("li.active").index();if(!e.hasClass("disabled"))return v(".upload-video").css("display","block"),0==t?r():1==t?d():5==t&&(v(".quad-list .quad-add").css("display","none"),quadView.getQuadViewData()),!1}}),v(".upload-header .close").on("click",function(){return v(".upload-video").css("display","none"),v("#bgFilter").css("display","none"),!1}),v(".video-body").on("click",".vedio-del",function(){!function(t,i){if(t.hasClass("disabled"))return;var r=t.attr("data-filename"),e=!1;if(!(e=v(".main-preview").attr("data-filename")==r||v(".main-output").attr("data-filename")==r)){if(v(".afv-cut .radius-box").hasClass("close")){var a=v(".afv-audio-cut .afv-audio").html().substring(6);v(".preview-content .preview-item").eq(a-1).attr("data-filename")==r&&(e=!0)}0!==v(".preview-content .preview-item.pipOutputActive").length&&v(".preview-content .preview-item.pipOutputActive").attr("data-filename")==r&&(e=!0)}if(e)return m.alertTips("i18n_dontDeleteVideoAtUsing");v(".preview-content [data-filename='"+r+"']").find("video").attr("id");var o=t.attr("data-videoId");m.confirmTips("i18n_producerProdeleteVideoConfirm",function(){var e={rid:v(".main-rList .rList-show").attr("data-peerId"),params:JSON.stringify([{FileShimeName:r}])};null!=o&&(e.id=o),m.ajaxReq("/producerpro/removeFileShim",e,function(e){"0x0"==e.errorCode?(t.remove(),i.css("display","block")):m.alertTips(e.errorInfo,1500)})})}(v(this).parent(),v(".video-manage .video-add"))}),v(".upload-footer .complete-btn").on("click",function(){return v(".upload-header .close").trigger("click"),!1}),v(".video-manage.grid .icon-search").on("click",function(){var e=v(this).parent(".search").find("input").val();i(e=e.toLowerCase())}),v(".video-manage.grid .search input").on("keyup",function(){return!1}),v(".video-manage.grid .sort_pos").on("click",function(){var e=v(this).find(".iconfont"),t={};e.hasClass("icon-sortup")?(e.removeClass("icon-sortup").addClass("icon-sortdown"),t.sort="desc"):e.removeClass("icon-sortdown").addClass("icon-sortup"),p.getGridSources(t)}),v(".pack-body").on("click",".pack-camera",function(e){var t=v(this).children("ul");if(t.hasClass("activeUl"))t.removeClass("activeUl"),t.css("display","none");else{if(v(this).siblings(".pack-operate").text()==f.i18n_cancelLive)return;t.css("display","block"),v(".upload-body").css("overflow","visible"),t.addClass("activeUl"),t.parents(".pack-info").siblings().find(".pack-camera").find("ul").css("display","none")}e.stopPropagation()}),v(".pack-body,.tvupack-body").on("click","li",function(){var e=v(this),t=e.text();return v(".upload-body").css("overflow","hidden"),e.parents(".pack-camera").children("span").text(t),e.parents(".pack-camera").siblings(".pack-operate").attr("data-selectNumber",t),e.parent("ul").css("display","none"),!1}),v(".tvupack-body").on("click",".pack-camera",function(e){var t=v(this).children("ul");if(t.hasClass("activeUl"))t.removeClass("activeUl"),t.css("display","none");else{if(v(this).siblings(".pack-operate").text()==f.i18n_cancelLive)return;if(0==v(this).siblings(".pack-operate").attr("data-status")||3==v(this).siblings(".pack-operate").attr("data-status"))return;t.css("display","block"),t.addClass("activeUl"),t.parents(".pack-info").siblings().find(".pack-camera").find("ul").css("display","none")}e.stopPropagation()}),v(".pack-body").on("click",".pack-operate",function(){var i=v(this),e=i.attr("data-peertid");if(i.text()==f.i18n_accept){if(4<v(".pack-body").find(".pack-operate").length)return void m.alertTips("i18n_hastoken",2e3);i.text("");i.append('<img src="images/cloud_loading.gif" class="tokenImg" style="width:20px;">');var t={"tokenCode.code":v(".anywher-title").attr("data-code"),peerId:e,confirm:"Accept"};v.ajax({type:"POST",url:"/producerpro/token_confirm",timeout:15e3,data:t,success:function(e){var t=JSON.parse(e).errorCode;"0x0"==t?(i.attr("data-tStatus","3"),m.alertTips("i18n_HasBeenSent",2e3)):"0x01"==t?m.alertTips("i18n_acceptFail",2e3):m.alertTips("i18n_proerrorTips",2e3),v(".tokenImg").remove(),i.text(f.i18n_accept)}})}else n(i,e)}),v(".pack-body,.tvupack-body").on("click",".pack-del",function(){var r=v(this),e=r.siblings(".pack-operate"),t=parseInt(r.siblings(".pack-camera").children("span").text()),i=v(".preview-list-container").find(".preview-item").eq(t-1).attr("data-rid"),a=v(".anywher-title").attr("data-code"),o=r.attr("data-peertid");if(e.text()!=f.i18n_cancelLive)if(""!=e.text()){if(null!=i&&""!=i){i=i.toLowerCase();var s={};s.TIdHex=o;var n={rid:i,params:JSON.stringify(s)};m.ajaxReq("/producerpro/stopLive",n)}var d={"tokenCode.code":a,peerId:o,confirm:"Delete"};r.parents(".tvupack-body")&&(d.type="T"),m.ajaxReq("/producerpro/token_confirm",d,function(e){var t=e.errorCode;if("0x0"==t){if(r.parents(".tvupack-body")){var i=v(".pack-body .pack-operate");v.each(i,function(e,t){v(t).attr("data-peertid")==o&&v(t).parents(".pack-info").remove()})}r.parent(".pack-info").remove(),m.alertTips("i18n_deleteFeilSuccess",2e3)}else"0x01"==t&&r.parent(".pack-info").remove()})}else m.alertTips("i18n_NotDelete");else m.alertTips("i18n_ProhibitedtoDelete")}),v(".tvupack-body").on("click",".pack-operate",function(){var r=v(this),a=r.attr("data-peertid");if(1==r.attr("data-status")){var e={"tokenCode.code":v(".pack").attr("data-code"),peerId:a,confirm:"Accept",type:"T"};v.ajax({type:"POST",url:"/producerpro/token_confirm",timeout:15e3,data:e,success:function(e){var t=JSON.parse(e).errorCode,i=JSON.parse(e).errorInfo;if("0x0"==t)m.alertTips("i18n_HasBeenSent",2e3),n(r,a,"pack");else if("0x01"==t)n(r,a,"pack");else if("0x80100003"==t)return void m.alertTips(i,2e3)}})}else{if(2!=r.attr("data-status"))return;n(r,a)}})}};v(".upload-body").fnNiceScroll("#333");var p={addExternalSource:function(e,t,i,r){var a={url:e,rid:t};m.ajaxReq("/producerpro/addExtAndSynchronize",a,function(e){"0x0"==e.errorCode?(p.reqNum=0,i.attr("data-livePeerid",e.result.peerId),p.startRAndExtLive(a.rid,e.result.peerId,r,i)):"0x80100017"==e.errorCode?m.alertTips("i18n_hasAddedUrl",1500):m.alertTips(e.errorInfo,1500)})},connectGridSourceAndR:function(o,s){v.ajax({type:"POST",url:"/producerpro/connectGridSourceAndR",timeout:3e4,data:o,success:function(e){if(e=JSON.parse(e),s.find(".grid-operate").css("display","block"),s.find(".grid-loading").css("display","none"),"0x0"==e.errorCode){var t=s.find(".select .dropdownDefault_value").html(),i={id:o.xId},r=o.rId,a=e.result.peerId;s.attr("data-tid",a),p.startRAndExtLive(r,a,t,s,i)}else m.alertTips(e.errorInfo,1500)}})},reqNum:0,startRAndExtLive:function(t,i,r,a,o){var e={};e.TIdHex=i;var s={rid:t.toLowerCase(),params:JSON.stringify(e)};m.ajaxReq("/producerpro/startLive",s,function(e){"0"==e.ErrorCode?(p.reqNum=0,o&&(o.TIdHex=i,i=o),u(r,i,a),m.alertTips("i18n_producerProUploadIpSourceTip",1500)):5<p.reqNum?(p.reqNum=0,m.alertTips("start live fail",1500)):(p.reqNum++,p.startRAndExtLive(t,i,r,a,o))})},deleteAddress:function(i,e){var t="",r="";0!=window.sourceList.uploadIpShimArr.length&&(t=window.sourceList.uploadIpShimArr[0].PreviewShm.SharedMemoryName,r=window.sourceList.uploadIpShimArr[0].PreviewShm.FileName);var a=i.attr("data-livepeerid"),o=i.find("input").val().trim()==r,s=!1,n=v(".preview-content .preview-item.outPutActive");if((n.attr("data-filename")==t&&o||n.attr("data-rlivepeerid")==a&&a)&&(s=!0),!s){if(v(".afv-cut .radius-box").hasClass("close")){var d=v(".afv-audio-cut .afv-audio").html().substring(6),c=v(".preview-content .preview-item").eq(d-1);(c.attr("data-filename")==t&&o||c.attr("data-rlivepeerid")==a)&&(s=!0)}var l=v(".preview-content .preview-item.pipOutputActive");0!=l.length&&(l.attr("data-filename")==t&&o||l.attr("data-rlivepeerid")==a)&&(s=!0)}if(s)return m.alertTips("i18n_dontDeleteVideoAtUsing"),!1;if(e)m.confirmTips("i18n_producerProdeleteVideoConfirm",function(){var e={id:i.attr("data-id")};if(m.ajaxReq("/producerpro/studio_delete_stream",e,function(e){if("0x0"==e.errorCode){if(i.hasClass("isLive"))u(i.find(".select .dropdownDefault_value").eq(0).html());i.remove()}else m.alertTips(e.errorInfo,1500)}),0!==window.sourceList.uploadIpShimArr.length&&window.sourceList.uploadIpShimArr[0].PreviewShm.SharedMemoryName){var t=window.sourceList.uploadIpShimArr[0].PreviewShm.SharedMemoryName;p.delIpsource(i,t),u(i.find(".select .dropdownDefault_value").eq(0).html(),null,i)}});else if(0!==window.sourceList.uploadIpShimArr.length&&window.sourceList.uploadIpShimArr[0].PreviewShm.SharedMemoryName){t=window.sourceList.uploadIpShimArr[0].PreviewShm.SharedMemoryName;p.delIpsource(i,t),u(i.find(".select .dropdownDefault_value").eq(0).html(),null,i)}},delIpsource:function(i,e,r,a){var o=window.sourceList.uploadIpShimArr[0].PreviewID,t={rid:v(".main-rList .rList-show").attr("data-peerId"),params:JSON.stringify([{FileShimeName:e}])};m.ajaxReq("/producerpro/removeFileShim",t,function(e){if("0x0"==e.errorCode){-1<i.attr("data-filename").indexOf("(IP Shim)")&&i.remove(),void 0!==o&&on_leave(o);var t=a.find(".ip-address input").val();r&&p.addIPSourceInProducer(t,a)}else m.alertTips(e.errorInfo,1500)})},addIPSourceInProducer:function(e,t){if(!o(e))return m.alertTips("i18n_producerProIsNotUrl",1500),!1;var i={rid:v(".main-rList .rList-show").attr("data-peerId")},r={FileShimeName:e,NickName:(new Date).getTime().toString()+" (IP Shim)",ShimType:200};i.params=JSON.stringify(r),m.ajaxReq("/producerpro/addIPSourceInProducer",i,function(e){"0x0"==e.errorCode?(m.alertTips("i18n_producerProUploadIpSourceTip",1500),u(5,t.attr("data-filename"),t)):m.alertTips(e.errorInfo,1500)})},addrStreamAddress:function(t,i){if(!o(t))return m.alertTips("i18n_producerProIsNotUrl",1500),!1;var e={pathUrl:t,streamType:1};m.ajaxReq("/producerpro/studio_store_stream",e,function(e){"0x0"==e.errorCode?(i.attr("data-id",e.result.id),i.find(".ip-del").removeClass("disabled"),s(i,t)):m.alertTips(e.errorInfo,1500)})},delIpsourceAndCreate:function(e,t){var i=window.sourceList.uploadIpShimArr[0].PreviewShm.SharedMemoryName,r=!1;if(!(r=v(".main-output").attr("data-filename")==i)){if(v(".afv-cut .radius-box").hasClass("close")){var a=v(".afv-audio-cut .afv-audio").html().substring(6);v(".preview-content .preview-item").eq(a-1).attr("data-filename")==i&&(r=!0)}0!==v(".preview-content .preview-item.pipOutputActive").length&&v(".preview-content .preview-item.pipOutputActive").attr("data-filename")==i&&(r=!0)}if(r)return m.alertTips("i18n_dontDeleteVideoAtUsing"),!1;p.delIpsource(e,i,!0,t)},getIpStreamList:function(){m.ajaxReq("/producerpro/studio_list_stream",{streamType:1},function(e){"0x0"==e.errorCode?function(e){var t="",i=v("#userBehavior").val();i=JSON.parse(decodeURIComponent(i)),console.log(i);var r=i.Position,a={},o="";Object.keys(r).forEach(function(e){5==e?o=r[e]:"object"!=_typeof(r[e])&&(a[r[e]]=e)});for(var s=0;s<e.length;s++){var n=e[s].pathUrl;if(o==n)t+='<div class="ip-info clearFix '+((d=!0)?"isLive":"")+'" data-filename="'+n+'" data-id="'+e[s].id+'" data-livepeerid="'+e[s].peerId+'"><div class="ip-address left"><input type="text"  placeholder="rtmp/http/issp/rtsp" value="'+e[s].pathUrl+'"></div><div class="left select '+(d?"seat_5 disabled":"")+'"></div><div class="ip-operate operate left">'+(d?f.i18n_ipUnConnect:f.i18n_ipConnect)+'</div><div class="ip-del left"><i class="iconfont icon-del"></i></div></div>';else{var d=!!a[e[s].peerId];t+='<div class="ip-info clearFix '+(d?"isLive":"")+'" data-filename="'+n+'" data-id="'+e[s].id+'" data-livepeerid="'+e[s].peerId+'"><div class="ip-address left"><input type="text"  placeholder="rtmp/http/issp/rtsp" value="'+e[s].pathUrl+'"></div><div class="left select '+(d?"seat_"+a[e[s].peerId]+" disabled":"")+'"></div><div class="ip-operate operate left">'+(d?f.i18n_ipUnConnect:f.i18n_ipConnect)+'</div><div class="ip-del left"><i class="iconfont icon-del"></i></div></div>'}}v(".ip-body").html(t);v(".ip-body .select").createSimulateSelect([{name:1,type:"R"},{name:2,type:"R"},{name:3,type:"R"},{name:4,type:"R"},{name:5,type:"ip"}],"","type","name"),v(".ip-info .ip-address input").css("width","368px"),v(".ip-body .select").attr("data-value","no_select"),v(".ip-body .select .dropdownDefault_value").html(f.i18n_Unspecified),v(".ip-body .select .dropdownDefault_value").attr("title",f.i18n_Unspecified);for(var c=1;c<6;c++)0!=v(".ip-body .seat_"+c).length&&(v(".ip-body .select.seat_"+c).attr("data-value",c),v(".ip-body .select.seat_"+c+" .dropdownDefault_value").html(c),v(".ip-body .select.seat_"+c+" .dropdownDefault_value").attr("title",c))}(e.result):m.alertTips(e.errorInfo,1500)})},getGridSources:function(e){e||(e={}),m.ajaxReq("/producerpro/getGridSource",e,function(e){if("0x0"==e.errorCode){v(".grid-body").attr("data-params",encodeURIComponent(JSON.stringify(e.result)));var t=v(".grid .search input").val();i(t=t.toLowerCase())}else m.alertTips(e.errorInfo,1500)})},saveGridPair:function(e){if(0!=e.lenght){var t=e.find(".dropdownDefault_value").html();v(".video-manage.grid .grid-info.live.seat_"+t).removeClass("live seat_"+t),e.removeClass("live"),e.removeClass("seat_1"),e.removeClass("seat_2"),e.removeClass("seat_3"),e.removeClass("seat_4"),e.addClass("live seat_"+t)}for(var i,r=v(".video-manage.grid .grid-info.live"),a={rid:"",source_seats:{},source_idarr:[]},o=0;o<r.length;o++){i={id:"",seat_index:"",class_name:""};var s=r.eq(o);s.hasClass("seat_1")?(i.class_name="seat_1",i.seat_index=1):s.hasClass("seat_2")?(i.class_name="seat_2",i.seat_index=2):s.hasClass("seat_3")?(i.class_name="seat_3",i.seat_index=3):s.hasClass("seat_4")&&(i.class_name="seat_4",i.seat_index=4),i.id=s.attr("data-id"),a.source_idarr.push(i.id),a.source_seats[i.id]=i}var n={pn:"sd",content:JSON.stringify(a),remark:"GridPair"};m.ajaxReq("saveUserBehavior",n,function(){p.getGridPair()})},getGridPair:function(){m.ajaxReq("/producerpro/getUserBehavior",{pn:"sd"},function(e){if("0x0"==e.errorCode){var t=JSON.parse(e.errorInfo);(t=t.GridPair||void 0)&&v(".grid-body").attr("data-liveparams",encodeURIComponent(JSON.stringify(t)))}})}};function r(){var e=QRImg();m.ajaxReq("/producerpro/token_getToken4Pro",e,function(e){if("0x0"==e.errorCode){v(".pack-container").addClass("pack-containerBg"),v(".upload-body .qr-img").addClass("qr-imgBg");var t=e.result,i="<p>"+f.i18n_headTips+"</p>";v(".anywher-title").html(i),v(".anywher-title").attr("data-code",t),v(".pack").attr("data-code",t),createQrImg("qrImg",t);var r='<p style="top:57px;"><b>'+f.i18n_StepOne+"</b><i></i><span>"+f.i18n_OnAppSetting+'</span></p>                    <p style="top:94px;"><b>'+f.i18n_StepTwo+"</b><i></i><span>"+f.i18n_OnThisPage+'</span></p>                    <p style="top:132px;"><b>'+f.i18n_StepThree+"</b><i></i><span>"+f.i18n_OnAppLive+'</span></p>                    <p style="top:169px;"><b>'+f.i18n_tips+"</b><i></i><span>"+f.i18n_OnAppLivetips+"</span></p>";v(".tips").html(r);var a='<div class="file left">'+f.i18n_Device+'</div>                               <div class="Camera left" style="position:absolute;left:378px;">'+f.i18n_Camera+'</div>                               <div class="operate right" style="width:114px;">'+f.i18n_Operation+"</div>";v(".sd-token-title").html(a)}else m.alertTips("i18n_errorTips",2e3)})}function a(e,t,i){var r,a,o=void 0;return 0==i?(o=f.i18n_add,r="pack-oprateNoAdd",a="inputAdd"):1==i?(o=f.i18n_add,r="pack-oprateAdd",a="inputAdd"):2==i?(o=f.i18n_cancelLive,r="pack-oprateCancel",a="inputCancel"):3==i&&(o=f.i18n_add,r="pack-oprateNoAdd",a="inputAdd"),'<div class="pack-info clearFix">                            <div class="pack-address left">                               <input type="text" value="'+e+"/"+t+'" class="'+a+'" disabled=disabled>                            </div>                            <div class="pack-camera left">                                <span>'+f.i18n_Unspecified+'</span>                                <i class="pack-cameraArrow"></i>                                <ul style="display:none;">                                    <li>1</li>                                    <li>2</li>                                    <li>3</li>                                    <li>4</li>                                </ul>                            </div>                            <div class="pack-operate left '+r+'" data-peertid="'+e+'" data-tStatus="'+i+'">'+o+"</div>                        </div>"}function i(e){var t,i,r=function(){var e=v("#userBehavior").val(),t=(e=JSON.parse(decodeURIComponent(e))).Position||{},i={sourceArr:[],liveSourHtml:""};if(!t)return i;var r=JSON.parse(decodeURIComponent(v(".grid-body").attr("data-params"))),a={};Object.keys(t).forEach(function(e){"object"==_typeof(t[e])&&(i.sourceArr.push(t[e].id),a[t[e].id]={position:e,TIdHex:t[e].TIdHex})}),console.log(a);for(var o=0;o<r.length;o++)-1<i.sourceArr.indexOf(r[o].peer_id)&&(i.liveSourHtml+='<div class="grid-info clearFix isLive" data-id="'+r[o].peer_id+'" data-tid="'+a[r[o].peer_id].TIdHex+'">                    <div class="grid-address left">                        <input type="text" readonly=true value='+r[o].name+'>                    </div>                    <div class="left select disabled seat_'+a[r[o].peer_id].position+'"></div>                    <div class="grid-loading left" style="display: none;"><img src="./images/Spinner-1s-24px.gif" alt=""></div>                    <div class="grid-operate operate left">'+f.i18n_ipUnConnect+"</div>                </div>");return i}();v(".grid-body").attr("data-params")&&(i=JSON.parse(decodeURIComponent(v(".grid-body").attr("data-params"))));var a=[];if(e)for(var o=0;o<i.length;o++)-1<(t=i[o]).name.toLowerCase().indexOf(e)&&a.push(t);else a=i;r.unliveSourceArr=a,function(e){for(var t=e.liveSourHtml,i=0,r=e.unliveSourceArr;i<r.length;i++)-1<e.sourceArr.indexOf(r[i].peer_id)||(t+='<div class="grid-info unlive clearFix" data-id="'+r[i].peer_id+'">                <div class="grid-address left">                    <input type="text" readonly=true value='+r[i].name+'>                </div>                <div class="left select"></div>                <div class="grid-loading left" style="display: none;"><img src="./images/Spinner-1s-24px.gif" alt=""></div>                <div class="grid-operate operate left">'+f.i18n_ipConnect+"</div>            </div>");v(".video-manage .grid-body").html(t);v(".grid-body .select").createSimulateSelect([{name:1,type:"R"},{name:2,type:"R"},{name:3,type:"R"},{name:4,type:"R"}],"","type","name"),v(".grid-body .select").attr("data-value","no_select"),v(".grid-body .select .dropdownDefault_value").html(f.i18n_Unspecified),v(".grid-body .select .dropdownDefault_value").attr("title",f.i18n_Unspecified);for(var a=1;a<5;a++)0!=v(".grid-body .seat_"+a).length&&(v(".grid-body .select.seat_"+a).attr("data-value",a),v(".grid-body .select.seat_"+a+" .dropdownDefault_value").html(a),v(".grid-body .select.seat_"+a+" .dropdownDefault_value").attr("title",a))}(r)}function s(e,t){var i=e.find(".select").attr("data-value"),r=e.find(".dropdownDefault_value").html(),a=v(".preview-content .preview-item").eq(r-1);if("R"==i){var o=a.attr("data-rid");p.addExternalSource(t,o,e,r)}else 0!==window.sourceList.uploadIpShimArr.length?p.delIpsourceAndCreate(a,e):p.addIPSourceInProducer(t,e)}function o(e){return!!new RegExp("^((http|rtmp|rtsp|issp)?://)+(([0-9a-zA-Z_!~*'().&=+$%-]+: )?[0-9a-zA-Z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-zA-Z_!~*'()-]+.)*([0-9a-zA-Z][0-9a-zA-Z-]{0,61})?[0-9a-zA-Z].[a-zA-Z]{2,6})(:[0-9]{1,5})?((/?)|(/[0-9a-zA-Z_!~*'().;?:@&=+$,%#-]+)+/?)$").test(e)}function n(e,t,i){var r,a,o,s,n,d=e.siblings(".pack-camera").children("span").text(),c=parseInt(e.siblings(".pack-camera").children("span").text());n=e.attr("data-status");var l=v(".preview-list-container").find(".preview-item").eq(c-1);if(a=l.attr("data-rStatus"),o=l.attr("data-RlivePeerId"),e.text()==f.i18n_add){if(d==f.i18n_Unspecified)return void m.alertTips("i18n_selectReceivers",2e3);if(""==l.attr("data-rid")||null==l.attr("data-rid"))return e.text()==f.i18n_cancelLive&&m.alertTips("i18n_ReceiverIslivingWithOther",2e3),void m.alertTips("i18n_ReceiverIsNotOnline",2e3);r=l.attr("data-rid").toLowerCase(),(u={}).TIdHex=t;var p={rid:r,params:JSON.stringify(u)};2==n&&2==a?s==r&&o==t?(p.rid=r,u.TIdHex=t,p.params=JSON.stringify(u),h(t,130),k(e,p)):(p.rid=r,u.TIdHex=o,p.params=JSON.stringify(u),k(e,p),p.rid=s,u.TIdHex=t,p.params=JSON.stringify(u),h(t,130),k(e,p),p.rid=r,u.TIdHex=t,p.params=JSON.stringify(u),h(t,null,r),g(e,p,c)):(2!=n&&2==a?(p.rid=r,u.TIdHex=o,p.params=JSON.stringify(u),k(e,p)):2==n&&2!=a&&(p.rid=s,u.TIdHex=t,p.params=JSON.stringify(u),h(t,130),k(e,p)),p.rid=r,u.TIdHex=t,p.params=JSON.stringify(u),h(t,null,r),g(e,p,c))}else if(e.text()==f.i18n_cancelLive){var u;r=l.attr("data-rid").toLowerCase(),(u={}).TIdHex=t;p={rid:r,params:JSON.stringify(u)};h(t,130),k(e,p)}}function h(e,t,i){var r={},a=null;if(t)a={tid:e,type:t};else{var o=v(".preview-content .preview-item[data-rid="+i.toUpperCase()+"]");a=o.hasClass("outPutActive")||o.hasClass("pipOutputActive")?{tid:e,type:132}:o.hasClass("pipPreviewActive")||o.hasClass("previewActive")?{tid:e,type:131}:{tid:e,type:130}}var s=[];s.push(a),r.tallyArray=JSON.stringify(s),m.ajaxReq("/producerpro/studio_tally",r,function(e){0!=e.ErrorCode&&console.log(e.errorInfo)})}function g(r,e,a){if(0!=sourceList.tokenFlag){sourceList.tokenFlag=!1;var o=4;sourceList.retryCountTimer&&clearInterval(sourceList.retryCountTimer),sourceList.retryCountTimer=setInterval(function(){v.ajax({type:"POST",url:"startLive",timeout:7e3,data:e,success:function(e){sourceList.tokenFlag=!0;var t=(e=JSON.parse(e)).ErrorCode+"";if(-1<t.indexOf("2147"))if(o<=0)m.alertTips("i18n_liveFailed",2e3),clearInterval(sourceList.retryCountTimer),r.find(".tokenImg").remove();else{if(o--,r.hasClass(".tokenImg"))return;r.text("");r.append('<img src="images/cloud_loading.gif" class="tokenImg" style="width:20px;">');var i=r.attr("data-status");r.find(".tokenImg").attr("data-tStatus",i)}else"0x80100002"==t||"0x80100008"==t?m.alertTips("i18n_pleaseOtherCamera",2e3):"0"==t&&(r.find(".tokenImg").remove(),u(a)),clearInterval(sourceList.retryCountTimer)},error:function(e){console.log("startlive:",e,"tid:",tid,"rid:",rid,"imgCode:",imgCode),sourceList.tokenFlag=!0}})},sourceList.startLvieTimeOut)}}function k(i,e){m.ajaxReq("/producerpro/stopLive",e,function(e){if(0==e.ErrorCode){if(i.hasClass(".tokenImg"))return;i.text("");i.append('<img src="images/cloud_loading.gif" class="tokenImg" style="width:20px;">');var t=i.attr("data-status");i.find(".tokenImg").attr("data-tStatus",t)}})}function u(e,t,i){var r=v("#userBehavior").val(),a=(r=JSON.parse(decodeURIComponent(r))).Position||{};if(i)if(t){for(var o=i.siblings(".isLive"),s=0;s<o.length;s++){var n=o.eq(s);0!=n.find(".seat_"+e).length&&(n.removeClass("isLive"),n.find(".operate").html(f.i18n_ipConnect),n.find(".select").removeClass("disabled"))}a[e]=t,i.addClass("isLive"),i.find(".operate").html(f.i18n_ipUnConnect),i.find(".select").addClass("disabled"),i.find(".select").addClass("seat_"+e)}else delete a[e],i.removeClass("isLive"),i.find(".operate").html(f.i18n_ipConnect),i.find(".select").removeClass("disabled");else delete a[e];var d=[];Object.keys(a).forEach(function(e){Number(e)||d.push(e)});for(var c=0;c<d.length;c++)delete a[d[c]];t={pn:"sd",content:JSON.stringify(a),remark:"Position"},r.Position=a,v("#userBehavior").val(encodeURIComponent(JSON.stringify(r))),m.ajaxReq("/producerpro/saveUserBehavior",t,function(e){})}function d(){var d="",e=sourceList.uploadFileShimArr;0==e.length?v(".video-manage .video-add").css("display","block"):v(".video-manage .video-add").css("display","none");for(var t=0;t<e.length;t++){var i=e[t].PreviewShm.SharedMemoryName,r=i.lastIndexOf("\\"),a=i.indexOf("(File Shim)"),o=i.substring(r+1,a);d+='<div class="video-info clearFix" data-filename="'+i+'" data-video="'+o+'"><div class="file left">'+o+'</div><div class="vedio-del left"><i class="iconfont icon-del"></i></div></div>'}"none"==v(".video-manage .video-add").css("display")&&v(".video-body").html(d);m.ajaxReq("/producerpro/studio_list_stream",{streamType:"0"},function(e){if("0x0"==e.errorCode){var t=e.result;d="";for(var i=0;i<t.length;i++){var r=t[i].pathUrl,a=(r=decodeURIComponent(r)).indexOf("video"),o=r.slice(a+6),s=r.slice(a+6)+" (File Shim)",n=t[i].id;0==v(".video-body [data-filename='"+s+"']").length?d+='<div class="video-info clearFix" data-videoId="'+n+'" data-filename="'+s+'"><div class="file left">'+o+'</div><div class="vedio-del left"><i class="iconfont icon-del"></i></div></div>':v(".video-body [data-filename='"+s+"']").attr("data-videoId",n)}v(".video-body").append(d),0==v(".video-body .video-info").length?v(".video-manage .video-add").css("display","block"):v(".video-manage .video-add").css("display","none")}})}return e.initEvent(),{getIpStreamList:p.getIpStreamList,uploadVideo:function(e){if(1===sourceList.uploadFileShimArr.length)return m.alertTips("i18n_uploadMax1Files"),void v("#file_v").val("");var t=v("#file_v").val(),i=new FormData(v("#formVideo")[0]),r=t.lastIndexOf("\\"),a=t.substring(r+1),o=t.lastIndexOf("."),s=t.substring(o+1),n=t.substring(r+1,o);if(v("#file_v").val(""),1===sourceList.uploadFileShimArr.length){var d=sourceList.uploadFileShimArr[0].PreviewShm.SharedMemoryName;if(d=d.slice(0,d.indexOf(" (File Shim)")),a===d)return void m.alertTips("i18n_NotSameFileName",2500)}if("png"!=s&&"jpg"!=s&&"gif"!=s){if(i.append("name","FileShim"),i.append("filename",t),i.append("UserID",userRolePerm.userId),""!=t){var c='<div class="video-info clearFix disabled filev" data-filename="'+a+' (File Shim)"><div class="file left">'+a+'</div><div class="vedio-del left"><img src="./images/cloud_loading.gif" width="24" height="24" /></div></div>';v(".video-body").append(c),v("#loading-Bg").fadeIn();var l=v(".main-rList .rList-show").attr("data-rip"),p=v(".main-preview").attr("data-logoUrl");v("#file_v").attr("disabled","disabled"),v.ajax({type:"POST",url:"http://"+l+":"+p,data:i,processData:!1,contentType:!1,success:function(e){"0x0"==(e=jQuery.parseJSON(e)).ErrorCode?(m.alertTips("i18n_slateUploadSucceed",2e3),v("#file_v").removeAttr("disabled"),v(".video-info[data-filename='"+a+" (File Shim)']").removeClass("disabled"),v(".video-manage .video-add").css("display","none"),v(".video-info[data-filename='"+a+" (File Shim)']").find(".vedio-del").html('<i class="iconfont icon-del"></i>'),v(".video-body .filev .vedio-del").html('<i class="iconfont icon-del"></i>')):(v(".video-info[data-filename='"+n+"']").remove(),v("#file_v").removeAttr("disabled"),"0x80524101"==e.ErrorCode?m.alertTips("i18n_uploadMax2Files"):m.alertTips("i18n_slateUploadFailed"),v("#loading-Bg").fadeOut(),v("#file_v").val(""))},error:function(e){v("#loading-Bg").fadeOut(),v("#file_v").val("")}})}}else m.alertTips("i18n_onlyCanUpVideo")},createPack:a}}($,oUtils,switchLangObj),initOverlay=function(c,l,p,r,d){function n(){var e;e=QRImg(),l.ajaxReq("/producerpro/token_getToken4Pro",e,function(e){var t=e.errorCode;if("0x0"==t){var i=e.result;r.listTokenDevice4Pro(i),l.ajaxReq("/producerpro/studio_device",{type:"T"},function(e){var t=e.errorCode;if("0x0"==t){var i=e.result;if(0!=i.length)for(var r="",a=0;a<i.length;a++){var o=i[a].peerId,s=i[a].name,n=i[a].status;r=d(o,s,n)+r}c(".tvupack-body").html(r)}})}});var t={peerId:c(".rList-show").attr("data-peerid"),module:"1"};l.ajaxReq("/producerpro/logo_list",t,function(e){if("0x0"==e.errorCode)for(var t=e.result,i=0;i<t.length;i++)if(1==t[i].usingType)c(".clip-dot .pic-submit").css("background-image","url("+t[i].url+")"),c(".clip-dot .pic-submit").attr("data-userlogoid",t[i].userLogoId);else{100<t[i].zorder&&(t[i].zorder=t[i].zorder%100),t[i].zorder>p.zorder&&(p.zorder=t[i].zorder);var r=t[i].checkedStatus;1==t[i].scoreBoard?1<=r&&(3!==r&&(overToPreview.scoreInit(t[i]),overlying.scoreInit(t[i],!1,!0)),1<r&&p.outputPreview&&overToPreview.scoreInit(t[i],".output-source .big-video")):(3!==r&&overlying.logoInit(t[i]),1<=r&&(3!=r&&overToPreview.logoInit(t[i]),1<r&&p.outputPreview&&overToPreview.logoInit(t[i],".output-source .big-video")))}var a,o=0;clearInterval(a),a=setInterval(function(){4==c(".preview-content .preview-item.isr").length?(clearInterval(a),function(){var i=c("#userBehavior").val(),e=(i=JSON.parse(decodeURIComponent(i))).Ip||"",t=c(".main-rList .rList-show").attr("data-rip");if(e.Ip!=t){l.ajaxReq("/producerpro/getGridSource",null,function(e){if("0x0"==e.errorCode){var o=[];e=e.result;for(var t=0;t<e.length;t++)o.push(e[t].peer_id);var s=i.Position||{},n=void 0;Object.keys(s).forEach(function(e){var t=e;5!=t&&(n=c(".preview-content .preview-item").eq(t-1).attr("data-rid").toLowerCase());var i={rid:n},r=void 0;if("object"==_typeof(s[t]))-1<o.indexOf(s[t].id)?(i.params=JSON.stringify({TIdHex:s[t].TIdHex}),r=s[t].TIdHex,l.ajaxReq("/producerpro/addExtAndSynchronize2R",{extId:r,rId:n},function(e){"0x0"==e.errorCode?m(s,i,t):(u++,v.push(t),u==Object.keys(s).length&&f(s,v))})):(u++,v.push(t),u==Object.keys(s).length&&f(s,v));else{if(5==t){var a=(new Date).getTime()+" (IP Shim)";return i.rid=c(".main-rList .rList-show").attr("data-peerId"),i.params=JSON.stringify({FileShimeName:s[t],NickName:a,ShimType:200}),l.ajaxReq("/producerpro/addIPSourceInProducer",i,function(e){"0x0"!==e.errorCode&&(u++,v.push(t),u==Object.keys(s).length&&f(s,v))}),!1}i.params=JSON.stringify({TIdHex:s[t]}),r=s[t],l.ajaxReq("/producerpro/addExtAndSynchronize2R",{extId:r,rId:n},function(e){"0x0"==e.errorCode?m(s,i,t):(u++,v.push(t),u==Object.keys(s).length&&f(s,v))})}})}});var r={pn:"sd",content:JSON.stringify({Ip:t}),remark:"Ip"};l.ajaxReq("/producerpro/saveUserBehavior",r),c(".overlay-cut-btn").trigger("click")}}()):120<=++o&&clearInterval(a)},1e3)})}var u=0,v=[];function m(t,i,r,a){a||(a=10),l.ajaxReq("/producerpro/startLive",i,function(e){0==e.ErrorCode?(u++,console.log("init video success","position:"+r,"Liveparam"+i)):(--a<=0?(u++,v.push(r)):m(t,i,r,a),console.log("init video failed","position:"+r,"Liveparam"+i),u>=Object.keys(t).length&&f(t,v))})}function f(e,t){if(0==t.length)return!1;for(var i=0;i<t.length;i++)delete e[t[i]];var r={pn:"sd",content:JSON.stringify(e),remark:"Position"};l.ajaxReq("/producerpro/saveUserBehavior",r,function(e){l.ajaxReq("/producerpro/getUserBehavior",{pn:"sd"},function(e){"0x0"==e.errorCode&&c("#userBehavior").val(encodeURIComponent(e.errorInfo))})})}function a(){var e=c(".apply-preview  .radius-box");e.addClass("shut"),c(".applyPre").addClass("disabled").removeClass("active"),e.animate({left:"0px"});c(".preview-source").append('<div class="maskLayer" style="position:absolute;z-index:0;height:100%;left:0;top:0;width:100%;"><img src="images/producer_pro_mark.png"  draggable="false" style="width:100%;height:100%;"/></div>'),c(".sd-preview-list .preview-item").hasClass("previewActive")&&c(".sd-preview-list .preview-item").removeClass("previewActive"),c(".main-center .main-cut").addClass("direct-pgm"),c(".main-center .main-cut").hasClass("replay")&&(c(".main-center .main-cut").removeClass("direct-pgm"),c(".preview-source .maskLayer").addClass("hide"))}function o(){var e=c(".main-preview").attr("data-filename"),t=c(".apply-preview  .radius-box");t.removeClass("shut"),t.animate({left:"11px"}),c(".output-source").removeClass("change"),c(".maskLayer").remove(),c(".applyPre").removeClass("disabled").addClass("active"),c(".main-center .main-cut").removeClass("direct-pgm");for(var i=0;i<c(".sd-preview-list .preview-item").length;i++)c(".sd-preview-list .preview-item").eq(i).attr("data-filename")===e&&(c(".radius-box").hasClass("shut")&&c(".sd-preview-list .preview-item").eq(i).removeClass("previewActive"),c(".sd-preview-list .preview-item").eq(i).addClass("previewActive").siblings().removeClass("previewActive"))}return{firstOverlyShow:function(){var e={peerId:c(".rList-show").attr("data-peerid"),textId:c(".preTextarea").attr("data-id")};c.ajax({type:"POST",url:"/producerpro/subtitle_list",timeout:15e3,data:e,success:function(e){n();var t=JSON.parse(e);if("0x0"==t.errorCode)for(var i=Object.keys(t.errorInfo),r=t.errorInfo,a=0;a<i.length;a++){var o=i[a];if(0!=r[o].length){var s=r[o][0];100<s.zorder&&(s.zorder=s.zorder%100),s.zorder>p.zorder&&(p.zorder=s.zorder),"pvwSubTitle"==o&&(s.checked&&overToPreview.textInit(s),overlying.textInit(s)),p.outputPreview&&"pgmSubTitle"==o&&overToPreview.textInit(s,".output-source .big-video")}}}});var t={peerId:c(".rList-show").attr("data-peerid"),dataType:"pip"};l.ajaxReq("/producerpro/studio_list",t,function(e){if("0x0"==e.errorCode){c(".preview-content .preview-item");for(var t,i=Object.keys(e.result),r=0;r<i.length;r++){var a=i[r];if("pgm"!=a&&0!=e.result[a].length){var o=e.result[a][0],s=o.pipVideoSharedMemoryName;if(t=c(".preview-content .preview-item[data-filename='"+s+"']").find("video").eq(0).attr("id"),100<o.zorder&&(o.zorder=o.zorder%100),o.zorder>p.zorder&&(p.zorder=o.zorder),"pvwPip"==a&&(overlying.pipInit(o),0!=o.checked&&(2==o.checked||1==o.checked))){c(".pip-picture").addClass("created"),overToPreview.pipInit(o,t),clearInterval(n);var n=setInterval(function(){0!=c(".preview-content .preview-item[data-filename='"+s+"']").length&&(c(".preview-content .preview-item[data-filename='"+s+"']").addClass("pipPreviewActive"),clearInterval(n))},500)}if(p.outputPreview&&"pgmPip"==a&&o.pgmPipVideoSharedMemoryName){var d=o.pgmPipVideoSharedMemoryName;t=c(".preview-content .preview-item[data-filename='"+d+"']").find("video").eq(0).attr("id"),overToPreview.pipInit(o,t,".output-source .big-video")}}}}else l.alertTips(e.errorInfo,1500)})},firstClockInit:function(){if(!studioBehavior)return!1;l.ajaxReq("/producerpro/clock_list",{},function(e){if("0x0"==e.errorCode){var t=e.result;if(""!=t){t=t[0];var i=JSON.parse(decodeURIComponent(studioBehavior)).ProgramClock;if(null==i)return;var r=i.status,a=i.location;overToPreview.clockInit(t),overlying.clockInit(t),2==t.checked&&p.outputPreview&&overToPreview.clockInit(t,".output-source .big-video");var o=t.endTime;clockObj.clockEndTime=o/1e3,1e4==(o=o/1e3/60)&&(o=""),c(".defaultTime input").val(o),"start"==r&&(c(".clockStop").removeClass("hide"),c(".clockStart").addClass("hide"),c(".clockInput").attr("disabled","disabled"),clearInterval(clockObj.setClockTimer),clockObj.setClockTimer=setInterval(function(){clockObj.clockSeconds++;var e=clockObj.clockSeconds%60,t=parseInt(clockObj.clockSeconds/60);e=e<=9?"0"+e:e,t=t<=9?"0"+t:t,clockObj.clockSeconds>clockObj.clockEndTime?c(".clockDiv").css("background-color","red"):c(".clockDiv").css("background-color","#212740"),c(".clockTextarea").html(t+":"+e),c(".clockDiv").attr("data-time",clockObj.clockSeconds),59940<clockObj.clockSeconds&&(clearInterval(clockObj.setClockTimer),clockObj.clockSeconds=0,c(".clockDiv").attr("data-operation","create"),c(".clockTextarea").html("00:00"),c(".clockStart").removeClass("hide"),c(".clockStop").addClass("hide"),c(".clockDiv").css("background-color","#212740"),c(".clockInput").removeAttr("disabled"),c(".clockInput").val(0),"pgm"==a?(applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"create"),saveClockuserBehavior("start","pvw")))},1e3))}}else l.alertTips(e.errorInfo,1500)})},initDirectChange:function(){var e=c(".rList-show").attr("data-peerId");if(studioBehavior){var t=JSON.parse(decodeURIComponent(studioBehavior));if(t.directChange)for(var i=0;i<t.directChange.length;i++)t.directChange[i].mainRid==e&&("shut"==t.directChange[i].status?(c(".main-preview .audio").css("display","none"),a()):o())}},directChangeShut:a,directChangeOpen:o}}($,oUtils,currentRInfo,initSystem.pageRequestObj,resourceAbout.createPack),CONFIG=null,studioTimer=null,initprogressTime=35,isrestoreHistory=!1,RestoringHistory=!1,versionUpdateFlag=void 0;function getQueryVariable(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");if(r[0]==e)return r[1]}return!1}function getCheckConfig(){(sessionId=getQueryVariable("session"))||(sessionId=localStorage.getItem("session"));var e="/producerpro/checkConfig?session="+sessionId;localStorage.setItem("session",sessionId),$.ajax({type:"POST",url:e,async:!1,success:function(e){e=JSON.parse(e),signalingUrl=(CONFIG=e).signalingUrl;var t=document.location.protocol;signalingUrl=e.signalingUrl,"http:"==t?signalingUrl=e.signalingUrl:"https:"==t&&(signalingUrl=e.rtcUrl),studioBehavior=e.userBehavior,facebookCheckInDistance=e.facebookCheckInDistance,domainAddress=e.domainAddress,userRoleList=e.USER_NAME.userRoleList,(userRolePerm={}).userId=e.USER_NAME.id,businessType=e.USER_NAME.businessType,isNewUser=e.isNewUser,userManage=e.userManage,userType=e.userType,localStorage.setItem("userManage",userManage),tvuccUrl=e.tvuccUrl,sessionId=e.session,AUTHORITY=e.USER_NAME.authority,orderStatus=e.orderStatus;var i=e.activeInstance,r=e.rversion,a=e.USER_NAME.amount;versionUpdateFlag=e.USER_NAME.versionUpdateFlag,parentInviteCode=e.USER_NAME.parentInviteCode,localStorage.setItem("amount",a),localStorage.setItem("parentInviteCode",parentInviteCode);var o="ui:"+jsVersion+"\nService:"+CONFIG.buildversion+"\nLinuxR:"+r,s=e.USER_NAME.email;if($("#userBehavior").val(studioBehavior),localStorage.setItem("userEmial",s),"guest@tvunetworks.com"==s?($(".not-visitor").hide(),$(".visitor").show()):($(".not-visitor").show(),$(".visitor").hide()),$("#user_info_name").text(s),"1"==businessType||null==businessType?businessType=switchLangObj.i18n_Pro:"0"==businessType&&(businessType=switchLangObj.i18n_Adv),$(".businessType").text(businessType),$("#user_info_name").attr("title",s),$("#website_title_text").attr("title",o),window.serviceList={userseviceUrl:userManage},userRoleList){userRoleList=JSON.parse(userRoleList);for(var n=0;n<userRoleList.length;n++)userRolePerm[userRoleList[n].feature]=userRoleList[n].value}if(-1==i)$(".switch-instance").html(switchLangObj.i18n_openInstance),$(".studio_operate .studio-box").animate({left:"0px"}),$(".studio_operate .studio-box").removeClass("active"),$.ajax({type:"GET",url:"/producerpro/studio_open",timeout:6e4,success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){if(3==e.result)return getCheckConfig(),!1;getProgress(0)}else if("0x80100016"==e.errorCode)oUtils.alertTips("i18n_systemOverload");else if("0x80100015"==e.errorCode)oUtils.alertTips("i18n_producerNotArea");else if("0x80100003"==e.errorCode)oUtils.alertTips("i18n_systemMaintained");else if("0x80100017"==e.errorCode)console.log("Do not send repeat request!");else if("0x80100019"==e.errorCode)if("producer.tvunetworks.cn"==location.host){var t=localStorage.getItem("amount");if(parentInviteCode||0!=parseInt(t)){$(".purchase-cn .discount").show();var i=0;i=parentInviteCode?72e3:8e4,$(".purchase-cn .discount").show(),0<(i-=t)?($(".purchase-cn .del-money").html(" - ¥ "+(8e4-i)/100),$(".purchase-cn .to-pay button").html("立即支付"+i/100+"元")):($(".purchase-cn .del-money").html(" - ¥ 800"),$(".purchase-cn .to-pay button").html("立即支付0元"))}else $(".purchase-cn .discount").hide(),$(".purchase-cn .del-money").html(" - ¥ 0"),$(".purchase-cn .to-pay button").html("立即支付800元");$(".purchase-cn").css("display","block"),$("#bgFilter").css("display","block")}else $(".purchase-loading").css("display","block"),$(".purchase-alert").css("display","block");else oUtils.alertTips("i18n_commentError")}});else if(3!==i)getProgress(i);else{$(".switch-instance").html(switchLangObj.i18n_closeInstance),$(".pp-loading").css("display","block"),$(".progress .progress-status").html("100%"),$(".progress p").html(switchLangObj.i18n_initialize),$(".progress .meter .compelete").css("width","100%"),$(".studio_operate .studio-box").animate({left:"11px"}),$(".studio_operate .studio-box").addClass("active"),$(".pp-loading").css("display","none"),$(".remaining").css("display","block"),$(".main-cut").css("margin-top","0.56rem");var d=void 0;studioBehavior&&(d=JSON.parse(decodeURIComponent(studioBehavior)).OverlaySync),null!=d&&2!=d&&($("#bgFilter").css("display","block"),$(".recover_history").css("display","block")),getStudioRestore(),"public"==e.userType&&(businessType==switchLangObj.i18n_Pro&&$(".operation-clip").remove(),getRemainCountDown());var c={sendaudio:!1,sendvideo:!1,recvaudio:!0,recvvideo:!0,caller:null,callee:null};if(c.mediaConstraints={audio:c.sendaudio,video:c.sendvideo},window.rtcclient=new RtcClient(c,signalingUrl),"function"==typeof initSystem.initStudioRList){if(null!=initSystem.pageWebsocketObj.socket)return!1;initSystem.initStudioRList(e.studioRList,e.userBehavior),initOverlay.initDirectChange()}}}})}function getProgress(e){if(0==e||1==e)$(".studio_operate .studio-box").animate({left:"11px"}),$(".studio_operate .studio-box").addClass("active"),$(".switch-instance").html(switchLangObj.i18n_closeInstance),0==e&&($(".pp-loading").css("display","block"),$(".remaining").css("display","none"),$(".main-cut").css("margin-top","0.2rem"),$(".progress p").html(switchLangObj.i18n_allocate),clearInterval(progressTimer),console.log("第二阶段开始"),progressTimer=setInterval(function(){++initprogressTime;var e=initprogressTime+"%";$(".progress .progress-status").html(initprogressTime+"%"),$(".progress .meter .compelete").css("width",e),88==initprogressTime&&clearInterval(progressTimer)},300)),1==e&&($(".pp-loading").css("display","block"),$(".remaining").css("display","none"),$(".main-cut").css("margin-top","0.2rem"),$(".progress .progress-status").html("88%"),$(".progress p").html(switchLangObj.i18n_initialize),$(".progress .meter .compelete").css("width","88%"));else if(3==e){if($(".switch-instance").html(switchLangObj.i18n_closeInstance),$(".progress .progress-status").html("100%"),$(".progress p").html(switchLangObj.i18n_config),$(".progress .meter .compelete").css("width","100%"),$(".studio_operate .studio-box").animate({left:"0.11rem"}),$(".studio_operate .studio-box").addClass("active"),$(".pp-loading").css("display","none"),$(".main-cut").css("margin-top","0.56rem"),$(".remaining").css("display","block"),null!=pageWebsocketObj.socket)return;getCheckConfig()}}function getRemainCountDown(){var e="";clearInterval(e),e=setInterval(function(){0==userRecord?($(".purchase-loading").css("display","block"),-1==AUTHORITY.indexOf("Grid")&&$(".refueling-package p").html(switchLangObj.i18n_gustRecharge),$(".refueling-package").css("display","block"),getRemainTimeAndExpireTime()):300==userRecord?($(".purchase-promptbox").fadeIn("slow"),getRemainTimeAndExpireTime()):240==userRecord?($(".purchase-promptbox").fadeOut("slow"),getRemainTimeAndExpireTime()):(getRemainTimeAndExpireTime(),$(".purchase-loading").css("display","none"),$(".refueling-package").css("display","none"))},5e3)}function getRemainTimeAndExpireTime(){var e={email:$("#user_info_name").text()};oUtils.ajaxReq("/producerpro/getRemainAndExpireTime",e,function(e){if("0x0"==e.errorCode){var t=e.result,i=t.expireTime;$(".Expiration-Date div").text(ExpireDateTime(i)),userRecord=t.remainTime,$(".remaining div").text(transTimeByms(userRecord,!0))}})}function ExpireDateTime(e,t){var i=new Date(e),r=i.getFullYear(),a=i.getMonth()+1;a=a<10?"0"+a:a;var o=i.getDate();o=o<10?"0"+o:o;var s=i.getHours(),n=i.getMinutes(),d=Math.floor(e/1e3%60%60);return s=s<=9?"0"+s:s,n=n<=9?"0"+n:n,d=d<=9?"0"+d:d,t?r+"-"+a+"-"+o+" "+s+":"+n:r+"/"+a+"/"+o}function transTimeByms(e,t){var i=Math.floor(e/3600),r=Math.floor(e/60%60),a=Math.floor(e%60%60);return i=i<=9?"0"+i:i,r=r<=9?"0"+r:r,a=a<=9?"0"+a:a,t?i+switchLangObj.i18n_hoursTime+r+switchLangObj.i18n_minTime:i+":"+r+":"+a}function getStudioRestore(){if(!studioBehavior)return!1;var e=JSON.parse(decodeURIComponent(studioBehavior)),t={rid:e=e.SelectR.peerId};$.ajax({type:"GET",url:"/producerpro/studio_restore",timeout:3e5,data:t,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode?"2"==e.result?($("#bgFilter").css("display","none"),$(".recover_history").css("display","none"),isrestoreHistory=!0,queryRecordInfo(),0==versionUpdateFlag&&$(".updateVersion").css("display","block")):($("#bgFilter").css("display","block"),$(".recover_history").css("display","block"),setTimeout(function(){getStudioRestore()},3e3)):($("#bgFilter").css("display","block"),$(".recover_history").css("display","block"),setTimeout(function(){getStudioRestore()},3e3))}})}function queryRecordInfo(){if(!studioBehavior)return!1;var e=JSON.parse(decodeURIComponent(studioBehavior)),t={rid:e=e.SelectR.peerId};oUtils.ajaxReq("/producerpro/record/current_session",t,function(e){var t=e.Sources;if(null!=t&&0<t.length)for(var i=0;i<t.length;i++)if("StudioOutputPreview"==t[i].ID)for(var r=t[i].Records,a=0;a<r.length;a++)if(0==r[a].EndTimestamp){$(".iconStopRecordBtn").removeClass("hide"),$(".iconRecordBtn").addClass("hide");var o=r[a].StartTimestamp,s=new Date;s=s.getTime();var n=parseInt(s-o)/1e3;clockObj.recordSeconds=n,clockObj.recordTimer=setInterval(function(){clockObj.recordSeconds++,$(".recordTime").html(transTimeByms(clockObj.recordSeconds))},1e3)}})}!function(){var e=window.localStorage.getItem("currentVersion");if(e&&e==currentVersion&&(i18n_cacheFlag=!0),window.localStorage.setItem("currentVersion",currentVersion),window.ActiveXObject||"ActiveXObject"in window)return $(".isChrome").css("display","block");getCheckConfig()}();var overlayObj=function(w,p,r){function n(){var e=w(".rList-show").attr("data-peerId"),t=w("#preview .preTextarea").attr("data-id"),i=overlayCut.subtitleCom();w.ajax({type:"POST",url:"/producerpro/subtitle_update",data:{peerId:e,textId:t,params:JSON.stringify(i)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.errorInfo;t.id;d.textInit(t,!0)}}})}var d={logoInit:function(i,e){var t=JSON.stringify(i);t=encodeURIComponent(t);var r=!0;e||w(".pretreat-content .logo").each(function(e,t){w(t).attr("data-id")!=i.id||(r=!1)});if(r){var a,o;if(null==i.imageWidth||""==i.imageWidth){var s=i.size.split("x");i.imageWidth=s[0],i.imageHeight=s[1];var n=i.imageHeight/i.imageWidth;i.imageWidth=needEven(i.imageWidth),i.imageHeight=Math.round(i.imageWidth*n)}widthAndHeight.resolutionW-i.imageWidth<=0&&(i.logoXOffset=widthAndHeight.resolutionW-i.imageWidth),widthAndHeight.resolutionH-i.imageHeight<=0&&(i.logoYOffset=widthAndHeight.resolutionH-i.imageHeight);var d="",c="";1<=i.checkedStatus?(d="border:1px solid #41FF6D;",c="check"):(d="border:border: 1px solid #444;",c=""),a=widthAndHeight.getPriviewWidth(null,240,i.imageWidth),o=widthAndHeight.getPriviewHeight(null,135,i.imageHeight);var l=widthAndHeight.getPriviewHeight(null,135,i.logoYOffset),p=widthAndHeight.getPriviewWidth(null,240,i.logoXOffset);a<30&&o<30&&(o=30*o/a,a=30),240-a<p&&(p=240-a),135-o<l&&(l=135-o);var u='<li class="pretreat-item-logo pretreat-content-item logo '+c+" logo"+i.id+'" data-id="'+i.id+'" data-params="'+t+'" data-imageWidth="'+i.imageWidth+'" data-imageHeight="'+i.imageHeight+'" data-logoYOffset="'+i.logoYOffset+'"  data-logoXOffset="'+i.logoXOffset+'" data-url="'+i.url+'" style="'+d+'"><div class="logo-img" style="width:'+a+"px;height:"+o+"px;right:"+p+"px;top:"+l+'px;"><img src="'+i.url+'" style="width:100%;height:100%;" /></div></li>';0!=w(".pretreat-content.show-logo .logo"+i.id).length?w(".pretreat-content.show-logo .logo"+i.id).replaceWith(u):w(".sd-pretreat-container .pretreat-content.show-logo").append(u)}},textInit:function(e,t){var i=JSON.stringify(e);i=encodeURIComponent(i);var r=!0;if(!t){w(".pretreat-content .text");if(w(".text").attr("data-id")==e.id)return void(r=!1)}if(r){var a=e.style;"object"!=(void 0===a?"undefined":_typeof(a))&&(0==a.indexOf('"')&&(a=a.substring(1,a.length-1)),a=JSON.parse(a));a.backgroundColor;var o=a.backgroundColor.slice(2,8),s=a.backgroundColor.slice(0,2),n=HexToRgba(o,s),d=a.foregroundColor.slice(2,8),c="",l="";e.checked?(c="border:1px solid #41FF6D;",l="check"):(c="border:border: 1px solid #444;",l="");var p=widthAndHeight.getPriviewHeight(null,135,e.yOffset),u=widthAndHeight.getPriviewWidth(null,240,e.xOffset),v=widthAndHeight.getPriviewWidth(null,240,a.fontSize),m='<li class="pretreat-item-text pretreat-content-item text  '+l+" text"+e.id+'" data-params="'+i+'" data-textYOffset="'+e.yOffset+'" data-id="'+e.id+'"  style=" overflow：hidden; '+c+' "><div class="text-img"  data-deleteFlag="'+e.deleteFlag+'"  style="white-space: pre;text-overflow: ellipsis; font-size:'+v+"px; top:"+p+"px; right:"+u+"px; background-color:"+n+";color:#"+d+";font-family:"+a.fontName+';">'+e.text+"</div></li>";0!=w(".pretreat-content.show-text  .text"+e.id).length?w(".pretreat-content.show-text  .text"+e.id).replaceWith(m):w(".sd-pretreat-container .pretreat-content.show-text").append(m)}},scoreInit:function(i,e,t){var r=JSON.stringify(i);r=encodeURIComponent(r);var a=!0;e||w(".pretreat-content .pretreat-item-score").each(function(e,t){w(t).attr("data-id")!=i.id||(a=!1)});if(a){var o,s;if(null==i.imageWidth||""==i.imageWidth){var n=i.size.split("x");i.imageWidth=n[0],i.imageHeight=n[1]}o=widthAndHeight.getPriviewWidth(null,240,i.imageWidth),s=widthAndHeight.getPriviewHeight(null,135,i.imageHeight);"border:border: 1px solid #444;","";for(var d=widthAndHeight.getPriviewHeight(null,135,i.logoYOffset),c=widthAndHeight.getPriviewWidth(null,240,i.logoXOffset),l='<li class="pretreat-item-score pretreat-content-item score  score'+i.id+'" data-params="'+r+'" data-id="'+i.id+'" data-size="'+i.size+'"  style="border:border: 1px solid #444;"><div class=" score-img score'+i.id+'" data-scoreBord=1 data-imageWidth="'+i.imageWidth+'" data-imageHeight="'+i.imageHeight+'"data-logoYOffset="'+i.logoYOffset+'"  data-logoXOffset="'+i.logoXOffset+'"data-id="'+i.id+'" style="width:'+o+"px;height:"+s+"px;top:"+d+"px;right:"+c+'px"><img src="'+i.url+'" alt="" style="position:relative;width:100%;height:100%;">',p=i.subtitles,u=0;u<p.length;u++){var v=p[u].style;"object"!=(void 0===v?"undefined":_typeof(v))&&(0==v.indexOf('"')&&(v=v.substring(1,v.length-1)),v=JSON.parse(v));var m=v.fontSize;m=widthAndHeight.getPriviewHeight(null,240,m);var f=p[u].yOffset-i.logoYOffset;f=widthAndHeight.getPriviewHeight(null,135,f);var h=p[u].xOffset-i.logoXOffset,g=(h=widthAndHeight.getPriviewWidth(null,240,h),p[u].width);g=widthAndHeight.getPriviewWidth(null,240,g);var k=p[u].height;k=widthAndHeight.getPriviewHeight(null,135,k),l+='<input type="text" class="scoreText text'+(u+1)+'" data-zorder=3 value="'+p[u].text+'" data-scoreTextId="'+p[u].id+'"  data-bind-'+(u+1)+'="name" style="height:'+k+"px; position:absolute; width:"+g+"px; text-align: center; background-color:transparent; right:"+h+"px; top:"+f+"px; font-size:"+m+"px;color:#"+v.foregroundColor.slice(2,8)+';" disabled="disabled">'}l+="</div></li>",0!=w(".pretreat-content.show-score  .pretreat-item-score").length?w(".pretreat-content.show-score  .pretreat-item-score").replaceWith(l):w(".sd-pretreat-container .pretreat-content.show-score").append(l),1==t?w(".pretreat-content.show-score  .pretreat-item-score").trigger("click"):(w(".pretreat-content.show-score  .pretreat-item-score").css({border:"1px solid rgb(65, 255, 109)"}),w(".pretreat-content.show-score  .pretreat-item-score").addClass("check"))}},clockInit:function(e,t){var i=JSON.stringify(e);i=encodeURIComponent(i);var r=!0;if(!t){w(".pretreat-content .clock");if(w(".clock").attr("data-id")==e.id)return void(r=!1)}if(r){var a=e.style;"object"!=(void 0===a?"undefined":_typeof(a))&&(0==a.indexOf('"')&&(a=a.substring(1,a.length-1)),a=JSON.parse(a));var o=a.foregroundColor.slice(2,8),s="",n="";e.checked?(s="border:1px solid #41FF6D;",n="check"):(s="border:border: 1px solid #444;",n="");var d=widthAndHeight.getPriviewHeight(null,135,e.yOffset),c=widthAndHeight.getPriviewWidth(null,240,e.xOffset),l=widthAndHeight.getPriviewWidth(null,240,a.fontSize),p=e.timestamp,u=a.text,v=u.split(":"),m=60*parseInt(v[0]),f=parseInt(v[1]),h=parseInt(m+f),g=calPts(w(".main-preview .main-player").attr("id"));if(""==g)return void console.log("Cannot get timecode from flv player.overlay");if("start"!=e.operation)u;else if(null!=p)TimeByms(parseInt((g-p)/1e3)+h);else u;var k='<li class="pretreat-item-clock pretreat-content-item clock '+n+" clock"+e.id+'" data-params="'+i+'" data-textYOffset="'+e.yOffset+'" data-id="'+e.id+'"  style=" overflow：hidden; '+s+' "><div class="clock-img"  data-deleteFlag="'+e.deleteFlag+'"  style="font-size:'+l+"px; top:"+d+"px; right:"+c+"px;background-color:#212740; color:#"+o+";font-family:"+a.fontName+'; position:absolute;">00:00</div></li>';0!=w(".pretreat-content.show-clock  .clock").length?w(".pretreat-content.show-clock  .clock").replaceWith(k):w(".sd-pretreat-container .pretreat-content.show-clock").append(k)}},delLogo:function(e){var t=w(e).attr("data-id"),i={peerId:w(".main-rList .rList-show").attr("data-peerId"),fileId:t,module:"1"};p.ajaxReq("/producerpro/logo_delete",i,function(){w(".preview-source .logo"+t).remove(),w(".pretreat-content .logo"+t).remove()})},delScore:function(e){var t=w(e).attr("data-id"),i={peerId:w(".main-rList .rList-show").attr("data-peerId"),fileId:t,module:"1"};p.ajaxReq("/producerpro/logo_delete",i,function(e){"0x0"==e.errorCode?(w(".pretreat-content .score"+t).remove(),w(".preview-source  .score"+t).remove()):"0x80100003"==e.errorCode&&p.alertTips("i18n_requestTimeOut")})},delPip:function(e){var t={id:w(e).attr("data-id")},i=[],r=w(e).attr("data-pipvideosharedmemoryname"),a=w(".preview-content .preview-item[data-filename='"+r+"']");if(a.hasClass("isr")&&a.hasClass("pipPreviewActive")&&!a.hasClass("pipOutputActive")&&!a.hasClass("previewActive")&&!a.hasClass("outPutActive")){var o=a.attr("data-rid"),s={};s.rid=o,s.type=130,i.push(s)}t.tallyArray=JSON.stringify(i),p.ajaxReq("/producerpro/studio_delete",t,function(e){"0x0"==e.errorCode?(a.removeClass("pipPreviewActive"),w(".preview-source .pip").remove(),w(".pretreat-content .pip").remove(),w(".pip-picture").removeClass("created"),w(".pip-in .voice").removeClass("icon-voice").addClass("icon-novoice"),w(".pip-out .voice").removeClass("icon-novoice").addClass("icon-voice"),w(".pip-in-sel p").html("1"),w(".preview-top .icon-erphone").hasClass("active")&&(w(".preview-top .preview-voice .icon-erphone").trigger("click"),w(".preview-top .preview-voice .icon-erphone").trigger("click")),w(".show-pip .pretreat-content-add").removeClass("hide")):p.alertTips(e.errorInfo,1500)})},delText:function(e){var t=w(".rList-show").attr("data-peerId"),i=w(e).attr("data-id"),r={peerId:t,textId:i};p.ajaxReq("/producerpro/subtitle_delete",r,function(){w(".preview-source .textDiv").remove(),w(".pretreat-content .text"+i).remove(),w(".show-text .pretreat-content-add").removeClass("hide")})},delClock:function(e){var t=w(".rList-show").attr("data-peerId"),i=w(e).attr("data-id"),r={peerId:t,id:i};p.ajaxReq("/producerpro/clock_delete",r,function(){clearInterval(clockObj.setClockTimer),clockObj.clockSeconds=0,w(".preview-source .clockDiv").remove(),w(".output-source .clockDiv").remove(),w(".pretreat-content .clock"+i).remove(),w(".clockInput").removeAttr("disabled"),w(".show-clock .pretreat-content-add").removeClass("hide"),w(".clockStart").hasClass("hide")&&(w(".clockStop").addClass("hide"),w(".clockStart").removeClass("hide")),w(".TimeSet input").val(0),saveClockuserBehavior("stop","pvw")})},pipInit:function(e){var t="",i="";0!=e.checked?(t="border:1px solid #41FF6D;",i="check"):(t="border: 1px solid #444;",i="");var r;r='<li class="pip pretreat-item-logo pretreat-content-item '+i+'" data-pipXOffset="'+e.pipXOffset+'" data-id="'+e.id+'" data-pipHeight="'+e.pipHeight+'" data-pipVideoSharedMemoryName="'+e.pipVideoSharedMemoryName+'" data-pipWidth="'+e.pipWidth+'" data-pipYOffset="'+e.pipYOffset+'" data-pipAudioSharedMemoryName="'+e.pipAudioSharedMemoryName+'" data-audiostatus="'+e.audioStatus+'" style="'+t+'" > </li>',w("#preview .pip").attr("data-id",e.id),0!=w(".pretreat-content.show-pip .pip").length?w(".pretreat-content.show-pip .pip").replaceWith(r):w(".sd-pretreat-container .pretreat-content.show-pip").append(r)},pipEidtInit:function(){var r=w(".main-preview").attr("data-filename"),a=w(".pretreat-content .pip").attr("data-audiostatus"),o=w(".pretreat-content .pip").attr("data-pipvideosharedmemoryname"),s=w(".pretreat-content .pip").attr("data-pipaudiosharedmemoryname");-1==a&&(w(".pip-in .voice").removeClass("icon-voice").addClass("icon-novoice"),w(".pip-out .voice").removeClass("icon-voice").addClass("icon-novoice")),1==a&&(w(".pip-in .voice").removeClass("icon-novoice").addClass("icon-voice"),w(".pip-out .voice").removeClass("icon-novoice").addClass("icon-voice")),w(".preview-content li").each(function(e,t){var i=w(t).attr("data-filename");o==i&&w(".pip-in-sel p").html(e+1),r==i&&w(".pip-out-sel p").html(e+1),0==a&&s==i&&(s==r?(w(".pip-in .voice").removeClass("icon-voice").addClass("icon-novoice"),w(".pip-out .voice").removeClass("icon-novoice").addClass("icon-voice")):(w(".pip-in .voice").removeClass("icon-novoice").addClass("icon-voice"),w(".pip-out .voice").removeClass("icon-voice").addClass("icon-novoice")))})}};return w(".pretreat-content").on("click",".logo",function(){if(!overlayCut.isCut){var e=w(this);if(e.hasClass("check")){e.removeClass("check"),e.css("border","1px solid #444");var t=e.attr("data-id");w(".preview-source .logo"+t).remove()}else{e.addClass("check"),e.css("border","1px solid #41FF6D");var i={imageWidth:"",imageHeight:"",logoYOffset:"",logoXOffset:"",url:"",id:""};(i=getAttrs(e,i)).zorder=currentRInfo.zorder++,overToPreview.logoInit(i)}}}),w(".pretreat-content").on("click",".text",function(){if(!overlayCut.isCut){var e=w(this);if(e.hasClass("check"))e.removeClass("check"),e.css("border","1px solid #444"),w(".preview-source .textDiv").remove();else{e.addClass("check"),e.css("border","1px solid #41FF6D");var t=e.attr("data-params");t=decodeURIComponent(t),(t=JSON.parse(t)).zorder=currentRInfo.zorder++,overToPreview.textInit(t)}}}),w(".pretreat-content").on("click",".clock",function(){if(!overlayCut.isCut){var e=w(this);if(e.hasClass("check"))e.removeClass("check"),e.css("border","1px solid #444"),w(".preview-source .clockDiv").remove();else{e.addClass("check"),e.css("border","1px solid #41FF6D");var t=e.attr("data-params");t=decodeURIComponent(t),(t=JSON.parse(t)).zorder=1e4,overToPreview.clockInit(t)}}}),w(".pretreat-content").on("click",".score",function(){if(!overlayCut.isCut){var e=w(this);if(e.hasClass("check"))e.removeClass("check"),e.css("border","1px solid #444"),e.attr("data-id"),w(".preview-source .scoreDiv").remove();else{e.addClass("check"),e.siblings(".score").removeClass("check"),e.siblings(".score").css("border","1px solid #444"),w(".preview-source .scoreDiv").remove(),e.css("border","1px solid #41FF6D");var t=e.attr("data-params");t=decodeURIComponent(t),(t=JSON.parse(t)).zorder=currentRInfo.zorder++,overToPreview.scoreInit(t)}}}),w(".pip-setting .pip-in-source").fnNiceScroll(),w(".pip-pat .pip-picture").on("click",function(){var e=w(this);if(e.hasClass("created")){if(w(".pretreat-content .pip").hasClass("check"))return;w(".pretreat-content .pip").trigger("click")}else createPipToInit(e)}),w(".pip-in-sel p").on("click",function(e){if(w(".pip-pat .pip-picture").hasClass("created")){for(var t=w(".preview-content .preview-item").length,i="",r=1;r<=t;r++)i+="<li>"+r+"</li>";w(".pip-in-source").html(i),w(".pip-in-source").css("display","block"),e.stopPropagation()}}),w(".pretreat-content").on("click",".edit",function(){if(!overlayCut.isCut){var i=w(this).parent(),e=[];if(i.hasClass("pip")){if(w(".sd-pip").removeClass("hide").siblings().addClass("hide"),w(".sd-operation-type").addClass("hide"),w(".sd-pretreat-container .show-pip").addClass("hide"),d.pipEidtInit(),!i.hasClass("check")){var t={id:i.attr("data-id")},r=i.attr("data-pipvideosharedmemoryname"),a=w(".preview-content .preview-item[data-filename='"+r+"']"),o=a.attr("data-rid");if(a.addClass("pipPreviewActive"),o){var s={};s.rid=o,a.hasClass("pipOutputActive")||a.hasClass("outPutActive")||a.hasClass("previewActive")||(s.type=131,e.push(s),t.tallyArray=JSON.stringify(e))}var n=a.find("video").eq(0).attr("id");t.checked=1,p.ajaxReq("/producerpro/studio_update",t,function(e){if("0x0"==e.errorCode){i.addClass("check"),i.css("border","1px solid #41FF6D");var t={pipXOffset:"",pipYOffset:"",zorder:"",pipWidth:"",pipHeight:"",pipVideoSharedMemoryName:"",pipAudioSharedMemoryName:"",audioStatus:""};(t=getAttrs(i,t)).zorder=currentRInfo.zorder++,overToPreview.pipInit(t,n)}else p.alertTips(e.errorInfo,1500)})}}else i.hasClass("score")&&(0!==w(".preview-source .scoreDiv").length?w(".preview-source .scoreDiv").trigger("click"):(w(".sd-pretreat-operation").addClass("active"),w(".sd-operation-type").hide(),w(".operation-view-score").css("border",""),w(".operation-view-score").css("border","none"),w(".pretreat-content").addClass("hide"),w(".sd-score").removeClass("hide").siblings().addClass("hide")));return!1}}),w(".pretreat-content").on("click",".pip",function(){if(!overlayCut.isCut){var i=w(this),e={id:i.attr("data-id")},t=[];if(i.hasClass("check")){var r=w(".preview-content .preview-item.pipPreviewActive");w(".main-preview .icon-erphone").hasClass("active")&&volume.delPipVideoVolume("pipPreviewActive");var a=r.attr("data-rid");if(a){var o={};o.rid=a,r.hasClass("pipOutputActive")||r.hasClass("outPutActive")||r.hasClass("previewActive")||(o.type=130,t.push(o),e.tallyArray=JSON.stringify(t))}w(".preview-content .preview-item.pipPreviewActive").removeClass("pipPreviewActive"),e.checked=0,p.ajaxReq("/producerpro/studio_update",e,function(e){"0x0"==e.errorCode?(i.removeClass("check"),i.css("border","1px solid #444"),w(".preview-source .pip").find("video").attr("id"),w(".preview-source .pip").remove()):p.alertTips(e.errorInfo,1500)})}else{var s=i.attr("data-pipvideosharedmemoryname"),n=w(".preview-content .preview-item[data-filename='"+s+"']"),d=n.attr("data-rid");if(n.addClass("pipPreviewActive"),w(".main-preview .icon-erphone").hasClass("active")&&volume.setPipVideoVolume(),d){var c={};c.rid=d,n.hasClass("pipOutputActive")||n.hasClass("outPutActive")||n.hasClass("previewActive")||(c.type=131,t.push(c),e.tallyArray=JSON.stringify(t))}var l=n.find("video").attr("id");e.checked=1,p.ajaxReq("/producerpro/studio_update",e,function(e){if("0x0"==e.errorCode){i.addClass("check"),i.css("border","1px solid #41FF6D");var t={pipXOffset:"",pipYOffset:"",zorder:"",pipWidth:"",pipHeight:"",pipVideoSharedMemoryName:"",pipAudioSharedMemoryName:"",audioStatus:""};(t=getAttrs(i,t)).zorder=currentRInfo.zorder++,overToPreview.pipInit(t,l)}else p.alertTips(e.errorInfo,1500)})}}}),w(".overlay-tab .operation-btns").on("click",".op-label",function(){var e=w(this);if(e.addClass("active").siblings().removeClass("active"),w(".overlay-tab .editSingular").addClass("hide"),w(".operation-show").addClass("hide"),w(".clip-dot").css("display","none"),w(".preview-source .clip").remove(),w(".preview-source .apply-btn").remove(),w(".sd-pretreat .sd-pretreat-operation").removeClass("active"),w(".sd-pretreat-container .pretreat-content").addClass("hide"),clipDot.changeVideoCut(!0),e.hasClass("operation-text"))w(".sd-pretreat-container .pretreat-content.show-text").removeClass("hide"),0<w(".pretreat-content").find(".pretreat-item-text").length&&w(".show-text .pretreat-content-add").addClass("hide");else if(e.hasClass("operation-logo"))w(".sd-pretreat-container .pretreat-content.show-logo").removeClass("hide");else if(e.hasClass("operation-score"))w(".sd-pretreat-container .pretreat-content.show-score").removeClass("hide");else if(e.hasClass("operation-pip"))w(".sd-pretreat-container .pretreat-content.show-pip").removeClass("hide"),0<w(".sd-pretreat-container .pretreat-content.show-pip").find(".pip").length&&w(".show-pip .pretreat-content-add").addClass("hide");else if(e.hasClass("operation-clock")){if(w(".sd-pretreat-container .pretreat-content.show-clock").removeClass("hide"),0<w(".sd-pretreat-container .pretreat-content.show-clock").find(".clock").length)return void w(".show-clock .pretreat-content-add").addClass("hide")}else e.hasClass("operation-clip")&&w(".sd-pretreat-container .pretreat-content.show-clipvideo").removeClass("hide")}),w(".pretreat-content").on("mouseenter",".singular-logo",function(){var e=w(this);e.hasClass("active")&&e.append('<i class="icon-edit iconfont edit"></i>')}),w(".sd-pretreat").on("keyup","input",function(){return!1}),w(".pretreat-content").on("mouseenter",".pretreat-content-item",function(){var e=w(this);e.append('<i class="icon-colse iconfont close"></i>'),(e.hasClass("pip")||e.hasClass("score"))&&e.append('<i class="icon-edit iconfont edit"></i>')}),w(".sd-pretreat").on("change",".operation-uploadLogo",function(){var a=w("#file_p").val(),e=document.getElementById("file_p"),o=new Image;o.onload=function(){var e=w(".main-preview").attr("data-logomaxh")-0,t=w(".main-preview").attr("data-logomaxw")-0;if(o.height>e||o.width>t)return fn_switchLangAlertTip("Image resolution can’t exceed "+t+"x"+e+" pixels","只允许上传"+t+"x"+e+"分辨率以下的图片"),void w("#file_p").val("");if(!(a.match(/.png$/i)||a.match(/.gif$/i)||a.match(/.jpg$/i)||a.match(/.jpeg$/i)))return p.alertTips("i18n_LogoFormatProducer"),void w("#file_p").val("");var i=o.width+"x"+o.height,r=new FormData;r.append("peerId",w(".rList-show").attr("data-peerid")),r.append("size",i),r.append("module",1),r.append("zorder",currentRInfo.zorder++),r.append("upload",w("#file_p")[0].files[0]),w(".pretreat-content-add .operation-logo-label").css("display","none"),w(".operation-type-btns .operation-type-btn.operation-logo").removeClass("hover-bg"),w(".show-logo .addImg").css("display","block"),w.ajax({type:"POST",url:"/producerpro/logo_uploadLogo",data:r,processData:!1,contentType:!1,success:function(e){if(e=JSON.parse(e),w("#file_p").val(""),"0x0"==e.errorCode){var t=e.result;d.logoInit(t),overToPreview.logoInit(t)}"0x3"==e.errorCode?p.alertTips("i18n_logoHavedUpload"):"0x4"==e.errorCode?p.alertTips("i18n_producerPro_uploadLogoSize",2e3):"0x80100003"==e.errorCode&&p.alertTips("i18n_uploadLogoFail"),w(".show-logo .operation-logo-label").css("display","block"),w(".operation-type-btns .operation-type-btn.operation-logo").addClass("hover-bg"),w(".show-logo .addImg").css("display","none")},error:function(e){p.alertTips("i18n_uploadLogoFail"),w("#file_p").val(""),w("#loading-Bg").fadeOut(),w(".operation-type-btns .operation-type-btn .operation-logo-label").css("display","inline-block"),w(".operation-type-btns .operation-type-btn.operation-logo").addClass("hover-bg"),w(".show-logo .addImg").css("display","none")}})},o.src=window.URL.createObjectURL(e.files[0])}),w(".preview-source").on("click",".logo-box",function(e){e.stopPropagation(),w(".sd-pretreat-container .pretreat-content").addClass("hide"),w(".operation-show").addClass("hide"),w(".operation-logo").addClass("active"),w(".changepoint").remove(),w(".operation-logo").siblings().removeClass("active"),w(".show-logo").removeClass("hide")}),w(".show-text").on("click",".pretreat-content-add",function(){w(".show-text").addClass("hide"),w(".sd-text").removeClass("hide");var e=r.i18n_textValue,t=null;(t="en"==i18nLanguage?textAjaxParams.en_text:textAjaxParams.zh_text).text=e,w("#sd-textarea").val(e),"zh-CN"==window.navigator.language||"zh"==window.navigator.language?(w("#fontFamily").text("SimHei"),t.style.fontName="SimHei"):("en-US"==window.navigator.language||window.navigator.language,w("#fontFamily").text("Arial"),t.style.fontName="Arial"),t.zorder=currentRInfo.zorder++;var i=w(".rList-show").attr("data-peerId");w.ajax({type:"POST",url:"/producerpro/subtitle_add",data:{peerId:i,params:JSON.stringify(t)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.errorInfo;overToPreview.textInit(t),d.textInit(t)}}})}),w(".bg-input").spectrum({showAlpha:!0,move:function(e){}}),w(".bg-input").on("move.spectrum",function(e,t){var i=w(".bg-input").siblings(".sp-replacer").find(".sp-preview-inner").css("background-color");0!==w(".preview-source .textDiv").length&&(w(".preview-source .textDiv").css("background-color",i),n())}),w(".fontColor").spectrum({move:function(e){}}),w(".fontColor").on("move.spectrum",function(e,t){var i=w(".fontColor").siblings(".sp-replacer").find(".sp-preview-inner").css("background-color");0!==w(".preview-source .preTextarea").length&&(w(".preview-source .preTextarea").css("color",i),n())}),w(".show-score").on("click",".pretreat-content-add",function(){w(".show-score").addClass("hide"),w(".sd-score").removeClass("hide")}),w(".score-pattern ").on("click","li",function(e){if(!w(".score-pattern").hasClass("disabled")){if(0<w("#preview .scoreDiv").length&&w("#preview .scoreDiv").attr("data-url")==w(this).find(".operation-view-score").attr("data-url"))return!1;var t=w(this).index();w(this).find(".scoreLoading").removeClass("hide"),function(r){w(".score-pattern").addClass("disabled");var e=w(".rList-show").attr("data-peerId"),t=scoreCard["score_"+r];t.zorder=currentRInfo.zorder++,t.peerId=e,w.ajax({type:"POST",url:"/producerpro/logo_uploadLogo",data:t,success:function(e){if(e=JSON.parse(e),w(".score-pattern").removeClass("disabled"),"0x0"==e.errorCode){w("#preview .scoreDiv").remove(),w(".scoreLoading").addClass("hide"),w(".operation-view-score").css("border","");var t=w(".operation-view-score").eq(r);t.css("border","1px solid #41FF6D");var i=e.result;overToPreview.scoreInit(i),d.scoreInit(i,!1,!0)}else"0x80100003"==e.errorCode?"Query preload image failed"==e.errorInfo?(w(".scoreDiv.score-hide").remove(),p.alertTips("i18n_preload")):p.alertTips("i18n_uploadScoreFail"):w(".scoreDiv").remove(),w(".scoreLoading").addClass("hide")},error:function(e){w(".score-pattern").removeClass("disabled"),p.alertTips("i18n_uploadScoreFail"),w(".scoreDiv.score-hide").remove(),w(".scoreLoading").addClass("hide"),w("#file_p").val(""),w("#loading-Bg").fadeOut()}})}(t),e.stopPropagation()}}),w(".show-pip").on("click",".pretreat-content-add",function(){w(".show-pip").addClass("hide"),w(".sd-pip").removeClass("hide"),w(".pip-pat .pip-picture").trigger("click")}),w(".pip-pat .pip-picture").on("click",function(){var e=w(this);if(e.hasClass("created")){if(w(".pretreat-content .pip").hasClass("check"))return;w(".pretreat-content .pip").trigger("click")}else createPipToInit(e)}),w(".pip-in-sel p").on("click",function(e){if(w(".pip-pat .pip-picture").hasClass("created")){for(var t=w(".preview-content .preview-item").length,i="",r=1;r<=t;r++)i+="<li>"+r+"</li>";w(".pip-in-source").html(i),w(".pip-in-source").removeClass("hide"),e.stopPropagation()}}),w(".preview-source").on("click",".pip",function(){d.pipEidtInit(),w(".sd-pip").removeClass("hide"),w(".operation-pip").addClass("active"),w(".operation-pip").siblings().removeClass("active"),w(".sd-pretreat-container .pretreat-content").addClass("hide"),w(".sd-pip").siblings().addClass("hide")}),w(".pip-in-sel").on("click","li",function(){if(w(".pip-picture").hasClass("created")){var e=w(this).html();changePipSource(e)}}),w(".show-clock").on("click",".pretreat-content-add",function(){if(w(".show-clock").addClass("hide"),w(".sd-clock").removeClass("hide"),0==w("#preview").find(".clockDiv").length){var e=w(".defaultTime input").val();""==e?(e=2700,w(".defaultTime input").val(45)):e=parseInt(e),clockObj.clockEndTime=60*parseInt(e)}var t,i,r,a;t=clockObj.clockEndTime,i=w(".rList-show").attr("data-peerId"),r=calPts(w(".main-preview .main-player").attr("id")),(a={yOffset:60,xOffset:218,style:{fontSize:46,fontName:"Arial",foregroundColor:"FFFFFFFF",text:"00:00"},zorder:1e4,width:144,height:60,horizonAlign:"left",verticalAlign:"center",startTime:0}).endTime=1e3*t,a.timestamp=r,a.operation="create",w.ajax({type:"POST",url:"/producerpro/clock_add",async:!1,data:{peerId:i,params:JSON.stringify(a)},success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode){var t=e.result,i=t.id;w(".clockDiv").attr("data-id",i),overToPreview.clockInit(t),d.clockInit(t)}}}),saveClockuserBehavior("create","pvw")}),w(".clockInput").keyup(function(e){var t=TimeByms(60*w(".TimeSet input").val());if("NaN:NaN"==t)return w(".clockTextarea").html("00:00"),!1;w(".clockTextarea").html(t)}),w(".clockStart").click(function(e){var t=parseInt(w(".TimeSet input").val());if(!/^[0-9]{1,3}$/.test(t))return p.alertTips("i18n_onlyNumber"),!1;if(w(".clockInput").attr("disabled","disabled"),!(w("#preview").find(".clockDiv").length<1)){w(".clockStart").addClass("hide"),w(".clockStop").removeClass("hide");var i=w(".defaultTime input").val();""==i&&(i=1e4),clockObj.clockEndTime=60*parseInt(i);var r=w(".clockTextarea").html().split(":"),a=60*parseInt(r[0])+parseInt(r[1]);clockObj.clockSeconds=a;var o=checkLocation("location");clearInterval(clockObj.setClockTimer),clockObj.setClockTimer=setInterval(function(){clockObj.clockSeconds++;var e=clockObj.clockSeconds%60,t=parseInt(clockObj.clockSeconds/60);e=e<=9?"0"+e:e,t=t<=9?"0"+t:t,clockObj.clockSeconds>clockObj.clockEndTime?w(".clockDiv").css("background-color","red"):w(".clockDiv").css("background-color","#212740"),w(".clockTextarea").html(t+":"+e),w(".clockDiv").attr("data-time",clockObj.clockSeconds),59940<clockObj.clockSeconds&&(clearInterval(clockObj.setClockTimer),clockObj.clockSeconds=0,w(".clockDiv").attr("data-operation","create"),w(".clockTextarea").html("00:00"),w(".clockStart").removeClass("hide"),w(".clockStop").addClass("hide"),w(".clockDiv").css("background-color","#212740"),w(".clockInput").removeAttr("disabled"),w(".clockInput").val(0),"pgm"==o?(applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"create"),saveClockuserBehavior("start","pvw")))},1e3),""!=o&&("pgm"==o?(w("#preview .clockDiv").attr("data-operation","run"),applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("start","pgm")):(w("#preview .clockDiv").attr("data-operation","start"),updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"start"),saveClockuserBehavior("start","pvw")))}}),w(".clockStop").click(function(e){w(".clockStart").removeClass("hide"),w(".clockStop").addClass("hide"),w(".clockInput").removeAttr("disabled");var t=w(".defaultTime input").val();""==t&&(t=1e4),clockObj.clockEndTime=60*parseInt(t),clearInterval(clockObj.setClockTimer);var i=checkLocation("location");""!=i&&("pgm"==i?(w(".clockDiv").attr("data-operation","pause"),applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(w(".clockDiv").attr("data-operation","create"),updateClock(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime,"pause"),saveClockuserBehavior("stop","pvw")))}),w(".clockReset").click(function(e){w(".clockTextarea").html("00:00"),w(".clockStart").removeClass("hide"),w(".clockStop").addClass("hide"),w(".TimeSet input").val(0),w(".clockDiv").attr("data-operation","create"),w(".clockInput").removeAttr("disabled");var t=w(".defaultTime input").val();""==t&&(t=1e4),clockObj.clockEndTime=60*t,clearInterval(clockObj.setClockTimer),w(".clockDiv").css("background-color","#212740");var i=checkLocation("location");""!=i&&("pgm"==i?(applyClockToPgm(0,1e3*clockObj.clockEndTime),saveClockuserBehavior("stop","pgm")):(updateClock(0,1e3*clockObj.clockEndTime,"create"),saveClockuserBehavior("stop","pvw")))}),w(".defaultTime").on("click",".TimerApply",function(){w(".clockDiv").attr("data-operation","newEndTime");var e,t=parseInt(w(".defaultTime input").val());if(!/^[0-9]{1,3}$/.test(t))return p.alertTips("i18n_onlyNumber"),!1;""==t&&""!=t&&(t=1e4),clockObj.clockEndTime=60*t,e=w(".clockStart").hasClass("hide")?"start":"stop";var i=checkLocation("location");""!=i&&("pgm"==i?(applyClockToPgm(1e3*clockObj.clockSeconds,1e3*clockObj.clockEndTime),saveClockuserBehavior(e,"pgm")):(updateClock(0,1e3*clockObj.clockEndTime,"newEndTime"),saveClockuserBehavior(e,"pvw")))}),w("#preview").on("click",".clockDiv",function(e){w(this),w(".sd-clock").removeClass("hide"),w(".sd-pretreat-container .pretreat-content").addClass("hide"),w(".operation-clock").addClass("active"),w(".operation-clock").siblings().removeClass("active"),w(".changepoint").remove(),w(".sd-clock").siblings().addClass("hide"),e.stopPropagation()}),w(".pretreat-content").on("mouseleave",".pretreat-content-item",function(){var e=w(this);e.find(".close").remove(),e.find(".edit").remove()}),w(".pretreat-content").on("mouseleave",".singular-logo",function(){w(this).find(".edit").remove()}),w(".pretreat-content").on("click",".close",function(){if(!overlayCut.isCut){var e=w(this).parent();return e.hasClass("logo")?d.delLogo(e):e.hasClass("pip")?d.delPip(e):e.hasClass("text")?d.delText(e):e.hasClass("score")?d.delScore(e):e.hasClass("clock")&&d.delClock(e),!1}}),w(".operation-item-title").click(function(){var e=w(this);e.parents(".operation").addClass("hide");var r=e.attr("data-type"),t=w(".pretreat-content");w.each(t,function(e,t){var i=w(t).attr("data-type");r==i&&(w(t).removeClass("hide"),0<w(t).find(".pretreat-content-item").length&&("text"!=i&&"pip"!=i&&"clock"!=i||w(t).find(".pretreat-content-add").addClass("hide")),"singular"==i&&w(t).find(".singular-logo").removeClass("hide"))})}),w(".family-ul").fnNiceScroll(),w(".family-ul").on("click","li",function(e){e.stopPropagation();var t=w(this).text().trim();w("#fontFamily").text(t);var i=w("#preview .preTextarea");i.css("font-family"),w(this).parent().css("display","none");var r=i.width(),a=i.text().gblen(),o=2*Math.round(r/a);i.css({transform:"scale(1)","font-size":o+"px"}),"Proxima Nova Con..."==t?(i.css("font-family","Proxima Nova Condensed"),w("#sd-textarea").css("font-family","Proxima Nova Condensed")):(i.css("font-family",t),w("#sd-textarea").css("font-family",t)),r=i.width();var s=i.height();w("#preview .textDiv").css({width:r+"px",height:s+"px"}),n()}),w(".sd-font-family").on("click",".fontFamilyDiv","i",function(e){e.stopPropagation(),w(this).hasClass("disabled")?w(".sd-font-family .family-ul").css("display","none"):w(".sd-font-family .family-ul").css("display","block")}),w(".preview-source").on("input",".preTextarea",function(){var e=w(this),t=e.text(),i=(t.gblen(),w("#preview .preTextarea").css("transform")),r=e.width();"none"!=i&&(r*=i=i.substring(7,i.indexOf(","))),w("#preview .textDiv").css("width",r+"px"),w("#preview").width()<w("#preview .textDiv").width()+w("#preview .textDiv").position().left&&(t=t.substring(0,t.length-1),e.text(t),r=e.width(),"none"!=i&&(r*=i=i.substring(7,i.indexOf(","))),w("#preview .textDiv").css("width",r+"px"));var a=w("#preview .textDiv").width();if(w("#preview .textDiv").position().left+a>w(".preview-source").width()-parseInt(w("#preview .preTextarea").css("font-size"))/2)return e.text(t.substring(0,t.length-1)),w("#preview .textDiv").css({width:e.width()+"px",height:e.height()+"px"}),w("#preview .preTextarea").blur(),!1;w("#sd-textarea").val(t),n()}),w(".preview-source").on("keydown",".preTextarea",function(e){if(13==e.keyCode)return!1}),w("#preview").on("focus",".preTextarea",function(){var e=w(this),t=w("#preview .preTextarea").css("transform");if("none"!=t){t=t.substring(7,t.indexOf(","));var i=parseInt(e.css("font-size"))*t;12<i?w("#preview .preTextarea").css({transform:"scale(1)","font-size":i+"px"}):(t=i/12,w("#preview .preTextarea").css({transform:"scale("+t+")","font-size":i+"px"}))}w("#preview .textDiv").css({width:e.width()+"px",height:e.height()+"px"})}),w("#sd-textarea").keydown(function(e){var t=e.keyCode;if(13==t)return!1;var i=w("#sd-textarea").val(),r=w("#preview .textDiv").width();if(w("#preview .textDiv").position().left+r>w(".preview-source").width()-parseInt(w("#preview .preTextarea").css("font-size")))return 8==t||46==t||37<=t&&t<=40||(w("#sd-textarea").blur(),!1);w("#preview .preTextarea").text(i)}),w("#sd-textarea").keyup(function(){w("#preview .textDiv").width(),w("#preview .textDiv").position().left;var e=w("#sd-textarea").val();w("#preview .preTextarea").html(e),n(),w("#preview .textDiv").css({width:w("#preview .preTextarea").width()+"px",height:w("#preview .preTextarea").height()+"px"})}),{overlying:d}}($,oUtils,switchLangObj);function TimeByms(e){var t=Math.floor(e/60),i=Math.floor(e%60);return(t=t<=9?"0"+t:t)+":"+(i=i<=9?"0"+i:i)}function checkLocation(e){var t=JSON.parse(decodeURIComponent(studioBehavior)).ProgramClock;return null!=t?t[e]:""}function updateUserBehavior(e){if(null!=e){var t=JSON.parse(decodeURIComponent(studioBehavior)),i=t.ProgramClock;for(var r in null==i&&(i={}),e){var a=e[r];i[r]=a}t.ProgramClock=i,studioBehavior=encodeURIComponent(JSON.stringify(t))}}