"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},config={domain:"producer.tvunetworks.cn"};$(function(){FastClick.attach(document.body)});var sendEmailFlag=!0;function isEmail(e){return/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(e)}function isPhoneAvailable(e){return!!/^1[3-578]\d{9}$/.test(e)}$(function(){-1<location.href.indexOf("producerpro/index")&&window.history.pushState({state:1},"",null);var e,t,i=(e=new RegExp("(^|&)"+"inviteCode"+"=([^&]*)(&|$)","i"),null!=(t=window.location.search.substr(1).match(e))?unescape(t[2]):null);if(i&&$(".register-body .invite input").val(i),$(".register-body .email input").on("blur",function(){var e=$(this).val().trim();$(".header-title").attr("data-username",e),isEmail(e)?$(".register-body .email .email-title").html(""):$(".register-body .email .email-title").html(switchLangObj.i18n_emailAddress)}),$(".register-body .phone input").on("blur",function(){var e=$(this).val().trim();$(".header-title").attr("data-username",e),isEmail(e)||isPhoneAvailable(e)?$(".register-body .phone .email-title").html(""):$(".register-body .phone .email-title").html(switchLangObj.i18n_emailOrPhoneAddress)}),$(".visitor").on("click",".login-btn",function(){confirmLogin()}),$(".visitor").on("click",".register-btn",function(){$(".register-body").css("display","block"),$("#bgFilter").css("display","block")}),$(".register-body .password input").on("blur",function(){var e=$(this).val().trim();""==e?$(".register-body .password-title").html(switchLangObj.i18n_inputPassword):e.length<6?$(".register-body .password-title").html(switchLangObj.i18n_digitsPassword):$(".register-body .password-title").html("")}),$(".register-body .close").on("click",function(){$(this).parent().css("display","none"),$("#bgFilter").css("display","none")}),$(".register-body .confirm input").on("blur",function(){var e=$(this),t=$(".register-body .password input").val().trim(),i=e.val().trim();""==i?$(".register-body .confirm-title").html(switchLangObj.i18n_inputPassword):t!=i?$(".register-body .confirm-title").html(switchLangObj.i18n_inconsistent):$(".register-body .confirm-title").html("")}),$(".register-body .emailCode input").on("blur",function(){""==$(this).val().trim()?$(".register-body .emailCode .code-title").html(switchLangObj.i18n_rightCode):$(".register-body .emailCode .code-title").html("")}),$(".emailCode span").click(function(e){$(".emailCode span").html();if(config.domain==location.host){if(""==(t=$(".register-body .phone input").val().trim())||!isEmail(t)&&!isPhoneAvailable(t))return $(".register-body .phone .email-title").html(switchLangObj.i18n_emailOrPhoneAddress),!1;$(".register-body .phone .email-title").html("")}else{var t;if(""==(t=$(".register-body .email input").val().trim())||!isEmail(t))return $(".register-body .email .email-title").html(switchLangObj.i18n_emailAddress),!1;$(".register-body .email .email-title").html("")}if(!$(".emailCode span").hasClass("disabled")){$(".emailCode span").addClass("disabled");var i={email:$(".register-body .email input").val().trim()||$(".register-body .phone input").val().trim()};$.ajax({url:"/producerpro/user/sendVerifyCode",type:"post",data:i,timeout:3e4,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode?($(".emailCode span").addClass("disabled"),Countdown()):"0x80100001"==e.errorCode&&("Exist user!"==e.errorInfo?$(".register-body .emailCode .code-title").html(switchLangObj.i18n_AccountExists):($(".register-body .emailCode .code-title").html(switchLangObj.i18n_tryagain),$(".emailCode span").addClass("disabled"),Countdown()))},error:function(e){console.log(e),$(".emailCode span").removeClass("disabled")}})}}),$(".register-body .user-register button").on("click",function(){var e,t,i,r,o;if(e=$(".register-body .email input").val().trim(),o=$(".register-body .phone input").val().trim(),t=$(".register-body .password input").val().trim(),i=$(".register-body .confirm input").val().trim(),r=$(".register-body .emailCode input").val().trim(),config.domain==location.host){if(!isEmail(o)&&!isPhoneAvailable(o))return void $(".register-body .email-title").html(switchLangObj.i18n_emailOrPhoneAddress)}else if(!isEmail(e))return void $(".register-body .email-title").html(switchLangObj.i18n_emailAddress);if(e=e||o,""!=t)if(""!=t&&i==t)if(""!=r){var n={email:e,password:CryptoJS.SHA512(t)+"",verifyCode:r,parentInviteCode:$(".register-body .invite input").val().trim()};$.ajax({url:"/producerpro/user/checkVerifyCode",type:"post",data:n,timeout:3e4,success:function(e){if("0x0"==(e=JSON.parse(e)).errorCode||"0x80100015"==e.errorCode){$(".register-body .email-title").html(""),$(".register-body .password-title").html(""),$(".register-body .username-title").html(""),$(".register-body input").val(""),$(".inviteCode-title").html("");var t=$(".header-title").attr("data-username");if(localStorage.setItem("userName",t),0!=$(".main-center").length)return logout(),!1;window.location.href="http://"+window.location.host+"/producerpro/"}else"0x80100001"==e.errorCode&&("parentInviteCode not exist!"==e.errorInfo?$(".inviteCode-title").html(switchLangObj.i18n_inviteRightCode):$(".register-body .emailCode .code-title").html(switchLangObj.i18n_rightCode))},error:function(e){console.log(e)}})}else $(".register-body .code-title").html(switchLangObj.i18n_rightCode);else $(".register-body .confirm-title").html(switchLangObj.i18n_inconsistent);else $(".register-body .password-title").html(switchLangObj.i18n_inputPassword)}),$(".userSignInfo a").click(function(){window.location.href="http://"+window.location.host+"/producerpro/"}),$(".registerSign").click(function(){if(0==$(".main-center").length){var e=location.host;if("producer-a.tvunetworks.com"==e||"producer-b.tvunetworks.com"==e)location.href="./selectSystem.html";else{var t="http://"+window.location.host+"/producerpro/";$(".registerSign").attr("href",t)}}else confirmLogin()}),$(".register").click(function(){var e="http://"+window.location.host+"/producerpro/user/register.html";$(".register").attr("href",e)}),$(".paypal").click(function(){var e=localStorage.getItem("userEmial");window.location.href="http://"+window.location.host+"/producerpro/newbilling?email="+e,$(".load").css("display","block")}),$(".terms span").click(function(e){$("body").css("background","rgba(0,0,0,0.3)"),$(this).parents(".terms").parent().find(".rule").css("display","block")}),$(".rule div").click(function(e){$("body").css("background","#fff"),$(this).parents(".rule").css("display","none")}),0==$(".main-center").length){if($(".purchase").hasClass("paymoney"))return!1;$.ajax({url:"/producerpro/logout",data:{session:localStorage.getItem("session")},success:function(e){},error:function(){}})}config.domain==location.host?($(".register-body .email").hide(),$(".register-body .phone").show()):($(".register-body .email").show(),$(".register-body .phone").hide())});var settimer="";function Countdown(){var e=60;settimer=setInterval(function(){if(e<=1){clearInterval(settimer),e=60;localStorage.getItem("session");$(".emailCode span").css("color","rgba(51,171,79,1)"),$(".emailCode span").removeClass("disabled"),$(".emailCode span").html(switchLangObj.i18_reSend)}else e--,$(".emailCode span").css("color","rgba(153,153,153,1)"),$(".emailCode span").html(switchLangObj.i18_reSend+"("+e+")")},1e3)}function confirmLogin(){oUtils.confirmTips(switchLangObj.i18_ComfirmLogin,function(){logout()})}$(window).unload(function(){0!=$("#user_info_name").lenght&&"guest@tvunetworks.com"==$("#user_info_name").html()&&logout()}),window.onpopstate=function(){var e=window.history.state;e&&0!=$("#user_info_name").lenght&&1==e.state&&"guest@tvunetworks.com"==$("#user_info_name").html()&&logout()},$(function(){var h=void 0,g=void 0;function f(){var e={orderId:g};$.ajax({type:"POST",data:e,url:"/producerpro/wechat_pay_getOrderStatus",timeout:6e4,success:function(e){"0x0"==(e=JSON.parse(e)).errorCode&&"SUCCESS"==e.result?(clearInterval(h),window.location.href="http://"+window.location.host+"/producerpro/"):"PAYERROR"==e.result&&(clearInterval(h),localStorage.setItem("useWeixin","isTrue"),window.location.href="http://"+window.location.host+"/producerpro/")}})}function b(e,t,i,r,o,n){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e,timeStamp:t,nonceStr:i,package:r,signType:o,paySign:n},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&clearInterval(h)})}$(".purchase-cn").on("click",".to-pay button",function(){if(-1!=navigator.userAgent.toLowerCase().indexOf("micromessenger")){var e=window.location.href,t=e.indexOf("="),i={openid:e=e.slice(t+1)};$.ajax({type:"POST",url:"/producerpro/weixinmobilepay",timeout:6e4,data:i,success:function(e){var t,i,r,o,n,a,s=(e=JSON.parse(e)).result;if("object"!=(void 0===s?"undefined":_typeof(s))&&(0==s.indexOf('"')&&(s=s.substring(1,s.length-1)),s=JSON.parse(s)),"0x0"==e.errorCode){if("free charge"==e.result.chargeType)return window.location.href="http://"+window.location.host+"/producerpro/",!1;var l=s.timeStamp,d=s.paySign;g=s.orderId;var c=s.repackage,u=s.appId,m=(s.prepayId,s.signType),p=s.nonceStr;clearInterval(h),h=setInterval(f,5e3),t=u,i=l,r=p,o=c,n=m,a=d,"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",b,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",b),document.attachEvent("onWeixinJSBridgeReady",b)):b(t,i,r,o,n,a)}}})}else $.ajax({type:"POST",url:"/producerpro/wechat_createPayUrl",timeout:6e4,success:function(e){if(e=JSON.parse(e),$("#payimg").html(""),$("#phonepayimg").html(""),"0x0"==e.errorCode){if("free charge"==e.result)return window.location.href="http://"+window.location.host+"/producerpro/",!1;var t=new QRCode("payimg",{width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}),i=e.result.lastIndexOf("&"),r=e.result.substring(0,i),o=e.result.substring(i+1);t.makeCode(r),$(".payqrimg").show(),g=o.split("=")[1],clearInterval(h),h=setInterval(f,5e3)}}})}),$(".payqrimg .close").on("click",function(){$(".payqrimg").hide()}),$(".payMobile .close").on("click",function(){$(".payMobile").hide()}),$(".purchase-cn .close").on("click",function(){clearInterval(h),$(".purchase-cn").hide(),$("#bgFilter").hide()})});