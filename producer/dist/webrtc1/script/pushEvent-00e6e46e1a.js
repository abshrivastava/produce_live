"use strict";!function(e,t,i){var a,o=e.getElementsByTagName(t)[0];e.getElementById(i)||((a=e.createElement(t)).id=i,a.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8",o.parentNode.insertBefore(a,o))}(document,"script","facebook-jssdk");var facebookpushapi={getPosition:function(e){var n=e||"",s=$("form.pushCount").attr("data-token"),t=$(".preview-content .preview-item[data-filename='Default']").attr("data-rid").toLowerCase(),i=$(".main-preview").attr("data-livepeerid"),a=($("form.pushCount").attr("data-rtmpid"),{rId:t,tId:i});oUtils.ajaxReq("/producerpro/getGeoInfo.action",a,function(e){if("0x0"==e.errorCode){var t=$.parseJSON(e.errorInfo),i=t.latitude,a=t.longitude,o="/search?q="+n+"&type=place&center="+i+","+a+"&distance=10000000&access_token="+s;FB.api(o,function(e){if(e&&!e.error){var t=e.data,a=[];0<t.length&&($.each(t,function(e,t){var i='<div class="listCommon" data-id="'+t.id+'">'+t.name+"</div>";a.push(i)}),$(".searchList").show(),$(".searchList").html(a.join("")),$(".searchList").fnNiceScroll(),facebookpushapi.createClick())}else oUtils.alertTips("")})}})},getFbFriends:function(){var e=$("form.pushCount").attr("data-token"),t="/"+$("form.pushCount").attr("data-rtmpid")+"/friends?access_token="+e;FB.api(t,"GET",function(e){if(e&&!e.error){var t=e.data,a=[];0<t.length&&($.each(t,function(e,t){var i='<div class="listCommon" data-id="'+t.id+'">'+t.name+"</div>";a.push(i)}),$(".searchList").html(a.join("")),$(".searchList").fnNiceScroll(),facebookpushapi.createClick())}else oUtils.alertTips("")})},getTag:function(e){var t=e||"tvu",i=$("form.pushCount").attr("data-token");FB.api("/search?type=adinterest&q="+t+"&access_token="+i,function(e){if(e&&!e.error){var t=e.data,a=[];if(0<t.length)$.each(t,function(e,t){var i='<div class="listCommon" data-id="'+t.id+'">'+t.name+"</div>";a.push(i)}),$(".searchList").html(a.join("")),$(".searchList").fnNiceScroll(),0<$(".tagList .Tag").length&&$.each($(".tagList .Tag"),function(e,t){var a=$(t).attr("data-id");$.each($(".searchList .listCommon"),function(e,t){var i=$(t).attr("data-id");a==i?$(t).hide():$(t).show()})}),$(".searchList").show(),facebookpushapi.createClick()}else oUtils.alertTips("")})},showFriendByKeyWord:function(i){var e=$(".searchList .listCommon").length,t=$(".searchList .listCommon"),n=[];0<e&&($.each(t,function(e,a){var o=$(a).html().toLowerCase();if(0<=o.indexOf(i)){var t=$(".friendList .friendTag");$.each(t,function(e,t){var i=$(t).children(".friendSpan").html().toLowerCase();n.push(i),0<=n.indexOf(o)?$(a).hide():$(a).show()}),t.length||$(a).show()}else $(a).hide()}),$(".searchList").show(),""==i&&$(".searchList").hide())},createClick:function(e){$("#detailPush .listCommon").unbind(),$("#detailPush .listCommon").on("click",function(){var e=$(this);$(".keyContent").attr("data-type");$(".searchList").hide(),facebookpushapi.createSelectTag(e)})},createClickKeyWord:function(){$(".keyText .greenFont").unbind(),$(".keyText .greenFont").on("click",function(){if("position"==$(this).attr("data-type")){var e=$("#positionInput").val();this.getPosition(e),$(".searchList").css("top",78),$(".keyContent").css("margin-top",0),$(".fbIcon").css("margin-top",0),$(".positionList").show().siblings().hide(),$("#positionInput").focus(),$(".iconBox").removeClass("active"),$(".iconBox").eq(0).addClass("active"),$(".searchList").css({left:30,width:380}),$(".keyContent").attr("name",switchLangObj.i18n_at).html(switchLangObj.i18n_at).attr("data-type","At")}else{$(".friendList").show().siblings().hide(),$(".iconBox").removeClass("active"),$(".iconBox").eq(1).addClass("active"),"35px"<$(".friendList").css("height")&&($(".searchList").css("top",107),$(".keyContent").css("margin-top",15),$(".fbIcon").css("margin-top",15)),$(".searchList").css({left:42,width:366}),$(".keyContent").attr("name",switchLangObj.i18n_with).html(switchLangObj.i18n_with).attr("data-type","Friends"),this.getFbFriends(),$(".searchList").hide()}})},createSelectTag:function(e){switch($(".keyContent").attr("data-type")){case"At":facebookpushapi.showPositionByKeyWord(e);break;case"Friends":facebookpushapi.createFriendTag(e);break;case"Tag":facebookpushapi.createTag(e)}},showPositionByKeyWord:function(e){var t=e.html(),i=e.attr("data-id"),a='<div class="i18n positionBox-key left" name=""></div><div class="positionBox-text greenFont ellipsis left" data-type="position">'+t+"</div>";$(".positionBox").html(a),$("#positionInput").val(t).attr("data-id",i);var o=0<$(".friendBox .friendMudleBox").length,n=0<t.indexOf(",");o?n?$(".positionBox .positionBox-key").html(switchLangObj.i18n_In_low):$(".positionBox .positionBox-key").html(switchLangObj.i18n_at_low):n?$(".positionBox .positionBox-key").html(switchLangObj.i18n_In):$(".positionBox .positionBox-key").html(switchLangObj.i18n_at_none),$(".keyWord").show(),facebookpushapi.createClickKeyWord()},createFriendTag:function(e){var t=e.html(),i=e.attr("data-id"),a=0<$(".friendList .friendTag").length,o='<span class="friendTag"><span data-id="'+i+'" class="friendSpan ellipsis">'+t+'</span><i class="closeTab iconfont closeIcon"></i></span>',n='<div class="left friendMudleBox"><div class="i18n positionBox-key left" name=""></div><div class="positionBox-text greenFont ellipsis" data-type="friends">'+t+"</div></div>";$(".friendBox").append(n),a?$(".friendTag").last().after(o):$(".friendList").prepend(o),"35px"<$(".friendList").css("height")?($(".searchList").css("top",107),$(".keyContent").css("margin-top",15),$(".fbIcon").css("margin-top",15)):$(".searchList").css("top",78);for(var s=$(".friendList .friendTag").length,r=2;r<s;r++)$(".friendBox .friendMudleBox").eq(r).hide();$(".friendBox .positionBox-key").html(switchLangObj.i18n_with_none),s<3?2==s&&$(".friendBox .friendMudleBox").eq(1).children(".positionBox-key").html(switchLangObj.i18n_andother):($(".friendBox .friendMudleBox").eq(1).hide(),$(".userNumber").html(s-1),$(".togetherKey").show()),$("#fbInput").attr("placeholder","").val(""),$(".keyWord").show(),$(".searchList").hide(),$(".friendList").fnNiceScroll();var d=0<$(".friendBox .friendMudleBox").length;if(!!$(".positionBox .positionBox-text").html())var c=0<$(".positionBox .positionBox-text").html().indexOf(",");d?c?$(".positionBox .positionBox-key").html(switchLangObj.i18n_In_low):$(".positionBox .positionBox-key").html(switchLangObj.i18n_at_low):c?$(".positionBox .positionBox-key").html(switchLangObj.i18n_In):$(".positionBox .positionBox-key").html(switchLangObj.i18n_at_none),facebookpushapi.createClickKeyWord()},createTag:function(e){var t=e.html().toLowerCase(),i='<span class="Tag" data-id="'+e.attr("data-id")+'"><span class="tagSpan ellipsis">'+t+'</span><i class="closeTab iconfont closeIcon"></i></span>';0<$(".tagList .Tag").length?$(".Tag").last().after(i):$(".tagList").prepend(i),"35px"<$(".tagList").css("height")?($(".searchList").css("top",107),$(".keyContent").css("margin-top",15),$(".fbIcon").css("margin-top",15)):($(".searchList").css("top",78),$(".searchList").hide(),$(".tagList").fnNiceScroll()),$("#tagInput").attr("placeholder","").val("")},closeFriend:function(e){e.parent(".friendTag").remove();var t,a=e.siblings(".friendSpan").html();$(".friendList").css("height")<="35px"&&($(".keyContent").css("margin-top",0),$(".fbIcon").css("margin-top",0),$(".searchList").css("top",78));var i=$(".friendBox .friendMudleBox");$.each(i,function(e,t){var i=$(t).children(".positionBox-text").html();a==i&&$(t).remove()}),3<=(t=$(".friendTag").length)?$(".friendBox .friendMudleBox").eq(0).show().children(".positionBox-key").html(switchLangObj.i18n_with):2==t?($(".togetherKey").hide(),$(".friendBox .friendMudleBox").eq(0).show().children(".positionBox-key").html(switchLangObj.i18n_with),$(".friendBox .friendMudleBox").eq(1).show().children(".positionBox-key").html(switchLangObj.i18n_andother)):1==t&&$(".friendBox .friendMudleBox").eq(0).show().children(".positionBox-key").html(switchLangObj.i18n_with),t?$("#fbInput").attr("placeholder","").blur():$("#fbInput").attr("placeholder",switchLangObj.i18n_who).blur(),$(".userNumber").html(t-1);var o=0<$(".friendBox .friendMudleBox").length;if(!!$(".positionBox .positionBox-text").html())var n=0<$(".positionBox .positionBox-text").html().indexOf(",");o||(n?$(".positionBox .positionBox-key").html(switchLangObj.i18n_In):$(".positionBox .positionBox-key").html(switchLangObj.i18n_at_none))},pushFaceBook:function(){var r="";$("form.pushCount").on("click","#fbFunction .iconBox",function(){var e=(new Date).getTime(),t=r;if(!((r=e)-t<1e3)){var i=$(this),a=i.attr("data-type"),o=i.hasClass("active"),n=i.parents("form").attr("data-token");if($("#fbFunction .iconBox").removeClass("active"),$(".searchList").html(""),$(".fb-head").hide(),!n)return $("#detailPush .panda-auth").show(),$("#detailPush .panda-login").show(),$("#detailPush .panda-nickname").hide(),void oUtils.alertTips("i18n_reAuthenticate",2e3);if(o)return $(".fb-head").slideUp().removeClass("border"),void $(".fb-foot-left").hide();switch($(".fb-head").slideDown().addClass("border"),$(".fb-foot-left").show(),i.addClass("active"),$(".searchList").css("top",78),$(".keyContent").css("margin-top",0),$(".fbIcon").css("margin-top",0),$(".positionList,.friendList,.tagList").hide(),$(".keyContent").attr("data-type",a),a){case"At":$(".positionList").show(),facebookpushapi.getPosition(),$("#positionInput").focus(),$(".searchList").css({left:30,width:380}),$(".keyContent").attr("name",switchLangObj.i18n_at).html(switchLangObj.i18n_at),$("#positionInput").attr("placeholder",switchLangObj.i18n_where);break;case"Friends":$(".friendList").show(),facebookpushapi.getFbFriends();var s=$(".friendList .friendTag").length;"35px"<$(".friendList").css("height")&&($(".searchList").css("top",107),$(".keyContent").css("margin-top",15),$(".fbIcon").css("margin-top",15)),$(".searchList").css({left:42,width:366}),$(".keyContent").attr("name",switchLangObj.i18n_with).html(switchLangObj.i18n_with),$("#fbInput").attr("placeholder",switchLangObj.i18n_who),0<s?$("#fbInput").val("").attr("placeholder",""):$("#fbInput").focus();break;case"Tag":$(".tagList").show(),facebookpushapi.getTag();s=$(".tagList .Tag").length;"35px"<$(".tagList").css("height")&&($(".searchList").css("top",107),$(".keyContent").css("margin-top",15),$(".fbIcon").css("margin-top",15)),$(".searchList").css({left:42,width:366}),$(".keyContent").attr("name",switchLangObj.i18n_tag).html(switchLangObj.i18n_tag),$("#tagInput").attr("placeholder",switchLangObj.i18n_videoTag),0<s?$("#tagInput").val("").attr("placeholder",""):$("#tagInput").focus()}}}),$("form.pushCount").on("click",".fb-foot-box .closeTab",function(){var e=$(this);switch($(".keyContent").attr("data-type")){case"Friends":facebookpushapi.closeFriend(e);break;case"Tag":var t=$(".tagList .Tag").length;e.parent(".Tag").remove(),$(".tagList").css("height")<="35px"&&($(".searchList").css("top",78),$(".keyContent").css("margin-top",0),$(".fbIcon").css("margin-top",0)),t?$("#tagInput").attr("placeholder","").blur():$("#tagInput").attr("placeholder",switchLangObj.i18n_videoTag).blur()}}),$("form.pushCount").on("click",".fb-foot-box",function(){switch($(".keyContent").attr("data-type")){case"At":$(".searchList").show(),$("#positionInput").focus();break;case"Friends":$("#fbInput").focus();break;case"Tag":facebookpushapi.getTag(),$("#tagInput").focus()}}),$("form.pushCount").on("click",".pageInfo",function(){var e=$(this).attr("data-id"),t=$(this).attr("data-token");$("#shareTo").attr({pageId:e,pageToken:t}),$(".pageList").addClass("hide"),$(".pageList").css("display","none"),$("#shareTo").attr("data-value","Page"),$("#shareTo .dropdownDefault_value").attr("title","Page").html("Page");var i=$(this).html();$("#shareTo .dropdownDefault_value").html("Page ("+i+")")}),$("form.pushCount").on("click",".closeInputBox",function(){0==$(".friendBox .friendMudleBox").length?$(".keyWord").hide():$(".keyWord").show(),$(".positionBox").html(""),$(".searchList").hide(),$("#positionInput").val("").attr("placeholder",switchLangObj.i18n_where)})},checkPage:function(){var e=$("#detailPush").attr("data-token"),t=$("#detailPush").attr("data-rtmpid");if(""!=e){var i="/"+t+"/accounts";FB.api(i,"GET",{access_token:e},function(e){0<e.data.length?$("#shareTo").removeClass("disabled"):$("#shareTo").addClass("disabled")})}},updateLiveVideo:function(e,t,i,a,o){var n={access_token:o};null!=t&&(n.place=t),null!=i&&(n.tags=i),null!=a&&(n.content_tags=a),FB.api("/"+e,"POST",n,function(e){facebookpushapi.clearLastData()})},clearLastData:function(){$(".friendList .friendTag").remove(),$(".tagList .Tag").remove(),$(".fb-head").slideUp().removeClass("border"),$(".fb-foot-left").hide(),$("#fbFunction .iconBox").removeClass("active"),$(".keyContent").css("margin-top",0),$(".fbIcon").css("margin-top",0),$(".searchList").css("top",78),$(".keyWord").hide(),$("#positionInput,#fbInput,#tagInput").val(""),$(".friendBox").html(""),$(".positionBox").html(""),$(".togetherKey").hide(),$("#positionInput").attr("data-id","")},getPageId:function(e){if("Page"==e.children().attr("data-value")){var t=$("#detailPush").attr("data-token"),i="/"+$("#detailPush").attr("data-rtmpid")+"/accounts";FB.api(i,"GET",{access_token:t},function(e){if(console.log(e),e&&!e.error){$(".pageList").removeClass("hide"),$(".pageList").css("display","block");var a=[];$.each(e.data,function(e,t){var i='<div class="pageInfo" data-id="'+t.id+'" data-token="'+t.access_token+'">'+t.name+"</div>";a.push(i)}),$(".pageList").html(a.join("")),$(".pageList").fnNiceScroll()}})}else $(".pageList").addClass("hide"),$(".pageList").css("display","none")}},pushAbout=function(g,p,k,n,d,c){var l={ancestorparent:".previewModule-control",parentDom:".share2Platform",pushBtnDom:" .publish",pushDetailDom:"#detailPush",addExtSourceType:"#addExtSource_sourceTypeList",addExtSource:"#addShareSource",pushCount:"form.pushCount",addCountFlag:!0,newAccountSaved:!0},s={buildDate:"2018/04/27 12:45:00",livepeerid:g("#showRVideo-liveOutputModule").attr("data-livepeerid"),rId:g("#showRVideo-liveOutputModule").attr("data-id"),liveModule:"",ylWaitInterval:""},a={eventInit:function(){this.pushButton(),this.reauthCancel(),this.reauthCount(),this.showOrHidePlatfrom(),this.pushDetailBtn(),this.pushReauth(),this.pushReauthYizhibo(),this.selectEvent(),this.selectPlatfrom(),this.selectYouTube(),this.selectResolutionAndBitrate()},pushButton:function(){g(l.parentDom).on("click",l.pushBtnDom,function(){var i=g(this).parents("li");s.livepeerid=g("#showRVideo-liveOutputModule").attr("data-livepeerid"),s.rId=g("#showRVideo-liveOutputModule").attr("data-id").toLowerCase();var e=i.attr("data-nickName");if(g(this).hasClass("green-block-button")){var t={rId:s.rId,nickName:e};u.queryRtmpurl(t)}else{var a={CopierNickName:i.attr("data-nickName"),EncoderIndex:"1"},o={rid:s.rId,buildDate:s.buildDate,params:JSON.stringify([a]),nickNameArr:e,liveVideoId:s.livepeerid};if(p.ajaxReq("/producerpro/stopSoicalFileInfo.action",o,function(e){var t=e.errorCode;"0X0"==t||"0x0"==t?(i.find(".publish").html(k.i18n_publish),i.find(".publish").removeClass("red-block-button").addClass("green-block-button")):p.alertTips("i18n_stopShareFailed")}),"p"==i.attr("data-type")){var n=[];n.push(shareNickname),p.ajaxReq("/producerpro/stopPeriscopeBroadcast.action",{shareDetail:n})}}})},pushDetailBtn:function(){g(l.pushDetailDom).on("click",".pushDetailbtn",function(){var e=g(l.pushDetailDom),t=v._getDetailPushParam(e.attr("data-type"),e),i=g("#detailPush").find(".resolutionTypeList").attr("data-value"),a=g("#detailPush").find(".BitrateTypeList .dropdownDefault_value").text(),o=a.indexOf("b"),n=i+"&"+(a=a.slice(0,o));if(t.resolution=i,t.vBitrate=a,3<=statusObj.resolutionArray.length&&statusObj.resolutionArray.indexOf(n)<0)p.alertTips("i18n_selectResolution",2e3);else{if("Y"==e.attr("data-type")&&null==e.find(".pushDetailbtn").attr("data-youtube"))return p.alertTips("i18n_producerReauthTitle",2e3),!1;if("F"==e.attr("data-type")){var s=(new Date).getTime(),r=g("#expired-date").val();if(""!=(r=""!=r&&null!=r?new Date(r).getTime():"")&&null!=r&&(r-s<=6e5||6048e5<r-s))return p.alertTips("i18n_appointment",3e3),!1}if(g(l.pushDetailDom+" .pushDetailbtn").css("display","none"),g(l.pushDetailDom+" .loading").css("display","inline-block"),"block"!=g(l.pushDetailDom+" .yiLive-mobile").css("display"))u.saveRtmpDetailReq(t);else{var d=g("#detailPush .yiLive-mobile input").val(),c=g("#detailPush .yiLive-message input").val();u.saveYizhibo(d,c,t,u.saveRtmpDetailReq)}}})},showOrHidePlatfrom:function(){g(l.parentDom).on("mouseenter",".pack-source-list",function(){g(this);return g(".share2Platform .select-live-platform").css("display","block"),!1}),g(l.ancestorparent).on("mouseleave",function(){return g(this).find(".select-live-platform").css("display","none"),!1})},reauthCount:function(){g(document.body).on("click",".reauthenticate .reauthen",function(){var e=(t=g(this).parents(".reauthenticate")).attr("data-nickName"),t=g(".select-live-platform .live-platform li[data-nickName='"+e+"']"),i={nickName:"",id:"",type:"",token:"",description:"",username:"",title:"",rtmpId:"",appId:"",refreshAccessToken:"",should_not_tweet:""};i=v._getAttrs(t,i),a.showReauth(i),g(".reauthenticate").remove()})},reauthCancel:function(){g(document.body).on("click",".reauthenticate .cancel",function(){g(".reauthenticate").remove()})},pushReauth:function(){g(l.pushCount).on("click",".panda-login .panda-auth-btn",function(){var e=g(this).parents(l.pushCount).attr("data-type");"Y"==e&&("addShareSource"==g(this).parents(l.pushCount).attr("id")?u.goReauth(e,"#addShareSource"):u.goReauth(e,"#detailPush"));u.goReauth(e)}),g(l.pushCount).on("click",".popupContent_closeBtn,.cancel",function(){clearInterval(u.gePeriscopeTimer),clearInterval(u.getPandaAccountsTimer),clearInterval(u.getYouTubeTimer),g("#expired-date").datetimepicker("remove")})},selectEvent:function(){g(".popupContent_content").on("click",".InkePlay-checkbox",function(){var e=g(this);e.hasClass("active")?e.removeClass("active"):e.addClass("active")})},selectPlatfrom:function(){g(l.pushCount).on("keyup","input",function(){return!1}),g(".pushing").on("click",function(){return!1}),g(".Push_toAccount_comment").on("click",".shareIcon",function(e){g("#girdUrlShow").css("display","none");var t=g(this),i=t.children(".selectPosition").children(".dropdown_option_item");g(".pushAlertTips").fadeIn(1e3),t.hasClass("bgGreen")||t.hasClass("bgRed")?(t.find(".icon-socialMeida").hasClass("active")?t.removeClass("bgRed"):t.removeClass("bgGreen"),i.removeClass("block"),0!=g(".Push_toAccount_comment").find(".bgGreen").length||g(".shareIcon").find(".icon-socialMeida").hasClass("active")||g(".push-live").removeClass("openLive")):(t.find(".icon-socialMeida").hasClass("active")?t.addClass("bgRed"):t.addClass("bgGreen"),i.addClass("block"),g(".push-live").addClass("openLive")),t.find(".icon-socialMeida").hasClass("active")||t.hasClass("bgRed")||g(e.target).hasClass("dropdown_option_item")||!t.hasClass("bgGreen")||(a.showDetailPush(t),i.hasClass("block")?(i.removeClass("block"),t.removeClass("bgGreen")):(i.addClass("block"),t.addClass("bgGreen"))),g(".shareIcon .icon-socialMeida.active").parent().find(".dropdown_option_item").hasClass("block")?g(".push-stop").removeClass("hide"):g(".push-stop").addClass("hide"),t.parent(".Push_toAccount_comment").find(".shareIcon").length!=g(".shareIcon .dropdown_option_item.block").length||t.hasClass("bgGreen")&&t.hasClass("bgRed")?t.parents(".pushing").find(".SelectAllBtn").children(".dropdown_option_item").removeClass("block selectAllBg"):t.parents(".pushing").find(".SelectAllBtn").children(".dropdown_option_item").addClass("block selectAllBg")})},selectResolutionAndBitrate:function(){g(".resolutionTypeList").createSimulateSelect([{name:"1280x720",type:"1280x720"},{name:"1920x1080",type:"1920x1080"},{name:"NTSC",type:"720x480"},{name:"PAL",type:"720x576"}],"","type","name");g(".BitrateTypeList").createSimulateSelect([{name:"2.0Mbps",type:"2.0"},{name:"12.0Mbps",type:"12.0"},{name:"2.5Mbps",type:"2.5"},{name:"1.5Mbps",type:"1.5"},{name:"750Kbps",type:"750"},{name:"400Kbps",type:"400"}],"","type","name")},showDetailPush:function(e){if(!(e.find(".detialPush").length<=0)){var t=e.attr("data-type"),i=c.getDetialPushInfo(t),a=v._getAccountInfo(t);g(".pushDetailbtn").val(k.i18n_publish),a=v._getAttrs(e,a),g("#detailPush .detail-info").html(i),g("#expired-date").datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,bootcssVer:3,forceParse:0,pickerPosition:"bottom-left",startDate:new Date});var o=!0;if(""!=a.token?"S"!==t&&(a.token=c.getDAesString(a.token,c.pwd_2,c.iv_2),a.token=c.getDAesString(a.token,c.pwd_1,c.iv_1)):o=!1,v._setAttrs(g("#detailPush"),a),"F"==t){var n={title:k.i18n_privacy,radio:[{val:"EVERYONE",text:k.i18n_public},{val:"ALL_FRIENDS",text:k.i18n_friends},{val:"SELF",text:k.i18n_only_me}]},s={title:k.i18n_type,radio:[{val:"REGULAR",text:k.i18n_regular},{val:"AMBIENT",text:k.i18n_continuous}]};g("#shareTo").createSimulateSelect({radio:[{val:"Timeline"},{val:"Page"}]},d.getPageId,"val","text"),g("#privacy_active").createSelectedOptionList(n,null,"val","text"),g("#type_active").createSelectedOptionList(s,null,"val","text","",!0),g("#expireTimeBox #expired-date").val(e.attr("data-startTime")),d.checkPage()}if("Y"==t){g(".detail-info .others-website").removeClass("hide");g(l.pushDetailDom).find("#youtube-sourceTypeList").createSimulateSelect([{name:"YouTube",type:"Y"}],"","type","name"),g("#detailPush #youtube-sourceTypeList").find(".dropdownDefault").css("cursor","not-allowed")}if("O"==t||"Y"==t?g("#detailPush .push-title").addClass("hide"):g("#detailPush .push-title").removeClass("hide"),v._setPushCountInfo(g("#detailPush"),a),g("#detailPush").css("display","block"),g("#detailPush .panda-auth").css("display","none"),"Y"==t){var r={account:g("#detailPush .push-nickname").val()};p.ajaxReq("/producerpro/checkYoutueAuth",r,function(e){"0x0"!=e.errorCode?(g("#detailPush .panda-auth").css("display","block"),p.alertTips("i18n_producerReauthTitle",2e3)):g("#detailPush .pushDetailbtn").attr("data-youtube",!0)})}return o?"F"!=t&&"S"!=t&&"P"!=t||(g(l.pushCount+" .panda-auth").show(),g(l.pushCount+" .panda-login").hide(),g(l.pushCount+" .panda-nickname").show(),g(l.pushCount+" .panda-nickname input").val(a.username)):"F"!=t&&"S"!=t&&"P"!=t||(g(l.pushCount+" .panda-auth").show(),g(l.pushCount+" .panda-login").show(),g(l.pushCount+" .panda-nickname").hide(),g(l.pushCount+" .panda-nickname input").val("")),g(".pushing").addClass("hide"),g(l.pushDetailDom+" .pushDetailbtn").css("display","inline-block"),g(l.pushDetailDom+" .loading").css("display","none"),!1}},selectYouTube:function(){g("#detailPush").on("click"," #youtube-sourceTypeList .dropdownDefault",function(){g("#detailPush").find("#youtube-sourceTypeList .dropdown_menu").css("display","none")})},pushReauthYizhibo:function(){g(l.pushCount).on("click",".yl-input-mobile a",function(){var e=g(this);a.getMesYizhibo(e)})},getMesYizhibo:function(e){var t=e;if(!t.hasClass("wait")){var i=t.prev().val();if(/^1[34578]\d{9}$/.test(i)){p.ajaxReq("/producerpro/sendSms.action",{mobile:i},function(e){"0x0"!=e.errorCode&&(-1!=e.errorInfo.indexOf("没有开播权限")?p.alertTips("i18n_ylNoPower"):-1!=e.errorInfo.indexOf("未注册用户")?p.alertTips("i18n_ylNoRegister"):-1!=e.errorInfo.indexOf("请求超限")?p.alertTips("i18n_ylRequestFrequently"):-1!=e.errorInfo.indexOf("禁止发起直播")?p.alertTips("i18n_accountBanned"):-1!=e.errorInfo.indexOf("24小时内发送短信")&&p.alertTips("i18n_messageTooMuch"))});var a=119;s.ylWaitInterval=setInterval(function(){var e=a+"s";t.addClass("wait").html(e),--a<0&&(clearInterval(s.ylWaitInterval),t.removeClass("wait").html(k.i18n_getMessgae))},1e3)}else p.alertTips("i18n_wrongPhoneNumber",2e3)}},showReauth:function(e){var t=e.nickName;if(0<window.location.host.indexOf("cn"))var i=[k.i18n_YiLive,k.i18n_Others];else i=["Facebook","YouTube",k.i18n_YiLive,"Periscope",k.i18n_Others];g("#addExtSource_sourceTypeList1").createSimulateSelect(i),showPopupBox(g("#editShareSource"),!0);var a=e.id,o=e.type,n=e.rtmpId,s=e.token,r=(v._getCopierType(e.type),e.description),d=e.username,c=e.title,l=e.appId,p=e.refreshAccessToken,u=e.should_not_tweet,h="1"===r?"active":"";switch(g("#editShareSource").find("#facebook_appKey").val(s),g("#addExtSource_sourceTypeList1").addClass("disabled"),g("#editShareSource").attr("data-sourceId",a),g("#addExtSource_sourceNames").val(t),g("#editShareSource").find(".nickName").attr("data-name",t),g(".eitItem").hide(),g("#editShareSource .yiLive-mobile a").removeClass("wait").html(k.i18n_getMessgae),resetCheckMessage(g("#editShareSource .yiLive-item .countdown")),o){case"F":g("#addExtSource_sourceTypeList1").find(".dropdownDefault_value").attr("title","facebook").html("Facebook"),g(".eit-fb-item").show(),l?(g(".eit_fb_oldversion").removeClass("hide"),g(".eit_fb_newversion").addClass("hide"),g("#eitVersion .selecet_option_item").eq(0).removeClass("active"),g("#eitVersion .selecet_option_item").eq(1).addClass("active"),g("#edit_appId").val(l),g("#edit_userId").val(n),g("#edit_token").val(s),g("#edit_eye_token").val(s)):(g(".eit_fb_newversion").removeClass("hide"),g(".eit_fb_oldversion").addClass("hide"),g("#eitVersion .selecet_option_item").eq(1).removeClass("active"),g("#eitVersion .selecet_option_item").eq(0).addClass("active"),d?(g(".eit-fb-item .eit-fb-login").addClass("hide"),g(".eit-fb-item .fb-nickname").removeClass("hide"),g(".eit-fb-item .fb-nickname input").val(d),g(".eit-fb-item .fb-nickname input").attr("user-id",n),g(".eit-fb-item .fb-nickname input").attr("access-token",s)):(g(".eit-fb-item .fb-nickname").addClass("hide"),g(".eit-fb-item .eit-fb-login").removeClass("hide")));break;case"Y":g(".eit-yt-item").show(),g("#addExtSource_sourceTypeList1").find(".dropdownDefault_value").attr("title","youtube").html("YouTube"),g("#sourceUrl").val(n),g("#sorce_token").val(s);break;case"I":g(".eit-inke-item").show(),g("#addExtSource_sourceTypeList1").find(".dropdownDefault_value").attr("title",k.i18n_Inke).html(k.i18n_Inke),g("#eitInkeId").val(n),g(".eitItem .InkePlay-checkbox").addClass(h);break;case"Z":g(".eit-yl-item").show(),g("#addExtSource_sourceTypeList1").find(".dropdownDefault_value").attr("title",k.i18n_YiLive).html(k.i18n_YiLive),g("#editShareSource .yiLive-title input").val(c),g(".eitItem .InkePlay-checkbox").addClass(h),s?(g(".eit-yl-item .eit-yl-login").addClass("hide"),g(".eit-yl-item .yl-nickname").removeClass("hide"),g("#editShareSource .yiLive-account input").val(d).attr({readonly:!0,"data-token":s,"data-rtmpId":n})):(g(".eit-yl-item .yl-nickname").addClass("hide"),g(".eit-yl-item .eit-yl-login").removeClass("hide"));break;case"S":g("#addExtSource_sourceTypeList1").find(".dropdownDefault_value").attr("title","Periscope").html("Periscope"),g("#editShareSource .eit-periscope .popup_item_value").val(c),g("#editShareSource .eit-periscope .popup_item_value").attr("data-token",s),g("#editShareSource .eit-periscope .popup_item_value").attr("data-refreshaccesstoken",p),g("#editShareSource .eit-periscope .periscope-rauth").css("display","block"),g("#editShareSource .eit-periscope .panda-nickname input").val(d),"0"==u?g("#editShareSource .eit-periscope .InkePlay-checkbox").addClass("active"):g("#editShareSource .eit-periscope .InkePlay-checkbox").removeClass("active"),g(".eit-periscope").show();break;case"O":g(".eit-others-item").show(),g("#addExtSource_sourceTypeList1").find(".dropdownDefault_value").attr("title",k.i18n_Others).html(k.i18n_Others),g("#editShareSource .others-rtmp input").val(n),g(".eitItem .InkePlay-checkbox").addClass(h)}}},r={eventInit:function(){this.selPushPlatfrom(),this.saveCountbtn(),d.pushFaceBook()},selPushPlatfrom:function(){g(l.addExtSourceType).on("click",".dropdown_option",function(){var e=g(this).find("a").attr("data-value");g(this).parents("form").attr("data-type",e);-1!=["F","P","S","Y"].indexOf(e)?g(l.addExtSource+" .panda-auth").show():g(l.addExtSource+" .panda-auth").hide();var t=c.getDetialPushInfo(e);g(l.pushCount+" .panda-login").show(),g(l.pushCount+" .panda-nickname").hide(),g(l.addExtSource+" .detail-info").html(t)}),g(".pushing .addCount").on("click",function(){if(!mix_fn.isPrower("AddSocial"))return!1;if(0!=l.addCountFlag){if(g("#girdUrlShow").css("display","none"),l.addCountFlag){if(l.addCountFlag=!1,(g(l.pushCount).find(".pushDetailbtn").attr("data-youtube")||g("#addShareSource").find(".add-count").attr("data-youtube"))&&(g(l.pushCount).find(".pushDetailbtn").removeAttr("data-youtube"),g("#addShareSource").find(".add-count").removeAttr("data-youtube")),g(l.pushCount).css("display","none"),0<window.location.host.indexOf("cn"))var e=[{name:k.i18n_YiLive,type:"Z"},{name:k.i18n_Others,type:"O"}];else e=[{name:"Facebook",type:"F"},{name:"Periscope",type:"S"},{name:k.i18n_YiLive,type:"Z"},{name:"YouTube",type:"Y"},{name:k.i18n_Others,type:"O"}];g(l.addExtSourceType).createSimulateSelect(e,"","type","name"),g(l.addExtSourceType).parents("form").attr("data-type",g(l.addExtSourceType).attr("data-value")),g("#addShareSource").fadeIn(),g("#addShareSource").attr("data-token",""),g("#addShareSource .add-count").val(k.i18n_save),g("#addShareSource .push-nickname").val(""),g(l.pushCount).attr("data-refreshaccesstoken",""),g(l.pushCount).attr("data-data-token",""),g(l.pushCount+" .panda-auth").show(),g(l.pushCount+" .panda-login").show(),g(l.pushCount+" .panda-nickname").hide();var t=g(l.addExtSource).attr("data-type"),i=c.getDetialPushInfo(t);g(l.addExtSource+" .detail-info").html(i)}setTimeout(function(){l.addCountFlag=!0},300)}}),g(l.pushCount+" .cancel").on("click",function(){g(this).parents(l.pushCount).fadeOut()}),g(".pushing .deleteCount").on("click",function(){var i=g(".shareIcon .dropdown_option_item.block");return 0==i.length?(p.alertTips("i18n_hasChoose",2e3),!1):g(".shareIcon .icon-socialMeida.active").parent().find(".dropdown_option_item").hasClass("block")?(p.alertTips("i18n_pleaseStopToDel",2e3),!1):void p.confirmTips("i18n_producerproDeleteCount",function(){for(var e="",t=0;t<i.length;t++)e+=g(i[t]).parents(".shareIcon").attr("data-nickname")+",";e=e.substring(0,e.length-1),u.deleteCountReq(e)})})},saveCountbtn:function(){g("#addShareSource .add-count").on("click",function(){var e=g(this).parents("form"),t=e.attr("data-type"),i=v._getDetailPushParam(t,e);console.log(i);var a=r.saveCountTest(i);if("Z"==t&&a){var o=g("#addShareSource .yiLive-mobile input").val(),n=g("#addShareSource .yiLive-message input").val();u.saveYizhibo(o,n,i,u.saveCountReq)}else a&&u.saveCountReq(i)})},saveCountTest:function(e){if(!e.nickName)return p.alertTips("i18n_nickNameNoEmpty",2e3),!1;if(!/^.{1,32}$/.test(e.nickName))return p.alertTips("i18n_nikeNameLength1to32"),!1;if("null"===e.nickName.toLowerCase())return p.alertTips("i18n_IllegalOutputname"),!1;if(-1<e.nickName.indexOf(",")||-1<e.nickName.indexOf("%")||-1<e.nickName.indexOf("'"))return p.alertTips("i18n_OutputNameSupport"),!1;switch(e.type){case"S":if(!e.key||!e.refreshAccessToken)return p.alertTips("i18n_PeriscopeNoAuth",2e3),!1;break;case"F":if(!e.key)return p.alertTips("i18n_accessTokenNoEmpty",2e3),!1;break;case"O":if(!e.rtmpId)return p.alertTips("i18n_othersRtmp",2e3),!1;break;case"Y":if(null==g("#addShareSource").find(".add-count").attr("data-youtube"))return p.alertTips("i18n_youTuBeIsAuthor",2e3),!1}return!0}},u={saveCountReq:function(t){g.ajax({type:"POST",url:"/producerpro/queryShareDetailByNickName",data:{nickName:t.nickName},timeout:7e3,success:function(e){"0x0"==(e=g.parseJSON(e)).errorCode?p.alertTips("i18n_nickNameExist",2e3):p.ajaxReq("/producerpro/saveRtmpDetail",t,function(e){"0x0"==e.errorCode?(g("#addShareSource").fadeOut(),i(),g(l.pushCount+" .panda-login").hide(),g(l.pushCount+" .panda-nickname").show()):"400"==e.errorCode||"403"==e.errorCode||"0x80400002"==e.errorCode||"0x80400003"==e.errorCode?(p.alertTips("i18n_FacebookTryagin",1500),g(l.pushCount+" .panda-login").show(),g(l.pushCount+" .panda-nickname").hide(),g(l.pushDetailDom+" .pushDetailbtn").css("display","inline-block"),g(l.pushDetailDom+" .loading").css("display","none")):(e.errorCode,p.alertTips("i18n_inputInfo",2e3))})}})},deleteCountReq:function(e){e={nickName:e},p.ajaxReq("deleteShareDetail",e,function(e){"0x0"==e.errorCode&&(g(l.pushCount).fadeOut(),i())})},saveRtmpDetailReq:function(i){i.Resolution;p.ajaxReq("/producerpro/saveRtmpDetail",i,function(e){if("0x0"==e.errorCode){s.buildDate=s.buildDate,s.livepeerid=g(".main-preview").attr("data-livepeerid"),s.rId=g(".preview-content .preview-item[data-filename='Default']").attr("data-rid").toLowerCase();var t={rId:s.rId,nickName:i.nickName};if("F"==i.type&&(t.destination=i.destination,t.pageId=i.pageId,t.pageAccessToken=i.pageAccessToken,g(l.pushDetailDom+" .pushDetailbtn").css("display","inline-block"),g(l.pushDetailDom+" .loading").css("display","none"),g(l.pushDetailDom).hide(),""!=i.startTime))return!1;u.queryRtmpurl(t)}})},getPandaAccountsTimer:"",gePeriscopeTimer:"",getYouTubeTimer:"",goReauth:function(e,t){switch(e){case"S":var i=(new Date).getTime()+"",a="https://www.periscope.tv/oauth?client_id=P7mELQ3vvNzS3R2-6ZlcFy0IlyZtLrY_KqZizXvtMahAfELelp&redirect_uri=http://"+window.location.host+"/producerpro/getPeriscopeAccesstoken&state="+i,o=(window.outerWidth-800)/2+"px",n=window.open(a,"periscope","width=800px,height=600px,menubar=no,top=200px,left="+o),s={state:i};clearInterval(u.gePeriscopeTimer),u.gePeriscopeTimer=setInterval(function(){p.ajaxReq("/producerpro/getUserAccesstoken",s,function(e){if("0x0"==e.errorCode){clearInterval(u.gePeriscopeTimer),n.close();var t=JSON.parse(e.errorInfo);g(l.pushCount).attr("data-refreshaccesstoken",t[0].refresh_token),g(l.pushCount).attr("data-token",t[0].access_token),g(l.pushCount).attr("data-username",t[0].username),g(l.pushCount+" .panda-login").hide(),g(l.pushCount+" .panda-nickname").show(),g(l.pushCount+" .panda-nickname input").val(t[0].username)}})},3e3);break;case"F":if(g(".fb-auth").length<=0){var r='<div class="fb-auth"><iframe src="https://cc.tvunetworks.'+(0<location.href.indexOf(".com")?"com":"cn")+'/tvucc/fbadapter.html" frameborder="0"></iframe></div>';g("body").append(r),g(".fb-auth").css("display","block")}else g(".fb-auth").css("display","block");window.addEventListener("message",function(e){var a=e.data;a=JSON.parse(a),console.log(a),a.cancel||g.ajax({type:"POST",url:"/producerpro/getLongToken",data:{access_token:a.access_token},dataType:"json",async:!1,timeout:3e3,success:function(e){if("0x0"==e.errorCode){g(".fb-auth").css("display","none");var t=e.errorInfo,i=g.parseJSON(t).access_token;g(l.pushCount).attr("data-rtmpid",a.userId),g(l.pushCount).attr("data-token",i),g(l.pushCount).attr("data-username",a.username),g(l.pushCount+" .panda-nickname input").val(a.username),g(l.pushCount+" .panda-login").hide(),g(l.pushCount+" .panda-nickname").show()}}}),g(".fb-auth").css("display","none")},!1);break;case"Y":var d=void 0;d=g("#detailPush"==t?"#detailPush":"#addShareSource"),u.queryYoutubeAuthor(d)}},queryYoutubeAuthor:function(e){var t;if(null!=(t="detailPush"==e.attr("id")?g("#detailPush").find(g(".push-nickname")).val():g("#addShareSource").find(g(".push-nickname")).val())&&""!=t){var i=(window.outerWidth-800)/2+"px",a=window.open("","Youtube","width=800px,height=600px,menubar=no,top=200px,left="+i),o={account:t};p.ajaxReq("/producerpro/getClientSecret",o,function(e){if("0x0"==e.errorCode){var t=e.errorInfo.redirectUrl;a.location.href=t}});var n={account:t};clearInterval(u.getYouTubeTimer),u.getYouTubeTimer=setInterval(function(){p.ajaxReq("/producerpro/checkYoutueAuth",n,function(e){if("0x0"==e.errorCode)return clearInterval(u.getYouTubeTimer),p.alertTips("i18n_youTuBeIsAuthorSuccess",2e3),g("#addShareSource").find(".add-count").attr("data-youtube",!0),g("#detailPush").find(".pushDetailbtn").attr("data-youtube",!0),void a.close()})},2e3)}else p.alertTips("i18n_nickNameNoEmpty",2e3)},queryRtmpurl:function(e){g.ajax({type:"POST",url:"/producerpro/getRtmpUrl",data:e,dataType:"json",async:!1,timeout:15e3,success:function(e){if("0x0"==e.errorCode){if("false"==(e=JSON.parse(e.errorInfo)[0]).valid){var t=g("#detailPush").attr("data-type");if("Z"==t&&(g(l.pushDetailDom+" .yiLive-account").hide(),g(l.pushDetailDom+" .yiLive-mobile input").val(""),g(l.pushDetailDom+" .yiLive-message input").val(""),g(l.pushDetailDom+" .yiLive-mobile").show(),g(l.pushDetailDom+" .yiLive-message").show()),g(l.pushDetailDom+" .pushDetailbtn").css("display","inline-block"),g(l.pushDetailDom+" .loading").css("display","none"),"S"!=t&&"P"!=t&&"Y"!=t||(g("#detailPush .panda-auth").css("display","block"),g("#detailPush .panda-auth .panda-login").css("display","block"),g("#detailPush .panda-auth .panda-nickname").css("display","none")),"F"==t){if("400"!=e.errorCode&&"403"!=e.errorCode)return p.alertTips("i18n_FacebookTryagin",1500),!1;g("#detailPush .panda-auth").css("display","block"),g("#detailPush .panda-auth .panda-login").css("display","block"),g("#detailPush .panda-auth .panda-nickname").css("display","none")}return p.alertTips("i18n_reAuthenticate",1500),!1}var i={};if(i.CopierNickName=e.nickName,i.EncoderIndex=1,i.RtmpUrl=e.rtmpUrl,i.CopierType=v._getCopierType(e.type),i.RetryTimes=0,i.LiveModule="social","F"==g("#detailPush").attr("data-type")){i.RetryTimes=10;var a=e.liveVideoId,o=g("#positionInput").attr("data-id"),n=[],s=[];g.each(g(".friendList .friendTag"),function(e,t){var i=g(t).children().attr("data-id");n.push(i)}),g.each(g(".tagList .Tag"),function(e,t){var i=g(t).attr("data-id");s.push(i)});var r=g("#detailPush").attr("data-token");d.updateLiveVideo(a,o,n,s,r)}u.startSocial([i],a)}else"0x80100016"==e.errorCode?p.alertTips("i18n_cannotUseCloudR"):"0x80100014"==e.errorCode&&p.alertTips("i18n_youTuBeLiveIsAuthor")},error:function(e){console.log(e)}})},resetCheckMessage:function(e){clearInterval(u.checkMessageInterval),u.checkMessageInterval=null,u.checkMessageCountdown=30,e.html("").hide()},checkMessageInterval:"",saveYizhibo:function(e,t,i,a){if(/^1[34578]\d{9}$/.test(e))if(/^\d{4}$/.test(t)){var o=g(l.pushCount+" .yiLive-message .countdown");o.removeClass("hide"),p.ajaxReq("/producerpro/checkSms",{mobile:e,checkcode:t},function(e){if("0x0"==e.errorCode)i.rtmpId=e.memberid,i.key=e.accesstoken,i.username=e.nickname,i.avatar=e.avatar,a&&a(i);else if(o.show(),u.checkMessageInterval||(o.html("(30s)"),u.checkMessageInterval=setInterval(function(){u.checkMessageCountdown--;var e="("+u.checkMessageCountdown+"s)";o.html(e),u.checkMessageCountdown<0&&u.resetCheckMessage(o)},1e3)),-1!=e.errorInfo.indexOf("短信验证码"))p.alertTips("i18n_wrongMessageCode",3e3);else if(-1!=e.errorInfo.indexOf("请求超限")){var t="";t="zh"===g("#switchLanguage")[0].value?"请输入正确的短信验证码，"+u.checkMessageCountdown+"秒后重试":"Please input the correct message code, and try again after "+checkMessageCountdown+" secs.",p.alertTips(t,3e3)}})}else p.alertTips("i18n_messageCodeError",2e3);else p.alertTips("i18n_wrongPhoneNumber",2e3)},startSocial:function(e,o){var t=g("#detailPush").find(".resolutionTypeList").attr("data-value"),i=g("#detailPush").find(".BitrateTypeList .dropdownDefault_value").text(),a=i.indexOf("b");i=i.slice(0,a);var n={rid:s.rId,share:["share"],params:JSON.stringify(e),buildDate:s.buildDate,encoderIndex:1,livePeerId:s.livePeerId,resolution:t,vBitrate:i,liveModule:s.liveModule};p.ajaxReq("/producerpro/startStudioFileInfo",n,function(e){if("0x0"==e.errorCode){var t=JSON.parse(n.params)[0],i={rId:n.rid,nickName:t.CopierNickName,encoderIndex:1,rtmpUrl:t.RtmpUrl,buildDate:s.buildDate,liveVideoId:o,liveModule:"social"},a={shareDetail:JSON.stringify(i)};g(l.pushDetailDom).hide(),u.saveShareDetail(a),g(l.pushDetailDom+" .pushDetailbtn").css("display","inline-block"),g(l.pushDetailDom+" .loading").css("display","none")}else p.alertTips(e.errorInfo)})},saveShareDetail:function(e){p.ajaxReq("/producerpro/saveShareDetail",e,function(e){console.log("saveShareDetail",e)})}},o={pushCurrentCountStateInfo:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].NickName);return t},setCurrentCountState:function(e){var t=o.pushCurrentCountStateInfo(e);g(".live-platform .publish").removeClass("red-block-button").addClass("green-block-button"),g(".live-platform .publish").html(k.i18n_publish);for(var i=0;i<t.length;i++)g(".live-platform [data-nickname='"+t[i]+"'] .publish").removeClass("green-block-button").addClass("red-block-button"),g(".live-platform [data-nickname='"+t[i]+"'] .publish").html(k.i18n_stop);0<t.length&&g(".share2Platform button.selectVideo-common").addClass("red-block-button").removeClass("green-block-button")}},v={pwd_1:"625202f9869e068d",iv_1:"5efd8f6060e20880",pwd_2:"1020304050607080",iv_2:"a1b2c3d4e5f6g7h8",getAesString:function(e,t,i){var a=n.enc.Utf8.parse(e);t=n.enc.Utf8.parse(t),i=n.enc.Utf8.parse(i);var o=n.AES.encrypt(a,t,{iv:i,mode:n.mode.CBC,padding:n.pad.Iso10126});return n.enc.Base64.stringify(o.ciphertext)},getDAesString:function(e,t,i){t=n.enc.Utf8.parse(t),i=n.enc.Utf8.parse(i);return n.AES.decrypt(e,t,{iv:i,mode:n.mode.CBC,padding:n.pad.Iso10126}).toString(n.enc.Utf8)},_setPushCountInfo:function(e,t){switch(e.find(".push-nickname").val(e.attr("data-nickname")),t.type){case"S":e.find(".push-title input").val(e.attr("data-title")),"1"==e.attr("data-should_not_tweet")?e.find(".select-twitter .InkePlay-checkbox").removeClass("active"):e.find(".select-twitter .InkePlay-checkbox").addClass("active");break;case"Y":e.find(".addExtSource_sourceUrl input").val(e.attr("data-rtmpid")),e.find(".addExtSource_sourceUrl input").val(e.attr("data-rtmpid")),e.find(".addKey input").val(e.attr("data-token")),e.find(".addKey input").val(e.attr("data-token"));break;case"I":e="Inke";break;case"Z":e.find(".yl-nickname input").val(e.attr("data-username")),e.find(".push-title input").val(e.attr("data-title")),"0"==e.attr("data-description")?e.find(".InkePlay-checkbox").removeClass("active"):e.find(".InkePlay-checkbox").addClass("active");break;case"O":e.find(".others-rtmp input").val(e.attr("data-rtmpid"))}},_getCopierType:function(e){var t="";switch(e){case"F":t="Facebook";break;case"S":t="Periscope";break;case"Y":t="Youtube";break;case"I":t="Inke";break;case"Z":t="Yi Live";break;case"O":t="Others"}return t},_getAccountInfo:function(e){var t={};switch(e){case"F":t={id:"",rtmpId:"",token:"",type:"",nickName:"",username:"",description:"",title:"",appId:""};break;case"S":t={id:"",rtmpId:"",token:"",type:"",nickName:"",username:"",description:"",title:"",appId:"",should_not_tweet:"",refreshAccessToken:"",isNew:""};break;case"Y":t={id:"",rtmpId:"",token:"",type:"",nickName:""};break;case"I":t={id:"",rtmpId:"",token:"",type:"",nickName:"",username:"",description:""};break;case"Z":t={id:"",rtmpId:"",token:"",type:"",nickName:"",username:"",description:"",title:""};break;case"O":t={id:"",rtmpId:"",token:"",type:"",nickName:"",username:"",description:""}}return t},_getDetailPushParam:function(e,t){var i;switch(e){case"F":var a=g("#expired-date").val();a=""!=a&&null!=a?new Date(a).getTime():"",i={id:t.attr("data-id"),username:t.attr("data-username"),userId:t.attr("data-rtmpid"),nickName:t.find(".push-nickname").val(),title:t.find(".push-title input").val(),description:t.find(".description").val(),privacy:g("#privacy_active").attr("data-value"),streamType:g("#type_active").attr("data-value"),type:"F",rtmpId:t.attr("data-rtmpid"),destination:"Page"==g("#shareTo").attr("data-value")?"Pages":g("#shareTo").attr("data-value"),pageId:g("#shareTo").attr("pageid"),pageAccessToken:g("#shareTo").attr("pagetoken"),startTime:a},t.attr("data-token")?i.key=v.getAesString(t.attr("data-token"),v.pwd_1,v.iv_1):i.key=void 0;break;case"S":i={id:t.attr("data-id"),rtmpId:t.attr("data-rtmpid"),key:t.attr("data-token"),type:"S",nickName:t.find(".push-nickname").val(),username:t.attr("data-username"),description:t.attr("data-description"),title:t.find(".push-title input").val(),appId:t.attr("data-appid"),should_not_tweet:t.find(" .select-twitter .InkePlay-checkbox").hasClass("active")?0:1,refreshAccessToken:t.attr("data-refreshaccesstoken"),isNew:"0"};break;case"Y":i={id:t.attr("data-id"),type:"Y",nickName:t.find(".push-nickname").val(),isAuto:0};break;case"I":i={id:"",rtmpId:"",token:"",type:"",nickName:"",username:"",description:""};break;case"Z":i={id:t.attr("data-id"),rtmpId:t.attr("data-rtmpid"),key:v.getAesString(t.attr("data-token"),v.pwd_1,v.iv_1),type:"Z",nickName:t.find(".push-nickname").val(),username:t.find(".yl-nickname input").val(),description:t.find(".InkePlay-checkbox").hasClass("active")?1:0,title:t.find(".push-title input").val()};break;case"O":i={id:t.attr("data-id"),rtmpId:t.find(".others-rtmp input").val(),key:v.getAesString(t.attr("data-token"),v.pwd_1,v.iv_1),type:"O",nickName:t.find(".push-nickname").val(),title:t.find(".push-title input").val(),username:"",description:""}}return i},_getAttrs:function(e,t){for(var i in t)t[i]=e.attr("data-"+i);return t},_setAttrs:function(e,t){for(var i in t)e.attr("data-"+i,t[i])}};function h(e){var m=[],t="";0<e.length&&("public"==userType?businessType!=k.i18n_Pro&&(t='<div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div>'):t='<div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div>',g.each(e,function(e,t){var i=t.type;if("P"!==i){var a,o=t.nickName,n=t.rtmpId,s=t.appId,r=t.token,d=t.refreshAccessToken,c=(t.locale,t.should_not_tweet),l="",p=window.location.host,u=t.startTime,h="";switch(""!=u&&(h=ExpireDateTime(parseInt(u),!0)),""!=u&&(u=k.i18n_StartAt+"&nbsp;"+ExpireDateTime(parseInt(u),!0)+"&#13;"),i){case"F":if(0<p.indexOf("cn"))return!1;a='<i class="iconfont icon-socialMeida icon-facebook icon-socialMeida-midddle icon-font-size showTitle icon-font-Facebooksize" data-website="'+i+'"></i>';break;case"Y":if(0<p.indexOf("cn"))return!1;a='<i class="iconfont icon-socialMeida icon-youtube icon-socialMeida-midddlthisObjSe icon-font-size showTitle" data-website="'+i+'"></i>';break;case"I":a='<i class="icon-socialMeida icon-inke showTitle" data-website="'+i+'" data-rtmpId="'+n+'"></i>';break;case"Z":a='<i class="icon-socialMeida icon-yiLive showTitle" data-website="'+i+'" data-rtmpId="'+n+'" data-token="'+r+'" data-scid="'+s+'"></i>';break;case"S":if(0<p.indexOf("cn"))return!1;a='<i class="iconfont icon-socialMeida icon-periscope showTitle" data-website="'+i+'" data-refreshaccesstoken="'+d+'" data-token="'+r+'" data-should_not_tweet="'+c+'"></i>';break;case"O":a='<i class="iconfont icon-socialMeida icon-yunzhibo icon-socialMeida-midddle icon-font-size showTitle" data-website="'+i+'"></i>'}l="F"==i||"S"==i?o:n;var v=o;"S"!=i&&"F"!=i&&"O"!=i&&"Z"!=i&&"Y"!=i||(v="<span class='detialPush'>"+o+"</span>",l=k.i18n_click2publish+" "+l);var f='<div class="shareIcon left" data-nickName="'+t.nickName+'" data-startTime="'+h+'" data-id="'+t.id+'" data-key="'+t.key+'" data-type="'+t.type+'" data-token="'+t.token+'" data-description="'+t.description+'" data-rtmpId="'+t.rtmpId+'" data-username="'+t.username+'" data-title="'+t.title+'" data-appId="'+t.appId+'" data-refreshAccessToken="'+t.refreshAccessToken+'" data-should_not_tweet="'+t.should_not_tweet+'"  data-name="'+o+'"  title="'+u+l+"/ "+o+'"><div class="dropdown_option checkbox shareOneSelectBtn selectPosition"><a href="javascript:;" class="ellipsis dropdown_option_item" data-value="'+o+'"></a></div>'+a+'<div class = "shareIcon-bottom"><span class="shareCircle hide"></span><span class="shareNickName ellipsis">'+v+"</span></div></div>";m.push(f)}}),g(".pushing").find(".Push_toAccount_comment").html(t+m.join("")),g(".pushing").find(".Push_toAccount_comment").fnNiceScroll(),g(".pushing").hasClass("hide")&&g(".pushing").toggleClass("hide"))}function i(){var i="All";if(!g(".websiteFilter .dropdown_menu li").eq(0).hasClass("active")){var e=g(".websiteFilter .dropdown_menu li.active");i="",g.each(e,function(e,t){i+=","+g(t).find("a").attr("data-value")}),i=i.slice(1)}var t={type:i,pageFlag:"false"};p.ajaxReq("/producerpro/queryRtmpDetail",t,function(e){if("0x0"==e.errorCode)h(e=g.parseJSON(e.errorInfo));else if(-1<e.errorInfo.indexOf("Null record")){var t="";t="public"==userType?businessType!=k.i18n_Pro?' <div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div><div class="emptyPush"><div class="empty_box"><img src="images/empty_box.png" alt=""></div><span class="emptyData i18n" name="i18n_EmptyData">Empty Data</span></div>':'<div class="emptyPush"><div class="empty_box"><img src="images/empty_box.png" alt=""></div><span class="emptyData i18n" name="i18n_EmptyData">Empty Data</span></div>':' <div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div><div class="emptyPush"><div class="empty_box"><img src="images/empty_box.png" alt=""></div><span class="emptyData i18n" name="i18n_EmptyData">Empty Data</span></div>',g(".pushing").find(".Push_toAccount_comment").html(t)}})}function m(e,t,i,n){var a={rid:e,share:["share"],params:JSON.stringify(t),buildDate:"2017/1/17 16:10",encoderIndex:1,livePeerId:i,resolution:"1280x720",vBitrate:"2.0M",liveModule:"producerPro"};p.ajaxReq("/producerpro/startStudioFileInfo",a,function(a){if("0X0"==a.errorCode||"0x0"==a.errorCode){var o=[];n&&g.each(n,function(e,t){t.liveModule="producerPro";var i=JSON.parse(a.errorInfo);g.each(i,function(e){t.nickName==e.copierNickName&&(t.encoderIndex=e.encoderIndex)}),o.push(JSON.stringify(t)),g(".pushing").find("[data-name='"+t.nickName+"']").children(".icon-socialMeida").addClass("active"),g(".pushing").find("[data-name='"+t.nickName+"']").find(".shareCircle").css("display","inline-block"),g(".Push_toAccount_comment .gridShow").after(g(".Push_toAccount_comment").find("[data-name='"+t.nickName+"']"))});var e={shareDetail:o};p.ajaxReq("/producerpro/saveShareDetail",e),g(".pushing").find(".block").parents(".shareIcon").removeClass("bgGreen"),g(".pushing").find(".block").removeClass("block selectAllBg")}g(".pushing").find(".loading").fadeOut()},null,null,function(){g(".pushing").find(".loading").fadeOut()})}return g(function(){if(0<window.location.host.indexOf("cn"))var e={checkbox:{parent:k.i18n_socialAccount,selectAll:!0,children:[{val:"Z",text:k.i18n_YiLive},{val:"O",text:k.i18n_Others}]}};else e={checkbox:{parent:k.i18n_socialAccount,selectAll:!0,children:[{val:"F",text:"Facebook"},{val:"Y",text:"YouTube"},{val:"Z",text:k.i18n_YiLive},{val:"S",text:"Periscope"},{val:"O",text:k.i18n_Others}]}};g(".pushing .websiteFilter").createSimulateSelect(e,i,"val","text"),g(".pushing .websiteFilter").setSimulateSelect("all"),g(".output-live").on("click",function(e){g(".pushing").hasClass("hide")?(g(".pushing .websiteFilter").setSimulateSelect("all"),p.ajaxReq("/producerpro/queryRtmpDetail",{type:"All",pageflag:"false"},function(e){if("0x0"==e.errorCode){var e=g.parseJSON(e.errorInfo);h(e)}else{-1<e.errorInfo.indexOf("Null record")&&g(".pushing").toggleClass("hide");var t="";"public"==userType?businessType!=k.i18n_Pro&&(t='<div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div>',g(".Push_toAccount_comment").html(t)):(t='<div class="gridShow"><img src="images/gridLogo.png" alt="" /><div class="gridShow-title">Grid</div></div>',g(".Push_toAccount_comment").html(t))}})):(g(".pushing").toggleClass("hide"),g(".pushAlertTips").fadeOut(200))}),g(".Push_toAccount_comment").hasClass("shareIcon")?g(".emptyPush").hide():g(".emptyPush").show(),g(".Push_toAccount_comment").on("mouseover",".shareIcon",function(){var e=g(this);e.find(".icon-socialMeida").hasClass("active")&&e.addClass("bghoverRed")}),g(".Push_toAccount_comment").on("mouseout",".shareIcon",function(){var e=g(this);e.find(".icon-socialMeida").hasClass("active")&&e.removeClass("bghoverRed")}),g(".push-foot").on("click",".SelectAllBtn .dropdown_option_item",function(){var e=g(this);g(".Push_toAccount_comment").hasClass("shareIcon")?g(".emptyPush").hide():g(".emptyPush").show(),e.hasClass("block selectAllBg")?(e.removeClass("block selectAllBg"),g(".push-live").removeClass("openLive"),e.parents(".pushing").find(".Push_toAccount_comment .dropdown_option_item").removeClass("block"),g(".shareIcon").find(".icon-socialMeida").hasClass("active")&&e.parents(".pushing").find(".shareIcon").removeClass("bgRed"),e.parents(".pushing").find(".shareIcon").removeClass("bgGreen")):(e.addClass("block selectAllBg"),g(".push-live").addClass("openLive"),e.parents(".pushing").find(".Push_toAccount_comment .dropdown_option_item").addClass("block"),g(".shareIcon").find(".icon-socialMeida").hasClass("active")?e.parents(".pushing").find(".shareIcon").addClass("bgRed"):e.parents(".pushing").find(".shareIcon").addClass("bgGreen"))}),g(".push-foot").on("click",".push-live",function(){var v,f,e,t=g(this),i=g(".main-rList .rList-show").attr("data-peerId"),a=g(".main-preview").attr("data-livepeerId"),o=t.parents(".pushing").find(".Push_toAccount_comment .block"),n=o.length,s=n+(g(".main-output .shareCounts").html()-0);if(0<g(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").length)return p.alertTips("i18n_stopThisVideoShareAnotherVideo",2e3),void t.parents(".liveVideo-item").find(".loading").fadeOut();if(g(".pushAlertTips").fadeOut(200),0<n){var r=g(".main-preview").attr("data-maxCopierCount");if(r<s)return void fn_switchLangAlertTip("The max length you can share is "+r,"最多能分享"+r+"个");v=i,f=a,e="",g(o.parents(".shareIcon")).each(function(){e+=g(this).attr("data-nickname")+","}),e=e.substr(0,e.length-1),g(".pushing").find(".loading").fadeIn(),g.ajax({type:"POST",url:"/producerpro/getRtmpUrl",data:{nickName:e,rId:v},dataType:"json",timeout:45e3,success:function(e){if("0x0"==e.errorCode){var t=e.errorInfo,c=[],l=[];if(g.each(g.parseJSON(t),function(e,t){var i=t.valid,a=(t.nickName,t.liveVideoId,t.rtmpUrl),o=t.scid;if("false"==i){var n={};n.nickName=t.nickName,n.type=t.type,n.rtmpUrl=t.rtmpUrl,c.push(n)}else{var s={rId:v,nickName:t.nickName,liveVideoId:t.liveVideoId,type:t.type,rtmpUrl:a,buildDate:"2017/1/17 16:10",livePeerId:f};if(l.push(s),o)for(var r=g("#"+v).find(".shareIcon").find(".shareNickName"),d=0;d<r.length;d++)r.eq(d).html()==t.nickName&&r.eq(d).parents(".shareIcon").children(".icon-socialMeida").attr("data-scid",o)}}),""!=c){var i=[],a=[],o=[],n=[];g.each(c,function(e,t){"I"===t.type?a.push(t.nickName):"P"===t.type?t.rtmpUrl&&(-1!=t.rtmpUrl.errorInfo.indexOf("room not exists")?o.push(t.nickName):i.push(t.nickName)):"Z"===t.type?t.rtmpUrl&&(500<t.rtmpUrl.result?a.push(t.nickName):i.push(t.nickName)):"F"!==t.type||"404"!=t.rtmpUrl&&"400"!=t.rtmpUrl?i.push(t.nickName):n.push(t.nickName)});var s="",r="";if(""!=i){var d=i.join(", ");r+="<div>Account "+d+" may be expired.</div>",s+="<div>账号 "+d+" 可能已过期。</div>"}if(0!=n.length){var p=n.join(", ");r+="<div>Account "+p+" live failed, please try again after a few minutes.</div>",s+="<div>账号 "+p+" 开启直播失败，请稍后重试。</div>"}if(""!=o){var u=o.join(", ");r+="<div>Account "+u+" does not have permission to go live on PandaTV.</div>",s+="<div>账号 "+u+" 在熊猫TV未开通直播权限。</div>"}if(""!=a){var h=a.join(", ");r+="<div>Account "+h+" failed to go live.</div>",s+="<div>账号 "+h+" 开启直播失败。</div>"}fn_switchLangAlertTip(r,s),g(".pushing").find(".loading").fadeOut()}""!=l&&function(e,t,i,a){var o="";"0X0"!=i.errorCode&&"0x0"!=i.errorCode||(o=jQuery.parseJSON(i.errorInfo));var n=[],s=[],r=[],d=g(".main-preview").attr("data-livepeerId");g.each(o,function(e,t){var i={};i.nickName=t.nickName,i.url=t.rtmpUrl,i.type=t.type,r.push(i)}),g.each(o,function(e,t){if("false"!=t.valid){var i={};i.CopierNickName=t.nickName,i.EncoderIndex=1,i.RtmpUrl=t.rtmpUrl,i.CopierType=t.type,i.LiveModule="producerPro",0<n.length?g.each(n,function(e,t){t!=i.CopierType&&n.push(i.CopierType)}):n.push(i.CopierType),"F"==i.CopierType?(i.CopierType="Facebook",i.RetryTimes=10):"Y"==i.CopierType?(i.CopierType="Youtube",i.RetryTimes=0):"I"==i.CopierType?(i.CopierType="Inke",i.RetryTimes=0):"Z"==i.CopierType?(i.CopierType="Yi Live",i.RetryTimes=0):"S"==i.CopierType?(i.CopierType="Periscope",i.RetryTimes=0):"O"==i.CopierType&&(i.CopierType="Others",i.RetryTimes=0),s.push(i)}}),m(t,s,d,e)}(l,v,e)}else g(".pushing").find(".loading").fadeOut()},error:function(){g(".pushing").find(".loading").fadeIn(),p.alertTips("i18n_networkUnavailable")}})}else p.alertTips("i18n_hasChoose",2e3)}),g(".push-foot").on("click",".push-stop",function(){var e=g(this),n=[],s=[];if(!e.hasClass("disabled")){var t=g(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").length,i=g(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active");if(0==t)return p.alertTips("i18n_chooseLiveAccount",2e3),void e.parents(".liveVideo-item").find(".loading").fadeOut();g.each(i,function(e,t){var i=g(t).attr("data-website");if("Z"==i){var a={};a.scid=g(t).attr("data-scid"),a.memberid=g(t).attr("data-rtmpId"),a.accesstoken=g(t).attr("data-token"),n.push(a)}else if("S"==i){var o=g(t).parent().attr("data-name");s.push(o)}}),""!=n&&p.ajaxReq("/producerpro/closeYizhiboPush",{param:JSON.stringify(n)}),0!=s.length&&p.ajaxReq("/producerpro/stopPeriscopeBroadcast",{shareDetail:s}),function(){var e=g(".main-rList .rList-show").attr("data-peerId"),t=g(".main-preview").attr("data-livepeerId"),i=g(".push-foot .push-stop").parents(".push-foot").siblings(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").parents(".shareIcon").find(".shareNickName"),a=g(".push-foot .push-stop").parents(".push-foot").siblings(".Push_toAccount_comment").find(".block").parents(".shareIcon").find(".icon-socialMeida.active").parents(".shareIcon").length,o=g(".main-output .shareCounts").html()-0,n=g(".pushing").find(".Push_toAccount_comment .block"),s=a<o?"":"1",r=[],d=[];if(g.each(n,function(e,t){r.push(g(t).attr("data-value"))}),a<o)g.each(i,function(e,t){var i={};i.CopierNickName=i.CopierNickName=g(t).parents(".shareIcon").attr("data-nickname"),i.EncoderIndex=1,d.push(i)});else{var c={};g.each(i,function(e,t){c.CopierNickName=[g(t).parents(".shareIcon").attr("data-nickname")]}),c.EncoderIndex=1,d.push(c)}var l={rid:e,buildDate:"2017/1/17 16:10",params:JSON.stringify(d),nickNameArr:r,encoderIndex:s,liveVideoId:t};p.ajaxReq("/producerpro/stopStudioFileInfo",l,function(e){var t=e.errorCode;"0X0"==t||"0x0"==t?(g(".Push_toAccount_comment").find(".block").parents(".shareIcon").children(".icon-socialMeida").removeClass("active"),g(".Push_toAccount_comment").find(".block").parents(".shareIcon").removeClass("bgRed").find(".shareCircle").hide(),g(".Push_toAccount_comment").find(".block").removeClass("block selectAllBg"),g(".shareIcon").find(".icon-socialMeida").hasClass("active")||0!=g(".Push_toAccount_comment").find(".bgRed").length||(g(".push-live").removeClass("openLive"),g(".push-stop").addClass("hide"))):p.alertTips("i18n_stopShareFailed")})}()}}),g(".Push_toAccount_comment").on("click",".gridShow",function(){if(!mix_fn.isPrower("Grid"))return!1;if(g("#girdUrlShow").css("display","block"),g("#detailPush").css("display","none"),g("#addShareSource").css("display","none"),"yes"!=g(".gridIssp").attr("data-issp")){var e=[],t={};t.CopierNickName=Math.random(),t.EncoderIndex=1,t.RtmpUrl="default",t.CopierType="Others",t.LiveModule="producerPro",t.type=5,t.RetryTimes=0,e.push(t);var i={rid:g(".rList-show").attr("data-peerId"),share:["share"],params:JSON.stringify(e),buildDate:"2017/1/17 16:10",encoderIndex:1,resolution:"1280x720",vBitrate:"2.0M",livePeerId:g(".main-preview").attr("data-livepeerId"),liveModule:"producerPro"};p.ajaxReq("/producerpro/startStudioFileInfo",i,function(e){"0X0"==e.errorCode||e.errorCode})}}),g("#girdUrlShow p").click(function(){g(".gridIssp").select(),document.execCommand("Copy"),p.alertTips("i18n_Copyed",2e3)}),g("#detailPush").on("click",".expiredCloseBtn",function(){g("#expireTimeBox #expired-date").val("")})}),a.eventInit(),r.eventInit(),c.setCurrentCountState=o.setCurrentCountState,c.goReauth=u.goReauth,c.getMesYizhibo=a.getMesYizhibo,c.pwd_1=v.pwd_1,c.iv_1=v.iv_1,c.iv_2=v.iv_2,c.pwd_2=v.pwd_2,c.getDAesString=v.getDAesString,c.getAesString=v.getAesString,c}($,oUtils,switchLangObj,CryptoJS,facebookpushapi,window.pushAbout||{}),overlayCut={isCut:!1,previewWidth:$("#preview").width(),textCut:function(){$(".rList-show").attr("data-peerId");var e=[];if(this.isCut=!0,0!=$("#preview .preTextarea").length||0!=$(".scoreText").length||0!=$(".clockDiv").length){var t=!1;sourceList.isOrCanvas&&(t=!0),e=updateMultiCheck(!1,t)}return e},logoCut:function(e){this.isCut=!0;var t={peerId:$(".rList-show").attr("data-peerId")};1==sourceList.isOrCanvas&&$("#preview .textDiv").addClass("logo-box");var p=[],i=$(".preview-source .logo-box"),a=$("#preview .preTextarea").css("transform");if(a&&(a=a.substring(7,a.indexOf(","))),0!=$("#preview .preTextarea").length)var o=$("#preview .preTextarea").html().gblen()/2,n={size:widthAndHeight.getOutputWidth("#preview",$("#preview .textDiv").width())+"x"+widthAndHeight.getOutputWidth("#preview",$("#preview .textDiv").height()),bgcolor:$("#preview .preTextarea").css("background-color"),color:$("#preview .preTextarea").css("color"),text:$("#preview .preTextarea").html(),fstyle:"normal",fweight:"normal",fsize:Math.round(widthAndHeight.getOutputWidth("#preview",$("#preview .textDiv").width())/o)+"px",ffamily:$("#preview .preTextarea").css("font-family")},u=placeholder.getData(n);i.each(function(e,t){var i={},a="";if($(t).hasClass("textDiv")||$(t).hasClass("scoreDiv")){var o=$(t).width(),n=$(t).height(),s=$(t).position().left;a=n/o;var r=$(t).position().top,d=$("#preview").width()-s-o;if(i.xOffset=widthAndHeight.getOutputWidth("#preview",d),i.yOffset=widthAndHeight.getOutputHeight("#preview",r),i.imageWidth=widthAndHeight.getOutputWidth("#preview",o),i.imageHeight=widthAndHeight.getOutputHeight("#preview",n),i.id=$(t).attr("data-id"),1==sourceList.isOrCanvas&&$(t).hasClass("#preview textDiv")){var c=u.indexOf(",");i.base64=u.substring(c+1)}}else{var l=$(".pretreat-content-item[data-id='"+$(t).attr("data-id")+"']");i={imageWidth:"",imageHeight:"",logoYOffset:"",logoXOffset:"",url:"",id:""},a=(i=getAttrs(l,i)).imageHeight/i.imageWidth,i.xOffset=i.logoXOffset,i.yOffset=i.logoYOffset}i.zorder=$(t).css("z-index"),i.xOffset=needEven(i.xOffset),i.yOffset=needEven(i.yOffset),i.imageWidth=needEven(i.imageWidth),i.imageHeight=i.imageWidth*a,$(t).css({width:widthAndHeight.getPriviewWidth("#preview",null,i.imageWidth)+"px",height:widthAndHeight.getPriviewWidth("#preview",null,i.imageWidth*a)+"px",top:widthAndHeight.getPriviewHeight("#preview",null,i.yOffset)+"px"}),$(t).css({left:widthAndHeight.getPriviewWidth("#preview",null,widthAndHeight.resolutionW-i.xOffset-i.imageWidth)+"px"}),p.push(i)}),t.logoParams=JSON.stringify(p),t.subtitleParams=JSON.stringify(e),$.ajax({type:"POST",url:"/producerpro/logo_subtitle_multiCheck",data:t,success:function(e){var t,i=(e=JSON.parse(e)).logoResult;overlayCut.isCut=!1;var a=e.subtitleResult;if("0x0"==a.errorCode&&(t=a.result,$(".output-source .textDiv").remove(),0!=t.length))for(var o=[],n=0;n<t.length;n++){null==t[n].logoId?(overlying.textInit(t[n],!0),currentRInfo.outputPreview&&overToPreview.textInit(t[n],".output-source .big-video")):o.push(t[n])}if("0x0"===i.errorCode){t=i.result,$(".output-source .big-video .logo-box").remove();for(n=0;n<t.length;n++){1!=t[n].scoreBoard?(overlying.logoInit(t[n],!0),currentRInfo.outputPreview&&overToPreview.logoInit(t[n],".output-source .big-video")):(currentRInfo.outputPreview&&overToPreview.scoreInit(t[n],".output-source .big-video"),overlying.scoreInit(t[n],!0))}}},error:function(e){overlayCut.isCut=!1,console.log(e)}}),0==$(".preview-source .logo-box").length&&0==$(".preview-source .scoreDiv").length&&oUtils.ajaxReq("/producerpro/logo_clear",t,function(e){"0x0"!==e.errorCode?overlayCut.isCut=!1:$(".output-source .big-video .logo-box").remove()})},pipCut:function(){var e={dataType:"pip",peerId:currentRInfo.selectRId};if(0!=$("#preview .pip").length){if(!$(".pretreat-content .pip")||!$(".pretreat-content .pip").attr("data-id"))return;var t=overToPreview.getPipInfo();if(t.id=$(".pretreat-content .pip").attr("data-id"),$(".afv-cut .radius-box").hasClass("close")){var i=$(".afv-audio-cut .afv-audio").html().substring(6),a=$(".preview-content .preview-item").eq(i-1).attr("data-filename");t.selectedAudio=a,t.audioStatus=0}else t.audioStatus=1;e.pipParams=JSON.stringify(t)}else{var o=$(".main-output").attr("data-filename");e.pipParams=JSON.stringify({pipAudioSharedMemoryName:o})}var n=[],s=$(".preview-content li.pipOutputActive");if(0!==s.length){var r=s.attr("data-rid");if(r){var d={};d.rid=r,s.hasClass("outPutActive")||!s.hasClass("previewActive")&&!s.hasClass("pipPreviewActive")?s.hasClass("outPutActive")||s.hasClass("previewActive")||s.hasClass("pipPreviewActive")||(d.type=130,n.push(d)):(d.type=131,n.push(d))}}$(".preview-content li").removeClass("pipOutputActive"),$(".preview-content li.pipPreviewActive").addClass("pipOutputActive");var c=$(".preview-content li.pipOutputActive"),l=c.attr("data-rid");if(l){var p={};p.rid=l,c.hasClass("outPutActive")||(p.type=132,n.push(p))}e.tallyArray=JSON.stringify(n),oUtils.ajaxReq("/producerpro/studio_check",e,function(e){if(overlayCut.isCut=!1,"0x0"==e.errorCode){if(0==$("#preview .pip").length)return $(".main-output").removeAttr("data-pipfilename"),$(".preview-list-container li.pipOutputActive").removeClass("pipOutputActive"),void $(".output-source .big-video .pip").remove();if(overlying.pipInit(e.result.pip),currentRInfo.outputPreview){var t=$("#preview .pip video").attr("data-videoid");overToPreview.pipInit(e.result.pip,t,".output-source .big-video")}}else oUtils.alertTips(e.errorInfo,1500)})},clockCut:function(){$(".rList-show").attr("data-peerId");if(this.isCut=!0,0<$("#preview").find(".clockDiv").length)var e=$(".clockTextarea").html().split(":"),t=60*parseInt(e[0])*1e3+1e3*parseInt(e[1]);var i=$(".defaultTime input").val();if(""==i&&(i=1e4),clockObj.clockEndTime=60*parseInt(i),$(".clockStart").hasClass("hide"))$(".clockDiv").attr("data-operation","run"),saveClockuserBehavior("start","pgm");else{var a=$(".clockDiv").attr("data-operation");saveClockuserBehavior(a,"pgm")}applyClockToPgm(t,1e3*clockObj.clockEndTime)},score:function(f){var e=$("#preview").width(),m=currentRInfo.zorder,g=[],t=1==f?$(".scoreDiv.score-hide .scoreText"):$("#preview").find($(".scoreDiv.score-active .scoreText")),i=$(".scoreDiv.score-active"),a=i.width(),o=i.position().left,k=i.position().top,b=e-o-a;return b=widthAndHeight.getOutputWidth("#preview",b),k=widthAndHeight.getOutputHeight("#preview",k),t.each(function(e,t){var i=$(this),a=($(this).parents(".scoreDiv"),i.css("color"));a="rgb(255, 255, 255)"==a?"FFFFFFFF":"FF000000","zh-CN"==window.navigator.language||"zh"==window.navigator.language?$(this).css("font-family","SimHei"):("en-US"==window.navigator.language||window.navigator.language,$(this).css("font-family","Arial"));var o=parseInt(i.css("right").split("p")[0]),n=parseInt(i.css("top").split("p")[0]),s=i.width(),r=i.height(),d=i.css("fontFamily"),c=i.val(),l=i.attr("data-scoreTextId"),p=a,u=i.css("font-size").split("p")[0],h={};h.fontSize=u,h.backgroundColor="00000000",h.fontName=d,h.foregroundColor=p,h.foregroundColor=p;var v={};""==l&&null==l||(v.textId=l),v.text=c,v.yOffset=n+k,v.xOffset=o+b,v.zorder=m,v.style=h,v.width=s,v.height=r,v.horizonAlign="center",v.verticalAlign="center",f?g.push(JSON.stringify(v)):g.push(v)}),g},subtitleCom:function(){var e,t=$("#preview .preTextarea").text(),i=$("#preview .preTextarea").attr("data-id"),a=$("#preview .preTextarea").css("font-size");a=a.split("p")[0];var o=$("#preview .preTextarea").css("transform");o&&(a*=o=o.substring(7,o.indexOf(",")));var n=$("#preview .preTextarea").css("font-family");-1<n.indexOf("gotham")?n="zh-CN"==window.navigator.language||"zh"==window.navigator.language?"SimHei":("en-US"==window.navigator.language||window.navigator.language,"Arial"):-1<n.indexOf("Proxima Nova Condensed")?n="Proxima Nova Condensed":-1<n.indexOf("Proxima Nova Rg")&&(n="Proxima Nova Rg"),e=changeColor($("#preview .textDiv").css("background-color")).substring(1,9);var s=changeColor($("#preview .preTextarea").css("color")).substring(1,9),r=$("#preview .textDiv").position().left,d=$("#preview .textDiv").position().top,c=$("#preview .textDiv").width(),l=$("#preview .textDiv").height(),p=$("#preview").width()-r-c;d=widthAndHeight.getOutputHeight("#preview",d),p=widthAndHeight.getOutputWidth("#preview",p),a=widthAndHeight.getOutputWidth("#preview",a),c=widthAndHeight.getOutputWidth("#preview",c),l=widthAndHeight.getOutputWidth("#preview",l);var u={},h={};return h.fontSize=a,h.backgroundColor=e,h.fontName=n,h.foregroundColor=s,u.text=t,u.yOffset=d,u.xOffset=p,u.style=h,u.zorder=$("#preview .textDiv").css("z-index"),u.width=c,u.height=l,u.horizonAlign="center",u.verticalAlign="center",""==i&&null==i||(u.textId=i),u},clockSubtitle:function(){var e=$("#preview .clockTextarea").text(),t=$("#preview .clockDiv").attr("data-id"),i=$("#preview .clockDiv").css("font-size");i=i.split("p")[0];var a=$("#preview .clockDiv").css("font-family");changeColor($("#preview .clockDiv").css("background-color")).substring(1,9);var o=changeColor($("#preview .clockDiv").css("color")).substring(1,9),n=$("#preview .clockDiv").position().left,s=$("#preview .clockDiv").position().top,r=$("#preview .clockDiv").width(),d=$("#preview .clockDiv").css("border-width").split("p")[0],c=$("#preview").width()-n-r;s=widthAndHeight.getOutputHeight("#preview",s),c=widthAndHeight.getOutputWidth("#preview",c),d=widthAndHeight.getOutputWidth("#preview",d);var l={},p={};return p.fontSize=i,p.fontName=a,p.foregroundColor=o,p.text=e,l.yOffset=s,l.xOffset=c,l.style=p,l.zorder=$("#preview .clockDiv").css("z-index")||7,l.width=144,l.height=60,l.horizonAlign="left",l.verticalAlign="center",""==t&&null==t||(l.id=t),l}};