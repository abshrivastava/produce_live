"use strict";var volume=function(u,a){var e={volumeObj:{},getVideoVolumeColumn:function(e){var i,t,o,n;for(var a in e)if("InputPreview"==a||"OutputPreview"==a){var r=e[a],v=r.SwitchBusNickName;this.volumeObj[v]||(this.volumeObj[v]={lastRightDb:0,lastLeftDb:0,curRightDb:0,curLeftDb:0,CurrentVolume:0}),i=this.volumeObj[v],t=r,o="InputPreview"==a?u(".preview-source").find(".audio"):u(".output-source ").find(".audio"),this.setVolumeColumn(t,o,i)}else for(var l=e.SourceListPreview,s=0;s<l.length;s++)l[s].PreviewShm.IsEnabled&&l[s].IsPreivewing&&(n=l[s].PreviewShm.SharedMemoryName,this.volumeObj[n]||(this.volumeObj[n]={lastRightDb:0,lastLeftDb:0,curRightDb:0,curLeftDb:0}),o=u(".preview-content [data-filename='"+n+"']").find(".audio"),i=this.volumeObj[n],t=l[s],this.setVolumeColumn(t,o,i))},setVolumeColumn:function(e,i,t){var o=u(i).find(".active");n.init(e,o,t)}},n={init:function(e,i,t){t.CurrentVolume=e.CurrentVolume,e=e.VolumePreviewWorker.PreviewVoiceClip,t.lastRightDb=t.curRightDb,t.lastLeftDb=t.curLeftDb,t.curRightDb=e.RightDb,t.curLeftDb=e.LeftDb,this.dealVolume(t,i)},dealVolume:function(e,i){var t=Math.round((e.curLeftDb- -40)/40*120),o=Math.round((e.curRightDb- -40)/40*120),n=Math.round((e.lastLeftDb- -40)/40*120),a=Math.round((e.lastRightDb- -40)/40*120),r=Math.round((t-n)/5),v=Math.round((o-a)/5);if(0==i.length)return!1;this.animation(n,t,r,i[0]),this.animation(a,o,v,i[1])},animation:function(i,t,o,n){if(i<t){a.requestAnimationFrame(function e(){i=t<(i+=o)?t:i,u(n).css("height",i/120*100+"%"),i<t&&a.requestAnimationFrame(e)})}else{a.requestAnimationFrame(function e(){i=(i+=o)<t?t:i,u(n).css("height",i/120*100+"%"),t<i&&a.requestAnimationFrame(e)})}}};u(".preview-content").on("mouseenter touchstart",".voice",function(){var e=u(this),i=u(this).parents(".preview-item");i.attr("data-filename");return u(".preview-item .item-control-voice .voice").removeClass("active"),u(".preview-item .item-control-voice .voice").css("color","#666"),u(".preview-item .voice-control").css("display","none"),e.addClass("active"),e.css("color","#fff"),i.find(".voice-control").eq(0).css("display","block"),!1}),u(".preview-content").on("mouseleave",".preview-item",function(){var e=u(this).find(".voice");return e.css("color","#666"),e.removeClass("active"),u(this).find(".voice-control").eq(0).css("display","none"),!1});var r={volumeR2local:function(e){if(0==(i=40+e))return 0;var i=(parseInt(i)+1)*(100/41);return Math.round(i)},volumeLocal2R:function(e){if(100==e)return 0;var i=.41*(parseInt(e)+1);return i=-40+i-1,Math.round(i)}};function v(){if(0!==u("#preview .pip").length){var e=u(".preview-content .pipPreviewActive").attr("data-filename"),i=u('.preview-content [data-filename="'+e+'"]'),t=i.find(".voice-value").html();i.find("video").prop("volume",t/100),i.find("video")[0].muted=!1,i.find(".icon-erphone").addClass("active")}}return u(".erphone").on("click",".icon-erphone",function(){var e=u(this),i="";if(e.hasClass("active")&&"rgb(255, 255, 255)"==e.css("color")){e.removeClass("active"),e.css("color","#666"),u("video").prop("volume",0);for(var t=u("video"),o=0;o<t.length;o++)t[o].muted=!0}else{u(".icon-erphone").removeClass("active").css("color","#666"),e.css("color","#fff"),u("video").prop("volume",0);for(t=u("video"),o=0;o<t.length;o++)t[o].muted=!0;if(e.addClass("active"),e.parents(".erphone").hasClass("main-preview")){if(!u(".apply-preview  .radius-box").hasClass("shut")){i=u(".main-preview").attr("data-filename");var n=u('.preview-content [data-filename="'+i+'"]').find(".voice-value").html();u(".main-preview .main-player").prop("volume",1),u(".main-preview .main-player")[0].muted=!1}v()}else if(e.parents(".erphone").hasClass("main-output")){if(u(".main-output .main-player").prop("volume",1),u(".main-output .main-player")[0].muted=!1,currentRInfo.outputPreview&&0!=u(".output-source .pip").length){var a=u(".output-source .pip").attr("data-pipvideosharedmemoryname");u(".main-output .pip video").prop("volume",u(".preview-content .preview-item[data-filename='"+a+"'] .voice-value").html().trim()/100),u(".main-output .pip video")[0].muted=!1}}else{n=e.parents(".preview-item").find(".voice-value").html();e.parents(".preview-item").find("video").prop("volume",n/100),e.parents(".preview-item").find("video")[0].muted=!1}}}),{volumeColumn:e,createVoiceControl:function(e,i,t){var o=i.find(".slider-vertical");o.slider({orientation:t,range:"min",min:0,max:100,step:1,value:e,slide:function(e,i){var t=u(this).parents(".preview-item");t.find(".voice-value").html(i.value),0==i.value?t.find(".voice").removeClass("icon-voice").addClass("icon-novoice"):t.find(".voice").removeClass("icon-novoice").addClass("icon-voice");var o=t.attr("data-filename");if(u(".main-preview").attr("data-filename"),u(".main-preview").find(".icon-erphone").hasClass("active")){var n=u(this).parents(".preview-item.pipPreviewActive");0!==n.length&&n.attr("data-filename")==o&&u(this).siblings("video").prop("volume",i.value/100)}else t.find(".icon-erphone").hasClass("active")&&u(this).siblings("video").prop("volume",i.value/100)},stop:function(e,i){var t=r.volumeLocal2R(i.value),o=u(this).parents(".preview-item").attr("data-filename");initSystem.volumeControlObj.changeVolume(t,o)}});var n='<span class="voice-value">'+e+"</span>";o.find(".ui-slider-handle").html(n)},setPipVideoVolume:v,delPipVideoVolume:function(e){var i=u(".preview-content ."+e).attr("data-filename"),t=u('.preview-content [data-filename="'+i+'"]');t.find(".voice-value").html(),t.find("video").prop("volume",0),t.find(".icon-erphone").removeClass("active")},volumeConversion:r}}($,window);