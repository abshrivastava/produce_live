!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).wpjs=e()}}(function(){return function e(t,i,n){function r(a,o){if(!i[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){var i=t[a][1][e];return r(i||e)},h,h.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,i){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}function s(e,t,i){for(var n,s=[],a=t;a<i;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],s.push(r(n));return s.join("")}i.byteLength=function(e){return 3*e.length/4-n(e)},i.toByteArray=function(e){var t,i,r,s,a,l=e.length;s=n(e),a=new u(3*l/4-s),i=s>0?l-4:l;var h=0;for(t=0;t<i;t+=4)r=o[e.charCodeAt(t)]<<18|o[e.charCodeAt(t+1)]<<12|o[e.charCodeAt(t+2)]<<6|o[e.charCodeAt(t+3)],a[h++]=r>>16&255,a[h++]=r>>8&255,a[h++]=255&r;return 2===s?(r=o[e.charCodeAt(t)]<<2|o[e.charCodeAt(t+1)]>>4,a[h++]=255&r):1===s&&(r=o[e.charCodeAt(t)]<<10|o[e.charCodeAt(t+1)]<<4|o[e.charCodeAt(t+2)]>>2,a[h++]=r>>8&255,a[h++]=255&r),a},i.fromByteArray=function(e){for(var t,i=e.length,n=i%3,r="",o=[],u=0,l=i-n;u<l;u+=16383)o.push(s(e,u,u+16383>l?l:u+16383));return 1===n?(t=e[i-1],r+=a[t>>2],r+=a[t<<4&63],r+="=="):2===n&&(t=(e[i-2]<<8)+e[i-1],r+=a[t>>10],r+=a[t>>4&63],r+=a[t<<2&63],r+="="),o.push(r),o.join("")};for(var a=[],o=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,f=l.length;h<f;++h)a[h]=l[h],o[l.charCodeAt(h)]=h;o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},{}],2:[function(e,t,i){"use strict";function n(e){if(e>x)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=r.prototype,t}function r(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return o(e)}return s(e,t,i)}function s(e,t,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return O(e)?function(e,t,i){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(i||0))throw new RangeError("'length' is out of bounds");var n;n=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i);return n.__proto__=r.prototype,n}(e,t,i):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!r.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var i=0|h(e,t),s=n(i),a=s.write(e,t);a!==i&&(s=s.slice(0,a));return s}(e,t):function(e){if(r.isBuffer(e)){var t=0|l(e.length),i=n(t);return 0===i.length?i:(e.copy(i,0,0,t),i)}if(e){if(R(e)||"length"in e)return"number"!=typeof e.length||M(e.length)?n(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function o(e){return a(e),n(e<0?0:0|l(e))}function u(e){for(var t=e.length<0?0:0|l(e.length),i=n(t),r=0;r<t;r+=1)i[r]=255&e[r];return i}function l(e){if(e>=x)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x.toString(16)+" bytes");return 0|e}function h(e,t){if(r.isBuffer(e))return e.length;if(R(e)||O(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return B(e).length;default:if(n)return T(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if(i>>>=0,t>>>=0,i<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,i){var n=e.length;(!t||t<0)&&(t=0);(!i||i<0||i>n)&&(i=n);for(var r="",s=t;s<i;++s)r+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[s]);return r}(this,t,i);case"utf8":case"utf-8":return S(this,t,i);case"ascii":return function(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(127&e[r]);return n}(this,t,i);case"latin1":case"binary":return function(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(e[r]);return n}(this,t,i);case"base64":return function(e,t,i){return 0===t&&i===e.length?D.fromByteArray(e):D.fromByteArray(e.slice(t,i))}(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,i){for(var n=e.slice(t,i),r="",s=0;s<n.length;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function d(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function c(e,t,i,n,s){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,M(i)&&(i=s?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(s)return-1;i=e.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof t&&(t=r.from(t,n)),r.isBuffer(t))return 0===t.length?-1:_(e,t,i,n,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):_(e,[t],i,n,s);throw new TypeError("val must be string, number or Buffer")}function _(e,t,i,n,r){function s(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,o=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,o/=2,u/=2,i/=2}var l;if(r){var h=-1;for(l=i;l<o;l++)if(s(e,l)===s(t,-1===h?0:l-h)){if(-1===h&&(h=l),l-h+1===u)return h*a}else-1!==h&&(l-=l-h),h=-1}else for(i+u>o&&(i=o-u),l=i;l>=0;l--){for(var f=!0,d=0;d<u;d++)if(s(e,l+d)!==s(t,d)){f=!1;break}if(f)return l}return-1}function m(e,t,i,n){i=Number(i)||0;var r=e.length-i;n?(n=Number(n))>r&&(n=r):n=r;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(t.substr(2*a,2),16);if(M(o))return a;e[i+a]=o}return a}function p(e,t,i,n){return C(T(t,e.length-i),e,i,n)}function v(e,t,i,n){return C(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function g(e,t,i,n){return v(e,t,i,n)}function y(e,t,i,n){return C(B(t),e,i,n)}function b(e,t,i,n){return C(function(e,t){for(var i,n,r,s=[],a=0;a<e.length&&!((t-=2)<0);++a)i=e.charCodeAt(a),n=i>>8,r=i%256,s.push(r),s.push(n);return s}(t,e.length-i),e,i,n)}function S(e,t,i){i=Math.min(e.length,i);for(var n=[],r=t;r<i;){var s=e[r],a=null,o=s>239?4:s>223?3:s>191?2:1;if(r+o<=i){var u,l,h,f;switch(o){case 1:s<128&&(a=s);break;case 2:128==(192&(u=e[r+1]))&&(f=(31&s)<<6|63&u)>127&&(a=f);break;case 3:u=e[r+1],l=e[r+2],128==(192&u)&&128==(192&l)&&(f=(15&s)<<12|(63&u)<<6|63&l)>2047&&(f<55296||f>57343)&&(a=f);break;case 4:u=e[r+1],l=e[r+2],h=e[r+3],128==(192&u)&&128==(192&l)&&128==(192&h)&&(f=(15&s)<<18|(63&u)<<12|(63&l)<<6|63&h)>65535&&f<1114112&&(a=f)}}null===a?(a=65533,o=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),r+=o}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var i="",n=0;for(;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=I));return i}(n)}function A(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function w(e,t,i,n,s,a){if(!r.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<a)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function k(e,t,i,n,r,s){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function E(e,t,i,n,r){return t=+t,i>>>=0,r||k(e,0,i,4),U.write(e,t,i,n,23,4),i+4}function L(e,t,i,n,r){return t=+t,i>>>=0,r||k(e,0,i,8),U.write(e,t,i,n,52,8),i+8}function T(e,t){t=t||1/0;for(var i,n=e.length,r=null,s=[],a=0;a<n;++a){if((i=e.charCodeAt(a))>55295&&i<57344){if(!r){if(i>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(t-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((t-=1)<0)break;s.push(i)}else if(i<2048){if((t-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function B(e){return D.toByteArray(function(e){if((e=e.trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}function O(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function R(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function M(e){return e!=e}var D=e("base64-js"),U=e("ieee754");i.Buffer=r,i.SlowBuffer=function(e){return+e!=e&&(e=0),r.alloc(+e)},i.INSPECT_MAX_BYTES=50;var x=2147483647;i.kMaxLength=x,(r.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&r[Symbol.species]===r&&Object.defineProperty(r,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),r.poolSize=8192,r.from=function(e,t,i){return s(e,t,i)},r.prototype.__proto__=Uint8Array.prototype,r.__proto__=Uint8Array,r.alloc=function(e,t,i){return function(e,t,i){return a(e),e<=0?n(e):void 0!==t?"string"==typeof i?n(e).fill(t,i):n(e).fill(t):n(e)}(e,t,i)},r.allocUnsafe=function(e){return o(e)},r.allocUnsafeSlow=function(e){return o(e)},r.isBuffer=function(e){return null!=e&&!0===e._isBuffer},r.compare=function(e,t){if(!r.isBuffer(e)||!r.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,s=0,a=Math.min(i,n);s<a;++s)if(e[s]!==t[s]){i=e[s],n=t[s];break}return i<n?-1:n<i?1:0},r.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return r.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=r.allocUnsafe(t),s=0;for(i=0;i<e.length;++i){var a=e[i];if(!r.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,s),s+=a.length}return n},r.byteLength=h,r.prototype._isBuffer=!0,r.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},r.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},r.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},r.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):f.apply(this,arguments)},r.prototype.equals=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===r.compare(this,e)},r.prototype.inspect=function(){var e="",t=i.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},r.prototype.compare=function(e,t,i,n,s){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||i>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=i)return 0;if(n>=s)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,n>>>=0,s>>>=0,this===e)return 0;for(var a=s-n,o=i-t,u=Math.min(a,o),l=this.slice(n,s),h=e.slice(t,i),f=0;f<u;++f)if(l[f]!==h[f]){a=l[f],o=h[f];break}return a<o?-1:o<a?1:0},r.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},r.prototype.indexOf=function(e,t,i){return c(this,e,t,i,!0)},r.prototype.lastIndexOf=function(e,t,i){return c(this,e,t,i,!1)},r.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-t;if((void 0===i||i>r)&&(i=r),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return m(this,e,t,i);case"utf8":case"utf-8":return p(this,e,t,i);case"ascii":return v(this,e,t,i);case"latin1":case"binary":return g(this,e,t,i);case"base64":return y(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;r.prototype.slice=function(e,t){var i=this.length;e=~~e,t=void 0===t?i:~~t,e<0?(e+=i)<0&&(e=0):e>i&&(e=i),t<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=r.prototype,n},r.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var n=this[e],r=1,s=0;++s<t&&(r*=256);)n+=this[e+s]*r;return n},r.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var n=this[e+--t],r=1;t>0&&(r*=256);)n+=this[e+--t]*r;return n},r.prototype.readUInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),this[e]},r.prototype.readUInt16LE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]|this[e+1]<<8},r.prototype.readUInt16BE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]<<8|this[e+1]},r.prototype.readUInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},r.prototype.readUInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},r.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var n=this[e],r=1,s=0;++s<t&&(r*=256);)n+=this[e+s]*r;return r*=128,n>=r&&(n-=Math.pow(2,8*t)),n},r.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||A(e,t,this.length);for(var n=t,r=1,s=this[e+--n];n>0&&(r*=256);)s+=this[e+--n]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*t)),s},r.prototype.readInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},r.prototype.readInt16LE=function(e,t){e>>>=0,t||A(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},r.prototype.readInt16BE=function(e,t){e>>>=0,t||A(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},r.prototype.readInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},r.prototype.readInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},r.prototype.readFloatLE=function(e,t){return e>>>=0,t||A(e,4,this.length),U.read(this,e,!0,23,4)},r.prototype.readFloatBE=function(e,t){return e>>>=0,t||A(e,4,this.length),U.read(this,e,!1,23,4)},r.prototype.readDoubleLE=function(e,t){return e>>>=0,t||A(e,8,this.length),U.read(this,e,!0,52,8)},r.prototype.readDoubleBE=function(e,t){return e>>>=0,t||A(e,8,this.length),U.read(this,e,!1,52,8)},r.prototype.writeUIntLE=function(e,t,i,n){if(e=+e,t>>>=0,i>>>=0,!n){w(this,e,t,i,Math.pow(2,8*i)-1,0)}var r=1,s=0;for(this[t]=255&e;++s<i&&(r*=256);)this[t+s]=e/r&255;return t+i},r.prototype.writeUIntBE=function(e,t,i,n){if(e=+e,t>>>=0,i>>>=0,!n){w(this,e,t,i,Math.pow(2,8*i)-1,0)}var r=i-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+i},r.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,1,255,0),this[t]=255&e,t+1},r.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},r.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*i-1);w(this,e,t,i,r-1,-r)}var s=0,a=1,o=0;for(this[t]=255&e;++s<i&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+i},r.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*i-1);w(this,e,t,i,r-1,-r)}var s=i-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+i},r.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},r.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},r.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||w(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeFloatLE=function(e,t,i){return E(this,e,t,!0,i)},r.prototype.writeFloatBE=function(e,t,i){return E(this,e,t,!1,i)},r.prototype.writeDoubleLE=function(e,t,i){return L(this,e,t,!0,i)},r.prototype.writeDoubleBE=function(e,t,i){return L(this,e,t,!1,i)},r.prototype.copy=function(e,t,i,n){if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var r,s=n-i;if(this===e&&i<t&&t<n)for(r=s-1;r>=0;--r)e[r+t]=this[r+i];else if(s<1e3)for(r=0;r<s;++r)e[r+t]=this[r+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+s),t);return s},r.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!r.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0);var a;if("number"==typeof e)for(a=t;a<i;++a)this[a]=e;else{var o=r.isBuffer(e)?e:new r(e,n),u=o.length;for(a=0;a<i-t;++a)this[a+t]=o[a%u]}return this};var P=/[^+/0-9A-Za-z-_]/g},{"base64-js":1,ieee754:4}],3:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,o,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(i=this._events[e],a(i))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(s(i))for(o=Array.prototype.slice.call(arguments,1),n=(l=i.slice()).length,u=0;u<n;u++)l[u].apply(this,o);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var i,n,a,o;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],a=i.length,n=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(i)){for(o=a;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){n=o;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],r(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],4:[function(e,t,i){i.read=function(e,t,i,n,r){var s,a,o=8*r-n-1,u=(1<<o)-1,l=u>>1,h=-7,f=i?r-1:0,d=i?-1:1,c=e[t+f];for(f+=d,s=c&(1<<-h)-1,c>>=-h,h+=o;h>0;s=256*s+e[t+f],f+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+f],f+=d,h-=8);if(0===s)s=1-l;else{if(s===u)return a?NaN:1/0*(c?-1:1);a+=Math.pow(2,n),s-=l}return(c?-1:1)*a*Math.pow(2,s-n)},i.write=function(e,t,i,n,r,s){var a,o,u,l=8*s-r-1,h=(1<<l)-1,f=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,c=n?0:s-1,_=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=h?(o=0,a=h):a+f>=1?(o=(t*u-1)*Math.pow(2,r),a+=f):(o=t*Math.pow(2,f-1)*Math.pow(2,r),a=0));r>=8;e[i+c]=255&o,c+=_,o/=256,r-=8);for(a=a<<r|o,l+=r;l>0;e[i+c]=255&a,c+=_,a/=256,l-=8);e[i+c-_]|=128*m}},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(e("events")),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._emitter=new r.default}return n(e,[{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"appendVideoSample",value:function(e){var t=this._videoTrack;t.samples.push(e),t.length+=e.length,this._onSample(this._audioTrack,t)}},{key:"appendAudioSample",value:function(e){var t=this._audioTrack;t.samples.push(e),t.length+=e.length,this._onSample(t,this._videoTrack)}},{key:"onSample",get:function(){return this._onSample},set:function(e){this._onSample=e}}]),e}();i.default=s},{events:3}],6:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i.MediaInfo=function(){function e(){n(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return r(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}}},{key:"_search",value:function(e,t){var i=0,n=e.length-1,r=0,s=0,a=n;for(t<e[0]&&(i=0,s=a+1);s<=a;){if((r=s+Math.floor((a-s)/2))===n||t>=e[r]&&t<e[r+1]){i=r;break}e[r]<t?s=r+1:a=r-1}return i}}]),e}(),i.SampleInfo=function e(t,i,r,s,a){n(this,e),this.dts=t,this.pts=i,this.duration=r,this.originalDts=s,this.isSyncPoint=a,this.fileposition=null},i.MediaSegmentInfo=function(){function e(){n(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return r(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),i.IDRSampleList=function(){function e(){n(this,e),this._list=[]}return r(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,i=0,n=t.length-1,r=0,s=0,a=n;for(e<t[0].dts&&(i=0,s=a+1);s<=a;){if((r=s+Math.floor((a-s)/2))===n||e>=t[r].dts&&e<t[r+1].dts){i=r;break}t[r].dts<e?s=r+1:a=r-1}return this._list[i]}}]),e}(),i.MediaSegmentInfoList=function(){function e(t){n(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return r(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,n=0,r=0,s=i,a=0;if(e<t[0].originalBeginDts)return a=-1;for(;r<=s;){if((n=r+Math.floor((s-r)/2))===i||e>t[n].lastSample.originalDts&&e<t[n+1].originalBeginDts){a=n;break}t[n].originalBeginDts<e?r=n+1:s=n-1}return a}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=e,n=this._lastAppendLocation,r=0;-1!==n&&n<t.length&&i.originalBeginDts>=t[n].lastSample.originalDts&&(n===t.length-1||n<t.length-1&&i.originalBeginDts<t[n+1].originalBeginDts)?r=n+1:t.length>0&&(r=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,i)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].syncPoints;0===i.length&&t>0;)t--,i=this._list[t].syncPoints;return i.length>0?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()},{}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=n(e("events")),a=e("../../utils/logger"),o=e("../media-info"),u=n(e("../../utils/timer")),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="MSEController",this._config=t,this._emitter=new s.default,this._config.isLive&&void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._systemTime=0,this._videoStartTime=0,this._played=!1,this._autoplayed=!1,this._delay=void 0!==this._config.preDelay?Number(this._config.preDelay):0,this._oldDelay=this._delay,this._newDelay=Number.NEGATIVE_INFINITY,this._delayIncre=!1,this._currentTime=0,this._bufferEnd=0,this._timer=null,this._timerAcc=void 0!==this._config.timerAcc?Number(this._config.timerAcc):1,this._presetRTO=!1,this._maxTimestampOffset=1.5,this._minTimestampOffset=.7,this._origTimestampOffset=0,this._refTimestampOffset=0,this._determinedTO=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new o.IDRSampleList}return r(e,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)console.error("IllegalStateException: MSE Controller: MediaSource has been attached to an HTMLMediaElement!");else{var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var i=this._pendingSegments[t];i.splice(0,i.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var n=this._sourceBuffers[t];n&&("closed"!==e.readyState&&(e.removeSourceBuffer(n),n.removeEventListener("error",this.e.onSourceBufferError),n.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)),this._mimeTypes[t]=null,this._sourceBuffers[t]=null)}if("open"===e.readyState)try{e.endOfStream()}catch(e){a.Log.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(a.Log.i(this.TAG,"Append Initialization segment"),!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var i=e,n=""+i.container;i.codec&&i.codec.length>0&&(n+=";codecs="+i.codec);var r=!1;if(a.Log.v(this.TAG,"Received Initialzation Segment, mimeType: "+n),this._lastInitSegments[i.type]=i,n!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])a.Log.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+n);else{r=!0;try{var s=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(n);s.addEventListener("error",this.e.onSourceBufferError),s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return a.Log.e(this.TAG,e.message),void this._emitter.emit("error",{code:e.code,msg:e.message})}}this._mimeTypes[i.type]=n}t||this._pendingSegments[i.type].push(i),r||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments()}},{key:"appendMediaSegment",value:function(e){var t=this,i=e;this._pendingSegments[i.type].push(i);var n=this._mediaElement.currentTime,r=0,s=-1;if(this._sourceBuffers[i.type].buffered.length>0&&this._config.isLive){if(this._mediaElement.readyState>=2&&this._mediaElement.paused&&null===this._timer&&!this._autoplayed){var o=this._mediaElement.play();void 0!==o&&o.then(function(e){t._autoplayed=!0,console.log("Video start.")}).catch(function(e){console.warn("Try to play later.")}),this._determinedTO||this._presetRTO||(this._systemTime=Date.now(),this._videoStartTime=n,a.Log.v(this.TAG,"Video should start at "+this._systemTime+" and current position is "+this._videoStartTime),this._refTimestampOffset=this._origTimestampOffset,a.Log.v(this.TAG,"The original delay should be "+1e3*this._origTimestampOffset+"ms"),this._refTimestampOffset<this._minTimestampOffset?this._refTimestampOffset=this._minTimestampOffset:this._refTimestampOffset>this._maxTimestampOffset&&(this._refTimestampOffset=this._maxTimestampOffset),this._determinedTO=!0,this._refTimestampOffset+=this._delay/1e3,a.Log.v(this.TAG,"The reference timeoffset should be "+1e3*this._refTimestampOffset+"ms, preset delay is "+this._delay+"ms"))}0!==n||this._played?this._determinedTO||this._presetRTO||(this._systemTime=Date.now(),this._videoStartTime=n,a.Log.v(this.TAG,"Video start at "+this._systemTime+" and current position is "+this._videoStartTime),this._refTimestampOffset=this._origTimestampOffset,a.Log.v(this.TAG,"The original delay is "+1e3*this._origTimestampOffset+"ms"),this._refTimestampOffset<this._minTimestampOffset?this._refTimestampOffset=this._minTimestampOffset:this._refTimestampOffset>this._maxTimestampOffset&&(this._refTimestampOffset=this._maxTimestampOffset),this._determinedTO=!0,this._refTimestampOffset+=this._delay/1e3,a.Log.v(this.TAG,"The reference timeoffset is "+1e3*this._refTimestampOffset+"ms, preset delay is "+this._delay+"ms")):this._origTimestampOffset=this._sourceBuffers[i.type].buffered.end(0),s=Date.now(),!this._delay||this._played||this._delayIncre||this._sourceBuffers[i.type].buffered.end(0)<this._refTimestampOffset&&(this._mediaElement.pause(),this._timer=new u.default(this._delay,this._timerAcc),this._timer.timeup=this._elementResume.bind(this),this._played=!0,this._timer.start(s)),r=this._sourceBuffers[i.type].buffered.end(0)-n,s-this._systemTime+1e3*(this._videoStartTime-this._refTimestampOffset)>1e3*n+200&&r>this._refTimestampOffset+.1&&0!==this._refTimestampOffset&&!this._delayIncre&&(this._mediaElement.currentTime=(s-this._systemTime-this._delay)/1e3+this._videoStartTime,a.Log.w(this.TAG,"buffer end at "+this._sourceBuffers[i.type].buffered.end(0)+", ref is "+this._refTimestampOffset+", change current time to "+this._mediaElement.currentTime),a.Log.w(this.TAG,"Change current time to "+this._mediaElement.currentTime))}this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var l=this._sourceBuffers[i.type];!l||l.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"changeDelay",value:function(e){var t=this._mediaElement.currentTime,i=0,n=void 0,r=(this._sourceBuffers,void 0);this._delay>e?(i=t+this._delay/1e3-e/1e3,n=1e3*this._refTimestampOffset-Number(this._delay)+Number(e),a.Log.v(this.TAG,"Change delay from "+this._delay+"s to "+e+"s"),a.Log.v(this.TAG,"Change reference timesoffset from "+1e3*this._refTimestampOffset+"ms to "+n+"ms"),this._refTimestampOffset=n/1e3,this._mediaElement.currentTime=i,a.Log.w(this.TAG,"Jump from "+t+"s to "+i+"s"),this._delay=e):(this._delayIncre=!0,this._mediaElement.pause(),r=Date.now(),this._oldDelay=this._delay,this._newDelay=e,this._timer=new u.default(this._newDelay-this._oldDelay,this._timerAcc),this._timer.timeup=this._elementResume.bind(this),a.Log.v(this.TAG,"Change delay from "+this._delay+"ms to "+this._newDelay+"ms"),this._delay=e,n=this._refTimestampOffset-this._oldDelay/1e3+this._newDelay/1e3,a.Log.w(this.TAG,"Change reference timeoffset from "+1e3*this._refTimestampOffset+"ms to "+1e3*n+"ms"),this._refTimestampOffset=n,this._timer.start(r,t))}},{key:"changeRefTSOffset",value:function(e){this._presetRTO=!0,e<this._minTimestampOffset?this._refTimestampOffset=this._delay/1e3+this._minTimestampOffset:this._refTimestampOffset=this._delay/1e3+e,this._systemTime=Date.now(),this._videoStartTime=e,a.Log.v(this.TAG,"Video start at "+this._systemTime+" and current position is "+this._videoStartTime),a.Log.v(this.TAG,"The original delay is "+1e3*this._origTimestampOffset+"ms"),a.Log.v(this.TAG,"The reference timeoffset is "+1e3*this._refTimestampOffset+"ms, preset delay is "+this._delay+"ms")}},{key:"seek",value:function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var i=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{i.abort()}catch(e){a.Log.e(this.TAG,e.message)}this._idrList.clear();var n=this._pendingSegments[t];if(n.splice(0,n.length),"closed"!==this._mediaSource.readyState){for(var r=0;r<i.buffered.length;r++){var s=i.buffered.start(r),o=i.buffered.end(r);this._pendingRemoveRanges[t].push({start:s,end:o})}i.updating||this._doRemoveRanges()}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_elementResume",value:function(){this._mediaElement.play(),this._timer&&(this._timer.stop(),this._timer=null),this._delayIncre=!1}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){var n=i.buffered;if(n.length>=1&&e-n.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){for(var n=i.buffered,r=!1,s=0;s<n.length;s++){var a=n.start(s),o=n.end(s);if(a<=e&&e<o+3){if(e-a>=this._config.autoCleanupMaxBackwardDuration){r=!0;var u=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:a,end:u})}}else o<e&&(r=!0,this._pendingRemoveRanges[t].push({start:a,end:o}))}r&&!i.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(t)||i>t)&&(a.Log.v(this.TAG,"Update MediaSource duration from "+t+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],i=this._pendingRemoveRanges[e];i.length&&!t.updating;){var n=i.shift();t.remove(n.start,n.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var i=e[t].shift();if(i.timestampOffset){var n=this._sourceBuffers[t].timestampOffset,r=i.timestampOffset/1e3;Math.abs(n-r)>.1&&(a.Log.v(this.TAG,"Update MPEG audio timestampOffset from "+n+" to "+r),this._sourceBuffers[t].timestampOffset=r),delete i.timestampOffset}if(!i.data||0===i.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(i.data),this._isBufferFull=!1,"video"===t&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(i),22===e.code?(this._isBufferFull||this._emitter.emit("buffer_full"),this._isBufferFull=!0):(a.Log.e(this.TAG,e.message),this._emitter.emit("error",{code:e.code,msg:e.message}))}}}},{key:"_onSourceOpen",value:function(){if(a.Log.i(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit("source_open")}},{key:"_onSourceEnded",value:function(){a.Log.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){a.Log.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit("update_end")}},{key:"_onSourceBufferError",value:function(e){a.Log.e(this.TAG,"SourceBuffer Error: "+e)}}]),e}();i.default=l},{"../../utils/logger":23,"../../utils/timer":24,"../media-info":6,events:3}],8:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=n(e("events")),o=e("../utils/logger"),u=n(e("./mse/mse-controller")),l=n(e("./buffer-controller")),h=n(e("../muxer/mp4-muxer/mp4-muxer")),f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="WebPlayer",this._type="WebPlayer",this._emitter=new a.default,this._config={enableStashBuffer:!0,stashInitialSize:void 0,lazyLoad:!0,lazyLoadMaxDuration:60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:20,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,accSlient:!1},"object"===(void 0===t?"undefined":r(t))&&Object.assign(this._config,t),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaElement=null,this._msectl=null,this._muxer=null,this._bufferController=null,this._delay=void 0!==this._config.preDelay?this._config.preDelay:0,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null,this._alwaysSeekKeyframe=!1}return s(e,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._mediaElement&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"appendVideoSample",value:function(e){this._bufferController.appendVideoSample(e)}},{key:"appendAudioSample",value:function(e){this._bufferController.appendAudioSample(e)}},{key:"init",value:function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new u.default(this._config),this._msectl.on("update_end",this._onmseUpdateEnd.bind(this)),this._msectl.on("buffer_full",this._onmseBufferFull.bind(this)),this._msectl.on("source_open",function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())}),this._msectl.on("error",function(e){t._emitter.emit("error","MediaError","MediaMSEError",e)}),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}this._mediaElement,this._hasPendingLoad||(this._bufferController=new l.default,this._muxer=new h.default(this._config),this._bufferController.on("init_segment",function(e,i){t._msectl.appendInitSegment(i)}),this._bufferController.on("media_segment",function(e,i){t._msectl.appendMediaSegment(i)}),this._bufferController.onSample=this._muxer.mux.bind(this._muxer),this._muxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this._bufferController),this._muxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this._bufferController))}},{key:"reset",value:function(e){this.detachMediaElement(),this.init(e)}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var e=this;this._mediaElement,this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._bufferController=new l.default,this._muxer=new h.default(this._config),this._bufferController.on("init_segment",function(t,i){e._msectl.appendInitSegment(i)}),this._bufferController.on("media_segment",function(t,i){e._msectl.appendMediaSegment(i)}),this._bufferController.onSample=this._muxer.remux.bind(this._muxer),this._muxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._muxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)))}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"changeDelay",value:function(e){this._msectl.changeDelay(Number(e))}},{key:"onMetadataReceived",value:function(e,t){this._muxer._onMetadataReceived(e,t)}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();i=r.totalVideoFrames,n=r.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=n),e}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,i=0,n=0;n<e.length;n++){var r=e.start(n),s=e.end(n);if(r<=t&&t<s){r,i=s;break}}i>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&o.Log.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task")}}},{key:"_onmseBufferFull",value:function(){o.Log.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._mediaElement.paused&&this._mediaElement.play()}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,i=!1,n=0;n<t.length;n++){var r=t.start(n),s=t.end(n);if(e>=r&&e<s){e>=s-this._config.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this._progressChecker),this._progressChecker=null,i&&o.Log.v(this.TAG,"Continue loading from paused position"))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(e>=n&&e<r)return!0}return!1}},{key:"_internalSeek",value:function(e){var t=this._isTimepointBuffered(e),i=!1,n=0;if(e<1&&this._mediaElement.buffered.length>0){var r=this._mediaElement.buffered.start(0);r<1&&e<r&&(i=!0,n=r)}if(i)this._requestSetTime=!0,this._mediaElement.currentTime=n;else if(t){if(this._alwaysSeekKeyframe){var s=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=s?s.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var i=t.buffered;i.length>0&&t.currentTime<i.start(0)&&(o.Log.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+i.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=i.start(0),this._msectl.changeRefTSOffset(i.start(0)),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,i=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&i.length>0){var n=i.start(0);if(n<1&&t<n)return this._requestSetTime=!0,void(this._mediaElement.currentTime=n)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var r=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=r&&(this._requestSetTime=!0,this._mediaElement.currentTime=r.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}}},{key:"_onvCanPlay",value:function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit("init_segment",e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){null==this._pendingSeekTime&&this._emitter.emit("media_segment",e,t)}},{key:"dtsBase",get:function(){return this._muxer.dtsBase}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),e}();i.default=f},{"../muxer/mp4-muxer/mp4-muxer":18,"../utils/logger":23,"./buffer-controller":5,"./mse/mse-controller":7,events:3}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return n(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var n=e-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(n,this._current_word_bits_left),s=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,i=i<<r|s}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();i.default=r},{}],10:[function(e,t,i){(function(t){"use strict";function n(e,i,n){return new t(e.buffer,i,n).toString("ascii")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("../../utils/logger"),a=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"parseScriptData",value:function(t,i,n){var r={};try{var a=e.parseValue(t,i,n),o=e.parseValue(t,i+a.size,n-a.size);r[a.data]=o.data}catch(e){s.Log.e("AMF",e.toString())}return r}},{key:"parseObject",value:function(t,i,n){n<3&&s.Log.w("AMF","Data not enough when parse ScriptDataObject");var r=e.parseString(t,i,n),a=e.parseValue(t,i+r.size,n-r.size),o=a.objectEnd;return{data:{name:r.data,value:a.data},size:r.size+a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,i,n){return e.parseObject(t,i,n)}},{key:"parseString",value:function(e,t,i){i<2&&s.Log.w("AMF","Data not enough when parse String");var r=new DataView(e,t,i),o=r.getUint16(0,!a),u=void 0;return u=o>0?n(r,t+2,o):"",{data:u,size:2+o}}},{key:"parseLongString",value:function(e,t,i){i<4&&s.Log.w("AMF","Data not enough when parse LongString");var r=new DataView(e,t,i),o=r.getUint32(0,!a),u=void 0;return u=o>0?n(r,t+4,o):"",{data:u,size:4+o}}},{key:"parseDate",value:function(e,t,i){i<10&&s.Log.w("AMF","Data size invalid when parse Date");var n=new DataView(e,t,i),r=n.getFloat64(0,!a);return r+=60*n.getInt16(8,!a)*1e3,{data:new Date(r),size:10}}},{key:"parseValue",value:function(t,i,n){n<1&&s.Log.w("AMF","Data not enough when parse Value");var r=new DataView(t,i,n),o=1,u=r.getUint8(0),l=void 0,h=!1;try{switch(u){case 0:l=r.getFloat64(1,!a),o+=8;break;case 1:l=!!r.getUint8(1),o+=1;break;case 2:var f=e.parseString(t,i+1,n-1);l=f.data,o+=f.size;break;case 3:l={};var d=0;for(9==(16777215&r.getUint32(n-4,!a))&&(d=3);o<n-4;){var c=e.parseObject(t,i+o,n-o-d);if(c.objectEnd)break;l[c.data.name]=c.data.value,o+=c.size}if(o<=n-3){9===(16777215&r.getUint32(o-1,!a))&&(o+=3)}break;case 8:l={},o+=4;var _=0;for(9==(16777215&r.getUint32(n-4,!a))&&(_=3);o<n-8;){var m=e.parseVariable(t,i+o,n-o-_);if(m.objectEnd)break;l[m.data.name]=m.data.value,o+=m.size}if(o<=n-3){9===(16777215&r.getUint32(o-1,!a))&&(o+=3)}break;case 9:l=void 0,o=1,h=!0;break;case 10:l=[];var p=r.getUint32(1,!a);o+=4;for(var v=0;v<p;v++){var g=e.parseValue(t,i+o,n-o);l.push(g.data),o+=g.size}break;case 11:var y=e.parseDate(t,i+1,n-1);l=y.data,o+=y.size;break;case 12:var b=e.parseString(t,i+1,n-1);l=b.data,o+=b.size;break;default:o=n,s.Log.w("AMF","Unsupported AMF value type "+u)}}catch(e){s.Log.e("AMF",e.toString())}return{data:l,size:o,objectEnd:h}}}]),e}();i.default=o}).call(this,e("buffer").Buffer)},{"../../utils/logger":23,buffer:2}],11:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=n(e("events")),o=e("../../utils/logger"),u=n(e("./amf-parser.js")),l=n(e("../sps-parser.js")),h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="FLVDemuxer",this._emitter=new a.default,this._onError=null,this._onMetadataArrived=null,this._onVideoSampleArrived=null,this._onAudioSampleArrived=null,this._firstParse=!0,this._dispatch=!1,this._firstIframe=!1,this._hasAudio=t.dataOffset,this._hasVideo=t.dataOffset,this._dataOffset=t.dataOffset,this._audioMetadata=null,this._videoMetadata=null,this._stashedAudioSample=null,this._stashedVideoSample=null,this._lastValidAudioDts=null,this._lastValidVideoDts=null,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._naluLengthSize=4,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return s(e,[{key:"destroy",value:function(){this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMetadataArrived=null,this._onVideoSampleArrived=null,this._onAudioSampleArrived=null}},{key:"parseChunks",value:function(e,t){var i=0,n=this._littleEndian;if(this._firstParse){this._firstParse=!1,i=this._dataOffset;0!==new DataView(e,i).getUint32(0,!n)&&o.Log.e(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4}if(e.byteLength===t){for(;i<t;){this._dispatch=!0;var r=new DataView(e,i);if(i+11+4>t)break;var s=r.getUint8(0),a=16777215&r.getUint32(0,!n);if(i+11+a+4>t)break;if(8===s||9===s||18===s){var u=r.getUint8(4),l=r.getUint8(5),h=r.getUint8(6)|l<<8|u<<16|r.getUint8(7)<<24;0!==(16777215&r.getUint32(7,!n))&&o.Log.w(this.TAG,"Meet tag which has StreamID != 0!");var f=i+11;switch(s){case 8:this._parseAudioData(e,f,a,h);break;case 9:this._parseVideoData(e,f,a,h,0);break;case 18:this._parseScriptData(e,f,a)}var d=r.getUint32(11+a,!n);d!==11+a&&o.Log.w(this.TAG,"Invalid PrevTagSize "+d),i+=11+a+4}else o.Log.e(this.TAG,"Unsupported tag type "+s+", skipped"),i+=11+a+4}return i}o.Log.e(this.TAG,"Invalid chunk length")}},{key:"_parseScriptData",value:function(e,t,i){var n=u.default.parseScriptData(e,t,i);if(n.hasOwnProperty("onMetaData")){if(null==n.onMetaData||"object"!==r(n.onMetaData))return;this._metadata,this._metadata=n;var s=this._metadata.onMetaData;if("boolean"==typeof s.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=s.hasAudio),"boolean"==typeof s.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=s.hasVideo),"number"==typeof s.duration&&!this._durationOverrided){var a=Math.floor(s.duration*this._timescale);this._duration=a}if("number"==typeof s.framerate){var l=Math.floor(1e3*s.framerate);if(l>0){var h=l/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=h,this._referenceFrameRate.fps_num=l,this._referenceFrameRate.fps_den=1e3}}if("object"===r(s.keyframes)){s.keyframes;s.keyframes=null}this._dispatch=!1,o.Log.v(this.TAG,"Parsed onMetaData")}}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],i=[],n=1;n<e.times.length;n++){var r=this._timestampBase+Math.floor(1e3*e.times[n]);t.push(r),i.push(e.filepositions[n])}return{times:t,filepositions:i}}},{key:"_parseAudioData",value:function(e,t,i,n){if(i<=1)o.Log.w(this.TAG,"Invalid audio packet, missing SoundData payload!");else{this._littleEndian;var r=new DataView(e,t,i).getUint8(0),s=r>>>4;if(2===s||10===s){var a=0,u=(12&r)>>>2;if(u>=0&&u<=4){a=this._flvSoundRateTable[u];var l=1&r,h=this._audioMetadata,f=this._audioTrack;if(h||((h=this._audioMetadata={}).type="audio",h.id=f.id,h.timescale=this._timescale,h.duration=this._duration,h.audioSampleRate=a,h.channelCount=0===l?1:2),10===s){var d=this._parseAACAudioData(e,t+1,i-1);if(void 0==d)return;if(0===d.packetType){h.config&&o.Log.w(this.TAG,"Found another AudioSpecificConfig!");var c=d.data;h.audioSampleRate=c.samplingRate,h.channelCount=c.channelCount,h.codec=c.codec,h.originalCodec=c.originalCodec,h.config=c.config,h.refSampleDuration=1024/h.audioSampleRate*h.timescale,o.Log.v(this.TAG,"Parsed AudioSpecificConfig"),this._dispatch=!1,this._onMetadataArrived("audio",h)}else if(1===d.packetType){var _=this._timestampBase+n,m={unit:d.data,dts:_,pts:_,length:d.data.length};this._stashAudioSample(m)}else o.Log.e(this.TAG,"Unsupported AAC data type "+d.packetType)}else if(2===s){if(!h.codec){var p=this._parseMP3AudioData(e,t+1,i-1,!0);if(void 0==p)return;h.audioSampleRate=p.samplingRate,h.channelCount=p.channelCount,h.codec=p.codec,h.originalCodec=p.originalCodec,h.refSampleDuration=1152/h.audioSampleRate*h.timescale,console.log("Parsed MPEG Audio Frame Header"),this._onMetadataArrived("audio",h)}var v=this._parseMP3AudioData(e,t+1,i-1,!1);if(void 0==v)return;var g=this._timestampBase+n,y={unit:v,dts:g,pts:g,length:v.length};this._stashAudioSample(y)}}else console.error("FORMAT_ERROR: Flv: Invalid audio sample rate idx: "+u)}else console.error("CODEC_UNSUPPORTED: Flv: Unsupported audio codec idx: "+s)}}},{key:"_stashAudioSample",value:function(e){if(null!==this._stashedAudioSample){var t=this._stashedAudioSample,i=e.dts-t.dts;i>0&&(t.duration=i),this._firstIframe&&this._onAudioSampleArrived(t),this._stashedAudioSample=e}else this._stashedAudioSample=e}},{key:"_parseAACAudioData",value:function(e,t,i){if(!(i<=1)){var n={},r=new Uint8Array(e,t,i);return n.packetType=r[0],0===r[0]?n.data=this._parseAACAudioSpecificConfig(e,t+1,i-1):n.data=r.subarray(1),n}o.Log.w(this.TAG,"Invalid AAC packet, missing AACPacketType or/and Data!")}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,i){var n=new Uint8Array(e,t,i),r=null,s=0,a=0,o=0,u=null;if(s=a=n[0]>>>3,(o=(7&n[0])<<1|n[1]>>>7)<0||o>=this._mpegSamplingRates.length)console.error("FORMAT_ERROR: Flv: AAC invalid sampling frequency index!");else{var l=this._mpegSamplingRates[o],h=(120&n[1])>>>3;if(!(h<0||h>=8))return 5===s&&(u=(7&n[1])<<1|n[2]>>>7,(124&n[2])>>>2),s=5,u=o,r=new Array(4),o>=6?u=o-3:1===h&&(s=2,r=new Array(2),u=o),r[0]=s<<3,r[0]|=(15&o)>>>1,r[1]=(15&o)<<7,r[1]|=(15&h)<<3,5===s&&(r[1]|=(15&u)>>>1,r[2]=(1&u)<<7,r[2]|=8,r[3]=0),{config:r,samplingRate:l,channelCount:h,codec:"mp4a.40."+s,originalCodec:"mp4a.40."+a};console.error("FORMAT_ERROR: Flv: AAC invalid channel configuration")}}},{key:"_parseMP3AudioData",value:function(e,t,i,n){if(!(i<4)){this._littleEndian;var r=new Uint8Array(e,t,i),s=null;if(n){if(255!==r[0])return;var a=r[1]>>>3&3,u=(6&r[1])>>1,l=(240&r[2])>>>4,h=(12&r[2])>>>2,f=3!==(r[3]>>>6&3)?2:1,d=0,c=0;switch(a){case 0:d=this._mpegAudioV25SampleRateTable[h];break;case 2:d=this._mpegAudioV20SampleRateTable[h];break;case 3:d=this._mpegAudioV10SampleRateTable[h]}switch(u){case 1:34,l<this._mpegAudioL3BitRateTable.length&&(c=this._mpegAudioL3BitRateTable[l]);break;case 2:33,l<this._mpegAudioL2BitRateTable.length&&(c=this._mpegAudioL2BitRateTable[l]);break;case 3:32,l<this._mpegAudioL1BitRateTable.length&&(c=this._mpegAudioL1BitRateTable[l])}s={bitRate:c,samplingRate:d,channelCount:f,codec:"mp3",originalCodec:"mp3"}}else s=r;return s}o.Log.w(this.TAG,"Invalid MP3 packet, header missing!")}},{key:"_parseVideoData",value:function(e,t,i,n,r){if(i<=1)o.Log.w(this.TAG,"Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var s=new Uint8Array(e,t,i)[0],a=(240&s)>>>4,u=15&s;7===u?this._parseAVCVideoPacket(e,t+1,i-1,n,r,a):console.error("CODEC_UNSUPPORTED: Flv: Unsupported codec in video frame: "+u)}}},{key:"_parseAVCVideoPacket",value:function(e,t,i,n,r,s){if(i<4)o.Log.w(this.TAG,"Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var a=this._littleEndian,u=new DataView(e,t,i),l=u.getUint8(0),h=(16777215&u.getUint32(0,!a))<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===l)this._parseAVCVideoData(e,t+4,i-4,n,r,s,h);else if(2!==l)return void console.warn("FORMAT_ERROR: Flv: Invalid video packet type "+l)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,i){if(i<7)o.Log.w(this.TAG,"Invalid AVCDecoderConfigurationRecord, lack of data!");else{var n=this._videoMetadata,r=this._videoTrack,s=this._littleEndian,a=new DataView(e,t,i);n?void 0!==n.avcc&&o.Log.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):((n=this._videoMetadata={}).type="video",n.id=r.id,n.timescale=this._timescale,n.duration=this._duration);var u=a.getUint8(0),h=a.getUint8(1);a.getUint8(2),a.getUint8(3);if(1===u&&0!==h)if(this._naluLengthSize=1+(3&a.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var f=31&a.getUint8(5);if(0!==f){f>1&&o.Log.w(this.TAG,"Strange AVCDecoderConfigurationRecord: SPS Count = "+f);for(var d=6,c=0;c<f;c++){var _=a.getUint16(d,!s);if(d+=2,0!==_){var m=new Uint8Array(e,t+d,_);d+=_;var p=l.default.parseSPS(m);if(0===c){n.codecWidth=p.codec_size.width,n.codecHeight=p.codec_size.height,n.presentWidth=p.present_size.width,n.presentHeight=p.present_size.height,n.profile=p.profile_string,n.level=p.level_string,n.bitDepth=p.bit_depth,n.chromaFormat=p.chroma_format,n.sarRatio=p.sar_ratio,n.frameRate=p.frame_rate,!1!==p.frame_rate.fixed&&0!==p.frame_rate.fps_num&&0!==p.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var v=n.frameRate.fps_den,g=n.frameRate.fps_num;n.refSampleDuration=n.timescale*(v/g);for(var y=m.subarray(1,4),b="avc1.",S=0;S<3;S++){var A=y[S].toString(16);A.length<2&&(A="0"+A),b+=A}n.codec=b}}}var w=a.getUint8(d++);if(0!==w){w>1&&o.Log.w(this.TAG,"Strange AVCDecoderConfigurationRecord: PPS Count = "+w);for(var k=0;k<w;k++){var E=a.getUint16(d,!s);d+=2,0!==E&&(d+=E)}n.avcc=new Uint8Array(i),n.avcc.set(new Uint8Array(e,t,i),0),o.Log.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._dispatch=!1,this._onMetadataArrived("video",n)}else console.error("FORMAT_ERROR: Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else console.error("FORMAT_ERROR: Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else console.error("FORMAT_ERROR: Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else console.error("FORMAT_ERROR: Flv: Invalid AVCDecoderConfigurationRecord")}}},{key:"_parseAVCVideoData",value:function(e,t,i,n,r,s,a){for(var u=this._littleEndian,l=new DataView(e,t,i),h=[],f=0,d=0,c=this._naluLengthSize,_=this._timestampBase+n,m=1===s,p=!1;d<i;){if(d+4>=i){o.Log.w(this.TAG,"Malformed Nalu near timestamp "+_+", offset = "+d+", dataSize = "+i);break}var v=l.getUint32(d,!u);if(3===c&&(v>>>=8),v>i-c)return void o.Log.w(this.TAG,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var g=31&l.getUint8(d+c);5===g&&(m=!0),6===g&&4==(31&l.getUint8(d+c+1))&&(p=!0);var y=new Uint8Array(e,t+d,c+v);if(p)p=!1;else{var b={type:g,data:y};h.push(b),f+=y.byteLength}d+=c+v}if(h.length){var S={units:h,length:f,isKeyframe:m,dts:_,cts:a,pts:_+a};if(m&&(S.fileposition=r,this._firstIframe||(this._firstIframe=!0)),null===this._stashedVideoSample)return void(this._stashedVideoSample=S);var A=this._stashedVideoSample,w=S.dts-A.dts;w>0&&(A.duration=w),this._firstIframe&&this._onVideoSampleArrived(A),this._stashedVideoSample=S}}},{key:"onMetadataArrived",get:function(){return this._onMetadataArrived},set:function(e){this._onMetadataArrived=e}},{key:"onVideoSampleArrived",get:function(){return this._onVideoSampleArrived},set:function(e){this._onVideoSampleArrived=e}},{key:"onAudioSampleArrived",get:function(){return this._onAudioSampleArrived},set:function(e){this._onAudioSampleArrived=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}}]),e}();i.default=h},{"../../utils/logger":23,"../sps-parser.js":13,"./amf-parser.js":10,events:3}],12:[function(e,t,i){(function(t){"use strict";function n(e,i){return new t(e.buffer,i,4).toString("ascii")}Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("../sps-parser.js")),o=e("../../core/media-info"),u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._trackDetail={},this._currentTrackType=null,this._currentTrackId=0,this._currentTrackSize=0,this._hasVideo=!1,this._hasAudio=!1,this._elst={},this._mdhd={},this._stsc={},this._stsz={},this._stco={},this._stts={},this._metadata=null,this._videoMetadata=null,this._audioMetadata=null,this._timestampBase=0,this._timescale=0,this._duration=0,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._mediaInfo=new o.MediaInfo,this._types={avc1:"avc1",ctts:"ctts",edts:"edts",elst:"elst",esds:"esds",ftyp:"ftyp",mdat:"mdat",mdhd:"mdhd",mdia:"mdia",minf:"minf",mp4a:"mp4a",moof:"moof",moov:"moov",mvhd:"mvhd",stbl:"stbl",stco:"stco",stsc:"stsc",stsd:"stsd",stsz:"stsz",stts:"stts",trak:"trak",tkhd:"tkhd"},this._trackTypes={audio:"audio",video:"video"},this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return s(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._currentTrackType=null,this._onMetadataArrived=null,this._onVideoSampleArrived=null,this._onAudioSampleArrived=null,this._elst=null,this._mdhd=null,this._stsc=null,this._stsz=null,this._stco=null,this._stts=null}},{key:"parseChunks",value:function(e){var t=null,i=0,r=this._littleEndian,s=new DataView(e,i),a=n(s,i+4);if(a===this._types.ftyp){var o=s.getUint32(i,!r);for(this._parseFtyp(e,i,o),i+=o;i<e.byteLength;){var u=s.getUint32(i,!r);switch(a=n(s,i+4)){case this._types.moov:case this._types.mdia:case this._types.minf:case this._types.stbl:i+=8;break;case this._types.trak:this._currentTrackSize=u,i+=8;break;case this._types.mvhd:this._parseMvhd(e,i,u),i+=u;break;case this._types.tkhd:var l=this._parseTkhd(e,i,u);this._currentTrackType=Object.keys(l)[0],this._currentTrackId=Object.values(l)[0],Object.assign(this._trackDetail,l),i+=u;break;case this._types.edts:i+=8,u=s.getUint32(i,!r),(a=n(s,i+4))===this._types.elst&&(this._elst[this._currentTrackId]=this._parseElst(e,i,u)),i+=u;break;case this._types.mdhd:this._parseMdhd(this._currentTrackType,e,i,u),i+=u;break;case this._types.stsd:this._parseStsd(e,i,u),i+=u;break;case this._types.stsc:this._stsc[this._currentTrackId]=this._parseStsc(e,i,u),i+=u;break;case this._types.stsz:this._stsz[this._currentTrackId]=this._parseStsz(e,i,u),i+=u;break;case this._types.stco:this._stco[this._currentTrackId]=this._parseStco(e,i,u),i+=u;break;case this._types.stts:this._stts[this._currentTrackId]=this._parseStts(e,i,u),i+=u;break;case this._types.ctts:t=this._parseCtts(e,i,u),i+=u;break;default:i+=u}}if(this._hasVideo){var h=this._samDetails(this._stsc[this._trackDetail.video],this._stsz[this._trackDetail.video],this._stco[this._trackDetail.video]);this._timeDetials(h,this._videoMetadata.timescale_mdhd,this._timescale,this._stts[this._trackDetail.video],this._elst[this._trackDetail.video],t);for(var f=0;f<h.length;f++)this._onVideoSampleArrived(this._parseAVCVideoData(e,h[f].offset,h[f].size,h[f].dts,h[f].offset,h[f].duration,h[f].cts))}if(this._hasAudio){var d=this._samDetails(this._stsc[this._trackDetail.audio],this._stsz[this._trackDetail.audio],this._stco[this._trackDetail.audio]);this._timeDetials(d,this._audioMetadata.timescale_mdhd,this._timescale,this._stts[this._trackDetail.audio],this._elst[this._trackDetail.audio],null);for(var c=0;c<d.length;c++)this._onAudioSampleArrived(this._parseAACAudioData(e,d[c].offset,d[c].size,d[c].dts,d[c].duration))}}else console.warn("MP4Demuxer: Input file is not mp4 format!")}},{key:"_parseFtyp",value:function(e,t,i){var r=this._littleEndian,s=new DataView(e,t,i),a=8,o={};o.major_brand=n(s,t+a),a+=4,o.minor_version=s.getUint32(a,!r).toString(),a+=4;for(var u=[];a+4<i;)u.push(n(s,t+a)),a+=4;return o.compatible_brands=u,o}},{key:"_parseMvhd",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s=20;this._timescale=r.getUint32(s,!n),s+=4,this._duration=r.getUint32(s,!n),s+=4,this._audioMetadata={},this._audioMetadata.type="audio",this._audioMetadata.timescale=this._timescale,this._audioMetadata.duration=this._duration,this._videoMetadata={},this._videoMetadata.type="video",this._videoMetadata.timescale=this._timescale,this._videoMetadata.duration=this._duration}},{key:"_parseTkhd",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s=8,a=r.getUint8(s);r.getUint32(s,!n);s+=4;var o=0;0===a&&(s+=8,o=r.getUint32(s,!n),s+=4,s+=8),s+=8,s+=4;var u=r.getUint16(s,!n);if(s+=4,256===u)return this._hasAudio=!0,{audio:o};s+=36;var l=r.getUint16(s,!n);s+=4;var h=r.getUint16(s,!n);return s+=4,0!==l&&0!==h?(this._hasVideo=!0,{video:o}):{}}},{key:"_parseElst",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s={},a=8,o=r.getUint8(a);r.getUint32(a,!n);a+=4;var u=r.getUint32(a,!n);a+=4,s.entries=[];for(var l=0;l<u;l++){if(0===o){var h=r.getInt32(a,!n);a+=4;var f=r.getInt32(a,!n);if(a+=4,f<0)this._timestampBase=h;else{var d={};d.segDuration=h,d.mediaTime=f,s.entries.push(d)}}a+=4}return s}},{key:"_parseMdhd",value:function(e,t,i,n){var r=this._littleEndian,s=new DataView(t,i,n),a=8,o=void 0;e===this._trackTypes.audio?o=this._audioMetadata:e===this._trackTypes.video&&(o=this._videoMetadata);var u=s.getUint8(a);s.getUint32(a,!r);a+=4,0===u?(a+=8,o.timescale_mdhd=s.getUint32(a,!r),a+=4,o.duration_mdhd=s.getUint32(a,!r),a+=4):1===u&&(a+=16,a+=4,a+=8),a+=4}},{key:"_parseStsd",value:function(e,t,i){var r=this._littleEndian,s=new DataView(e,t,i),o={},u=8;s.getUint8(u),s.getUint32(u,!r);u+=4;s.getUint32(u,!r);var l=n(s,t+(u+=4)+4);if(l===this._types.mp4a){o.mp4a={};var h=this._audioMetadata;u+=14,o.mp4a.dataRefIndex=s.getUint16(u,!r),u+=10,o.mp4a.channelCount=s.getUint16(u,!r),u+=2,o.mp4a.sampleSize=s.getUint16(u,!r),u+=2,u+=4,o.mp4a.sampleRate=s.getUint16(u,!r),u+=4,o.mp4a.esdsSize=s.getUint32(u,!r),o.mp4a.esdsData=this._parseEsds(e,t+u,o.mp4a.esdsSize);var f=o.mp4a.esdsData;h.audioSampleRate=f.samplingRate,h.channelCount=f.channelCount,h.codec=f.codec,h.originalCodec=f.originalCodec,h.config=f.config,h.refSampleDuration=1024/h.audioSampleRate*h.timescale,h.id=this._trackDetail.audio,this._onMetadataArrived("audio",h)}else{if(l!==this._types.avc1)return void console.warn("MP4Demuxer: Input file's video is not encoded as expect!");var d=this._videoMetadata;o.avc1={},o.avc1.size=s.getUint32(u,!r),u+=14,o.avc1.dataRefIndex=s.getUint16(u,!r),u+=18,o.avc1.width=s.getUint16(u,!r),u+=2,o.avc1.height=s.getUint16(u,!r),u+=14,o.avc1.frameCount=s.getUint16(u,!r),u+=2,u+=32,o.avc1.depth=s.getUint16(u,!r),u+=4;var c={};c.size=s.getUint32(u,!r);var _=new Uint8Array(c.size-8);u+=8,_.set(new Uint8Array(e,t+u,c.size-8),0),console.log("MP4Demuxer: Copied AVCDecoderConfigurationRecord!"),d.avcc=_;var m=s.getUint8(u++),p=s.getUint8(u++);s.getUint8(u++),s.getUint8(u++);if(1!==m||0===p)return;if(this._naluLengthSize=1+(3&s.getUint8(u++)),3!==this._naluLengthSize&&4!==this._naluLengthSize)return;var v=31&s.getUint8(u++);if(0===v)return;v>1&&console.info("MP4Demuxer: MP4: Strange AVCDecoderConfigurationRecord: SPS Count = "+v);for(var g=0;g<v;g++){var y=s.getUint16(u,!r);if(u+=2,0!==y){var b=new Uint8Array(e,t+u,y);u+=y;var S=a.default.parseSPS(b);if(0===g){d.codecWidth=S.codec_size.width,d.codecHeight=S.codec_size.height,d.presentWidth=S.present_size.width,d.presentHeight=S.present_size.height,d.profile=S.profile_string,d.level=S.level_string,d.bitDepth=S.bit_depth,d.chromaFormat=S.chroma_format,d.sarRatio=S.sar_ratio,d.frameRate=S.frame_rate,!1!==S.frame_rate.fixed&&0!==S.frame_rate.fps_num&&0!==S.frame_rate.fps_den||(d.frameRate=this._referenceFrameRate);var A=d.frameRate.fps_den,w=d.frameRate.fps_num;d.refSampleDuration=d.timescale*(A/w);for(var k=b.subarray(1,4),E="avc1.",L=0;L<3;L++){var T=k[L].toString(16);T.length<2&&(T="0"+T),E+=T}d.codec=E}}}var B=s.getUint8(u++);if(0===B)return;B>1&&console.info("MP4Demuxer: MP4: Strange AVCDecoderConfigurationRecord: PPS Count = "+B);for(var C=0;C<B;C++){var O=s.getUint16(u,!r);u+=2,0!==O&&(u+=O)}d.id=this._trackDetail.video,this._onMetadataArrived("video",d)}return o}},{key:"_parseStsc",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s={},a=8;r.getUint8(a),r.getUint32(a,!n);a+=4;var o=r.getUint32(a,!n);s.entryCount=o,a+=4,s.entries=[];for(var u=0;u<o;u++){var l={};l.firstChk=r.getUint32(a,!n),a+=4,l.samPerChk=r.getUint32(a,!n),a+=4,l.samDesIndex=r.getUint32(a,!n),a+=4,s.entries.push(l)}return s}},{key:"_parseStsz",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s={},a=8,o=0;r.getUint8(a),r.getUint32(a,!n);a+=4,s.sampleSize=r.getUint32(a,!n),a+=4;var u=r.getUint32(a,!n);s.sampleCount=u,a+=4,s.samples=[];for(var l=0;l<u;l++){o+=r.getUint32(a,!n),s.samples.push(r.getUint32(a,!n)),a+=4}return s.total=o,s}},{key:"_parseStco",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s={},a=8;r.getUint8(a),r.getUint32(a,!n);a+=4;var o=r.getUint32(a,!n);s.entryCount=o,a+=4,s.entries=[];for(var u=0;u<o;u++)s.entries.push(r.getUint32(a,!n)),a+=4;return s}},{key:"_parseStts",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s={},a=8;r.getUint8(a),r.getUint32(a,!n);a+=4;var o=r.getUint32(a,!n);s.entryCount=o,a+=4,s.entries=[];for(var u=0;u<o;u++){var l={};l.samCount=r.getUint32(a,!n),a+=4,l.samDelta=r.getUint32(a,!n),a+=4,s.entries.push(l)}return s}},{key:"_parseCtts",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s={},a=8;a+=4;var o=r.getUint32(a,!n);s.entryCount=o,a+=4,s.entries=[];for(var u=0;u<o;u++){var l={};l.samCount=r.getUint32(a,!n),a+=4,l.offset=r.getUint32(a,!n),a+=4,s.entries.push(l)}return s}},{key:"_parseEsds",value:function(e,t,i){var n=this._littleEndian,r=new DataView(e,t,i),s=12;if(3===r.getUint8(s)){8421504===(16777215&r.getUint32(s,!n))&&(s+=3),s++;r.getUint8(s++),r.getUint16(s,!n);s+=3;if(4===r.getUint8(s)){8421504===(16777215&r.getUint32(s,!n))&&(s+=3),s++;r.getUint8(s++);var a=r.getUint8(s++);r.getUint8(s),r.getUint32(s,!n);s+=4;r.getUint32(s,!n);s+=4;r.getUint32(s,!n);s+=4;if(5===r.getUint8(s)){8421504===(16777215&r.getUint32(s,!n))&&(s+=3),s++;var o=r.getUint8(s++);if(64===a){var u=new Uint8Array(e,t+s,o),l=null,h=0,f=h=u[0]>>>3,d=(7&u[0])<<1|u[1]>>>7,c=(120&u[1])>>>3,_=null,m=this._mpegSamplingRates[d];return 5===f&&(_=(7&u[1])<<1|u[2]>>>7,(124&u[2])>>>2),f=5,_=d,l=new Array(4),d>=6?_=d-3:1===c&&(f=2,l=new Array(2),_=d),l[0]=f<<3,l[0]|=(15&d)>>>1,l[1]=(15&d)<<7,l[1]|=(15&c)<<3,5===f&&(l[1]|=(15&_)>>>1,l[2]=(1&_)<<7,l[2]|=8,l[3]=0),{config:l,samplingRate:m,channelCount:c,codec:"mp4a.40."+f,originalCodec:"mp4a.40."+h}}return void console.warn("MP4Demuxer: Input file's audio is not encoded as expect!")}console.error("Mp4 decode config description error")}else console.error("Mp4 decode config description error")}else console.error("Mp4 element stream description error")}},{key:"_parseScriptData",value:function(e,t,i,n){var s={};if(s.onMetaData={},s.onMetaData=Object.assign(s.onMetaData,t),null!=s.onMetaData&&"object"===r(s.onMetaData)){this._metadata&&console.warn("MP4Demuxer: Found another onMetaData tag!"),this._metadata=s;var a=this._metadata.onMetaData;"boolean"==typeof a.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=a.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof i.avc1.width&&(a.width=i.avc1.width,this._mediaInfo.width=a.width),"number"==typeof i.avc1.height&&(a.height=i.avc1.height,this._mediaInfo.height=a.height);var o=this._videoMetadata.duration;this._duration=o,a.duration=o/this._timescale,this._mediaInfo.duration=o,a.videocodecid=7,a.filesize=e,a.videodatarate=8*n.total/a.duration/1e3,this._mediaInfo.videoDataRate=a.videodatarate,a.framerate=n.sampleCount*this._timescale/this._duration;var u=Math.floor(1e3*a.framerate);if(u>0){var l=u/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=l,this._referenceFrameRate.fps_num=u,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=l}this._mediaInfo.hasKeyframesIndex=!1,this._dispatch=!1,this._mediaInfo.metadata=a,this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}else console.warn("MP4Demuxer: Invalid onMetaData structure!")}},{key:"_samDetails",value:function(e,t,i){for(var n=i.entryCount,r=new Array(n),s=[],a=0,o=n+1,u=e.entryCount-1;u>=0;u--){for(var l=e.entries[u].firstChk,h=l-1;h<o-1;h++){var f={};f.samCount=e.entries[u].samPerChk,f.sdi=e.entries[u].samDesIndex,r[h]=f}o=l}for(var d=0;d<r.length;d++){r[d].firstSamIndex=a;for(var c=0,_=i.entries[d],m=0;m<r[d].samCount;m++){var p={};p.chkIndex=d,p.indexInChk=c,p.offset=_,p.size=t.samples[a],_+=p.size,s.push(p),a++,c++}}if(a==s.length)return s;console.warn("MP4Demuxer: Map samples to chunk!! Wrong sample count!!")}},{key:"_timeDetials",value:function(e,t,i,n,r,s){for(var a=0,o=null!==r&&void 0!==r?r.entries[0].mediaTime:0,u=0,l=0;l<n.entryCount;l++)for(var h=0;h<n.entries[l].samCount;h++){var f={};f.dts=Math.round(u+n.entries[l].samDelta/t*i*h-o/t*i),h==n.entries[l].samCount-1&&(u+=n.entries[l].samDelta/t*i*(h+1)),f.cts=0,f.duration=n.entries[l].samDelta/t*i,e[a]=Object.assign(e[a],f),a++}if(null!==s)for(var d=0,c=0;c<s.entryCount;c++)for(var _=0;_<s.entries[c].samCount;_++){var m=Math.round(s.entries[c].offset/t*i);e[d].cts=m,d++}}},{key:"_parseAVCVideoData",value:function(e,t,i,n,r,s,a){for(var o=this._littleEndian,u=new DataView(e,t,i),l=!1,h=[],f=0,d=0,c=this._naluLengthSize,_=n+this._timestampBase;d<i;){if(d+4>=i){console.warn("MP4Demuxer: Malformed Nalu near timestamp "+_+", offset = "+d+", dataSize = "+i);break}var m=u.getUint32(d,!o);if(3===c&&(m>>>=8),m>i-c)return void console.warn("MP4Demuxer: Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var p=31&u.getUint8(d+c);5===p&&(l=!0);var v=new Uint8Array(e,t+d,c+m),g={type:p,data:v};h.push(g),f+=v.byteLength,d+=c+m}if(h.length){var y={units:h,length:f,isKeyframe:l,dts:_,cts:a,pts:_+a,duration:s};return l&&(y.fileposition=r),y}}},{key:"_parseAACAudioData",value:function(e,t,i,n,r){var s=new Uint8Array(e,t,i),a={unit:s,dts:n,pts:n,duration:r};return a.length=s.length,a}},{key:"onMetadataArrived",get:function(){return this._onMetadataArrived},set:function(e){this._onMetadataArrived=e}},{key:"onVideoSampleArrived",get:function(){return this._onVideoSampleArrived},set:function(e){this._onVideoSampleArrived=e}},{key:"onAudioSampleArrived",get:function(){return this._onAudioSampleArrived},set:function(e){this._onAudioSampleArrived=e}}]),e}();i.default=u}).call(this,e("buffer").Buffer)},{"../../core/media-info":6,"../sps-parser.js":13,buffer:2}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(e("./exp-golomb.js")),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,n=new Uint8Array(i),r=0,s=0;s<i;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(n[r]=t[s],r++);return new Uint8Array(n.buffer,0,r)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),n=new r.default(i);n.readByte();var s=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var o=e.getProfileString(s),u=e.getLevelString(a),l=1,h=420,f=8;if((100===s||110===s||122===s||244===s||44===s||83===s||86===s||118===s||128===s||138===s||144===s)&&(3===(l=n.readUEG())&&n.readBits(1),l<=3&&(h=[0,420,422,444][l]),f=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var d=3!==l?8:12,c=0;c<d;c++)n.readBool()&&(c<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var _=n.readUEG();if(0===_)n.readUEG();else if(1===_){n.readBits(1),n.readSEG(),n.readSEG();for(var m=n.readUEG(),p=0;p<m;p++)n.readSEG()}n.readUEG(),n.readBits(1);var v=n.readUEG(),g=n.readUEG(),y=n.readBits(1);0===y&&n.readBits(1),n.readBits(1);var b=0,S=0,A=0,w=0;n.readBool()&&(b=n.readUEG(),S=n.readUEG(),A=n.readUEG(),w=n.readUEG());var k=1,E=1,L=0,T=!0,B=0,C=0;if(n.readBool()){if(n.readBool()){var O=n.readByte();O>0&&O<16?(k=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][O-1],E=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][O-1]):255===O&&(k=n.readByte()<<8|n.readByte(),E=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var R=n.readBits(32),M=n.readBits(32);T=n.readBool(),L=(B=M)/(C=2*R)}}var D=1;1===k&&1===E||(D=k/E);var U=0,x=0;if(0===l)U=1,x=2-y;else{U=3===l?1:2,x=(1===l?2:1)*(2-y)}var I=16*(v+1),P=16*(g+1)*(2-y);I-=(b+S)*U,P-=(A+w)*x;var V=Math.ceil(I*D);return n.destroy(),n=null,{profile_string:o,level_string:u,bit_depth:f,chroma_format:h,chroma_format_string:e.getChromaFormatString(h),frame_rate:{fixed:T,fps:L,fps_den:C,fps_num:B},sar_ratio:{width:k,height:E},codec_size:{width:I,height:P},present_size:{width:V,height:P}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,n=8,r=0;r<t;r++)0!==n&&(n=(i+e.readSEG()+256)%256),i=0===n?i:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();i.default=s},{"./exp-golomb.js":9}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(e("../sps-parser.js")),s=e("../../core/media-info"),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._metadata=null,this._videoMetadata=null,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._mediaInfo=new s.MediaInfo,this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return n(e,[{key:"parseChunks",value:function(e){var t=new DataView(e,0),i=this._littleEndian,n=t.getUint32(0,!i);switch(t.getUint16(4,!i)){case 1:this._parseVideoData(e,6,n-6);break;case 2:case 11:this._parseAVCDecoderConfigurationRecord(e,6,n-6)}}},{key:"_parseVideoData",value:function(e,t,i){var n=0,r=this._littleEndian,s=new DataView(e,t,i),a=!1,o=[],u=0,l=this._naluLengthSize,h=s.getUint16(n,!r);n+=2;var f=s.getUint32(n,!r);n+=4;var d=s.getUint32(n,!r);n+=4;var c=s.getUint32(n,!r);n+=4;var _=s.getUint32(n,!r);n+=4;for(var m=0;m<_;m++){var p=s.getUint32(n,!r),v=31&s.getUint8(n+l);5===v&&(a=!0);var g=new Uint8Array(e,t+n,l+p),y={type:v,data:g};o.push(y),u+=g.byteLength,n+=l+p}if(o.length){var b={units:o,length:u,isKeyframe:a,dts:f,cts:d,pts:f+d,duration:h};a&&(b.fileposition=c),this._onVideoSampleArrived(b)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,i){var n=this._littleEndian,s=this._videoMetadata,a=0,o=new DataView(e,t,i);s?s.avcc:(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(s=this._videoMetadata={}).type="video",s.id=1),s.duration=o.getUint32(a,!n),a+=4,s.timescale=o.getUint32(a,!n),a+=4;var u=o.getUint8(a++),l=o.getUint8(a++);o.getUint8(a++),o.getUint8(a++);if(1===u&&0!==l&&(this._naluLengthSize=1+(3&o.getUint8(a++)),3===this._naluLengthSize||4===this._naluLengthSize)){var h=31&o.getUint8(a++);if(0!==h){h>1&&console.info("MP4Demuxer: MP4: Strange AVCDecoderConfigurationRecord: SPS Count = "+h);for(var f=0;f<h;f++){var d=o.getUint16(a,!n);if(a+=2,0!==d){var c=new Uint8Array(e,t+a,d);a+=d;var _=r.default.parseSPS(c);if(0===f){s.codecWidth=_.codec_size.width,s.codecHeight=_.codec_size.height,s.presentWidth=_.present_size.width,s.presentHeight=_.present_size.height,s.profile=_.profile_string,s.level=_.level_string,s.bitDepth=_.bit_depth,s.chromaFormat=_.chroma_format,s.sarRatio=_.sar_ratio,s.frameRate=_.frame_rate,!1!==_.frame_rate.fixed&&0!==_.frame_rate.fps_num&&0!==_.frame_rate.fps_den||(s.frameRate=this._referenceFrameRate);var m=s.frameRate.fps_den,p=s.frameRate.fps_num;s.refSampleDuration=s.timescale*(m/p);for(var v=c.subarray(1,4),g="avc1.",y=0;y<3;y++){var b=v[y].toString(16);b.length<2&&(b="0"+b),g+=b}s.codec=g}}}var S=o.getUint8(a++);if(0!==S){S>1&&console.info("MP4Demuxer: MP4: Strange AVCDecoderConfigurationRecord: PPS Count = "+S);for(var A=0;A<S;A++){var w=o.getUint16(a,!n);a+=2,0!==w&&(a+=w)}s.avcc=new Uint8Array(i-8),s.avcc.set(new Uint8Array(e,t+8,i-8),0),console.log("Parsed AVCDecoderConfigurationRecord"),this._onMetadataArrived("video",s)}}}}},{key:"onMetadataArrived",get:function(){return this._onMetadataArrived},set:function(e){this._onMetadataArrived=e}},{key:"onVideoSampleArrived",get:function(){return this._onVideoSampleArrived},set:function(e){this._onVideoSampleArrived=e}},{key:"onAudioSampleArrived",get:function(){return this._onAudioSampleArrived},set:function(e){this._onAudioSampleArrived=e}}]),e}();i.default=a},{"../../core/media-info":6,"../sps-parser.js":13}],15:[function(e,t,i){"use strict";t.exports=e("./wp.js").default},{"./wp.js":25}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();i.default=r},{}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=e.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,i=null,n=Array.prototype.slice.call(arguments,1),r=n.length,s=0;s<r;s++)t+=n[s].byteLength;(i=new Uint8Array(t))[0]=t>>>24&255,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i.set(e,4);for(var a=8,o=0;o<r;o++)i.set(n[o],a),a+=n[o].byteLength;return i}},{key:"generateInitSegment",value:function(t){var i=e.box(e.types.ftyp,e.constants.FTYP),n=e.moov(t),r=new Uint8Array(i.byteLength+n.byteLength);return r.set(i,0),r.set(n,i.byteLength),r}},{key:"moov",value:function(t){var i=e.mvhd(t.timescale,t.duration),n=e.trak(t),r=e.mvex(t);return e.box(e.types.moov,i,n,r)}},{key:"mvhd",value:function(t,i){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var i=t.id,n=t.duration,r=t.presentWidth,s=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,s>>>8&255,255&s,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var i=t.timescale,n=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))}},{key:"hdlr",value:function(t){var i=null;return i="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,i)}},{key:"minf",value:function(t){var i=null;return i="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,i,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var i=t.channelCount,n=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types[".mp3"],r)}},{key:"mp4a",value:function(t){var i=t.channelCount,n=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types.mp4a,r,e.esds(t))}},{key:"esds",value:function(t){var i=t.config||[],n=i.length,r=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(i).concat([6,1,2]));return e.box(e.types.esds,r)}},{key:"avc1",value:function(t){var i=t.avcc,n=t.codecWidth,r=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,5,116,114,97,99,121,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,s,e.box(e.types.avcC,i))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var i=t.id,n=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)}},{key:"moof",value:function(t,i){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,i))}},{key:"mfhd",value:function(t){var i=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,i)}},{key:"traf",value:function(t,i){var n=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),s=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),a=e.sdtp(t),o=e.trun(t,a.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,s,o,a)}},{key:"sdtp",value:function(t){for(var i=t.samples||[],n=i.length,r=new Uint8Array(4+n),s=0;s<n;s++){var a=i[s].flags;r[s+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return e.box(e.types.sdtp,r)}},{key:"trun",value:function(t,i){var n=t.samples||[],r=n.length,s=12+16*r,a=new Uint8Array(s);i+=8+s,a.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var o=0;o<r;o++){var u=n[o].duration,l=n[o].size,h=n[o].flags,f=n[o].cts;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.isNonSync,0,0,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();r.init(),i.default=r},{}],18:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("../../utils/logger"),a=n(e("./mp4-generator")),o=n(e("./aac-silent")),u=e("../../core/media-info.js"),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="MP4Muxer",this._config=t,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedSample=null,this._videoStashedSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new u.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new u.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap,this._isLive=t.isLive,this._accSlient=t.accSlient}return r(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null,this._audioStashedSample=null,this._videoStashedSample=null}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"mux",value:function(e,t){this._onMediaSegment?(this._dtsBaseInited||this._calculateDtsBase(e,t),0!==t.length&&this._muxVideo(t),0!==e.length&&this._muxAudio(e)):console.error("IllegalStateException: MP4Muxer: onMediaSegment callback must be specificed!")}},{key:"_onMetadataReceived",value:function(e,t){var i=null,n="mp4",r=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec?(n="mpeg",r="",i=new Uint8Array):i=a.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t;var o=new Date,u=o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+":"+o.getMilliseconds();i=a.default.generateInitSegment(t),s.Log.v(this.TAG,"Generate Init Segment at "+u)}this._onInitSegment?this._onInitSegment(e,{type:e,data:i.buffer,codec:r,container:e+"/"+n,mediaDuration:t.duration}):console.error("IllegalStateException: MP4Muxer: onInitSegment callback must be specified!")}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"_muxAudio",value:function(e){if(null!=this._audioMeta){var t=e,i=t.samples,n=-1,r=-1,l=this._audioMeta.refSampleDuration,h="mp3"===this._audioMeta.codec;if(i&&0!==i.length){var f=0,d=null,c=0;h?(f=0,c=t.length):(f=8,c=8+t.length);var _=[],m=i[0],p=m.unit,v=m.dts-this._dtsBase,g=v,y=void 0;y=void 0!==m.duration?m.duration:Math.floor(l),-1===n&&(n=g);var b=!1,S=null;if(this._accSlient&&y>1.5*l&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap){b=!0;var A=Math.abs(y-l),w=Math.ceil(A/l),k=g+l;s.Log.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\ndts: "+(g+y)+" ms, expected: "+(g+Math.round(l))+" ms, delta: "+Math.round(A)+" ms, generate: "+w+" frames");var E=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==E&&(s.Log.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),E=p),S=[];for(var L=0;L<w;L++){var T=Math.round(k);if(S.length>0){var B=S[S.length-1];B.duration=T-B.dts}var C={dts:T,pts:T,cts:0,unit:E,size:E.byteLength,duration:0,originalDts:v,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};S.push(C),c+=E.byteLength,k+=l}var O=S[S.length-1];O.duration=g+y-O.dts,y=Math.round(l)}_.push({dts:g,pts:g,cts:0,unit:m.unit,size:m.unit.byteLength,duration:y,originalDts:v,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),b&&_.push.apply(_,S),h?d=new Uint8Array(c):((d=new Uint8Array(c))[0]=c>>>24&255,d[1]=c>>>16&255,d[2]=c>>>8&255,d[3]=255&c,d.set(a.default.types.mdat,4));for(var R=0;R<_.length;R++){var M=_[R].unit;d.set(M,f),f+=M.byteLength}var D=_[_.length-1];r=D.dts+D.duration;var U=new u.MediaSegmentInfo;U.beginDts=n,U.endDts=r,U.beginPts=n,U.endPts=r,U.originalBeginDts=_[0].originalDts,U.originalEndDts=D.originalDts+D.duration,U.firstSample=new u.SampleInfo(_[0].dts,_[0].pts,_[0].duration,_[0].originalDts,!1),U.lastSample=new u.SampleInfo(D.dts,D.pts,D.duration,D.originalDts,!1),t.samples=_,t.sequenceNumber++;var x=null;x=h?new Uint8Array:a.default.moof(t,n),t.samples=[],t.length=0;var I={type:"audio",data:this._mergeBoxes(x,d).buffer,sampleCount:_.length,info:U};this._onMediaSegment("audio",I)}}}},{key:"_muxVideo",value:function(e){if(null!=this._videoMeta){var t=e,i=t.samples,n=-1,r=-1,s=-1,o=-1,l=8,h=8+e.length;if(i&&0!==i.length){var f=new u.MediaSegmentInfo,d=[],c=i[0],_=c.dts-this._dtsBase,m=c.isKeyframe,p=_,v=c.cts,g=p+v,y=void 0;if(y=void 0!==c.duration?c.duration:1e3,-1===n&&(n=p,s=g),m){var b=new u.SampleInfo(p,g,y,c.dts,!0);b.fileposition=c.fileposition,f.appendSyncPoint(b)}d.push({dts:p,pts:g,cts:v,units:c.units,size:c.length,isKeyframe:m,duration:y,originalDts:_,flags:{isLeading:0,dependsOn:m?2:1,isDependedOn:m?1:0,hasRedundancy:0,isNonSync:m?0:1}});var S=new Uint8Array(h);S[0]=h>>>24&255,S[1]=h>>>16&255,S[2]=h>>>8&255,S[3]=255&h,S.set(a.default.types.mdat,4);for(var A=0;A<d.length;A++)for(var w=d[A].units;w.length;){var k=w.shift().data;S.set(k,l),l+=k.byteLength}var E=d[d.length-1];r=E.dts+E.duration,o=E.pts+E.duration,f.beginDts=n,f.endDts=r,f.beginPts=s,f.endPts=o,f.originalBeginDts=d[0].originalDts,f.originalEndDts=E.originalDts+E.duration,f.firstSample=new u.SampleInfo(d[0].dts,d[0].pts,d[0].duration,d[0].originalDts,d[0].isKeyframe),f.lastSample=new u.SampleInfo(E.dts,E.pts,E.duration,E.originalDts,E.isKeyframe),t.samples=d,t.sequenceNumber++;var L=a.default.moof(t,n);t.samples=[],t.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(L,S).buffer,sampleCount:d.length,info:f})}}}},{key:"_mergeBoxes",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}},{key:"dtsBase",get:function(){return this._dtsBase}}]),e}();i.default=l},{"../../core/media-info.js":6,"../../utils/logger":23,"./aac-silent":16,"./mp4-generator":17}],19:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("../reader.js"),a=n(e("../../demuxer/mp4-demuxer/mp4-demuxer")),o=n(e("../../demuxer/flv-demuxer/flv-demuxer")),u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._files=e,i._fileReader=new FileReader,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Reader),r(t,[{key:"destroy",value:function(){this._fileReader&&(this._fileReader=null),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(){var e=this,i=null,n=this._files,r=this._fileReader,s=this._demuxer;r.onload=function(){var n=r.result;null===s&&((i=t.probeflv(n)).match?s=new o.default(i):(i=t.probemp4(n)).match&&(s=new a.default),s.onMetadataArrived=e._onDemuxMetadataReceived.bind(e),s.onVideoSampleArrived=e._onDemuxVideoSampleReceived.bind(e),s.onAudioSampleArrived=e._onDemuxAudioSampleReceived.bind(e)),s.parseChunks(n,n.byteLength)},r.readAsArrayBuffer(n[0])}}]),t}();i.default=u},{"../../demuxer/flv-demuxer/flv-demuxer":11,"../../demuxer/mp4-demuxer/mp4-demuxer":12,"../reader.js":21}],20:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("../../utils/logger"),s=e("../reader.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(e("../../demuxer/flv-demuxer/flv-demuxer")),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.TAG="HTTPReader",i._mediaElement=e,i._url=null,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i._stashUsed=0,i._stashBufferSize=3145728,i._stashBuffer=new ArrayBuffer(i._stashBufferSize),i._stashByteOffset=0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Reader),n(t,[{key:"destroy",value:function(){this._contentLength=null,this._receivedLength=0,this._stashByteOffset=0,function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),console.warn("HTTP reader was destroyed!")}},{key:"reconnect",value:function(){this.destroy(),this._onReconnect(this._mediaElement),r.Log.w(this.TAG,"Try to reconnect to http."),this.open(this._url)}},{key:"open",value:function(e){var t=this;this._url=e,this._destroyed=!1;var i={method:"GET",headers:new self.Headers,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};this._status=s.LoaderStatus.kConnecting,self.fetch(e,i).then(function(e){if(t._requestAbort)return t._requestAbort=!1,void(t._status=s.LoaderStatus.kIdle);if(e.ok&&e.status>=200&&e.status<=299){var i=e.headers.get("Content-Length");return null!=i&&(t._contentLength=parseInt(i)),t._pump.call(t,e.body.getReader())}t._status=s.LoaderStatus.kError,r.Log.e(t.TAG,"http status code: "+e.status),setTimeout(function(){t.reconnect()},1e3)}).catch(function(e){t._status=s.LoaderStatus.kError,r.Log.e(t.TAG,"Loader error: "+e.message),setTimeout(function(){t.reconnect()},1e3)})}},{key:"_pump",value:function(e){var t=this;return e.read().then(function(i){if(i.done)t._status=s.LoaderStatus.kComplete;else{if(!0===t._requestAbort)return t._requestAbort=!1,t._status=s.LoaderStatus.kComplete,e.cancel();t._status=s.LoaderStatus.kBuffering;var n=i.value.buffer;t._receivedLength+=n.byteLength,t._handleArrayBuffer(n),t._pump(e)}}).catch(function(e){t._status=s.LoaderStatus.kError;19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(s.LoaderErrors.EXCEPTION,{code:e.code,msg:e.message},r.Log.w(t.TAG,e.code+": "+e.message)):(s.LoaderErrors.EARLY_EOF,{code:e.code,msg:"Fetch stream meet Early-EOF"},r.Log.w(t.TAG,e.code+": "+e.message)),setTimeout(function(){t.reconnect()},1e3)})}},{key:"_handleArrayBuffer",value:function(e){if(!this._destroyed){var i=null,n=new Uint8Array(this._stashBuffer,0,this._stashBufferSize);n.set(new Uint8Array(e),this._stashByteOffset),this._stashByteOffset+=e.byteLength,null===this._demuxer&&this._stashByteOffset>9&&(i=t.probeflv(e)).match&&(this._demuxer=new a.default(i),this._demuxer.onMetadataArrived=this._onDemuxMetadataReceived.bind(this),this._demuxer.onVideoSampleArrived=this._onDemuxVideoSampleReceived.bind(this),this._demuxer.onAudioSampleArrived=this._onDemuxAudioSampleReceived.bind(this));var r=this._demuxer.parseChunks(this._stashBuffer.slice(0,this._stashByteOffset),this._stashByteOffset);if(r>0){var s=new Uint8Array(this._stashBuffer,r,this._stashByteOffset-r);n.set(s,0),this._stashByteOffset-=r}}}},{key:"onReconnect",get:function(){return this._onReconnect},set:function(e){this._onReconnect=e}}]),t}();i.default=o}).call(this,e("buffer").Buffer)},{"../../demuxer/flv-demuxer/flv-demuxer":11,"../../utils/logger":23,"../reader.js":21,buffer:2}],21:[function(e,t,i){"use strict";function n(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};i.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},i.Reader=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._demuxer=null,this._onMetadataArrived=null,this._onVideoSampleArrived=null,this._onAudioSampleArrived=null,this._status=s.kIdle,this._destroyed=!1}return r(e,[{key:"destroy",value:function(){this._destroyed=!0,this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._status=s.kIdle}},{key:"isWorking",value:function(){return this._status===s.kConnecting||this._status===s.kBuffering}},{key:"_onDemuxMetadataReceived",value:function(e,t){null!==this._onMetadataArrived&&this._onMetadataArrived(e,t)}},{key:"_onDemuxVideoSampleReceived",value:function(e){null!==this._onVideoSampleArrived&&this._onVideoSampleArrived(e)}},{key:"_onDemuxAudioSampleReceived",value:function(e){null!==this._onAudioSampleArrived&&this._onAudioSampleArrived(e)}},{key:"open",value:function(){}},{key:"onMetadataArrived",get:function(){return this._onMetadataArrived},set:function(e){this._onMetadataArrived=e}},{key:"onVideoSampleArrived",get:function(){return this._onVideoSampleArrived},set:function(e){this._onVideoSampleArrived=e}},{key:"onAudioSampleArrived",get:function(){return this._onAudioSampleArrived},set:function(e){this._onAudioSampleArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}}],[{key:"probeflv",value:function(e){var t=new Uint8Array(e);if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return console.warn("The file is not invalid flv."),{match:!1};var i=(4&t[4])>>>2!=0,r=0!=(1&t[4]),s=n(t,5);return s<9?(console.warn("The file is not invalid flv."),{match:!1}):{match:!0,dataOffset:s,hasAudioTrack:i,hasVideoTrack:r}}},{key:"probemp4",value:function(e){var t=new Uint8Array(e),i=n(t,0);if(102!==t[4]||116!==t[5]||121!==t[6]||112!==t[7])return console.warn("The file is not invalid mp4."),{match:!1};var r=i+n(t,i),s=n(t,r);return{match:!0,dataOffset:r,rawDataSize:s,infoOffset:r+s}}}]),e}()},{}],22:[function(e,t,i){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=(n(e("../../utils/logger")),e("../reader.js")),a=(n(e("../../demuxer/ws-demuxer/ws-demuxer")),n(e("../../demuxer/flv-demuxer/flv-demuxer"))),o=n(e("../../utils/timer")),u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._mediaElement=e,i._url=null,i._protocols=null,i._wsClient=null,i._stashBufferSize=3145728,i._stashBuffer=new ArrayBuffer(i._stashBufferSize),i._stashByteOffset=0,i._onReconnect=null,i._destroyWS=!1,i._timer=null,i._wsOpen=!1,i._getMessage=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Reader),r(t,[{key:"destroy",value:function(){this._destroyWS=!0,this._wsClient&&(this._wsClient.close(),this._wsClient=null,this._status=s.LoaderStatus.kComplete),this._stashByteOffset=0,function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),console.warn("WebSocket Client was destroyed!")}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(this._getMessage||(this._getMessage=!0),e.data instanceof ArrayBuffer)this._handleArrayBuffer(e.data);else if(e.data instanceof Blob){var i=new FileReader;i.onload=function(){t._handleArrayBuffer(i.result)},i.readAsArrayBuffer(e.data)}}},{key:"open",value:function(e,t){this._url=e,this._protocols=t,this._destroyWS=!1,this._getMessage=!1;var i=Date.now();this._timer=new o.default(6e4,1),this._timer.timeup=this._timeOut.bind(this),this._timer.start(i);try{console.log(e.slice(-4),"attemp to open");var n=this._wsClient=new WebSocket(e,t);console.log(e.slice(-4),"have new ws"),n.binaryType="arraybuffer",n.onopen=this._onWebSocketOpen.bind(this),n.onmessage=this._onWebSocketMessage.bind(this),n.onclose=this._onWebSocketClose.bind(this),n.onerror=this._onWebSocketError.bind(this),this._status=s.LoaderStatus.kConnecting}catch(e){this._status=s.LoaderStatus.kError;e.code,e.message}}},{key:"reconnect",value:function(){this._onReconnect(this._mediaElement),this._wsOpen=!1,console.warn("Websocket Client try to connect again."),this.open(this._url,this._protocols)}},{key:"_onWebSocketOpen",value:function(e){this._wsOpen=!0,this._status=s.LoaderStatus.kBuffering,console.log("WSReader: WebSocket connected.")}},{key:"_onWebSocketClose",value:function(e){var t=this;this._status=s.LoaderStatus.kComplete,console.warn(e.code+" "+e.reason),console.log("WSReader: WebSocket close."),this._destroyWS||(this.destroy(),console.warn("WebSocket was closed, WebSocket will reconnect later."),setTimeout(function(){t.reconnect()},5e3))}},{key:"_onWebSocketError",value:function(e){this._status=s.LoaderStatus.kError;e.code,e.message;console.error("WSReader: "+e.code+": "+e.message)}},{key:"_handleArrayBuffer",value:function(e){if(!this._destroyed){var i=null,n=new Uint8Array(this._stashBuffer,0,this._stashBufferSize);n.set(new Uint8Array(e),this._stashByteOffset),this._stashByteOffset+=e.byteLength,null===this._demuxer&&this._stashByteOffset>9&&(i=t.probeflv(e)).match&&(this._demuxer=new a.default(i),this._demuxer.onMetadataArrived=this._onDemuxMetadataReceived.bind(this),this._demuxer.onVideoSampleArrived=this._onDemuxVideoSampleReceived.bind(this),this._demuxer.onAudioSampleArrived=this._onDemuxAudioSampleReceived.bind(this));var r=this._demuxer.parseChunks(this._stashBuffer.slice(0,this._stashByteOffset),this._stashByteOffset);if(r>0){var s=new Uint8Array(this._stashBuffer,r,this._stashByteOffset-r);n.set(s,0),this._stashByteOffset-=r}}}},{key:"_timeOut",value:function(){this._wsOpen&&this._getMessage||this._destroyWS||(console.warn("Haven't got any data, WebSocket will reconnect."),this.destroy(),this.reconnect())}},{key:"onReconnect",get:function(){return this._onReconnect},set:function(e){this._onReconnect=e}},{key:"WSDestroy",get:function(){return this._destroyWS},set:function(e){this._destroyWS=e}}]),t}();i.default=u}).call(this,e("buffer").Buffer)},{"../../demuxer/flv-demuxer/flv-demuxer":11,"../../demuxer/ws-demuxer/ws-demuxer":14,"../../utils/logger":23,"../../utils/timer":24,"../reader.js":21,buffer:2}],23:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.LoggingControl=i.Log=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(e){return e&&e.__esModule?e:{default:e}}(e("events")),a=i.Log=function(){function e(){n(this,e)}return r(e,null,[{key:"e",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",n),e.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))}},{key:"i",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",n),e.ENABLE_INFO&&(console.info?console.info(n):console.log(n))}},{key:"w",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",n),e.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))}},{key:"d",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",n),e.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))}},{key:"v",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",n),e.ENABLE_VERBOSE&&console.log(n)}}]),e}();a.GLOBAL_TAG="flv.js",a.FORCE_GLOBAL_TAG=!1,a.ENABLE_ERROR=!0,a.ENABLE_INFO=!0,a.ENABLE_WARN=!0,a.ENABLE_DEBUG=!0,a.ENABLE_VERBOSE=!0,a.ENABLE_CALLBACK=!1,a.emitter=new s.default;(i.LoggingControl=function(){function e(){n(this,e)}return r(e,null,[{key:"getConfig",value:function(){return{globalTag:a.GLOBAL_TAG,forceGlobalTag:a.FORCE_GLOBAL_TAG,enableVerbose:a.ENABLE_VERBOSE,enableDebug:a.ENABLE_DEBUG,enableInfo:a.ENABLE_INFO,enableWarn:a.ENABLE_WARN,enableError:a.ENABLE_ERROR,enableCallback:a.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){a.GLOBAL_TAG=e.globalTag,a.FORCE_GLOBAL_TAG=e.forceGlobalTag,a.ENABLE_VERBOSE=e.enableVerbose,a.ENABLE_DEBUG=e.enableDebug,a.ENABLE_INFO=e.enableInfo,a.ENABLE_WARN=e.enableWarn,a.ENABLE_ERROR=e.enableError,a.ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var t=e.emitter;if(t.listenerCount("change")>0){var i=e.getConfig();t.emit("change",i)}}},{key:"registerListener",value:function(t){e.emitter.addListener("change",t)}},{key:"removeListener",value:function(t){e.emitter.removeListener("change",t)}},{key:"addLogListener",value:function(t){a.emitter.addListener("log",t),a.emitter.listenerCount("log")>0&&(a.ENABLE_CALLBACK=!0,e._notifyChange())}},{key:"removeLogListener",value:function(t){a.emitter.removeListener("log",t),0===a.emitter.listenerCount("log")&&(a.ENABLE_CALLBACK=!1,e._notifyChange())}},{key:"forceGlobalTag",get:function(){return a.FORCE_GLOBAL_TAG},set:function(t){a.FORCE_GLOBAL_TAG=t,e._notifyChange()}},{key:"globalTag",get:function(){return a.GLOBAL_TAG},set:function(t){a.GLOBAL_TAG=t,e._notifyChange()}},{key:"enableAll",get:function(){return a.ENABLE_VERBOSE&&a.ENABLE_DEBUG&&a.ENABLE_INFO&&a.ENABLE_WARN&&a.ENABLE_ERROR},set:function(t){a.ENABLE_VERBOSE=t,a.ENABLE_DEBUG=t,a.ENABLE_INFO=t,a.ENABLE_WARN=t,a.ENABLE_ERROR=t,e._notifyChange()}},{key:"enableDebug",get:function(){return a.ENABLE_DEBUG},set:function(t){a.ENABLE_DEBUG=t,e._notifyChange()}},{key:"enableVerbose",get:function(){return a.ENABLE_VERBOSE},set:function(t){a.ENABLE_VERBOSE=t,e._notifyChange()}},{key:"enableInfo",get:function(){return a.ENABLE_INFO},set:function(t){a.ENABLE_INFO=t,e._notifyChange()}},{key:"enableWarn",get:function(){return a.ENABLE_WARN},set:function(t){a.ENABLE_WARN=t,e._notifyChange()}},{key:"enableError",get:function(){return a.ENABLE_ERROR},set:function(t){a.ENABLE_ERROR=t,e._notifyChange()}}]),e}()).emitter=new s.default},{events:3}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=(function(e){e&&e.__esModule}(e("events")),e("./logger"),function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Timer",this._delay=t-5,this._expected=0,this._timeout=0,this._interval=i,this._timeup=null}return n(e,[{key:"start",value:function(e){this._expected=e+this._interval,this._timeout=setTimeout(this.step.bind(this),this._interval)}},{key:"stop",value:function(){clearTimeout(this._timeout)}},{key:"step",value:function(){var e=Date.now()-this._expected;this._interval;e>0&&(this._delay-=e,this._expected+=e,this._interval-e>0&&this._interval),this._expected+=this._interval,this._delay-=this._interval,this._delay<=0?(this._delay,this._timeup()):this._timeout=setTimeout(this.step.bind(this),this._interval)}},{key:"timeup",get:function(){return this._timeup},set:function(e){this._timeup=e}}]),e}());i.default=r},{"./logger":23,events:3}],25:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r=n(e("./core/webplayer")),s=n(e("./reader/filereader/freader")),a=n(e("./reader/wsreader/wsreader")),o=n(e("./reader/httpreader/httpreader")),u=e("./utils/logger"),l={};l.createPlayer=function(e){return new r.default(e)},l.createReader=function(e){return new s.default(e)},l.createWSReader=function(e){return new a.default(e)},l.createHTTPReader=function(e){return new o.default(e)},l.LoggingControl=u.LoggingControl,Object.defineProperty(l,"version",{enumerable:!0,get:function(){return"1.0.0"}}),i.default=l},{"./core/webplayer":8,"./reader/filereader/freader":19,"./reader/httpreader/httpreader":20,"./reader/wsreader/wsreader":22,"./utils/logger":23}]},{},[15])(15)});
//# sourceMappingURL=wp.min.js.map
